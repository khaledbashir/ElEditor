{"version":3,"file":"bound.js","sourceRoot":"","sources":["../../src/utils/bound.ts"],"names":[],"mappings":"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","sourcesContent":["import { Bound, type IBound, type IVec, Vec } from './model/index.js';\n\nfunction getExpandedBound(a: IBound, b: IBound): IBound {\n  const minX = Math.min(a.x, b.x);\n  const minY = Math.min(a.y, b.y);\n  const maxX = Math.max(a.x + a.w, b.x + b.w);\n  const maxY = Math.max(a.y + a.h, b.y + b.h);\n  const width = Math.abs(maxX - minX);\n  const height = Math.abs(maxY - minY);\n\n  return {\n    x: minX,\n    y: minY,\n    w: width,\n    h: height,\n  };\n}\n\nexport function getPointsFromBoundWithRotation(\n  bounds: IBound,\n  getPoints: (bounds: IBound) => IVec[] = ({ x, y, w, h }: IBound) => [\n    // left-top\n    [x, y],\n    // right-top\n    [x + w, y],\n    // right-bottom\n    [x + w, y + h],\n    // left-bottom\n    [x, y + h],\n  ],\n  resPadding: [number, number] = [0, 0]\n): IVec[] {\n  const { rotate } = bounds;\n  let points = getPoints({\n    x: bounds.x - resPadding[1],\n    y: bounds.y - resPadding[0],\n    w: bounds.w + resPadding[1] * 2,\n    h: bounds.h + resPadding[0] * 2,\n  });\n\n  if (rotate) {\n    const { x, y, w, h } = bounds;\n    const cx = x + w / 2;\n    const cy = y + h / 2;\n\n    const m = new DOMMatrix()\n      .translateSelf(cx, cy)\n      .rotateSelf(rotate)\n      .translateSelf(-cx, -cy);\n\n    points = points.map(point => {\n      const { x, y } = new DOMPoint(...point).matrixTransform(m);\n      return [x, y];\n    });\n  }\n\n  return points;\n}\n\nexport function getQuadBoundWithRotation(bounds: IBound): DOMRect {\n  const { x, y, w, h, rotate } = bounds;\n  const rect = new DOMRect(x, y, w, h);\n\n  if (!rotate) return rect;\n\n  return new DOMQuad(\n    ...getPointsFromBoundWithRotation(bounds).map(\n      point => new DOMPoint(...point)\n    )\n  ).getBounds();\n}\n\nexport function getBoundWithRotation(bound: IBound): IBound {\n  const { x, y, width: w, height: h } = getQuadBoundWithRotation(bound);\n  return { x, y, w, h };\n}\n\n/**\n * Returns the common bound of the given bounds.\n * The rotation of the bounds is not considered.\n * @param bounds\n * @returns\n */\nexport function getCommonBound(bounds: IBound[]): Bound | null {\n  if (!bounds.length) {\n    return null;\n  }\n\n  if (bounds.length === 1) {\n    const { x, y, w, h } = bounds[0];\n    return new Bound(x, y, w, h);\n  }\n\n  let result = bounds[0];\n\n  for (let i = 1; i < bounds.length; i++) {\n    result = getExpandedBound(result, bounds[i]);\n  }\n\n  return new Bound(result.x, result.y, result.w, result.h);\n}\n\n/**\n * Like `getCommonBound`, but considers the rotation of the bounds.\n * @returns\n */\nexport function getCommonBoundWithRotation(bounds: IBound[]): Bound {\n  if (bounds.length === 0) {\n    return new Bound(0, 0, 0, 0);\n  }\n\n  return bounds.reduce(\n    (pre, bound) => {\n      return pre.unite(\n        bound instanceof Bound ? bound : Bound.from(getBoundWithRotation(bound))\n      );\n    },\n    Bound.from(getBoundWithRotation(bounds[0]))\n  );\n}\n\nexport function getIBoundFromPoints(\n  points: IVec[],\n  rotation = 0\n): IBound & {\n  maxX: number;\n  maxY: number;\n  minX: number;\n  minY: number;\n} {\n  let minX = Infinity;\n  let minY = Infinity;\n  let maxX = -Infinity;\n  let maxY = -Infinity;\n\n  if (points.length < 1) {\n    minX = 0;\n    minY = 0;\n    maxX = 1;\n    maxY = 1;\n  } else {\n    for (const [x, y] of points) {\n      minX = Math.min(x, minX);\n      minY = Math.min(y, minY);\n      maxX = Math.max(x, maxX);\n      maxY = Math.max(y, maxY);\n    }\n  }\n\n  if (rotation !== 0) {\n    return getIBoundFromPoints(\n      points.map(pt =>\n        Vec.rotWith(pt, [(minX + maxX) / 2, (minY + maxY) / 2], rotation)\n      )\n    );\n  }\n\n  return {\n    minX,\n    minY,\n    maxX,\n    maxY,\n    x: minX,\n    y: minY,\n    w: maxX - minX,\n    h: maxY - minY,\n  };\n}\n\nexport function getBoundFromPoints(points: IVec[]) {\n  return Bound.from(getIBoundFromPoints(points));\n}\n\nexport function inflateBound(bound: IBound, delta: number) {\n  const half = delta / 2;\n\n  const newBound = new Bound(\n    bound.x - half,\n    bound.y - half,\n    bound.w + delta,\n    bound.h + delta\n  );\n\n  if (newBound.w <= 0 || newBound.h <= 0) {\n    throw new Error('Invalid delta range or bound size.');\n  }\n\n  return newBound;\n}\n\nexport function transformPointsToNewBound<T extends { x: number; y: number }>(\n  points: T[],\n  oldBound: IBound,\n  oldMargin: number,\n  newBound: IBound,\n  newMargin: number\n) {\n  const wholeOldMargin = oldMargin * 2;\n  const wholeNewMargin = newMargin * 2;\n  const oldW = Math.max(oldBound.w - wholeOldMargin, 1);\n  const oldH = Math.max(oldBound.h - wholeOldMargin, 1);\n  const newW = Math.max(newBound.w - wholeNewMargin, 1);\n  const newH = Math.max(newBound.h - wholeNewMargin, 1);\n\n  const transformedPoints = points.map(p => {\n    return {\n      ...p,\n      x: newW * ((p.x - oldMargin) / oldW) + newMargin,\n      y: newH * ((p.y - oldMargin) / oldH) + newMargin,\n    } as T;\n  });\n\n  return {\n    points: transformedPoints,\n    bound: new Bound(\n      newBound.x,\n      newBound.y,\n      newW + wholeNewMargin,\n      newH + wholeNewMargin\n    ),\n  };\n}\n"]}