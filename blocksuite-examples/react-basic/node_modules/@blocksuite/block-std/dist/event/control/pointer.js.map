{"version":3,"file":"pointer.js","sourceRoot":"","sources":["../../../src/event/control/pointer.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_IPAD } from '@blocksuite/global/env';\nimport { nextTick, Vec } from '@blocksuite/global/utils';\n\nimport type { UIEventDispatcher } from '../dispatcher.js';\n\nimport { UIEventState, UIEventStateContext } from '../base.js';\nimport {\n  DndEventState,\n  MultiPointerEventState,\n  PointerEventState,\n} from '../state/index.js';\nimport { EventScopeSourceType, EventSourceState } from '../state/source.js';\nimport { isFarEnough } from '../utils.js';\n\ntype PointerId = typeof PointerEvent.prototype.pointerId;\n\nfunction createContext(\n  event: Event,\n  state: PointerEventState | MultiPointerEventState\n) {\n  return UIEventStateContext.from(\n    new UIEventState(event),\n    new EventSourceState({\n      event,\n      sourceType: EventScopeSourceType.Target,\n    }),\n    state\n  );\n}\n\nconst POLL_INTERVAL = 1000;\n\nabstract class PointerControllerBase {\n  constructor(\n    protected _dispatcher: UIEventDispatcher,\n    protected _getRect: () => DOMRect\n  ) {}\n\n  abstract listen(): void;\n}\n\nclass PointerEventForward extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const pointerState = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    this._startStates.set(pointerId, pointerState);\n    this._lastStates.set(pointerId, pointerState);\n    this._dispatcher.run('pointerDown', createContext(event, pointerState));\n  };\n\n  private _lastStates = new Map<PointerId, PointerEventState>();\n\n  private _move = (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const start = this._startStates.get(pointerId) ?? null;\n    const last = this._lastStates.get(pointerId) ?? null;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: start?.x ?? -Infinity,\n      startY: start?.y ?? -Infinity,\n      last,\n    });\n    this._lastStates.set(pointerId, state);\n\n    this._dispatcher.run('pointerMove', createContext(event, state));\n  };\n\n  private _startStates = new Map<PointerId, PointerEventState>();\n\n  private _upOrOut = (up: boolean) => (event: PointerEvent) => {\n    const { pointerId } = event;\n\n    const start = this._startStates.get(pointerId) ?? null;\n    const last = this._lastStates.get(pointerId) ?? null;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: start?.x ?? -Infinity,\n      startY: start?.y ?? -Infinity,\n      last,\n    });\n\n    this._startStates.delete(pointerId);\n    this._lastStates.delete(pointerId);\n\n    this._dispatcher.run(\n      up ? 'pointerUp' : 'pointerOut',\n      createContext(event, state)\n    );\n  };\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointermove', this._move);\n    disposables.addFromEvent(host, 'pointerup', this._upOrOut(true));\n    disposables.addFromEvent(host, 'pointerout', this._upOrOut(false));\n  }\n}\n\nclass ClickController extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    // disable for secondary pointer\n    if (event.isPrimary === false) return;\n\n    if (\n      this._downPointerState &&\n      event.pointerId === this._downPointerState.raw.pointerId &&\n      event.timeStamp - this._downPointerState.raw.timeStamp < 500 &&\n      !isFarEnough(event, this._downPointerState.raw)\n    ) {\n      this._pointerDownCount++;\n    } else {\n      this._pointerDownCount = 1;\n    }\n\n    this._downPointerState = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n  };\n\n  private _downPointerState: PointerEventState | null = null;\n\n  private _pointerDownCount = 0;\n\n  private _up = (event: PointerEvent) => {\n    if (!this._downPointerState) return;\n\n    if (isFarEnough(this._downPointerState.raw, event)) {\n      this._pointerDownCount = 0;\n      this._downPointerState = null;\n      return;\n    }\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    const context = createContext(event, state);\n\n    const run = () => {\n      this._dispatcher.run('click', context);\n      if (this._pointerDownCount === 2) {\n        this._dispatcher.run('doubleClick', context);\n      }\n      if (this._pointerDownCount === 3) {\n        this._dispatcher.run('tripleClick', context);\n      }\n    };\n\n    run();\n  };\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointerup', this._up);\n  }\n}\n\nclass DragController extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    if (this._nativeDragging) return;\n\n    if (!event.isPrimary) {\n      if (this._dragging && this._lastPointerState) {\n        this._up(this._lastPointerState.raw);\n      }\n      this._reset();\n      return;\n    }\n\n    const pointerState = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n    this._startPointerState = pointerState;\n\n    this._dispatcher.disposables.addFromEvent(\n      document,\n      'pointermove',\n      this._move\n    );\n    this._dispatcher.disposables.addFromEvent(document, 'pointerup', this._up);\n  };\n\n  private _dragging = false;\n\n  private _lastPointerState: PointerEventState | null = null;\n\n  private _move = (event: PointerEvent) => {\n    if (\n      this._startPointerState === null ||\n      this._startPointerState.raw.pointerId !== event.pointerId\n    )\n      return;\n\n    const start = this._startPointerState;\n    const last = this._lastPointerState ?? start;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: start.x,\n      startY: start.y,\n      last,\n    });\n\n    this._lastPointerState = state;\n\n    if (\n      !this._nativeDragging &&\n      !this._dragging &&\n      isFarEnough(event, this._startPointerState.raw)\n    ) {\n      this._dragging = true;\n      this._dispatcher.run('dragStart', createContext(event, start));\n    }\n\n    if (this._dragging) {\n      this._dispatcher.run('dragMove', createContext(event, state));\n    }\n  };\n\n  private _nativeDragEnd = (event: DragEvent) => {\n    this._nativeDragging = false;\n    const dndEventState = new DndEventState({ event });\n    this._dispatcher.run(\n      'nativeDragEnd',\n      this._createContext(event, dndEventState)\n    );\n  };\n\n  private _nativeDragging = false;\n\n  private _nativeDragMove = (event: DragEvent) => {\n    const dndEventState = new DndEventState({ event });\n    this._dispatcher.run(\n      'nativeDragMove',\n      this._createContext(event, dndEventState)\n    );\n  };\n\n  private _nativeDragStart = (event: DragEvent) => {\n    this._reset();\n    this._nativeDragging = true;\n    const dndEventState = new DndEventState({ event });\n    this._dispatcher.run(\n      'nativeDragStart',\n      this._createContext(event, dndEventState)\n    );\n  };\n\n  private _nativeDrop = (event: DragEvent) => {\n    this._reset();\n    this._nativeDragging = false;\n    const dndEventState = new DndEventState({ event });\n    this._dispatcher.run(\n      'nativeDrop',\n      this._createContext(event, dndEventState)\n    );\n  };\n\n  private _reset = () => {\n    this._dragging = false;\n    this._startPointerState = null;\n    this._lastPointerState = null;\n\n    document.removeEventListener('pointermove', this._move);\n    document.removeEventListener('pointerup', this._up);\n  };\n\n  private _startPointerState: PointerEventState | null = null;\n\n  private _up = (event: PointerEvent) => {\n    if (\n      !this._startPointerState ||\n      this._startPointerState.raw.pointerId !== event.pointerId\n    )\n      return;\n\n    const start = this._startPointerState;\n    const last = this._lastPointerState;\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: start.x,\n      startY: start.y,\n      last,\n    });\n\n    if (this._dragging) {\n      this._dispatcher.run('dragEnd', createContext(event, state));\n    }\n\n    this._reset();\n  };\n\n  // https://mikepk.com/2020/10/iOS-safari-scribble-bug/\n  private _applyScribblePatch() {\n    if (!IS_IPAD) return;\n\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'touchmove', (event: TouchEvent) => {\n      if (\n        this._dragging &&\n        this._startPointerState &&\n        this._startPointerState.raw.pointerType === 'pen'\n      ) {\n        event.preventDefault();\n      }\n    });\n  }\n\n  private _createContext(event: Event, dndState: DndEventState) {\n    return UIEventStateContext.from(\n      new UIEventState(event),\n      new EventSourceState({\n        event,\n        sourceType: EventScopeSourceType.Target,\n      }),\n      dndState\n    );\n  }\n\n  listen() {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    this._applyScribblePatch();\n\n    disposables.addFromEvent(host, 'dragstart', this._nativeDragStart);\n    disposables.addFromEvent(host, 'dragend', this._nativeDragEnd);\n    disposables.addFromEvent(host, 'drag', this._nativeDragMove);\n    disposables.addFromEvent(host, 'drop', this._nativeDrop);\n  }\n}\n\nabstract class DualDragControllerBase extends PointerControllerBase {\n  private _down = (event: PointerEvent) => {\n    // Another pointer down\n    if (\n      this._startPointerStates.primary !== null &&\n      this._startPointerStates.secondary !== null\n    ) {\n      this._reset();\n    }\n\n    if (this._startPointerStates.primary === null && !event.isPrimary) {\n      return;\n    }\n\n    const state = new PointerEventState({\n      event,\n      rect: this._getRect(),\n      startX: -Infinity,\n      startY: -Infinity,\n      last: null,\n    });\n\n    if (event.isPrimary) {\n      this._startPointerStates.primary = state;\n    } else {\n      this._startPointerStates.secondary = state;\n    }\n  };\n\n  private _lastPointerStates: {\n    primary: PointerEventState | null;\n    secondary: PointerEventState | null;\n  } = {\n    primary: null,\n    secondary: null,\n  };\n\n  private _move = (event: PointerEvent) => {\n    if (\n      this._startPointerStates.primary === null ||\n      this._startPointerStates.secondary === null\n    ) {\n      return;\n    }\n\n    const { isPrimary } = event;\n    const startPrimaryState = this._startPointerStates.primary;\n    let lastPrimaryState = this._lastPointerStates.primary;\n\n    const startSecondaryState = this._startPointerStates.secondary;\n    let lastSecondaryState = this._lastPointerStates.secondary;\n\n    if (isPrimary) {\n      lastPrimaryState = new PointerEventState({\n        event,\n        rect: this._getRect(),\n        startX: startPrimaryState.x,\n        startY: startPrimaryState.y,\n        last: lastPrimaryState,\n      });\n    } else {\n      lastSecondaryState = new PointerEventState({\n        event,\n        rect: this._getRect(),\n        startX: startSecondaryState.x,\n        startY: startSecondaryState.y,\n        last: lastSecondaryState,\n      });\n    }\n\n    const multiPointerState = new MultiPointerEventState(event, [\n      lastPrimaryState ?? startPrimaryState,\n      lastSecondaryState ?? startSecondaryState,\n    ]);\n\n    this._handleMove(event, multiPointerState);\n\n    this._lastPointerStates = {\n      primary: lastPrimaryState,\n      secondary: lastSecondaryState,\n    };\n  };\n\n  private _reset = () => {\n    this._startPointerStates = {\n      primary: null,\n      secondary: null,\n    };\n    this._lastPointerStates = {\n      primary: null,\n      secondary: null,\n    };\n  };\n\n  private _startPointerStates: {\n    primary: PointerEventState | null;\n    secondary: PointerEventState | null;\n  } = {\n    primary: null,\n    secondary: null,\n  };\n\n  private _upOrOut = (event: PointerEvent) => {\n    const { pointerId } = event;\n    if (\n      pointerId === this._startPointerStates.primary?.raw.pointerId ||\n      pointerId === this._startPointerStates.secondary?.raw.pointerId\n    ) {\n      this._reset();\n    }\n  };\n\n  abstract _handleMove(\n    event: PointerEvent,\n    state: MultiPointerEventState\n  ): void;\n\n  override listen(): void {\n    const { host, disposables } = this._dispatcher;\n    disposables.addFromEvent(host, 'pointerdown', this._down);\n    disposables.addFromEvent(host, 'pointermove', this._move);\n    disposables.addFromEvent(host, 'pointerup', this._upOrOut);\n    disposables.addFromEvent(host, 'pointerout', this._upOrOut);\n  }\n}\n\nclass PinchController extends DualDragControllerBase {\n  override _handleMove(event: PointerEvent, state: MultiPointerEventState) {\n    if (event.pointerType !== 'touch') return;\n\n    const deltaFirstPointer = state.pointers[0].delta;\n    const deltaSecondPointer = state.pointers[1].delta;\n\n    const deltaFirstPointerVec = Vec.toVec(deltaFirstPointer);\n    const deltaSecondPointerVec = Vec.toVec(deltaSecondPointer);\n\n    const deltaFirstPointerValue = Vec.len(deltaFirstPointerVec);\n    const deltaSecondPointerValue = Vec.len(deltaSecondPointerVec);\n\n    const deltaDotProduct = Vec.dpr(\n      deltaFirstPointerVec,\n      deltaSecondPointerVec\n    );\n\n    const deltaValueThreshold = 0.1;\n\n    // the changes of distance between two pointers is not far enough\n    if (\n      !isFarEnough(deltaFirstPointer, deltaSecondPointer) ||\n      deltaDotProduct > 0 ||\n      deltaFirstPointerValue < deltaValueThreshold ||\n      deltaSecondPointerValue < deltaValueThreshold\n    )\n      return;\n\n    this._dispatcher.run('pinch', createContext(event, state));\n  }\n}\n\nclass PanController extends DualDragControllerBase {\n  override _handleMove(event: PointerEvent, state: MultiPointerEventState) {\n    if (event.pointerType !== 'touch') return;\n\n    const deltaFirstPointer = state.pointers[0].delta;\n    const deltaSecondPointer = state.pointers[1].delta;\n\n    const deltaDotProduct = Vec.dpr(\n      Vec.toVec(deltaFirstPointer),\n      Vec.toVec(deltaSecondPointer)\n    );\n\n    // the center move distance is not far enough\n    if (\n      !isFarEnough(deltaFirstPointer, deltaSecondPointer) &&\n      deltaDotProduct < 0\n    )\n      return;\n\n    this._dispatcher.run('pan', createContext(event, state));\n  }\n}\n\nexport class PointerControl {\n  private _cachedRect: DOMRect | null = null;\n\n  private _getRect = () => {\n    if (this._cachedRect === null) {\n      this._updateRect();\n    }\n    return this._cachedRect as DOMRect;\n  };\n\n  // XXX: polling is used instead of MutationObserver\n  // due to potential performance issues\n  private _pollingInterval: number | null = null;\n\n  private controllers: PointerControllerBase[];\n\n  constructor(private _dispatcher: UIEventDispatcher) {\n    this.controllers = [\n      new PointerEventForward(_dispatcher, this._getRect),\n      new ClickController(_dispatcher, this._getRect),\n      new DragController(_dispatcher, this._getRect),\n      new PanController(_dispatcher, this._getRect),\n      new PinchController(_dispatcher, this._getRect),\n    ];\n  }\n\n  private _startPolling() {\n    const poll = () => {\n      nextTick()\n        .then(() => this._updateRect())\n        .catch(console.error);\n    };\n    this._pollingInterval = window.setInterval(poll, POLL_INTERVAL);\n    poll();\n  }\n\n  protected _updateRect() {\n    if (!this._dispatcher.host) return;\n    this._cachedRect = this._dispatcher.host.getBoundingClientRect();\n  }\n\n  dispose() {\n    if (this._pollingInterval !== null) {\n      clearInterval(this._pollingInterval);\n      this._pollingInterval = null;\n    }\n  }\n\n  listen() {\n    this._startPolling();\n    this.controllers.forEach(controller => controller.listen());\n  }\n}\n"]}