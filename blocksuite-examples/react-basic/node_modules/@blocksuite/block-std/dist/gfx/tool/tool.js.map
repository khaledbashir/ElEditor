{"version":3,"file":"tool.js","sourceRoot":"","sources":["../../../src/gfx/tool/tool.ts"],"names":[],"mappings":"AAAA,OAAO,EAAkB,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AACzE,OAAO,EAAE,eAAe,EAAE,SAAS,EAAE,MAAM,+BAA+B,CAAC;AAC3E,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAM3D,OAAO,EAAE,SAAS,EAAE,MAAM,8BAA8B,CAAC;AACzD,OAAO,EAAE,uBAAuB,EAAE,MAAM,mBAAmB,CAAC;AAE5D,MAAM,OAAgB,QAEpB,SAAQ,SAAS;aACV,aAAQ,GAAW,EAAE,AAAb,CAAc;IAe7B,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC;IACpD,CAAC;IAED,IAAI,wBAAwB;QAC1B,OAAO,KAAK,CAAC;IACf,CAAC;IAED,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;IACvB,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;IACtB,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;IACtB,CAAC;IAED,IAAI,QAAQ;QACV,OAAQ,IAAI,CAAC,WAA+B,CAAC,QAAQ,CAAC;IACxD,CAAC;IAED,YAAqB,GAAkB;QACrC,KAAK,EAAE,CAAC;QADW,QAAG,GAAH,GAAG,CAAe;QAnCvC,oBAAe,GAAW,EAAY,CAAC;QAEvC,YAAO,GAA+B,CAAC,OAAO,EAAE,OAAO,EAAE,EAAE;YACzD,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QAC7C,CAAC,CAAC;QAEF;;WAEG;QACgB,eAAU,GAAG,IAAI,eAAe,EAAE,CAAC;IA4BtD,CAAC;IAED,MAAM,CAAU,KAAK,CAAC,EAAa;QACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACnB,MAAM,IAAI,eAAe,CACvB,SAAS,CAAC,cAAc,EACxB,yBAAyB,IAAI,CAAC,IAAI,6CAA6C,CAChF,CAAC;QACJ,CAAC;QAED,EAAE,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,CAAC,uBAAuB,CAAC,CAAC,CAAC;IAC7E,CAAC;IAED;;;OAGG;IACH,QAAQ,CAAC,CAAS,IAAS,CAAC;IAE5B,KAAK,CAAC,CAAoB,IAAS,CAAC;IAEpC,WAAW,CAAC,CAAoB,IAAS,CAAC;IAE1C;;OAEG;IACH,UAAU,KAAU,CAAC;IAErB,WAAW,CAAC,CAAoB,IAAS,CAAC;IAE1C,OAAO,CAAC,CAAoB,IAAS,CAAC;IAEtC,QAAQ,CAAC,CAAoB,IAAS,CAAC;IAEvC,SAAS,CAAC,CAAoB,IAAS,CAAC;IAExC;;OAEG;IACH,OAAO,KAAU,CAAC;IAElB,WAAW,CAAC,CAAoB,IAAS,CAAC;IAE1C,WAAW,CAAC,CAAoB,IAAS,CAAC;IAE1C,UAAU,CAAC,CAAoB,IAAS,CAAC;IAEzC,SAAS,CAAC,CAAoB,IAAS,CAAC;IAExC,WAAW,CAAC,CAAoB,IAAS,CAAC;IAE1C;;OAEG;IACH,SAAS,KAAU,CAAC;;AAGtB,MAAM,CAAC,MAAM,cAAc,GAAG,gBAAgB,CAAW,SAAS,CAAC,CAAC","sourcesContent":["import { type Container, createIdentifier } from '@blocksuite/global/di';\nimport { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport { DisposableGroup } from '@blocksuite/global/utils';\n\nimport type { PointerEventState } from '../../event/index.js';\nimport type { GfxController } from '../controller.js';\nimport type { ToolEventTarget } from './tool-controller.js';\n\nimport { Extension } from '../../extension/extension.js';\nimport { GfxControllerIdentifier } from '../identifiers.js';\n\nexport abstract class BaseTool<\n  Option = Record<string, unknown>,\n> extends Extension {\n  static toolName: string = '';\n\n  private readonly eventTarget!: ToolEventTarget;\n\n  activatedOption: Option = {} as Option;\n\n  addHook: ToolEventTarget['addHook'] = (evtName, handler) => {\n    this.eventTarget.addHook(evtName, handler);\n  };\n\n  /**\n   * The `disposable` will be disposed when the tool is unloaded.\n   */\n  protected readonly disposable = new DisposableGroup();\n\n  get active() {\n    return this.gfx.tool.currentTool$.peek() === this;\n  }\n\n  get allowDragWithRightButton() {\n    return false;\n  }\n\n  get controller() {\n    return this.gfx.tool;\n  }\n\n  get doc() {\n    return this.gfx.doc;\n  }\n\n  get std() {\n    return this.gfx.std;\n  }\n\n  get toolName() {\n    return (this.constructor as typeof BaseTool).toolName;\n  }\n\n  constructor(readonly gfx: GfxController) {\n    super();\n  }\n\n  static override setup(di: Container): void {\n    if (!this.toolName) {\n      throw new BlockSuiteError(\n        ErrorCode.ValueNotExists,\n        `The tool constructor '${this.name}' should have a static 'toolName' property.`\n      );\n    }\n\n    di.addImpl(ToolIdentifier(this.toolName), this, [GfxControllerIdentifier]);\n  }\n\n  /**\n   * Called when the tool is activated.\n   * @param _ - The data passed as second argument when calling `ToolController.use`.\n   */\n  activate(_: Option): void {}\n\n  click(_: PointerEventState): void {}\n\n  contextMenu(_: PointerEventState): void {}\n\n  /**\n   * Called when the tool is deactivated.\n   */\n  deactivate(): void {}\n\n  doubleClick(_: PointerEventState): void {}\n\n  dragEnd(_: PointerEventState): void {}\n\n  dragMove(_: PointerEventState): void {}\n\n  dragStart(_: PointerEventState): void {}\n\n  /**\n   * Called when the tool is registered.\n   */\n  mounted(): void {}\n\n  pointerDown(_: PointerEventState): void {}\n\n  pointerMove(_: PointerEventState): void {}\n\n  pointerOut(_: PointerEventState): void {}\n\n  pointerUp(_: PointerEventState): void {}\n\n  tripleClick(_: PointerEventState): void {}\n\n  /**\n   * Called when the tool is unloaded, usually when the whole `ToolController` is destroyed.\n   */\n  unmounted(): void {}\n}\n\nexport const ToolIdentifier = createIdentifier<BaseTool>('GfxTool');\n\nexport interface GfxToolsMap {}\n\nexport interface GfxToolsOption {}\n\nexport type GfxToolsFullOption = {\n  [Key in keyof GfxToolsMap]: Key extends keyof GfxToolsOption\n    ? { type: Key } & GfxToolsOption[Key]\n    : { type: Key };\n};\n\nexport type GfxToolsFullOptionValue =\n  GfxToolsFullOption[keyof GfxToolsFullOption];\n"]}