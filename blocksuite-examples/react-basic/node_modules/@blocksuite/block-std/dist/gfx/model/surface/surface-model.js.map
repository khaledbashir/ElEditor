{"version":3,"file":"surface-model.js","sourceRoot":"","sources":["../../../../src/gfx/model/surface/surface-model.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Boxed, Y } from '@blocksuite/store';\n\nimport { assertType, type Constructor, Slot } from '@blocksuite/global/utils';\nimport { BlockModel, DocCollection, nanoid } from '@blocksuite/store';\n\nimport type { GfxGroupModel, GfxModel } from '../model.js';\nimport type { GfxLocalElementModel } from './local-element-model.js';\n\nimport {\n  type GfxGroupCompatibleInterface,\n  isGfxGroupCompatibleModel,\n} from '../base.js';\nimport { createDecoratorState } from './decorators/common.js';\nimport { initializeObservers, initializeWatchers } from './decorators/index.js';\nimport {\n  GfxGroupLikeElementModel,\n  GfxPrimitiveElementModel,\n  syncElementFromY,\n} from './element-model.js';\n\nexport type SurfaceBlockProps = {\n  elements: Boxed<Y.Map<Y.Map<unknown>>>;\n};\n\nexport interface ElementUpdatedData {\n  id: string;\n  props: Record<string, unknown>;\n  oldValues: Record<string, unknown>;\n  local: boolean;\n}\n\nexport type MiddlewareCtx = {\n  type: 'beforeAdd';\n  payload: {\n    type: string;\n    props: Record<string, unknown>;\n  };\n};\n\nexport type SurfaceMiddleware = (ctx: MiddlewareCtx) => void;\n\nexport class SurfaceBlockModel extends BlockModel<SurfaceBlockProps> {\n  protected _decoratorState = createDecoratorState();\n\n  protected _elementCtorMap: Record<\n    string,\n    Constructor<\n      GfxPrimitiveElementModel,\n      ConstructorParameters<typeof GfxPrimitiveElementModel>\n    >\n  > = Object.create(null);\n\n  protected _elementModels = new Map<\n    string,\n    {\n      mount: () => void;\n      unmount: () => void;\n      model: GfxPrimitiveElementModel;\n    }\n  >();\n\n  protected _elementTypeMap = new Map<string, GfxPrimitiveElementModel[]>();\n\n  protected _groupLikeModels = new Map<string, GfxGroupModel>();\n\n  protected _middlewares: SurfaceMiddleware[] = [];\n\n  protected _surfaceBlockModel = true;\n\n  elementAdded = new Slot<{ id: string; local: boolean }>();\n\n  elementRemoved = new Slot<{\n    id: string;\n    type: string;\n    model: GfxPrimitiveElementModel;\n    local: boolean;\n  }>();\n\n  elementUpdated = new Slot<ElementUpdatedData>();\n\n  localElementAdded = new Slot<GfxLocalElementModel>();\n\n  localElementDeleted = new Slot<GfxLocalElementModel>();\n\n  protected localElements = new Set<GfxLocalElementModel>();\n\n  localElementUpdated = new Slot<{\n    model: GfxLocalElementModel;\n    props: Record<string, unknown>;\n    oldValues: Record<string, unknown>;\n  }>();\n\n  get elementModels() {\n    const models: GfxPrimitiveElementModel[] = [];\n    this._elementModels.forEach(model => models.push(model.model));\n    return models;\n  }\n\n  get localElementModels() {\n    return this.localElements;\n  }\n\n  get registeredElementTypes() {\n    return Object.keys(this._elementCtorMap);\n  }\n\n  constructor() {\n    super();\n    this.created.once(() => this._init());\n  }\n\n  private _createElementFromProps(\n    props: Record<string, unknown>,\n    options: {\n      onChange: (payload: {\n        id: string;\n        props: Record<string, unknown>;\n        oldValues: Record<string, unknown>;\n        local: boolean;\n      }) => void;\n    }\n  ) {\n    const { type, id, ...rest } = props;\n\n    if (!id) {\n      throw new Error('Cannot find id in props');\n    }\n\n    const yMap = new DocCollection.Y.Map();\n    const elementModel = this._createElementFromYMap(\n      type as string,\n      id as string,\n      yMap,\n      {\n        ...options,\n        newCreate: true,\n      }\n    );\n\n    props = this._propsToY(type as string, props);\n\n    yMap.set('type', type);\n    yMap.set('id', id);\n\n    Object.keys(rest).forEach(key => {\n      if (props[key] !== undefined) {\n        // @ts-ignore\n        elementModel.model[key] = props[key];\n      }\n    });\n\n    return elementModel;\n  }\n\n  private _createElementFromYMap(\n    type: string,\n    id: string,\n    yMap: Y.Map<unknown>,\n    options: {\n      onChange: (payload: {\n        id: string;\n        props: Record<string, unknown>;\n        oldValues: Record<string, unknown>;\n        local: boolean;\n      }) => void;\n      skipFieldInit?: boolean;\n      newCreate?: boolean;\n    }\n  ) {\n    const stashed = new Map<string | symbol, unknown>();\n    const Ctor = this._elementCtorMap[type];\n\n    if (!Ctor) {\n      throw new Error(`Invalid element type: ${yMap.get('type')}`);\n    }\n    const state = this._decoratorState;\n\n    state.creating = true;\n    state.skipField = options.skipFieldInit ?? false;\n\n    let mounted = false;\n    // @ts-ignore\n    Ctor['_decoratorState'] = state;\n\n    const elementModel = new Ctor({\n      id,\n      yMap,\n      model: this,\n      stashedStore: stashed,\n      onChange: payload => mounted && options.onChange({ id, ...payload }),\n    }) as GfxPrimitiveElementModel;\n\n    // @ts-ignore\n    delete Ctor['_decoratorState'];\n    state.creating = false;\n    state.skipField = false;\n\n    const unmount = () => {\n      mounted = false;\n      elementModel.onDestroyed();\n    };\n\n    const mount = () => {\n      initializeObservers(Ctor.prototype, elementModel);\n      initializeWatchers(Ctor.prototype, elementModel);\n      elementModel['_disposable'].add(\n        syncElementFromY(elementModel, payload => {\n          mounted &&\n            options.onChange({\n              id,\n              ...payload,\n            });\n        })\n      );\n      mounted = true;\n      elementModel.onCreated();\n    };\n\n    return {\n      model: elementModel,\n      mount,\n      unmount,\n    };\n  }\n\n  private _initElementModels() {\n    const elementsYMap = this.elements.getValue()!;\n    const addToType = (type: string, model: GfxPrimitiveElementModel) => {\n      const sameTypeElements = this._elementTypeMap.get(type) || [];\n\n      if (sameTypeElements.indexOf(model) === -1) {\n        sameTypeElements.push(model);\n      }\n\n      this._elementTypeMap.set(type, sameTypeElements);\n\n      if (isGfxGroupCompatibleModel(model)) {\n        this._groupLikeModels.set(model.id, model);\n      }\n    };\n    const removeFromType = (type: string, model: GfxPrimitiveElementModel) => {\n      const sameTypeElements = this._elementTypeMap.get(type) || [];\n      const index = sameTypeElements.indexOf(model);\n\n      if (index !== -1) {\n        sameTypeElements.splice(index, 1);\n      }\n\n      if (this._groupLikeModels.has(model.id)) {\n        this._groupLikeModels.delete(model.id);\n      }\n    };\n    const onElementsMapChange = (\n      event: Y.YMapEvent<Y.Map<unknown>>,\n      transaction: Y.Transaction\n    ) => {\n      const { changes, keysChanged } = event;\n      const addedElements: {\n        mount: () => void;\n        model: GfxPrimitiveElementModel;\n      }[] = [];\n      const deletedElements: {\n        unmount: () => void;\n        model: GfxPrimitiveElementModel;\n      }[] = [];\n\n      keysChanged.forEach(id => {\n        const change = changes.keys.get(id);\n        const element = this.elements.getValue()!.get(id);\n\n        switch (change?.action) {\n          case 'add':\n            if (element) {\n              const hasModel = this._elementModels.has(id);\n              const model = hasModel\n                ? this._elementModels.get(id)!\n                : this._createElementFromYMap(\n                    element.get('type') as string,\n                    element.get('id') as string,\n                    element,\n                    {\n                      onChange: payload => {\n                        this.elementUpdated.emit(payload);\n                        Object.keys(payload.props).forEach(key => {\n                          model.model.propsUpdated.emit({ key });\n                        });\n                      },\n                      skipFieldInit: true,\n                    }\n                  );\n\n              !hasModel && this._elementModels.set(id, model);\n              addToType(model.model.type, model.model);\n              addedElements.push(model);\n            }\n            break;\n          case 'delete':\n            if (this._elementModels.has(id)) {\n              const { model, unmount } = this._elementModels.get(id)!;\n              removeFromType(model.type, model);\n              this._elementModels.delete(id);\n              deletedElements.push({ model, unmount });\n            }\n            break;\n        }\n      });\n\n      addedElements.forEach(({ mount, model }) => {\n        mount();\n        this.elementAdded.emit({ id: model.id, local: transaction.local });\n      });\n      deletedElements.forEach(({ unmount, model }) => {\n        unmount();\n        this.elementRemoved.emit({\n          id: model.id,\n          type: model.type,\n          model,\n          local: transaction.local,\n        });\n      });\n    };\n\n    elementsYMap.forEach((val, key) => {\n      const model = this._createElementFromYMap(\n        val.get('type') as string,\n        val.get('id') as string,\n        val,\n        {\n          onChange: payload => {\n            this.elementUpdated.emit(payload),\n              Object.keys(payload.props).forEach(key => {\n                model.model.propsUpdated.emit({ key });\n              });\n          },\n          skipFieldInit: true,\n        }\n      );\n\n      this._elementModels.set(key, model);\n    });\n\n    this._elementModels.forEach(({ mount, model }) => {\n      addToType(model.type, model);\n      mount();\n    });\n\n    Object.values(this.doc.blocks.peek()).forEach(block => {\n      if (isGfxGroupCompatibleModel(block.model)) {\n        this._groupLikeModels.set(block.id, block.model);\n      }\n    });\n\n    elementsYMap.observe(onElementsMapChange);\n\n    const disposable = this.doc.slots.blockUpdated.on(payload => {\n      switch (payload.type) {\n        case 'add':\n          if (isGfxGroupCompatibleModel(payload.model)) {\n            this._groupLikeModels.set(payload.id, payload.model);\n          }\n          break;\n        case 'delete':\n          if (isGfxGroupCompatibleModel(payload.model)) {\n            this._groupLikeModels.delete(payload.id);\n          }\n          {\n            const group = this.getGroup(payload.id);\n            if (group) {\n              // eslint-disable-next-line unicorn/prefer-dom-node-remove\n              group.removeChild(payload.model as GfxModel);\n            }\n          }\n          break;\n      }\n    });\n\n    this.deleted.on(() => {\n      elementsYMap.unobserve(onElementsMapChange);\n      disposable.dispose();\n    });\n  }\n\n  private _propsToY(type: string, props: Record<string, unknown>) {\n    const ctor = this._elementCtorMap[type];\n\n    if (!ctor) {\n      throw new Error(`Invalid element type: ${type}`);\n    }\n\n    // @ts-ignore\n    return (ctor.propsToY ?? GfxPrimitiveElementModel.propsToY)(props);\n  }\n\n  private _watchGroupRelationChange() {\n    const isGroup = (\n      element: GfxPrimitiveElementModel\n    ): element is GfxGroupLikeElementModel =>\n      element instanceof GfxGroupLikeElementModel;\n\n    const disposable = this.elementUpdated.on(({ id, oldValues }) => {\n      const element = this.getElementById(id)!;\n\n      if (isGroup(element) && oldValues['childIds']) {\n        if (element.childIds.length === 0) {\n          this.deleteElement(id);\n        }\n      }\n    });\n    this.deleted.on(() => {\n      disposable.dispose();\n    });\n  }\n\n  protected _extendElement(\n    ctorMap: Record<\n      string,\n      Constructor<\n        GfxPrimitiveElementModel,\n        ConstructorParameters<typeof GfxPrimitiveElementModel>\n      >\n    >\n  ) {\n    Object.assign(this._elementCtorMap, ctorMap);\n  }\n\n  protected _init() {\n    this._initElementModels();\n    this._watchGroupRelationChange();\n  }\n\n  addElement<T extends object = Record<string, unknown>>(\n    props: Partial<T> & { type: string }\n  ) {\n    if (this.doc.readonly) {\n      throw new Error('Cannot add element in readonly mode');\n    }\n\n    const middlewareCtx: MiddlewareCtx = {\n      type: 'beforeAdd',\n      payload: {\n        type: props.type,\n        props,\n      },\n    };\n\n    this._middlewares.forEach(mid => mid(middlewareCtx));\n\n    props = middlewareCtx.payload.props as Partial<T> & { type: string };\n\n    const id = nanoid();\n\n    // @ts-ignore\n    props.id = id;\n\n    const elementModel = this._createElementFromProps(props, {\n      onChange: payload => {\n        this.elementUpdated.emit(payload);\n        Object.keys(payload.props).forEach(key => {\n          elementModel.model.propsUpdated.emit({ key });\n        });\n      },\n    });\n\n    this._elementModels.set(id, elementModel);\n\n    this.doc.transact(() => {\n      this.elements.getValue()!.set(id, elementModel.model.yMap);\n    });\n\n    return id;\n  }\n\n  addLocalElement(elem: GfxLocalElementModel) {\n    this.localElements.add(elem);\n    this.localElementAdded.emit(elem);\n  }\n\n  applyMiddlewares(middlewares: SurfaceMiddleware[]) {\n    this._middlewares = middlewares;\n  }\n\n  deleteElement(id: string) {\n    if (this.doc.readonly) {\n      throw new Error('Cannot remove element in readonly mode');\n    }\n\n    if (!this.hasElementById(id)) {\n      return;\n    }\n\n    this.doc.transact(() => {\n      const element = this.getElementById(id)!;\n      const group = this.getGroup(id);\n\n      if (element instanceof GfxGroupLikeElementModel) {\n        element.childIds.forEach(childId => {\n          if (this.hasElementById(childId)) {\n            this.deleteElement(childId);\n          } else if (this.doc.hasBlock(childId)) {\n            this.doc.deleteBlock(this.doc.getBlock(childId)!.model);\n          }\n        });\n      }\n\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      group?.removeChild(element as GfxModel);\n\n      this.elements.getValue()!.delete(id);\n    });\n  }\n\n  deleteLocalElement(elem: GfxLocalElementModel) {\n    if (this.localElements.delete(elem)) {\n      this.localElementDeleted.emit(elem);\n    }\n  }\n\n  override dispose(): void {\n    super.dispose();\n\n    this.elementAdded.dispose();\n    this.elementRemoved.dispose();\n    this.elementUpdated.dispose();\n\n    this._elementModels.forEach(({ unmount }) => unmount());\n    this._elementModels.clear();\n  }\n\n  getElementById(id: string): GfxPrimitiveElementModel | null {\n    return this._elementModels.get(id)?.model ?? null;\n  }\n\n  getElementsByType(type: string): GfxPrimitiveElementModel[] {\n    return this._elementTypeMap.get(type) || [];\n  }\n\n  getGroup(elem: string | GfxModel): GfxGroupModel | null {\n    elem =\n      typeof elem === 'string'\n        ? ((this.getElementById(elem) ??\n            this.doc.getBlock(elem)?.model) as GfxModel)\n        : elem;\n\n    if (!elem) return null;\n\n    assertType<GfxModel>(elem);\n\n    for (const group of this._groupLikeModels.values()) {\n      if (group.hasChild(elem)) {\n        return group;\n      }\n    }\n\n    return null;\n  }\n\n  getGroups(id: string): GfxGroupModel[] {\n    const groups: GfxGroupModel[] = [];\n    const visited = new Set<GfxGroupModel>();\n    let group = this.getGroup(id);\n\n    while (group) {\n      if (visited.has(group)) {\n        console.warn('Exists a cycle in group relation');\n        break;\n      }\n      visited.add(group);\n      groups.push(group);\n      group = this.getGroup(group.id);\n    }\n\n    return groups;\n  }\n\n  hasElementById(id: string): boolean {\n    return this._elementModels.has(id);\n  }\n\n  isGroup(element: GfxModel): element is GfxModel & GfxGroupCompatibleInterface;\n  isGroup(id: string): boolean;\n  isGroup(element: string | GfxModel): boolean {\n    if (typeof element === 'string') {\n      const el = this.getElementById(element);\n      if (el) return isGfxGroupCompatibleModel(el);\n\n      const blockModel = this.doc.getBlock(element)?.model;\n      if (blockModel) return isGfxGroupCompatibleModel(blockModel);\n\n      return false;\n    } else {\n      return isGfxGroupCompatibleModel(element);\n    }\n  }\n\n  updateElement<T extends object = Record<string, unknown>>(\n    id: string,\n    props: Partial<T>\n  ) {\n    if (this.doc.readonly) {\n      throw new Error('Cannot update element in readonly mode');\n    }\n\n    const elementModel = this.getElementById(id);\n\n    if (!elementModel) {\n      throw new Error(`Element ${id} is not found`);\n    }\n\n    this.doc.transact(() => {\n      props = this._propsToY(\n        elementModel.type,\n        props as Record<string, unknown>\n      ) as T;\n      Object.entries(props).forEach(([key, value]) => {\n        // @ts-ignore\n        elementModel[key] = value;\n      });\n    });\n  }\n}\n"]}