{"version":3,"file":"mindmap.js","sourceRoot":"","sources":["../../../src/elements/mindmap/mindmap.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  BaseElementProps,\n  GfxModel,\n  PointTestOptions,\n  SerializedElement,\n} from '@blocksuite/block-std/gfx';\nimport type { Bound, SerializedXYWH, XYWH } from '@blocksuite/global/utils';\n\nimport {\n  convert,\n  field,\n  GfxGroupLikeElementModel,\n  observe,\n  watch,\n} from '@blocksuite/block-std/gfx';\nimport {\n  assertType,\n  deserializeXYWH,\n  keys,\n  last,\n  noop,\n  pick,\n} from '@blocksuite/global/utils';\nimport { DocCollection, type Y } from '@blocksuite/store';\nimport { generateKeyBetween } from 'fractional-indexing';\nimport { z } from 'zod';\n\nimport type { MindmapStyleGetter } from './style.js';\n\nimport { ConnectorMode } from '../../consts/connector.js';\nimport { LayoutType, MindmapStyle } from '../../consts/mindmap.js';\nimport { LocalConnectorElementModel } from '../connector/local-connector.js';\nimport { mindmapStyleGetters } from './style.js';\nimport { findInfiniteLoop } from './utils.js';\n\nexport type NodeDetail = {\n  /**\n   * The index of the node, it decides the layout order of the node\n   */\n  index: string;\n  parent?: string;\n  collapsed?: boolean;\n};\n\nexport type MindmapNode = {\n  id: string;\n  detail: NodeDetail;\n\n  element: BlockSuite.SurfaceElementModel;\n  children: MindmapNode[];\n\n  parent: MindmapNode | null;\n\n  /**\n   * This area is used to determine where to place the dragged node.\n   *\n   * When dragging another node into this area, it will become a sibling of the this node.\n   * But if it is dragged into the small area located right after the this node, it will become a child of the this node.\n   */\n  responseArea?: Bound;\n\n  /**\n   * This property override the preferredDir or default layout direction.\n   * It is used during dragging that would temporary change the layout direction\n   */\n  overriddenDir?: LayoutType;\n};\n\nexport type MindmapRoot = MindmapNode & {\n  left: MindmapNode[];\n  right: MindmapNode[];\n};\n\nconst baseNodeSchema = z.object({\n  text: z.string(),\n  xywh: z.optional(z.string()),\n});\n\ntype Node = z.infer<typeof baseNodeSchema> & {\n  children?: Node[];\n};\n\nconst nodeSchema: z.ZodType<Node> = baseNodeSchema.extend({\n  children: z.lazy(() => nodeSchema.array()).optional(),\n});\n\nexport type NodeType = z.infer<typeof nodeSchema>;\n\nfunction isNodeType(node: Record<string, unknown>): node is NodeType {\n  return typeof node.text === 'string' && Array.isArray(node.children);\n}\n\nexport type SerializedMindmapElement = SerializedElement & {\n  children: Record<string, NodeDetail>;\n};\n\ntype MindmapElementProps = BaseElementProps & {\n  children: Y.Map<NodeDetail>;\n};\n\nfunction observeChildren(\n  _: unknown,\n  instance: MindmapElementModel,\n  transaction: Y.Transaction | null\n) {\n  if (instance.children.doc) {\n    instance.setChildIds(\n      Array.from(instance.children.keys()),\n      transaction?.local ?? true\n    );\n\n    instance.buildTree();\n    instance.connectors.clear();\n  }\n}\n\nfunction watchLayoutType(\n  _: unknown,\n  instance: MindmapElementModel,\n  local: boolean\n) {\n  if (!local) {\n    return;\n  }\n\n  instance.surface.doc.transact(() => {\n    instance['_tree']?.children.forEach(child => {\n      if (!instance.children.has(child.id)) {\n        return;\n      }\n\n      instance.children.set(child.id, {\n        index: child.detail.index,\n        parent: child.detail.parent,\n      });\n    });\n  });\n\n  instance.buildTree();\n}\n\nfunction watchStyle(_: unknown, instance: MindmapElementModel, local: boolean) {\n  if (!local) return;\n  instance.layout();\n}\n\nexport class MindmapElementModel extends GfxGroupLikeElementModel<MindmapElementProps> {\n  private _layout: MindmapElementModel['layout'] | null = null;\n\n  private _nodeMap = new Map<string, MindmapNode>();\n\n  private _queueBuildTree = false;\n\n  private _queuedLayout = false;\n\n  private _stashedNode = new Set<string>();\n\n  private _tree!: MindmapRoot;\n\n  connectors = new Map<string, LocalConnectorElementModel>();\n\n  get nodeMap() {\n    return this._nodeMap;\n  }\n\n  override get rotate() {\n    return 0;\n  }\n\n  override set rotate(_: number) {}\n\n  get styleGetter(): MindmapStyleGetter {\n    return mindmapStyleGetters[this.style];\n  }\n\n  get tree() {\n    return this._tree;\n  }\n\n  get type() {\n    return 'mindmap';\n  }\n\n  static override propsToY(props: Record<string, unknown>) {\n    if (\n      props.children &&\n      !isNodeType(props.children as Record<string, unknown>) &&\n      !(props.children instanceof DocCollection.Y.Map)\n    ) {\n      const children: Y.Map<NodeDetail> = new DocCollection.Y.Map();\n\n      keys(props.children).forEach(key => {\n        const detail = pick<Record<string, unknown>, keyof NodeDetail>(\n          props.children![key],\n          ['index', 'parent']\n        );\n        children.set(key as string, detail as NodeDetail);\n      });\n\n      props.children = children;\n    }\n\n    return props as MindmapElementProps;\n  }\n\n  private _cfgBalanceLayoutDir() {\n    if (this.layoutType !== LayoutType.BALANCE) {\n      return;\n    }\n\n    const tree = this._tree;\n    const splitPoint = Math.ceil(tree.children.length / 2);\n\n    tree.right.push(...tree.children.slice(0, splitPoint));\n    tree.left.push(...tree.children.slice(splitPoint));\n    tree.left.reverse();\n  }\n\n  private _isConnectorOutdated(\n    options:\n      | {\n          connector: LocalConnectorElementModel;\n          from: MindmapNode;\n          to: MindmapNode;\n          layout: LayoutType;\n        }\n      | {\n          connector: LocalConnectorElementModel;\n          from: MindmapNode;\n          layout: LayoutType;\n          collapsed: boolean;\n        },\n    updateKey: boolean = true\n  ) {\n    const collapsed = 'collapsed' in options;\n    const { connector, from, layout } = options;\n\n    if (!from.element || (!collapsed && !options.to.element)) {\n      return { outdated: true, cacheKey: '' };\n    }\n\n    const cacheKey = collapsed\n      ? `${from.element.xywh}-collapsed-${layout}-${this.style}`\n      : `${from.element.xywh}-${options.to.element.xywh}-${layout}-${this.style}`;\n\n    if (connector.cache.get('MINDMAP_CONNECTOR') === cacheKey) {\n      return false;\n    } else if (updateKey) {\n      connector.cache.set('MINDMAP_CONNECTOR', cacheKey);\n    }\n\n    return true;\n  }\n\n  protected override _getXYWH(): Bound {\n    return super._getXYWH();\n  }\n\n  /**\n   * @deprecated\n   * you should not call this method directly\n   */\n  addChild(_element: GfxModel) {\n    noop();\n  }\n\n  addNode(\n    /**\n     * The parent node id of the new node. If it's null, the node will be the root node\n     */\n    parent: string | MindmapNode | null,\n    sibling?: string | number,\n    position: 'before' | 'after' = 'after',\n    props: Record<string, unknown> = {}\n  ) {\n    if (parent && typeof parent !== 'string') {\n      parent = parent.id;\n    }\n\n    assertType<string | null>(parent);\n\n    if (parent && !this._nodeMap.has(parent)) {\n      throw new Error(`Parent node ${parent} not found`);\n    }\n\n    props['text'] = new DocCollection.Y.Text(\n      (props['text'] as string) ?? 'New node'\n    );\n\n    const type = (props.type as string) ?? 'shape';\n    let id: string;\n    this.surface.doc.transact(() => {\n      const parentNode = parent ? this._nodeMap.get(parent)! : null;\n\n      if (parentNode) {\n        let index = last(parentNode.children)\n          ? generateKeyBetween(last(parentNode.children)!.detail.index, null)\n          : 'a0';\n\n        sibling = sibling ?? last(parentNode.children)?.id;\n        const siblingNode =\n          typeof sibling === 'number'\n            ? parentNode.children[sibling]\n            : sibling\n              ? this._nodeMap.get(sibling)\n              : undefined;\n        const path = siblingNode\n          ? this.getPath(siblingNode)\n          : this.getPath(parentNode).concat([0]);\n        const style = this.styleGetter.getNodeStyle(\n          siblingNode ?? parentNode,\n          path\n        );\n\n        id = this.surface.addElement({\n          type,\n          xywh: '[0,0,100,30]',\n          maxWidth: false,\n          ...props,\n          ...style.node,\n        });\n\n        if (siblingNode) {\n          const siblingIndex = parentNode.children.findIndex(\n            val => val.id === sibling\n          );\n\n          index =\n            position === 'after'\n              ? generateKeyBetween(\n                  siblingNode.detail.index,\n                  parentNode.children[siblingIndex + 1]?.detail.index ?? null\n                )\n              : generateKeyBetween(\n                  parentNode.children[siblingIndex - 1]?.detail.index ?? null,\n                  siblingNode.detail.index\n                );\n        }\n\n        const nodeDetail: NodeDetail = {\n          index,\n          parent: parent!,\n        };\n\n        this.children.set(id, nodeDetail);\n      } else {\n        const rootStyle = this.styleGetter.root;\n\n        id = this.surface.addElement({\n          type,\n          xywh: '[0,0,113,41]',\n          maxWidth: false,\n          ...props,\n          ...rootStyle,\n        });\n\n        this.children.clear();\n        this.children.set(id, {\n          index: 'a0',\n        });\n      }\n    });\n    this.layout();\n\n    return id!;\n  }\n\n  buildTree() {\n    const mindmapNodeMap = new Map<string, MindmapNode>();\n    const nodesMap = this.children;\n\n    // The element may be removed\n    if (!nodesMap || nodesMap.size === 0) {\n      this._nodeMap = mindmapNodeMap;\n      // @ts-ignore\n      this._tree = null;\n      return;\n    }\n\n    let rootNode: MindmapRoot | undefined;\n\n    nodesMap.forEach((val, id) => {\n      if (!mindmapNodeMap.has(id)) {\n        mindmapNodeMap.set(id, {\n          id,\n          index: val.index,\n          detail: val,\n          element: this.surface.getElementById(id)!,\n          children: [],\n          parent: null,\n        } as MindmapNode);\n      }\n\n      const node = mindmapNodeMap.get(id)!;\n\n      // some node may be already created during\n      // iterating its children\n      if (!node.detail) {\n        node.detail = val;\n      }\n\n      if (!val.parent) {\n        rootNode = node as MindmapRoot;\n        rootNode.left = [];\n        rootNode.right = [];\n      } else {\n        if (!mindmapNodeMap.has(val.parent)) {\n          mindmapNodeMap.set(val.parent, {\n            id: val.parent,\n            detail: nodesMap.get(val.parent)!,\n            parent: null,\n            children: [],\n            element: this.surface.getElementById(val.parent)!,\n          } as MindmapNode);\n        }\n\n        const parent = mindmapNodeMap.get(val.parent)!;\n        parent.children.push(node);\n        node.parent = parent;\n      }\n    });\n\n    mindmapNodeMap.forEach(node => {\n      node.children.sort((a, b) =>\n        a.detail.index === b.detail.index\n          ? 0\n          : a.detail.index > b.detail.index\n            ? 1\n            : -1\n      );\n    });\n\n    if (!rootNode) {\n      return;\n    }\n\n    const loops = findInfiniteLoop(rootNode, mindmapNodeMap);\n\n    if (loops.length) {\n      this.surface.doc.withoutTransact(() => {\n        loops.forEach(loop => {\n          if (loop.detached) {\n            loop.chain.forEach(node => {\n              this.children.delete(node.id);\n            });\n          } else {\n            const child = last(loop.chain);\n\n            if (child) {\n              this.children.set(child.id, {\n                index: child.detail.index,\n              });\n            }\n          }\n        });\n      });\n      return;\n    }\n\n    this._nodeMap = mindmapNodeMap;\n    this._tree = rootNode;\n\n    if (this.layoutType === LayoutType.BALANCE) {\n      this._cfgBalanceLayoutDir();\n    } else {\n      this._tree[this.layoutType === LayoutType.RIGHT ? 'right' : 'left'] =\n        this._tree.children;\n    }\n  }\n\n  /**\n   *\n   * @param subtree The subtree of root, this only take effects when the layout type is BALANCED.\n   * @returns\n   */\n  getChildNodes(id: string, subtree?: 'left' | 'right') {\n    const node = this._nodeMap.get(id);\n\n    if (!node) {\n      return [];\n    }\n\n    if (subtree && id === this._tree.id) {\n      return this._tree[subtree];\n    }\n\n    return node.children;\n  }\n\n  /**\n   * Get all the connectors start from the given node\n   * @param node\n   * @returns\n   */\n  getConnectors(node: MindmapNode) {\n    if (!this._nodeMap.has(node.id)) {\n      return null;\n    }\n\n    if (node.detail.collapsed) {\n      const id = `#${node.id}-collapsed`;\n      const layout = this.getLayoutDir(node)!;\n      const connector =\n        this.connectors.get(id) ?? new LocalConnectorElementModel(this.surface);\n      const connectorExist = this.connectors.has(id);\n      const connectorStyle = this.styleGetter.getNodeStyle(\n        node,\n        this.getPath(node).concat([0])\n      ).connector;\n      const outdated = this._isConnectorOutdated({\n        connector,\n        from: node,\n        collapsed: true,\n        layout,\n      });\n\n      if (!connectorExist) {\n        connector.id = id;\n        this.connectors.set(id, connector);\n      }\n\n      if (outdated) {\n        const nodeBound = node.element.elementBound;\n        connector.id = id;\n        connector.source = {\n          id: node.id,\n          position: layout === LayoutType.LEFT ? [0, 0.5] : [1, 0.5],\n        };\n        connector.target = {\n          position:\n            layout === LayoutType.LEFT\n              ? [nodeBound.x - 6, nodeBound.y + nodeBound.h / 2]\n              : [nodeBound.x + nodeBound.w + 6, nodeBound.y + nodeBound.h / 2],\n        };\n\n        Object.entries(connectorStyle).forEach(([key, value]) => {\n          // @ts-ignore\n          connector[key as unknown] = value;\n        });\n\n        connector.mode = ConnectorMode.Straight;\n      }\n\n      return [{ outdated, connector }];\n    } else {\n      const from = node;\n      return from.children.map(to => {\n        const layout = this.getLayoutDir(to)!;\n        const id = `#${from.id}-${to.id}`;\n        const connectorExist = this.connectors.has(id);\n        const connectorStyle = this.styleGetter.getNodeStyle(\n          to,\n          this.getPath(to)\n        ).connector;\n        const connector =\n          this.connectors.get(id) ??\n          new LocalConnectorElementModel(this.surface);\n        const outdated = this._isConnectorOutdated({\n          connector,\n          from,\n          to,\n          layout,\n        });\n\n        if (!connectorExist) {\n          connector.id = id;\n          this.connectors.set(id, connector);\n        }\n\n        if (outdated) {\n          connector.source = {\n            id: from.id,\n            position: layout === LayoutType.RIGHT ? [1, 0.5] : [0, 0.5],\n          };\n          connector.target = {\n            id: to.id,\n            position: layout === LayoutType.RIGHT ? [0, 0.5] : [1, 0.5],\n          };\n\n          Object.entries(connectorStyle).forEach(([key, value]) => {\n            // @ts-ignore\n            connector[key as unknown] = value;\n          });\n        }\n\n        return { outdated, connector };\n      });\n    }\n  }\n\n  getLayoutDir(node: string | MindmapNode): LayoutType {\n    node = typeof node === 'string' ? this._nodeMap.get(node)! : node;\n\n    assertType<MindmapNode>(node);\n\n    let current: MindmapNode | null = node;\n    const root = this._tree;\n\n    while (current) {\n      if (current.overriddenDir !== undefined) {\n        return current.overriddenDir;\n      }\n\n      const parent: MindmapNode | null = current.detail.parent\n        ? (this._nodeMap.get(current.detail.parent) ?? null)\n        : null;\n\n      if (parent === root) {\n        return (\n          parent.overriddenDir ??\n          (root.left.includes(current)\n            ? LayoutType.LEFT\n            : root.right.includes(current)\n              ? LayoutType.RIGHT\n              : this.layoutType)\n        );\n      }\n\n      current = parent;\n    }\n\n    return this.layoutType;\n  }\n\n  getNode(id: string) {\n    return this._nodeMap.get(id) ?? null;\n  }\n\n  getParentNode(id: string) {\n    const node = this.children.get(id);\n\n    return node?.parent ? (this._nodeMap.get(node.parent) ?? null) : null;\n  }\n\n  /**\n   * Path is an array of indexes that represent the path from the root node to the target node.\n   * The first element of the array is always 0, which represents the root node.\n   * @param element\n   * @returns\n   *\n   * @example\n   * ```ts\n   * const path = mindmap.getPath('nodeId');\n   * // [0, 1, 2]\n   * ```\n   */\n  getPath(element: string | MindmapNode) {\n    let node = this._nodeMap.get(\n      typeof element === 'string' ? element : element.id\n    );\n\n    if (!node) {\n      throw new Error('Node not found');\n    }\n\n    const path: number[] = [];\n\n    while (node && node !== this._tree) {\n      const parent = this._nodeMap.get(node!.detail.parent!);\n\n      path.unshift(parent!.children.indexOf(node!));\n      node = parent;\n    }\n\n    path.unshift(0);\n\n    return path;\n  }\n\n  getSiblingNode(\n    id: string,\n    direction: 'prev' | 'next' = 'next',\n    /**\n     * The subtree of which that the sibling node belongs to,\n     * this is used when the layout type is BALANCED.\n     */\n    subtree?: 'left' | 'right'\n  ) {\n    const node = this._nodeMap.get(id);\n\n    if (!node) {\n      return null;\n    }\n\n    const parent = this._nodeMap.get(node.detail.parent!);\n\n    if (!parent) {\n      return null;\n    }\n\n    const childrenTree =\n      subtree && parent.id === this._tree.id\n        ? this._tree[subtree]\n        : parent.children;\n    const idx = childrenTree.indexOf(node);\n    if (idx === -1) {\n      return null;\n    }\n    const siblingIndex = direction === 'next' ? idx + 1 : idx - 1;\n    const sibling = childrenTree[siblingIndex] ?? null;\n\n    return sibling;\n  }\n\n  override includesPoint(x: number, y: number, options: PointTestOptions) {\n    const bound = this.elementBound;\n\n    bound.x -= options.responsePadding?.[0] ?? 0;\n    bound.w += (options.responsePadding?.[0] ?? 0) * 2;\n    bound.y -= options.responsePadding?.[1] ?? 0;\n    bound.h += (options.responsePadding?.[1] ?? 0) * 2;\n\n    return bound.containsPoint([x, y]);\n  }\n\n  layout(\n    _tree: MindmapNode | MindmapRoot = this.tree,\n    _options: {\n      applyStyle?: boolean;\n      layoutType?: LayoutType;\n      calculateTreeBound?: boolean;\n      stashed?: boolean;\n    } = {\n      applyStyle: true,\n      calculateTreeBound: true,\n      stashed: true,\n    }\n  ) {\n    // should be implemented by the view\n    // otherwise, it would be just an empty function\n    if (this._layout) {\n      this._layout(_tree, _options);\n    }\n  }\n\n  moveTo(targetXYWH: SerializedXYWH | XYWH) {\n    const { x, y } = this;\n    const targetPos =\n      typeof targetXYWH === 'string' ? deserializeXYWH(targetXYWH) : targetXYWH;\n    const offsetX = targetPos[0] - x;\n    const offsetY = targetPos[1] - y + targetPos[3];\n\n    this.surface.doc.transact(() => {\n      this.childElements.forEach(el => {\n        const deserializedXYWH = deserializeXYWH(el.xywh);\n\n        el.xywh =\n          `[${deserializedXYWH[0] + offsetX},${deserializedXYWH[1] + offsetY},${deserializedXYWH[2]},${deserializedXYWH[3]}]` as SerializedXYWH;\n      });\n    });\n  }\n\n  override onCreated(): void {\n    this.buildTree();\n  }\n\n  removeChild(element: GfxModel) {\n    if (!this._nodeMap.has(element.id)) {\n      return;\n    }\n\n    const surface = this.surface;\n    const removedDescendants: string[] = [];\n    const remove = (node: MindmapNode) => {\n      node.children?.forEach(child => {\n        remove(child);\n      });\n\n      this.children?.delete(node.id);\n      removedDescendants.push(node.id);\n    };\n\n    surface.doc.transact(() => {\n      remove(this._nodeMap.get(element.id)!);\n    });\n\n    queueMicrotask(() => {\n      removedDescendants.forEach(id => surface.deleteElement(id));\n    });\n\n    // This transaction may not end\n    // force to build the elements\n    this.buildTree();\n    this.requestLayout();\n  }\n\n  protected requestBuildTree() {\n    if (this._queueBuildTree) {\n      return;\n    }\n\n    this._queueBuildTree = true;\n    queueMicrotask(() => {\n      this.buildTree();\n      this._queueBuildTree = false;\n    });\n  }\n\n  requestLayout() {\n    if (!this._queuedLayout) {\n      this._queuedLayout = true;\n\n      queueMicrotask(() => {\n        this.layout();\n        this._queuedLayout = false;\n      });\n    }\n  }\n\n  override serialize() {\n    const result = super.serialize();\n    return result as SerializedMindmapElement;\n  }\n\n  setLayoutMethod(layoutMethod: MindmapElementModel['layout']) {\n    this._layout = layoutMethod;\n  }\n\n  /**\n   * Stash mind map node and its children's xywh property\n   * @param node\n   * @returns a function that write back the stashed xywh into yjs\n   */\n  stashTree(node: MindmapNode | string) {\n    const mindNode = typeof node === 'string' ? this.getNode(node) : node;\n\n    if (!mindNode || this._stashedNode.has(mindNode.id)) {\n      return;\n    }\n\n    const stashed = new Set<BlockSuite.SurfaceElementModel>();\n    const traverse = (node: MindmapNode) => {\n      node.element.stash('xywh');\n      stashed.add(node.element);\n\n      if (node.children.length) {\n        node.children.forEach(child => traverse(child));\n      }\n    };\n\n    traverse(mindNode);\n\n    return () => {\n      this._stashedNode.delete(mindNode.id);\n      stashed.forEach(el => {\n        el.pop('xywh');\n      });\n    };\n  }\n\n  toggleCollapse(node: MindmapNode, options: { layout?: boolean } = {}) {\n    if (!this._nodeMap.has(node.id)) {\n      return;\n    }\n\n    const { layout = false } = options;\n\n    if (node && node.children.length > 0) {\n      const collapsed = node.detail.collapsed ? false : true;\n      const isExpand = !collapsed;\n\n      const changeNodesVisibility = (node: MindmapNode) => {\n        node.element.hidden = collapsed;\n\n        if (isExpand && node.detail.collapsed) {\n          return;\n        }\n\n        node.children.forEach(child => {\n          changeNodesVisibility(child);\n        });\n      };\n\n      node.children.forEach(changeNodesVisibility);\n      this.surface.doc.transact(() => {\n        this.children.set(node.id, {\n          ...node.detail,\n          collapsed,\n        });\n      });\n    }\n\n    if (layout) {\n      this.requestLayout();\n    }\n  }\n\n  traverse(\n    callback: (node: MindmapNode, parent: MindmapNode | null) => void,\n    root: MindmapNode = this._tree,\n    options: { stopOnCollapse?: boolean } = {}\n  ) {\n    const { stopOnCollapse = false } = options;\n    const traverse = (node: MindmapNode, parent: MindmapNode | null) => {\n      callback(node, parent);\n\n      if (stopOnCollapse && node.detail.collapsed) {\n        return;\n      }\n\n      node?.children.forEach(child => {\n        traverse(child, node);\n      });\n    };\n\n    if (root) {\n      traverse(root, null);\n    }\n  }\n\n  @convert((initialValue, instance) => {\n    if (!(initialValue instanceof DocCollection.Y.Map)) {\n      nodeSchema.parse(initialValue);\n\n      assertType<NodeType>(initialValue);\n\n      const map: Y.Map<NodeDetail> = new DocCollection.Y.Map();\n      const surface = instance.surface;\n      const doc = surface.doc;\n      const recursive = (\n        node: NodeType,\n        parent: string | null = null,\n        index: string = 'a0'\n      ) => {\n        const id = surface.addElement({\n          type: 'shape',\n          text: node.text,\n          xywh: node.xywh ? node.xywh : `[0, 0, 100, 30]`,\n        });\n\n        map.set(id, {\n          index,\n          parent: parent ?? undefined,\n        });\n\n        let curIdx = 'a0';\n        node.children?.forEach(childNode => {\n          recursive(childNode, id, curIdx);\n          curIdx = generateKeyBetween(curIdx, null);\n        });\n      };\n\n      doc.transact(() => {\n        recursive(initialValue);\n      });\n\n      instance.requestBuildTree();\n      instance.requestLayout();\n      return map;\n    } else {\n      instance.requestBuildTree();\n      instance.requestLayout();\n      return initialValue;\n    }\n  })\n  // Use extracted function to avoid playwright test failure\n  // since this model package is imported by playwright\n  @observe(observeChildren)\n  @field()\n  accessor children: Y.Map<NodeDetail> = new DocCollection.Y.Map();\n\n  @watch(watchLayoutType)\n  @field()\n  accessor layoutType: LayoutType = LayoutType.RIGHT;\n\n  @watch(watchStyle)\n  @field()\n  accessor style: MindmapStyle = MindmapStyle.ONE;\n}\n\ndeclare global {\n  namespace BlockSuite {\n    interface SurfaceGroupLikeModelMap {\n      mindmap: MindmapElementModel;\n    }\n  }\n}\n"]}