{"version":3,"file":"hast.js","sourceRoot":"","sources":["../../../src/adapters/utils/hast.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Element, ElementContent, Text } from 'hast';\n\nimport type { HtmlAST } from '../types/hast.js';\n\nconst isElement = (ast: HtmlAST): ast is Element => {\n  return ast.type === 'element';\n};\n\nconst getTextContent = (ast: HtmlAST | undefined, defaultStr = ''): string => {\n  if (!ast) {\n    return defaultStr;\n  }\n  switch (ast.type) {\n    case 'text': {\n      return ast.value.replace(/\\s+/g, ' ');\n    }\n    case 'element': {\n      switch (ast.tagName) {\n        case 'br': {\n          return '\\n';\n        }\n      }\n      return ast.children.map(child => getTextContent(child)).join('');\n    }\n  }\n  return defaultStr;\n};\n\nconst getElementChildren = (ast: HtmlAST | undefined): Element[] => {\n  if (!ast) {\n    return [];\n  }\n  if (ast.type === 'element') {\n    return ast.children.filter(child => child.type === 'element') as Element[];\n  }\n  return [];\n};\n\nconst getTextChildren = (ast: HtmlAST | undefined): Text[] => {\n  if (!ast) {\n    return [];\n  }\n  if (ast.type === 'element') {\n    return ast.children.filter(child => child.type === 'text') as Text[];\n  }\n  return [];\n};\n\nconst getTextChildrenOnlyAst = (ast: Element): Element => {\n  return {\n    ...ast,\n    children: getTextChildren(ast),\n  };\n};\n\nconst isTagInline = (tagName: string): boolean => {\n  // Phrasing content\n  const inlineElements = [\n    'a',\n    'abbr',\n    'audio',\n    'b',\n    'bdi',\n    'bdo',\n    'br',\n    'button',\n    'canvas',\n    'cite',\n    'code',\n    'data',\n    'datalist',\n    'del',\n    'dfn',\n    'em',\n    'embed',\n    'i',\n    // 'iframe' is not included because it needs special handling\n    // 'img' is not included because it needs special handling\n    'input',\n    'ins',\n    'kbd',\n    'label',\n    'link',\n    'map',\n    'mark',\n    'math',\n    'meta',\n    'meter',\n    'noscript',\n    'object',\n    'output',\n    'picture',\n    'progress',\n    'q',\n    'ruby',\n    's',\n    'samp',\n    'script',\n    'select',\n    'slot',\n    'small',\n    'span',\n    'strong',\n    'sub',\n    'sup',\n    'svg',\n    'template',\n    'textarea',\n    'time',\n    'u',\n    'var',\n    'video',\n    'wbr',\n  ];\n  return inlineElements.includes(tagName);\n};\n\nconst isElementInline = (element: Element): boolean => {\n  return (\n    isTagInline(element.tagName) ||\n    // Inline elements\n    !!(\n      typeof element.properties?.style === 'string' &&\n      element.properties.style.match(/display:\\s*inline/)\n    )\n  );\n};\n\nconst getInlineElementsAndText = (ast: Element): (Element | Text)[] => {\n  if (!ast || !ast.children) {\n    return [];\n  }\n\n  return ast.children.filter((child): child is Element | Text => {\n    if (child.type === 'text') {\n      return true;\n    }\n    if (child.type === 'element' && child.tagName && isElementInline(child)) {\n      return true;\n    }\n    return false;\n  });\n};\n\nconst getInlineOnlyElementAST = (ast: Element): Element => {\n  return {\n    ...ast,\n    children: getInlineElementsAndText(ast),\n  };\n};\n\nconst querySelectorTag = (\n  ast: HtmlAST,\n  tagName: string\n): Element | undefined => {\n  if (ast.type === 'element') {\n    if (ast.tagName === tagName) {\n      return ast;\n    }\n    for (const child of ast.children) {\n      const result = querySelectorTag(child, tagName);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\nconst querySelectorClass = (\n  ast: HtmlAST,\n  className: string\n): Element | undefined => {\n  if (ast.type === 'element') {\n    if (\n      Array.isArray(ast.properties?.className) &&\n      ast.properties.className.includes(className)\n    ) {\n      return ast;\n    }\n    for (const child of ast.children) {\n      const result = querySelectorClass(child, className);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\nconst querySelectorId = (ast: HtmlAST, id: string): Element | undefined => {\n  if (ast.type === 'element') {\n    if (ast.properties.id === id) {\n      return ast;\n    }\n    for (const child of ast.children) {\n      const result = querySelectorId(child, id);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\nconst querySelector = (ast: HtmlAST, selector: string): Element | undefined => {\n  if (ast.type === 'root') {\n    for (const child of ast.children) {\n      const result = querySelector(child, selector);\n      if (result) {\n        return result;\n      }\n    }\n  } else if (ast.type === 'element') {\n    if (selector.startsWith('.')) {\n      return querySelectorClass(ast, selector.slice(1));\n    } else if (selector.startsWith('#')) {\n      return querySelectorId(ast, selector.slice(1));\n    } else {\n      return querySelectorTag(ast, selector);\n    }\n  }\n  return undefined;\n};\n\nconst flatNodes = (\n  ast: HtmlAST,\n  expression: (tagName: string) => boolean\n): HtmlAST => {\n  if (ast.type === 'element') {\n    const children = ast.children.map(child => flatNodes(child, expression));\n    return {\n      ...ast,\n      children: children.flatMap(child => {\n        if (child.type === 'element') {\n          if (expression(child.tagName)) {\n            return child.children;\n          }\n        }\n        return child;\n      }) as ElementContent[],\n    };\n  }\n  return ast;\n};\n\n// Check if it is a paragraph like element\n// https://html.spec.whatwg.org/#paragraph\nconst isParagraphLike = (node: Element): boolean => {\n  // Flex container\n  return (\n    (typeof node.properties?.style === 'string' &&\n      node.properties.style.match(/display:\\s*flex/) !== null) ||\n    getElementChildren(node).every(child => isElementInline(child))\n  );\n};\n\nexport const HastUtils = {\n  isElement,\n  getTextContent,\n  getElementChildren,\n  getTextChildren,\n  getTextChildrenOnlyAst,\n  getInlineOnlyElementAST,\n  querySelector,\n  flatNodes,\n  isParagraphLike,\n};\n"]}