{"version":3,"file":"captioned-block-component.js","sourceRoot":"","sources":["../../src/caption/captioned-block-component.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,aAAa,EAAE,MAAM,oCAAoC,CAAC;AACnE,OAAO,EAAE,cAAc,EAAqB,MAAM,uBAAuB,CAAC;AAC1E,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACpC,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,SAAS,EAAY,GAAG,EAAE,MAAM,uBAAuB,CAAC;AACjE,OAAO,EAAkB,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAIvE,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AAErC,MAAM,CAAN,IAAY,aAGX;AAHD,WAAY,aAAa;IACvB,0CAAyB,CAAA;IACzB,kCAAiB,CAAA;AACnB,CAAC,EAHW,aAAa,KAAb,aAAa,QAGxB;AAED,MAAM,OAAO,uBAIX,SAAQ,cAA0C;aAClC,WAAM,GAAG,MAAM,CAAC;IAEhC,IAAI,aAAa;QACf,IAAI,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;YAC5D,OAAO,CAAC,KAAK,CACX,qEAAqE,CACtE,CAAC;QACJ,CAAC;QACD,OAAO,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;IACtC,CAAC;IAED;QACE,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAC3C,CAAC;IAEO,iBAAiB,CAAC,OAAgB;QACxC,MAAM,KAAK,GAAG,QAAQ,CAAC;YACrB,QAAQ,EAAE,UAAU;YACpB,GAAG,IAAI,CAAC,oBAAoB;SAC7B,CAAC,CAAC;QACH,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,KAAK,CAAC;QAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,KAAK,aAAa,CAAC,MAAM,CAAC;QAE7D,OAAO,IAAI,CAAA;cACD,KAAK;cACL,QAAQ,CAAC;YACf,wBAAwB,EAAE,IAAI;YAC9B,CAAC,KAAK,CAAC,EAAE,IAAI;YACb,MAAM,EAAE,QAAQ;SACjB,CAAC;;QAEA,OAAO;QACP,IAAI,CAAC,gBAAgB;YACrB,CAAC,CAAC,IAAI,CAAA;cACA,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC;mCACN;YAC3B,CAAC,CAAC,OAAO;QACT,IAAI,CAAC,aAAa,KAAK,aAAa,CAAC,UAAU;YAC/C,CAAC,CAAC,IAAI,CAAA,kCAAkC,IAAI,4BAA4B;YACxE,CAAC,CAAC,IAAI;QACN,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ;YACvC,CAAC,CAAC,IAAI,CAAA,4BAA4B,IAAI,sBAAsB;YAC5D,CAAC,CAAC,OAAO;WACN,CAAC;IACV,CAAC;IAGD,sCACE,SAAS,EAAsB,CAAC;IAFlC,qEAAqE;IACrE,IAAiB,iBAAiB,uDACA;IADlC,IAAiB,iBAAiB,6DACA;IAElC,yCAAiE,SAAS,CAAC;IAA3E,IAAmB,oBAAoB,0DAAoC;IAA3E,IAAmB,oBAAoB,gEAAoC;IAE3E,kCAAmC,aAAa,CAAC,UAAU,CAAC;IAA5D,IAAmB,aAAa,mDAA4B;IAA5D,IAAmB,aAAa,yDAA4B;IAE5D,qCAAsC,KAAK,CAAC;IAA5C,IAAmB,gBAAgB,sDAAS;IAA5C,IAAmB,gBAAgB,4DAAS;IAE5C,iCAAkC,KAAK,CAAC;IAAxC,IAAmB,YAAY,kDAAS;IAAxC,IAAmB,YAAY,wDAAS","sourcesContent":["import type { BlockModel } from '@blocksuite/store';\n\nimport { ThemeProvider } from '@blocksuite/affine-shared/services';\nimport { BlockComponent, type BlockService } from '@blocksuite/block-std';\nimport { html, nothing } from 'lit';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport type { BlockCaptionEditor } from './block-caption.js';\n\nimport { styles } from './styles.js';\n\nexport enum SelectedStyle {\n  Background = 'Background',\n  Border = 'Border',\n}\n\nexport class CaptionedBlockComponent<\n  Model extends BlockModel = BlockModel,\n  Service extends BlockService = BlockService,\n  WidgetName extends string = string,\n> extends BlockComponent<Model, Service, WidgetName> {\n  static override styles = styles;\n\n  get captionEditor() {\n    if (!this.useCaptionEditor || !this._captionEditorRef.value) {\n      console.error(\n        'Oops! Please enable useCaptionEditor before accessing captionEditor'\n      );\n    }\n    return this._captionEditorRef.value;\n  }\n\n  constructor() {\n    super();\n    this.addRenderer(this._renderWithWidget);\n  }\n\n  private _renderWithWidget(content: unknown) {\n    const style = styleMap({\n      position: 'relative',\n      ...this.blockContainerStyles,\n    });\n    const theme = this.std.get(ThemeProvider).theme;\n    const isBorder = this.selectedStyle === SelectedStyle.Border;\n\n    return html`<div\n      style=${style}\n      class=${classMap({\n        'affine-block-component': true,\n        [theme]: true,\n        border: isBorder,\n      })}\n    >\n      ${content}\n      ${this.useCaptionEditor\n        ? html`<block-caption-editor\n            ${ref(this._captionEditorRef)}\n          ></block-caption-editor>`\n        : nothing}\n      ${this.selectedStyle === SelectedStyle.Background\n        ? html`<affine-block-selection .block=${this}></affine-block-selection>`\n        : null}\n      ${this.useZeroWidth && !this.doc.readonly\n        ? html`<block-zero-width .block=${this}></block-zero-width>`\n        : nothing}\n    </div>`;\n  }\n\n  // There may be multiple block-caption-editors in a nested structure.\n  private accessor _captionEditorRef: Ref<BlockCaptionEditor> =\n    createRef<BlockCaptionEditor>();\n\n  protected accessor blockContainerStyles: StyleInfo | undefined = undefined;\n\n  protected accessor selectedStyle = SelectedStyle.Background;\n\n  protected accessor useCaptionEditor = false;\n\n  protected accessor useZeroWidth = false;\n}\n"]}