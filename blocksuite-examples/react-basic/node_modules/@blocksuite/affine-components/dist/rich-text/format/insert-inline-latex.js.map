{"version":3,"file":"insert-inline-latex.js","sourceRoot":"","sources":["../../../src/rich-text/format/insert-inline-latex.ts"],"names":[],"mappings":"AAEA,MAAM,CAAC,MAAM,iBAAiB,GAM1B,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,aAAa,GAAG,GAAG,CAAC,aAAa,IAAI,GAAG,CAAC,oBAAoB,CAAC;IACpE,IAAI,CAAC,aAAa,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE;QAAE,OAAO;IAE3D,MAAM,cAAc,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACzE,IAAI,CAAC,cAAc;QAAE,OAAO;IAE5B,MAAM,QAAQ,GAAG,cAAc,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;IAC3D,IAAI,CAAC,QAAQ;QAAE,OAAO;IAEtB,MAAM,YAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;IAC3C,IAAI,CAAC,YAAY;QAAE,OAAO;IAE1B,YAAY,CAAC,UAAU,CACrB;QACE,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,KAAK;QAC/B,MAAM,EAAE,CAAC;KACV,EACD,GAAG,CACJ,CAAC;IACF,YAAY,CAAC,UAAU,CACrB;QACE,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,KAAK;QAC/B,MAAM,EAAE,CAAC;KACV,EACD;QACE,KAAK,EAAE,EAAE;KACV,CACF,CAAC;IACF,YAAY,CAAC,cAAc,CAAC;QAC1B,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,KAAK;QAC/B,MAAM,EAAE,CAAC;KACV,CAAC,CAAC;IAEH,YAAY;SACT,aAAa,EAAE;SACf,IAAI,CAAC,KAAK,IAAI,EAAE;QACf,MAAM,YAAY,CAAC,aAAa,EAAE,CAAC;QAEnC,MAAM,SAAS,GAAG,YAAY,CAAC,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;QAC1E,IAAI,CAAC,SAAS;YAAE,OAAO;QACvB,MAAM,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;QACzB,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;QACnE,IAAI,CAAC,SAAS;YAAE,OAAO;QACvB,SAAS,CAAC,YAAY,EAAE,CAAC;IAC3B,CAAC,CAAC;SACD,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IAExB,IAAI,EAAE,CAAC;AACT,CAAC,CAAC","sourcesContent":["import type { Command, TextSelection } from '@blocksuite/block-std';\n\nexport const insertInlineLatex: Command<\n  'currentTextSelection',\n  never,\n  {\n    textSelection?: TextSelection;\n  }\n> = (ctx, next) => {\n  const textSelection = ctx.textSelection ?? ctx.currentTextSelection;\n  if (!textSelection || !textSelection.isCollapsed()) return;\n\n  const blockComponent = ctx.std.view.getBlock(textSelection.from.blockId);\n  if (!blockComponent) return;\n\n  const richText = blockComponent.querySelector('rich-text');\n  if (!richText) return;\n\n  const inlineEditor = richText.inlineEditor;\n  if (!inlineEditor) return;\n\n  inlineEditor.insertText(\n    {\n      index: textSelection.from.index,\n      length: 0,\n    },\n    ' '\n  );\n  inlineEditor.formatText(\n    {\n      index: textSelection.from.index,\n      length: 1,\n    },\n    {\n      latex: '',\n    }\n  );\n  inlineEditor.setInlineRange({\n    index: textSelection.from.index,\n    length: 1,\n  });\n\n  inlineEditor\n    .waitForUpdate()\n    .then(async () => {\n      await inlineEditor.waitForUpdate();\n\n      const textPoint = inlineEditor.getTextPoint(textSelection.from.index + 1);\n      if (!textPoint) return;\n      const [text] = textPoint;\n      const latexNode = text.parentElement?.closest('affine-latex-node');\n      if (!latexNode) return;\n      latexNode.toggleEditor();\n    })\n    .catch(console.error);\n\n  next();\n};\n"]}