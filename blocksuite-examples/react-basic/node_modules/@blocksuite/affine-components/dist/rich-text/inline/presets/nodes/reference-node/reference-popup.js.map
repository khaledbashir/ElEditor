{"version":3,"file":"reference-popup.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\nimport type { InlineRange } from '@blocksuite/inline';\n\nimport {\n  GenerateDocUrlProvider,\n  type LinkEventType,\n  type TelemetryEvent,\n  TelemetryProvider,\n} from '@blocksuite/affine-shared/services';\nimport {\n  cloneReferenceInfoWithoutAliases,\n  isInsideBlockByFlavour,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  BLOCK_ID_ATTR,\n  type BlockComponent,\n  type BlockStdScope,\n} from '@blocksuite/block-std';\nimport { assertExists, WithDisposable } from '@blocksuite/global/utils';\nimport { computePosition, inline, offset, shift } from '@floating-ui/dom';\nimport { effect } from '@preact/signals-core';\nimport { html, LitElement, nothing } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AffineInlineEditor } from '../../affine-inline-specs.js';\n\nimport {\n  CenterPeekIcon,\n  CopyIcon,\n  DeleteIcon,\n  EditIcon,\n  ExpandFullSmallIcon,\n  MoreVerticalIcon,\n  OpenIcon,\n  SmallArrowDownIcon,\n} from '../../../../../icons/index.js';\nimport { notifyLinkedDocSwitchedToEmbed } from '../../../../../notification/index.js';\nimport { isPeekable, peek } from '../../../../../peek/index.js';\nimport { toast } from '../../../../../toast/toast.js';\nimport {\n  type MenuItem,\n  renderActions,\n  renderToolbarSeparator,\n} from '../../../../../toolbar/index.js';\nimport { RefNodeSlotsProvider } from '../../../../extension/index.js';\nimport { ReferenceAliasPopup } from './reference-alias-popup.js';\nimport { styles } from './styles.js';\n\nexport class ReferencePopup extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  private _copyLink = () => {\n    const url = this.std\n      .getOptional(GenerateDocUrlProvider)\n      ?.generateDocUrl(this.referenceInfo.pageId, this.referenceInfo.params);\n\n    if (url) {\n      navigator.clipboard.writeText(url).catch(console.error);\n      toast(this.std.host, 'Copied link to clipboard');\n    }\n\n    this.abortController.abort();\n\n    track(this.std, 'CopiedLink', { control: 'copy link' });\n  };\n\n  private _openDoc = () => {\n    this.std\n      .getOptional(RefNodeSlotsProvider)\n      ?.docLinkClicked.emit(this.referenceInfo);\n  };\n\n  private _openEditPopup = (e: MouseEvent) => {\n    e.stopPropagation();\n\n    if (document.body.querySelector('reference-alias-popup')) {\n      return;\n    }\n\n    const {\n      std,\n      docTitle,\n      referenceInfo,\n      inlineEditor,\n      targetInlineRange,\n      abortController,\n    } = this;\n\n    const aliasPopup = new ReferenceAliasPopup();\n\n    aliasPopup.std = std;\n    aliasPopup.docTitle = docTitle;\n    aliasPopup.referenceInfo = referenceInfo;\n    aliasPopup.inlineEditor = inlineEditor;\n    aliasPopup.inlineRange = targetInlineRange;\n\n    document.body.append(aliasPopup);\n\n    abortController.abort();\n\n    track(std, 'OpenedAliasPopup', { control: 'edit' });\n  };\n\n  private _toggleViewSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, 'OpenedViewSelector', { control: 'switch view' });\n  };\n\n  private _trackViewSelected = (type: string) => {\n    track(this.std, 'SelectedView', {\n      control: 'select view',\n      type: `${type} view`,\n    });\n  };\n\n  get _embedViewButtonDisabled() {\n    if (\n      this.block.doc.readonly ||\n      isInsideBlockByFlavour(\n        this.block.doc,\n        this.block.model,\n        'affine:edgeless-text'\n      )\n    ) {\n      return true;\n    }\n    return (\n      !!this.block.closest('affine-embed-synced-doc-block') ||\n      this.referenceDocId === this.doc.id\n    );\n  }\n\n  get _openButtonDisabled() {\n    return this.referenceDocId === this.doc.id;\n  }\n\n  get block() {\n    const block = this.inlineEditor.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(block);\n    return block;\n  }\n\n  get doc() {\n    const doc = this.block.doc;\n    assertExists(doc);\n    return doc;\n  }\n\n  get referenceDocId() {\n    const docId = this.inlineEditor.getFormat(this.targetInlineRange).reference\n      ?.pageId;\n    assertExists(docId);\n    return docId;\n  }\n\n  get std() {\n    const std = this.block.std;\n    assertExists(std);\n    return std;\n  }\n\n  private _convertToCardView() {\n    const block = this.block;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n\n    doc.addBlock(\n      'affine:embed-linked-doc',\n      this.referenceInfo,\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _convertToEmbedView() {\n    const block = this.block;\n    const std = block.std;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n    const referenceInfo = this.referenceInfo;\n    const hasTitleAlias = Boolean(referenceInfo.title);\n\n    doc.addBlock(\n      'affine:embed-synced-doc',\n      cloneReferenceInfoWithoutAliases(referenceInfo),\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    if (hasTitleAlias) {\n      notifyLinkedDocSwitchedToEmbed(std);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _delete() {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.deleteText(this.targetInlineRange);\n    }\n    this.abortController.abort();\n  }\n\n  private _moreActions() {\n    return renderActions([\n      [\n        {\n          type: 'delete',\n          label: 'Delete',\n          icon: DeleteIcon,\n          disabled: this.doc.readonly,\n          action: () => this._delete(),\n        },\n      ],\n    ]);\n  }\n\n  private _openMenuButton() {\n    const buttons: MenuItem[] = [\n      {\n        label: 'Open this doc',\n        type: 'open-this-doc',\n        icon: ExpandFullSmallIcon,\n        action: this._openDoc,\n        disabled: this._openButtonDisabled,\n      },\n    ];\n\n    // open in new tab\n\n    if (isPeekable(this.target)) {\n      buttons.push({\n        label: 'Open in center peek',\n        type: 'open-in-center-peek',\n        icon: CenterPeekIcon,\n        action: () => peek(this.target),\n      });\n    }\n\n    // open in split view\n\n    if (buttons.length === 0) {\n      return nothing;\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Open doc\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n          >\n            ${OpenIcon}${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"large\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.label,\n            ({ label, icon, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${ifDefined(label)}\n                ?disabled=${disabled}\n                @click=${action}\n              >\n                ${icon}<span class=\"label\">${label}</span>\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  private _viewSelector() {\n    // synced doc entry controlled by awareness flag\n    const isSyncedDocEnabled = this.doc.awarenessStore.getFlag(\n      'enable_synced_doc_block'\n    );\n    const buttons = [];\n\n    buttons.push({\n      type: 'inline',\n      label: 'Inline view',\n    });\n\n    buttons.push({\n      type: 'card',\n      label: 'Card view',\n      action: () => this._convertToCardView(),\n      disabled: this.doc.readonly,\n    });\n\n    if (isSyncedDocEnabled) {\n      buttons.push({\n        type: 'embed',\n        label: 'Embed view',\n        action: () => this._convertToEmbedView(),\n        disabled:\n          this.doc.readonly ||\n          this.isLinkedNode ||\n          this._embedViewButtonDisabled,\n      });\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Switch view\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n            .iconContainerWidth=${'110px'}\n          >\n            <span class=\"label\">Inline view</span>\n            ${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n        @toggle=${this._toggleViewSelector}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.type,\n            ({ type, label, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${label}\n                data-testid=${`link-to-${type}`}\n                ?data-selected=${type === 'inline'}\n                ?disabled=${disabled || type === 'inline'}\n                @click=${() => {\n                  action?.();\n                  this._trackViewSelected(type);\n                }}\n              >\n                ${label}\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.targetInlineRange.length === 0) {\n      return;\n    }\n\n    const parent = this.block.host.doc.getParent(this.block.model);\n    assertExists(parent);\n\n    this.disposables.add(\n      effect(() => {\n        const children = parent.children;\n        if (children.includes(this.block.model)) return;\n        this.abortController.abort();\n      })\n    );\n  }\n\n  override render() {\n    const titleButton = this.referenceInfo.title\n      ? html`\n          <editor-icon-button\n            class=\"doc-title\"\n            aria-label=\"Doc title\"\n            .hover=${false}\n            .labelHeight=${'20px'}\n            .tooltip=${this.docTitle}\n            @click=${this._openDoc}\n          >\n            <span class=\"label\">${this.docTitle}</span>\n          </editor-icon-button>\n        `\n      : nothing;\n\n    const buttons = [\n      this._openMenuButton(),\n\n      html`\n        ${titleButton}\n\n        <editor-icon-button\n          aria-label=\"Copy link\"\n          data-testid=\"copy-link\"\n          .tooltip=${'Copy link'}\n          @click=${this._copyLink}\n        >\n          ${CopyIcon}\n        </editor-icon-button>\n\n        <editor-icon-button\n          aria-label=\"Edit\"\n          data-testid=\"edit\"\n          .tooltip=${'Edit'}\n          ?disabled=${this.doc.readonly}\n          @click=${this._openEditPopup}\n        >\n          ${EditIcon}\n        </editor-icon-button>\n      `,\n\n      this._viewSelector(),\n\n      html`\n        <editor-menu-button\n          .contentPadding=${'8px'}\n          .button=${html`\n            <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n              ${MoreVerticalIcon}\n            </editor-icon-button>\n          `}\n        >\n          <div data-size=\"large\" data-orientation=\"vertical\">\n            ${this._moreActions()}\n          </div>\n        </editor-menu-button>\n      `,\n    ];\n\n    return html`\n      <div class=\"overlay-root\">\n        <div class=\"affine-reference-popover-container\">\n          <editor-toolbar class=\"affine-reference-popover view\">\n            ${join(\n              buttons.filter(button => button !== nothing),\n              renderToolbarSeparator\n            )}\n          </editor-toolbar>\n        </div>\n      </div>\n    `;\n  }\n\n  override updated() {\n    assertExists(this.popupContainer);\n    const range = this.inlineEditor.toDomRange(this.targetInlineRange);\n    assertExists(range);\n\n    const visualElement = {\n      getBoundingClientRect: () => range.getBoundingClientRect(),\n      getClientRects: () => range.getClientRects(),\n    };\n    computePosition(visualElement, this.popupContainer, {\n      middleware: [\n        offset(10),\n        inline(),\n        shift({\n          padding: 6,\n        }),\n      ],\n    })\n      .then(({ x, y }) => {\n        const popupContainer = this.popupContainer;\n        if (!popupContainer) return;\n        popupContainer.style.left = `${x}px`;\n        popupContainer.style.top = `${y}px`;\n      })\n      .catch(console.error);\n  }\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @property({ attribute: false })\n  accessor docTitle!: string;\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @property({ attribute: false })\n  accessor isLinkedNode!: boolean;\n\n  @query('.affine-reference-popover-container')\n  accessor popupContainer!: HTMLDivElement;\n\n  @property({ type: Object })\n  accessor referenceInfo!: ReferenceInfo;\n\n  @property({ attribute: false })\n  accessor target!: LitElement;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n}\n\nexport function toggleReferencePopup(\n  target: LitElement,\n  isLinkedNode: boolean,\n  referenceInfo: ReferenceInfo,\n  inlineEditor: AffineInlineEditor,\n  targetInlineRange: InlineRange,\n  docTitle: string,\n  abortController: AbortController\n): ReferencePopup {\n  const popup = new ReferencePopup();\n  popup.target = target;\n  popup.isLinkedNode = isLinkedNode;\n  popup.referenceInfo = referenceInfo;\n  popup.inlineEditor = inlineEditor;\n  popup.targetInlineRange = targetInlineRange;\n  popup.docTitle = docTitle;\n  popup.abortController = abortController;\n\n  document.body.append(popup);\n\n  return popup;\n}\n\nfunction track(\n  std: BlockStdScope,\n  event: LinkEventType,\n  props: Partial<TelemetryEvent>\n) {\n  std.getOptional(TelemetryProvider)?.track(event, {\n    segment: 'toolbar',\n    page: 'doc editor',\n    module: 'reference toolbar',\n    type: 'inline view',\n    category: 'linked doc',\n    ...props,\n  });\n}\n"]}