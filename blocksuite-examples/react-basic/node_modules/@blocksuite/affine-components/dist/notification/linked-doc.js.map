{"version":3,"file":"linked-doc.js","sourceRoot":"","sources":["../../src/notification/linked-doc.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,oBAAoB,EAAE,MAAM,oCAAoC,CAAC;AAE1E,OAAO,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAE1C,SAAS,MAAM,CAAC,GAAkB,EAAE,KAAa,EAAE,OAAe;IAChE,MAAM,YAAY,GAAG,GAAG,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC;IAC3D,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC;IAE1B,IAAI,CAAC,YAAY,EAAE,CAAC;QAClB,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QACnB,OAAO;IACT,CAAC;IAED,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;IAC9C,MAAM,KAAK,GAAG,GAAG,EAAE;QACjB,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,UAAU,CAAC,CAAC;QAChD,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,UAAU,CAAC,CAAC;QACjD,UAAU,CAAC,OAAO,EAAE,CAAC;IACvB,CAAC,CAAC;IACF,MAAM,WAAW,GAAG,GAAG,EAAE;QACvB,eAAe,CAAC,KAAK,EAAE,CAAC;QACxB,KAAK,EAAE,CAAC;IACV,CAAC,CAAC;IAEF,iDAAiD;IACjD,MAAM,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,kBAAkB,EAAE,WAAW,CAAC,CAAC;IACnE,MAAM,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;IACpE,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC;IAExD,YAAY,CAAC,MAAM,CAAC;QAClB,KAAK;QACL,OAAO;QACP,MAAM,EAAE,MAAM;QACd,QAAQ,EAAE,EAAE,GAAG,IAAI;QACnB,MAAM,EAAE;YACN,KAAK,EAAE,MAAM;YACb,OAAO,EAAE,GAAG,EAAE;gBACZ,GAAG,CAAC,IAAI,EAAE,CAAC;gBACX,KAAK,EAAE,CAAC;YACV,CAAC;SACF;QACD,KAAK,EAAE,eAAe,CAAC,MAAM;QAC7B,OAAO,EAAE,KAAK;KACf,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,6BAA6B,CAAC,GAAkB;IAC9D,MAAM,CACJ,GAAG,EACH,cAAc,EACd,sFAAsF,CACvF,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,8BAA8B,CAAC,GAAkB;IAC/D,MAAM,CACJ,GAAG,EACH,qBAAqB,EACrB,uFAAuF,CACxF,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,6BAA6B,CAAC,GAAkB;IAC9D,MAAM,CACJ,GAAG,EACH,kBAAkB,EAClB,0GAA0G,CAC3G,CAAC;AACJ,CAAC","sourcesContent":["import type { BlockStdScope } from '@blocksuite/block-std';\n\nimport { NotificationProvider } from '@blocksuite/affine-shared/services';\n\nimport { toast } from '../toast/toast.js';\n\nfunction notify(std: BlockStdScope, title: string, message: string) {\n  const notification = std.getOptional(NotificationProvider);\n  const { doc, host } = std;\n\n  if (!notification) {\n    toast(host, title);\n    return;\n  }\n\n  const abortController = new AbortController();\n  const clear = () => {\n    doc.history.off('stack-item-added', addHandler);\n    doc.history.off('stack-item-popped', popHandler);\n    disposable.dispose();\n  };\n  const closeNotify = () => {\n    abortController.abort();\n    clear();\n  };\n\n  // edit or undo or switch doc, close notify toast\n  const addHandler = doc.history.on('stack-item-added', closeNotify);\n  const popHandler = doc.history.on('stack-item-popped', closeNotify);\n  const disposable = host.slots.unmounted.on(closeNotify);\n\n  notification.notify({\n    title,\n    message,\n    accent: 'info',\n    duration: 10 * 1000,\n    action: {\n      label: 'Undo',\n      onClick: () => {\n        doc.undo();\n        clear();\n      },\n    },\n    abort: abortController.signal,\n    onClose: clear,\n  });\n}\n\nexport function notifyLinkedDocSwitchedToCard(std: BlockStdScope) {\n  notify(\n    std,\n    'View Updated',\n    'The alias modification has disabled sync. The embed has been updated to a card view.'\n  );\n}\n\nexport function notifyLinkedDocSwitchedToEmbed(std: BlockStdScope) {\n  notify(\n    std,\n    'Embed View Restored',\n    'Custom alias removed. The linked doc now displays the original title and description.'\n  );\n}\n\nexport function notifyLinkedDocClearedAliases(std: BlockStdScope) {\n  notify(\n    std,\n    'Reset successful',\n    `Card view has been restored to original doc title and description. All custom aliases have been removed.`\n  );\n}\n"]}