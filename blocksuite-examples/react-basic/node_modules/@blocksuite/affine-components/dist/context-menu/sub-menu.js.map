{"version":3,"file":"sub-menu.js","sourceRoot":"","sources":["../../src/context-menu/sub-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_MOBILE } from '@blocksuite/global/env';\nimport { ArrowRightSmallIcon } from '@blocksuite/icons/lit';\nimport {\n  autoPlacement,\n  autoUpdate,\n  computePosition,\n  offset,\n} from '@floating-ui/dom';\nimport { html, nothing, type TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport type { MenuItemRender } from './types.js';\n\nimport { MenuFocusable } from './focusable.js';\nimport { Menu, type MenuOptions } from './menu.js';\nimport { popMenu, popupTargetFromElement } from './menu-renderer.js';\n\nexport type MenuSubMenuData = {\n  content: () => TemplateResult;\n  options: MenuOptions;\n  select?: () => void;\n  class?: string;\n};\nexport const subMenuOffset = offset({\n  mainAxis: 16,\n  crossAxis: -8.5,\n});\nexport const subMenuPlacements = autoPlacement({\n  allowedPlacements: ['right-start', 'left-start', 'right-end', 'left-end'],\n});\nexport const subMenuMiddleware = [subMenuOffset, subMenuPlacements];\n\nexport class MenuSubMenu extends MenuFocusable {\n  createTime = 0;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.createTime = Date.now();\n    this.disposables.addFromEvent(this, 'mouseenter', this.onMouseEnter);\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (this.data.select) {\n        this.data.select();\n        this.menu.close();\n      } else {\n        this.openSubMenu();\n      }\n    });\n  }\n\n  onMouseEnter() {\n    if (Date.now() - this.createTime > 100) {\n      this.openSubMenu();\n    }\n  }\n\n  override onPressEnter() {\n    this.onMouseEnter();\n  }\n\n  openSubMenu() {\n    const focus = this.menu.currentFocused$.value;\n    const menu = new Menu({\n      ...this.data.options,\n      onComplete: () => {\n        this.menu.close();\n      },\n      onClose: () => {\n        menu.menuElement.remove();\n        this.menu.focusTo(focus);\n        this.data.options.onClose?.();\n        unsub();\n      },\n    });\n    this.menu.menuElement.parentElement?.append(menu.menuElement);\n    const unsub = autoUpdate(this, menu.menuElement, () => {\n      computePosition(this, menu.menuElement, {\n        middleware: subMenuMiddleware,\n      })\n        .then(({ x, y }) => {\n          menu.menuElement.style.left = `${x}px`;\n          menu.menuElement.style.top = `${y}px`;\n        })\n        .catch(err => console.error(err));\n    });\n    this.menu.openSubMenu(menu);\n  }\n\n  protected override render(): unknown {\n    const classString = classMap({\n      [this.data.class ?? '']: true,\n      'affine-menu-button': true,\n      focused: this.isFocused$.value,\n    });\n    return html` <div class=\"${classString}\">${this.data.content()}</div>`;\n  }\n\n  @property({ attribute: false })\n  accessor data!: MenuSubMenuData;\n}\n\nexport class MobileSubMenu extends MenuFocusable {\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.openSubMenu();\n    });\n  }\n\n  onMouseEnter() {\n    this.openSubMenu();\n  }\n\n  override onPressEnter() {\n    this.onMouseEnter();\n  }\n\n  openSubMenu() {\n    const { menu } = popMenu(popupTargetFromElement(this), {\n      options: {\n        ...this.data.options,\n        onComplete: () => {\n          this.menu.close();\n        },\n        onClose: () => {\n          menu.menuElement.remove();\n          this.data.options.onClose?.();\n        },\n      },\n    });\n    this.menu.openSubMenu(menu);\n  }\n\n  protected override render(): unknown {\n    const classString = classMap({\n      [this.data.class ?? '']: true,\n      'mobile-menu-button': true,\n      focused: this.isFocused$.value,\n    });\n    return html` <div class=\"${classString}\">${this.data.content()}</div>`;\n  }\n\n  @property({ attribute: false })\n  accessor data!: MenuSubMenuData;\n}\n\nexport const renderSubMenu = (data: MenuSubMenuData, menu: Menu) => {\n  if (IS_MOBILE) {\n    return html` <mobile-sub-menu\n      .data=\"${data}\"\n      .menu=\"${menu}\"\n    ></mobile-sub-menu>`;\n  }\n  return html` <affine-menu-sub-menu\n    .data=\"${data}\"\n    .menu=\"${menu}\"\n  ></affine-menu-sub-menu>`;\n};\n\nexport const subMenuItems = {\n  subMenu:\n    (config: {\n      name: string;\n      label?: () => TemplateResult;\n      select?: () => void;\n      isSelected?: boolean;\n      postfix?: TemplateResult;\n      prefix?: TemplateResult;\n      class?: string;\n      options: MenuOptions;\n      disableArrow?: boolean;\n      hide?: () => boolean;\n    }) =>\n    menu => {\n      if (config.hide?.() || !menu.search(config.name)) {\n        return;\n      }\n      const data: MenuSubMenuData = {\n        content: () =>\n          html`${config.prefix}\n            <div class=\"affine-menu-action-text\">\n              ${config.label?.() ?? config.name}\n            </div>\n            ${config.postfix}\n            ${config.disableArrow ? nothing : ArrowRightSmallIcon()} `,\n        class: config.class,\n        options: config.options,\n      };\n      return renderSubMenu(data, menu);\n    },\n} satisfies Record<string, MenuItemRender<never>>;\n"]}