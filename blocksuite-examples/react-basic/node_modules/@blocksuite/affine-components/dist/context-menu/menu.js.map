{"version":3,"file":"menu.js","sourceRoot":"","sources":["../../src/context-menu/menu.ts"],"names":[],"mappings":"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","sourcesContent":["import type { TemplateResult } from 'lit';\n\nimport { IS_MOBILE } from '@blocksuite/global/env';\nimport { computed, signal } from '@preact/signals-core';\n\nimport type { MenuComponentInterface, MenuItemRender } from './types.js';\n\nimport { menuButtonItems } from './button.js';\nimport { menuDynamicItems } from './dynamic.js';\nimport { MenuFocusable } from './focusable.js';\nimport { menuGroupItems } from './group.js';\nimport { menuInputItems } from './input.js';\nimport { MenuComponent, MobileMenuComponent } from './menu-renderer.js';\nimport { subMenuItems } from './sub-menu.js';\n\nexport const menu = {\n  ...menuButtonItems,\n  ...subMenuItems,\n  ...menuInputItems,\n  ...menuGroupItems,\n  ...menuDynamicItems,\n} satisfies Record<string, MenuItemRender<never>>;\nexport type MenuConfig = (\n  menu: Menu,\n  index: number\n) => TemplateResult | undefined;\n\nexport type MenuOptions = {\n  onComplete?: () => void;\n  onClose?: () => void;\n  title?: {\n    text: string;\n    onBack?: (menu: Menu) => void;\n    onClose?: () => void;\n    postfix?: () => TemplateResult;\n  };\n  search?: {\n    placeholder?: string;\n  };\n  items: MenuConfig[];\n};\n\n// Global menu open listener type\ntype MenuOpenListener = (menu: Menu) => (() => void) | void;\n\n// Global menu open listeners\nconst menuOpenListeners = new Set<MenuOpenListener>();\n\n// Add global menu open listener\nexport function onMenuOpen(listener: MenuOpenListener) {\n  menuOpenListeners.add(listener);\n  // Return cleanup function\n  return () => {\n    menuOpenListeners.delete(listener);\n  };\n}\n\nexport class Menu {\n  private _cleanupFns: Array<() => void> = [];\n\n  private _currentFocused$ = signal<MenuFocusable>();\n\n  private _subMenu$ = signal<Menu>();\n\n  closed = false;\n\n  readonly currentFocused$ = computed(() => this._currentFocused$.value);\n\n  menuElement: MenuComponentInterface;\n\n  searchName$ = signal('');\n\n  searchResult$ = computed(() => {\n    return this.renderItems(this.options.items);\n  });\n\n  showSearch$ = computed(() => {\n    return this.enableSearch && this.searchName$.value.length > 0;\n  });\n\n  get enableSearch() {\n    return true;\n  }\n\n  constructor(public options: MenuOptions) {\n    this.menuElement = IS_MOBILE\n      ? new MobileMenuComponent()\n      : new MenuComponent();\n    this.menuElement.menu = this;\n\n    // Call global menu open listeners\n    menuOpenListeners.forEach(listener => {\n      const cleanup = listener(this);\n      if (cleanup) {\n        this._cleanupFns.push(cleanup);\n      }\n    });\n  }\n\n  close() {\n    if (this.closed) {\n      return;\n    }\n    this.closed = true;\n    // Execute cleanup functions\n    this._cleanupFns.forEach(cleanup => cleanup());\n    this._cleanupFns = [];\n\n    this.menuElement.remove();\n    this.options.onClose?.();\n  }\n\n  closeSubMenu() {\n    this._subMenu$.value?.close();\n    this._subMenu$.value = undefined;\n  }\n\n  focusNext() {\n    if (!this._currentFocused$.value) {\n      const ele = this.menuElement.getFirstFocusableElement();\n      if (ele instanceof MenuFocusable) {\n        ele.focus();\n      }\n      return;\n    }\n    const list = this.menuElement\n      .getFocusableElements()\n      .filter(ele => ele instanceof MenuFocusable);\n    const index = list.indexOf(this._currentFocused$.value);\n    list[index + 1]?.focus();\n  }\n\n  focusPrev() {\n    if (!this._currentFocused$.value) {\n      return;\n    }\n    const list = this.menuElement\n      .getFocusableElements()\n      .filter(ele => ele instanceof MenuFocusable);\n    const index = list.indexOf(this._currentFocused$.value);\n    if (index === 0) {\n      this._currentFocused$.value = undefined;\n      return;\n    }\n    list[index - 1]?.focus();\n  }\n\n  focusTo(ele?: MenuFocusable) {\n    this.menuElement.focusTo(ele);\n  }\n\n  openSubMenu(menu: Menu) {\n    this.closeSubMenu();\n    this._subMenu$.value = menu;\n  }\n\n  pressEnter() {\n    this._currentFocused$.value?.onPressEnter();\n  }\n\n  renderItems(items: MenuConfig[]) {\n    const result = [];\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      const template = item(this, result.length);\n      if (template != null) {\n        result.push(template);\n      }\n    }\n    return result;\n  }\n\n  search(name: string) {\n    return name.toLowerCase().includes(this.searchName$.value.toLowerCase());\n  }\n\n  setFocusOnly(ele?: MenuFocusable) {\n    this._currentFocused$.value = ele;\n  }\n}\n"]}