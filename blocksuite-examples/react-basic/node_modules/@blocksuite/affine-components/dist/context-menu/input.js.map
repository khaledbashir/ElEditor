{"version":3,"file":"input.js","sourceRoot":"","sources":["../../src/context-menu/input.ts"],"names":[],"mappings":"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","sourcesContent":["import type { StyleInfo } from 'lit-html/directives/style-map.js';\n\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { IS_MOBILE } from '@blocksuite/global/env';\nimport { cssVarV2 } from '@toeverything/theme/v2';\nimport { css, html, type TemplateResult } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { Menu } from './menu.js';\nimport type { MenuItemRender } from './types.js';\n\nimport { MenuFocusable } from './focusable.js';\n\nexport type MenuInputData = {\n  placeholder?: string;\n  initialValue?: string;\n  class?: string;\n  onComplete?: (value: string) => void;\n  onChange?: (value: string) => void;\n  disableAutoFocus?: boolean;\n};\n\nexport class MenuInput extends MenuFocusable {\n  static override styles = css`\n    .affine-menu-input {\n      flex: 1;\n      outline: none;\n      border-radius: 4px;\n      font-size: 14px;\n      line-height: 22px;\n      padding: 4px 6px;\n      border: 1px solid var(--affine-border-color);\n      width: 100%;\n      color: ${unsafeCSSVarV2('text/primary')};\n      background-color: transparent;\n    }\n\n    .affine-menu-input.focused {\n      border: 1px solid ${unsafeCSSVarV2('layer/insideBorder/primaryBorder')};\n    }\n\n    .affine-menu-input:focus {\n      border: 1px solid ${unsafeCSSVarV2('layer/insideBorder/primaryBorder')};\n      box-shadow: 0px 0px 0px 2px rgba(28, 158, 228, 0.3);\n    }\n  `;\n\n  private onCompositionEnd = () => {\n    this.data.onChange?.(this.inputRef.value);\n  };\n\n  private onInput = (e: InputEvent) => {\n    e.stopPropagation();\n    if (e.isComposing) return;\n    this.data.onChange?.(this.inputRef.value);\n  };\n\n  private onKeydown = (e: KeyboardEvent) => {\n    e.stopPropagation();\n    if (e.isComposing) return;\n    if (e.key === 'Escape') {\n      this.complete();\n      this.inputRef.blur();\n      this.menu.focusTo(this);\n      return;\n    }\n    if (e.key === 'Enter') {\n      this.complete();\n      this.menu.close();\n      return;\n    }\n  };\n\n  private stopPropagation = (e: Event) => {\n    e.stopPropagation();\n  };\n\n  complete() {\n    this.data.onComplete?.(this.inputRef.value);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n    });\n    this.disposables.addFromEvent(this, 'mouseenter', () => {\n      this.menu.closeSubMenu();\n    });\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        this.inputRef.select();\n      });\n    });\n  }\n\n  override onPressEnter() {\n    this.inputRef.focus();\n  }\n\n  protected override render(): unknown {\n    const classString = classMap({\n      [this.data.class ?? '']: true,\n      'affine-menu-input': true,\n      focused: this.isFocused$.value,\n    });\n\n    return html`<input\n      @focus=\"${() => {\n        this.menu.setFocusOnly(this);\n      }}\"\n      @input=\"${this.onInput}\"\n      @keydown=\"${this.onKeydown}\"\n      @copy=\"${this.stopPropagation}\"\n      @paste=\"${this.stopPropagation}\"\n      @compositionend=\"${this.onCompositionEnd}\"\n      class=\"${classString}\"\n      value=\"${this.data.initialValue ?? ''}\"\n      type=\"text\"\n    />`;\n  }\n\n  @property({ attribute: false })\n  accessor data!: MenuInputData;\n\n  @query('input')\n  accessor inputRef!: HTMLInputElement;\n}\n\nexport class MobileMenuInput extends MenuFocusable {\n  static override styles = css`\n    .mobile-menu-input {\n      flex: 1;\n      outline: none;\n      font-size: 17px;\n      line-height: 22px;\n      border: none;\n      width: 100%;\n      color: ${unsafeCSSVarV2('text/primary')};\n    }\n  `;\n\n  private onCompositionEnd = () => {\n    this.data.onChange?.(this.inputRef.value);\n  };\n\n  private onInput = (e: InputEvent) => {\n    e.stopPropagation();\n    if (e.isComposing) return;\n    this.data.onChange?.(this.inputRef.value);\n  };\n\n  private stopPropagation = (e: Event) => {\n    e.stopPropagation();\n  };\n\n  complete() {\n    this.data.onComplete?.(this.inputRef.value);\n  }\n\n  override onPressEnter() {\n    this.inputRef.focus();\n  }\n\n  protected override render(): unknown {\n    const classString = classMap({\n      [this.data.class ?? '']: true,\n      'mobile-menu-input': true,\n      focused: this.isFocused$.value,\n    });\n\n    return html`<input\n      @focus=\"${() => {\n        this.menu.setFocusOnly(this);\n      }}\"\n      @input=\"${this.onInput}\"\n      @copy=\"${this.stopPropagation}\"\n      @paste=\"${this.stopPropagation}\"\n      @compositionend=\"${this.onCompositionEnd}\"\n      class=\"${classString}\"\n      value=\"${this.data.initialValue ?? ''}\"\n      type=\"text\"\n    />`;\n  }\n\n  @property({ attribute: false })\n  accessor data!: MenuInputData;\n\n  @query('input')\n  accessor inputRef!: HTMLInputElement;\n}\n\nconst renderInput = (data: MenuInputData, menu: Menu) => {\n  if (IS_MOBILE) {\n    return html` <mobile-menu-input\n      style=\"flex:1\"\n      .data=\"${data}\"\n      .menu=\"${menu}\"\n    ></mobile-menu-input>`;\n  }\n  return html` <affine-menu-input\n    style=\"flex:1\"\n    .data=\"${data}\"\n    .menu=\"${menu}\"\n  ></affine-menu-input>`;\n};\nexport const menuInputItems = {\n  input:\n    (config: {\n      placeholder?: string;\n      initialValue?: string;\n      postfix?: TemplateResult;\n      prefix?: TemplateResult;\n      onComplete?: (value: string) => void;\n      onChange?: (value: string) => void;\n      class?: string;\n      style?: Readonly<StyleInfo>;\n    }) =>\n    menu => {\n      if (menu.showSearch$.value) {\n        return;\n      }\n      const data: MenuInputData = {\n        placeholder: config.placeholder,\n        initialValue: config.initialValue,\n        class: config.class,\n        onComplete: config.onComplete,\n        onChange: config.onChange,\n      };\n      const style = styleMap({\n        display: 'flex',\n        alignItems: 'center',\n        ...(IS_MOBILE\n          ? {\n              borderRadius: '12px',\n              backgroundColor: cssVarV2('layer/background/primary'),\n              padding: '12px',\n              gap: '8px',\n            }\n          : {\n              marginBottom: '8px',\n              gap: '4px',\n            }),\n        ...config.style,\n      });\n      return html`\n        <div style=\"${style}\">\n          ${config.prefix} ${renderInput(data, menu)} ${config.postfix}\n        </div>\n      `;\n    },\n} satisfies Record<string, MenuItemRender<never>>;\n"]}