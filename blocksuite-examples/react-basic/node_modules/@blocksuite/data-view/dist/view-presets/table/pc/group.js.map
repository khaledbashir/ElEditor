{"version":3,"file":"group.js","sourceRoot":"","sources":["../../../../src/view-presets/table/pc/group.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popFilterableSimpleMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { PlusIcon } from '@blocksuite/icons/lit';\nimport { effect } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { DataViewRenderer } from '../../../core/data-view.js';\nimport type { GroupData } from '../../../core/group-by/trait.js';\nimport type { TableSingleView } from '../table-view-manager.js';\nimport type { DataViewTable } from './table-view.js';\n\nimport { GroupTitle } from '../../../core/group-by/group-title.js';\nimport { createDndContext } from '../../../core/utils/wc-dnd/dnd-context.js';\nimport { defaultActivators } from '../../../core/utils/wc-dnd/sensors/index.js';\nimport { linearMove } from '../../../core/utils/wc-dnd/utils/linear-move.js';\nimport { LEFT_TOOL_BAR_WIDTH } from '../consts.js';\nimport { TableAreaSelection } from '../types.js';\nimport { DataViewColumnPreview } from './header/column-renderer.js';\nimport { getVerticalIndicator } from './header/vertical-indicator.js';\n\nconst styles = css`\n  affine-data-view-table-group:hover .group-header-op {\n    visibility: visible;\n    opacity: 1;\n  }\n\n  .data-view-table-group-add-row {\n    display: flex;\n    width: 100%;\n    height: 28px;\n    position: relative;\n    z-index: 0;\n    cursor: pointer;\n    transition: opacity 0.2s ease-in-out;\n    padding: 4px 8px;\n    border-bottom: 1px solid var(--affine-border-color);\n  }\n\n  @media print {\n    .data-view-table-group-add-row {\n      display: none;\n    }\n  }\n\n  .data-view-table-group-add-row-button {\n    position: sticky;\n    left: ${8 + LEFT_TOOL_BAR_WIDTH}px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    user-select: none;\n    font-size: 12px;\n    line-height: 20px;\n    color: var(--affine-text-secondary-color);\n  }\n`;\n\nexport class TableGroup extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  private clickAddRow = () => {\n    this.view.rowAdd('end', this.group?.key);\n    requestAnimationFrame(() => {\n      const selectionController = this.viewEle.selectionController;\n      const index = this.view.properties$.value.findIndex(\n        v => v.type$.value === 'title'\n      );\n      selectionController.selection = TableAreaSelection.create({\n        groupKey: this.group?.key,\n        focus: {\n          rowIndex: this.rows.length - 1,\n          columnIndex: index,\n        },\n        isEditing: true,\n      });\n    });\n  };\n\n  private clickAddRowInStart = () => {\n    this.view.rowAdd('start', this.group?.key);\n    requestAnimationFrame(() => {\n      const selectionController = this.viewEle.selectionController;\n      const index = this.view.properties$.value.findIndex(\n        v => v.type$.value === 'title'\n      );\n      selectionController.selection = TableAreaSelection.create({\n        groupKey: this.group?.key,\n        focus: {\n          rowIndex: 0,\n          columnIndex: index,\n        },\n        isEditing: true,\n      });\n    });\n  };\n\n  private clickGroupOptions = (e: MouseEvent) => {\n    const group = this.group;\n    if (!group) {\n      return;\n    }\n    const ele = e.currentTarget as HTMLElement;\n    popFilterableSimpleMenu(popupTargetFromElement(ele), [\n      menu.action({\n        name: 'Ungroup',\n        hide: () => group.value == null,\n        select: () => {\n          group.rows.forEach(id => {\n            group.manager.removeFromGroup(id, group.key);\n          });\n        },\n      }),\n      menu.action({\n        name: 'Delete Cards',\n        select: () => {\n          this.view.rowDelete(group.rows);\n        },\n      }),\n    ]);\n  };\n\n  private renderGroupHeader = () => {\n    if (!this.group) {\n      return null;\n    }\n    return html`\n      <div\n        style=\"position: sticky;left: 0;width: max-content;padding: 6px 0;margin-bottom: 4px;display:flex;align-items:center;gap: 12px;max-width: 400px\"\n      >\n        ${GroupTitle(this.group, {\n          readonly: this.view.readonly$.value,\n          clickAdd: this.clickAddRowInStart,\n          clickOps: this.clickGroupOptions,\n        })}\n      </div>\n    `;\n  };\n\n  @property({ attribute: false })\n  accessor group: GroupData | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor view!: TableSingleView;\n\n  dndContext = createDndContext({\n    activators: defaultActivators,\n    container: this,\n    modifiers: [\n      ({ transform }) => {\n        return {\n          ...transform,\n          y: 0,\n        };\n      },\n    ],\n    onDragEnd: ({ over, active }) => {\n      if (over && over.id !== active.id) {\n        const activeIndex = this.view.properties$.value.findIndex(\n          data => data.id === active.id\n        );\n        const overIndex = this.view.properties$.value.findIndex(\n          data => data.id === over.id\n        );\n        this.view.propertyMove(active.id, {\n          before: activeIndex > overIndex,\n          id: over.id,\n        });\n      }\n    },\n    collisionDetection: linearMove(true),\n    createOverlay: active => {\n      const column = this.view.propertyGet(active.id);\n      const preview = new DataViewColumnPreview();\n      preview.column = column;\n      preview.group = this.group;\n      preview.container = this;\n      preview.style.position = 'absolute';\n      preview.style.zIndex = '999';\n      const scale = this.dndContext.scale$.value;\n      const offsetParentRect = this.offsetParent?.getBoundingClientRect();\n      if (!offsetParentRect) {\n        return;\n      }\n      preview.style.width = `${column.width$.value}px`;\n      preview.style.top = `${(active.rect.top - offsetParentRect.top - 1) / scale.y}px`;\n      preview.style.left = `${(active.rect.left - offsetParentRect.left) / scale.x}px`;\n      const cells = Array.from(\n        this.querySelectorAll(`[data-column-id=\"${active.id}\"]`)\n      ) as HTMLElement[];\n      cells.forEach(ele => {\n        ele.style.opacity = '0.1';\n      });\n      this.append(preview);\n      return {\n        overlay: preview,\n        cleanup: () => {\n          preview.remove();\n          cells.forEach(ele => {\n            ele.style.opacity = '1';\n          });\n        },\n      };\n    },\n  });\n\n  showIndicator = () => {\n    const columnMoveIndicator = getVerticalIndicator();\n    this.disposables.add(\n      effect(() => {\n        const active = this.dndContext.active$.value;\n        const over = this.dndContext.over$.value;\n        if (!active || !over) {\n          columnMoveIndicator.remove();\n          return;\n        }\n        const scrollX = this.dndContext.scrollOffset$.value.x;\n        const bottom =\n          this.rowsContainer?.getBoundingClientRect().bottom ??\n          this.getBoundingClientRect().bottom;\n        const left =\n          over.rect.left < active.rect.left ? over.rect.left : over.rect.right;\n        const height = bottom - over.rect.top;\n        columnMoveIndicator.display(left - scrollX, over.rect.top, height);\n      })\n    );\n  };\n\n  get rows() {\n    return this.group?.rows ?? this.view.rows$.value;\n  }\n\n  private renderRows(ids: string[]) {\n    return html`\n      <affine-database-column-header\n        .renderGroupHeader=\"${this.renderGroupHeader}\"\n        .tableViewManager=\"${this.view}\"\n      ></affine-database-column-header>\n      <div class=\"affine-database-block-rows\">\n        ${repeat(\n          ids,\n          id => id,\n          (id, idx) => {\n            return html` <data-view-table-row\n              data-row-index=\"${idx}\"\n              data-row-id=\"${id}\"\n              .dataViewEle=\"${this.dataViewEle}\"\n              .view=\"${this.view}\"\n              .rowId=\"${id}\"\n              .rowIndex=\"${idx}\"\n            ></data-view-table-row>`;\n          }\n        )}\n      </div>\n      ${this.view.readonly$.value\n        ? null\n        : html` <div\n            class=\"data-view-table-group-add-row dv-hover\"\n            @click=\"${this.clickAddRow}\"\n          >\n            <div\n              class=\"data-view-table-group-add-row-button dv-icon-16\"\n              data-test-id=\"affine-database-add-row-button\"\n              role=\"button\"\n            >\n              ${PlusIcon()}<span style=\"font-size: 12px\">New Record</span>\n            </div>\n          </div>`}\n      <affine-database-column-stats .view=\"${this.view}\" .group=\"${this.group}\">\n      </affine-database-column-stats>\n    `;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    this.showIndicator();\n  }\n\n  override render() {\n    return this.renderRows(this.rows);\n  }\n\n  @property({ attribute: false })\n  accessor dataViewEle!: DataViewRenderer;\n\n  @query('.affine-database-block-rows')\n  accessor rowsContainer: HTMLElement | null = null;\n\n  @property({ attribute: false })\n  accessor viewEle!: DataViewTable;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-table-group': TableGroup;\n  }\n}\n"]}