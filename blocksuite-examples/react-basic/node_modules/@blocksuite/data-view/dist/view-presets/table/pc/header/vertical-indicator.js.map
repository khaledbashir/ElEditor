{"version":3,"file":"vertical-indicator.js","sourceRoot":"","sources":["../../../../../src/view-presets/table/pc/header/vertical-indicator.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,cAAc,EAAE,MAAM,iCAAiC,CAAC;AACjE,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,MAAM,KAAK,CAAC;AAChC,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC7C,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAIvD,OAAO,EAAE,SAAS,EAAE,MAAM,gCAAgC,CAAC;AAC3D,OAAO,EAAE,gBAAgB,EAAE,MAAM,iCAAiC,CAAC;IAEtD,sBAAsB;sBAAS,cAAc,CAAC,iBAAiB,CAAC;;;;;;;;;;;;;;;;iBAAhE,sBAAuB,SAAQ,WAAiC;;;kCA+C1E,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;gCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;kCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;+BAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;iCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAX/B,uKAAS,MAAM,6BAAN,MAAM,uFAAU;YAGzB,iKAAS,IAAI,6BAAJ,IAAI,mFAAU;YAGvB,uKAAS,MAAM,6BAAN,MAAM,uFAAS;YAGxB,8JAAS,GAAG,6BAAH,GAAG,iFAAU;YAGtB,oKAAS,KAAK,6BAAL,KAAK,qFAAU;;;iBA3DR,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;0BAaJ,cAAc,CAAC,+BAA+B,CAAC;;;;;;;;;;;;;;;;;GAiBtE,CAAC;QAEiB,MAAM;YACvB,MAAM,KAAK,GAAG,QAAQ,CAAC;gBACrB,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,IAAI;gBACpB,IAAI,EAAE,GAAG,IAAI,CAAC,IAAI,IAAI;gBACtB,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,IAAI;gBAC1B,KAAK,EAAE,GAAG,IAAI,CAAC,KAAK,IAAI;aACzB,CAAC,CAAC;YACH,MAAM,SAAS,GAAG,QAAQ,CAAC;gBACzB,aAAa,EAAE,IAAI,CAAC,MAAM;gBAC1B,oBAAoB,EAAE,IAAI;aAC3B,CAAC,CAAC;YACH,OAAO,IAAI,CAAA,gBAAgB,SAAS,WAAW,KAAK,UAAU,CAAC;QACjE,CAAC;QAGD,iFAAyB;QAAzB,IAAS,MAAM,4CAAU;QAAzB,IAAS,MAAM,kDAAU;QAGzB,mIAAuB;QAAvB,IAAS,IAAI,0CAAU;QAAvB,IAAS,IAAI,gDAAU;QAGvB,4HAAkB,KAAK,GAAC;QAAxB,IAAS,MAAM,4CAAS;QAAxB,IAAS,MAAM,kDAAS;QAGxB,iIAAsB;QAAtB,IAAS,GAAG,yCAAU;QAAtB,IAAS,GAAG,+CAAU;QAGtB,kIAAwB;QAAxB,IAAS,KAAK,2CAAU;QAAxB,IAAS,KAAK,iDAAU;;;;;;;SA5Db,sBAAsB;AA+DnC,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,GAAgB,EAAE,EAAE;IACpD,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,8BAA8B,CAAC,CAAC;IAC1D,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO;IACT,CAAC;IACD,MAAM,SAAS,GAAG,KAAK,EAAE,qBAAqB,EAAE,CAAC;IACjD,MAAM,GAAG,GACP,KAAK;SACF,aAAa,CAAC,gCAAgC,CAAC;QAChD,EAAE,qBAAqB,EAAE,CAAC,GAAG,IAAI,SAAS,CAAC,GAAG,CAAC;IACnD,MAAM,MAAM,GACV,KAAK,CAAC,aAAa,CAAC,6BAA6B,CAAC,EAAE,qBAAqB,EAAE;SACxE,MAAM,IAAI,SAAS,CAAC,MAAM,CAAC;IAChC,OAAO;QACL,GAAG,EAAE,GAAG;QACR,MAAM,EAAE,MAAM;KACf,CAAC;AACJ,CAAC,CAAC;AACF,MAAM,CAAC,MAAM,2BAA2B,GAAG,CACzC,GAAiB,EACjB,GAAgB,EAChB,KAAa,EACb,MAAmB,EACnB,EAAE;IACF,MAAM,KAAK,GAAG,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC;IAC1C,MAAM,IAAI,GAAG,GAAG,CAAC,qBAAqB,EAAE,CAAC,IAAI,CAAC;IAC9C,MAAM,IAAI,GAAG,iBAAiB,CAAC,GAAG,CAAC,CAAC;IACpC,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO;IACT,CAAC;IACD,MAAM,OAAO,GAAG,oBAAoB,EAAE,CAAC;IACvC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,KAAK,GAAG,KAAK,CAAC,CAAC;IACvE,SAAS,CAAoB,GAAG,EAAE;QAChC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QAC9C,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE;YAChB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CACtB,gBAAgB,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,KAAK,EAAE,MAAM,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAChE,CAAC;YACF,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,KAAK,GAAG,KAAK,CAAC,CAAC;YACvE,OAAO;gBACL,KAAK;aACN,CAAC;QACJ,CAAC;QACD,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE;YACpB,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC;QACD,OAAO,EAAE,GAAG,EAAE;YACZ,OAAO,CAAC,MAAM,EAAE,CAAC;QACnB,CAAC;KACF,CAAC,CAAC;AACL,CAAC,CAAC;AACF,IAAI,OAAO,GAA6B,IAAI,CAAC;AAW7C,MAAM,CAAC,MAAM,oBAAoB,GAAG,GAAsB,EAAE;IAC1D,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,MAAM,OAAO,GAAG,IAAI,sBAAsB,EAAE,CAAC;QAC7C,OAAO,GAAG;YACR,OAAO,CACL,IAAY,EACZ,GAAW,EACX,MAAc,EACd,KAAK,GAAG,CAAC,EACT,MAAM,GAAG,KAAK;gBAEd,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;gBAC9B,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC;gBACpB,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;gBACxB,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC;gBAClB,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC;gBACtB,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;YAC1B,CAAC;YACD,MAAM;gBACJ,OAAO,CAAC,MAAM,EAAE,CAAC;YACnB,CAAC;SACF,CAAC;IACJ,CAAC;IAED,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC","sourcesContent":["import { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { css, html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { TableColumn } from '../../table-view-manager.js';\n\nimport { startDrag } from '../../../../core/utils/drag.js';\nimport { getResultInRange } from '../../../../core/utils/utils.js';\n\nexport class TableVerticalIndicator extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    data-view-table-vertical-indicator {\n      position: fixed;\n      left: 0;\n      top: 0;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    .vertical-indicator {\n      position: absolute;\n      pointer-events: none;\n      width: 1px;\n      background-color: ${unsafeCSSVarV2('layer/background/hoverOverlay')};\n    }\n\n    .vertical-indicator::after {\n      position: absolute;\n      z-index: 1;\n      width: 2px;\n      height: 100%;\n      content: '';\n      right: 0;\n      background-color: var(--affine-primary-color);\n      border-radius: 1px;\n    }\n\n    .with-shadow.vertical-indicator::after {\n      box-shadow: 0px 0px 8px 0px rgba(30, 150, 235, 0.35);\n    }\n  `;\n\n  protected override render(): unknown {\n    const style = styleMap({\n      top: `${this.top}px`,\n      left: `${this.left}px`,\n      height: `${this.height}px`,\n      width: `${this.width}px`,\n    });\n    const className = classMap({\n      'with-shadow': this.shadow,\n      'vertical-indicator': true,\n    });\n    return html` <div class=\"${className}\" style=${style}></div> `;\n  }\n\n  @property({ attribute: false })\n  accessor height!: number;\n\n  @property({ attribute: false })\n  accessor left!: number;\n\n  @property({ attribute: false })\n  accessor shadow = false;\n\n  @property({ attribute: false })\n  accessor top!: number;\n\n  @property({ attribute: false })\n  accessor width!: number;\n}\n\nexport const getTableGroupRect = (ele: HTMLElement) => {\n  const group = ele.closest('affine-data-view-table-group');\n  if (!group) {\n    return;\n  }\n  const groupRect = group?.getBoundingClientRect();\n  const top =\n    group\n      .querySelector('.affine-database-column-header')\n      ?.getBoundingClientRect().top ?? groupRect.top;\n  const bottom =\n    group.querySelector('.affine-database-block-rows')?.getBoundingClientRect()\n      .bottom ?? groupRect.bottom;\n  return {\n    top: top,\n    bottom: bottom,\n  };\n};\nexport const startDragWidthAdjustmentBar = (\n  evt: PointerEvent,\n  ele: HTMLElement,\n  width: number,\n  column: TableColumn\n) => {\n  const scale = width / column.width$.value;\n  const left = ele.getBoundingClientRect().left;\n  const rect = getTableGroupRect(ele);\n  if (!rect) {\n    return;\n  }\n  const preview = getVerticalIndicator();\n  preview.display(left, rect.top, rect.bottom - rect.top, width * scale);\n  startDrag<{ width: number }>(evt, {\n    onDrag: () => ({ width: column.width$.value }),\n    onMove: ({ x }) => {\n      const width = Math.round(\n        getResultInRange((x - left) / scale, column.minWidth, Infinity)\n      );\n      preview.display(left, rect.top, rect.bottom - rect.top, width * scale);\n      return {\n        width,\n      };\n    },\n    onDrop: ({ width }) => {\n      column.updateWidth(width);\n    },\n    onClear: () => {\n      preview.remove();\n    },\n  });\n};\nlet preview: VerticalIndicator | null = null;\ntype VerticalIndicator = {\n  display: (\n    left: number,\n    top: number,\n    height: number,\n    width?: number,\n    shadow?: boolean\n  ) => void;\n  remove: () => void;\n};\nexport const getVerticalIndicator = (): VerticalIndicator => {\n  if (!preview) {\n    const dragBar = new TableVerticalIndicator();\n    preview = {\n      display(\n        left: number,\n        top: number,\n        height: number,\n        width = 1,\n        shadow = false\n      ) {\n        document.body.append(dragBar);\n        dragBar.left = left;\n        dragBar.height = height;\n        dragBar.top = top;\n        dragBar.width = width;\n        dragBar.shadow = shadow;\n      },\n      remove() {\n        dragBar.remove();\n      },\n    };\n  }\n\n  return preview;\n};\n"]}