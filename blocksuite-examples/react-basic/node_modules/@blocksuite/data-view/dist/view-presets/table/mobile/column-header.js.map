{"version":3,"file":"column-header.js","sourceRoot":"","sources":["../../../../src/view-presets/table/mobile/column-header.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  type MenuConfig,\n  popMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport {\n  DeleteIcon,\n  DuplicateIcon,\n  InsertLeftIcon,\n  InsertRightIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n  ViewIcon,\n} from '@blocksuite/icons/lit';\nimport { css } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { Property } from '../../../core/view-manager/property.js';\nimport type { NumberPropertyDataType } from '../../../property-presets/index.js';\nimport type { TableColumn, TableSingleView } from '../table-view-manager.js';\n\nimport { inputConfig, typeConfig } from '../../../core/common/property-menu.js';\nimport { numberFormats } from '../../../property-presets/number/utils/formats.js';\nimport { DEFAULT_COLUMN_TITLE_HEIGHT } from '../consts.js';\n\nexport class MobileTableColumnHeader extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    .mobile-table-column-header {\n      display: flex;\n      padding: 6px;\n      gap: 6px;\n      align-items: center;\n    }\n\n    .mobile-table-column-header-icon {\n      font-size: 18px;\n      color: ${unsafeCSSVarV2('database/textSecondary')};\n      display: flex;\n      align-items: center;\n    }\n\n    .mobile-table-column-header-name {\n      font-weight: 500;\n      font-size: 14px;\n      color: ${unsafeCSSVarV2('database/textSecondary')};\n    }\n  `;\n\n  private _clickColumn = () => {\n    if (this.tableViewManager.readonly$.value) {\n      return;\n    }\n    this.popMenu();\n  };\n\n  editTitle = () => {\n    this._clickColumn();\n  };\n\n  private popMenu(ele?: HTMLElement) {\n    const enableNumberFormatting =\n      this.tableViewManager.featureFlags$.value.enable_number_formatting;\n\n    popMenu(popupTargetFromElement(ele ?? this), {\n      options: {\n        title: {\n          text: 'Property settings',\n        },\n        items: [\n          inputConfig(this.column),\n          typeConfig(this.column),\n          // Number format begin\n          ...(enableNumberFormatting\n            ? [\n                menu.subMenu({\n                  name: 'Number Format',\n                  hide: () =>\n                    !this.column.dataUpdate ||\n                    this.column.type$.value !== 'number',\n                  options: {\n                    title: {\n                      text: 'Number Format',\n                    },\n                    items: [\n                      numberFormatConfig(this.column),\n                      ...numberFormats.map(format => {\n                        const data = (\n                          this.column as Property<\n                            number,\n                            NumberPropertyDataType\n                          >\n                        ).data$.value;\n                        return menu.action({\n                          isSelected: data.format === format.type,\n                          prefix: html`<span\n                            style=\"font-size: var(--affine-font-base); scale: 1.2;\"\n                            >${format.symbol}</span\n                          >`,\n                          name: format.label,\n                          select: () => {\n                            if (data.format === format.type) return;\n                            this.column.dataUpdate(() => ({\n                              format: format.type,\n                            }));\n                          },\n                        });\n                      }),\n                    ],\n                  },\n                }),\n              ]\n            : []),\n          // Number format end\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Hide In View',\n                prefix: ViewIcon(),\n                hide: () =>\n                  this.column.hide$.value ||\n                  this.column.type$.value === 'title',\n                select: () => {\n                  this.column.hideSet(true);\n                },\n              }),\n            ],\n          }),\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Insert Left Column',\n                prefix: InsertLeftIcon(),\n                select: () => {\n                  this.tableViewManager.propertyAdd({\n                    id: this.column.id,\n                    before: true,\n                  });\n                  Promise.resolve()\n                    .then(() => {\n                      const pre =\n                        this.previousElementSibling?.previousElementSibling;\n                      if (pre instanceof MobileTableColumnHeader) {\n                        pre.editTitle();\n                        pre.scrollIntoView({\n                          inline: 'nearest',\n                          block: 'nearest',\n                        });\n                      }\n                    })\n                    .catch(console.error);\n                },\n              }),\n              menu.action({\n                name: 'Insert Right Column',\n                prefix: InsertRightIcon(),\n                select: () => {\n                  this.tableViewManager.propertyAdd({\n                    id: this.column.id,\n                    before: false,\n                  });\n                  Promise.resolve()\n                    .then(() => {\n                      const next = this.nextElementSibling?.nextElementSibling;\n                      if (next instanceof MobileTableColumnHeader) {\n                        next.editTitle();\n                        next.scrollIntoView({\n                          inline: 'nearest',\n                          block: 'nearest',\n                        });\n                      }\n                    })\n                    .catch(console.error);\n                },\n              }),\n              menu.action({\n                name: 'Move Left',\n                prefix: MoveLeftIcon(),\n                hide: () => this.column.isFirst,\n                select: () => {\n                  const preId = this.tableViewManager.propertyPreGet(\n                    this.column.id\n                  )?.id;\n                  if (!preId) {\n                    return;\n                  }\n                  this.tableViewManager.propertyMove(this.column.id, {\n                    id: preId,\n                    before: true,\n                  });\n                },\n              }),\n              menu.action({\n                name: 'Move Right',\n                prefix: MoveRightIcon(),\n                hide: () => this.column.isLast,\n                select: () => {\n                  const nextId = this.tableViewManager.propertyNextGet(\n                    this.column.id\n                  )?.id;\n                  if (!nextId) {\n                    return;\n                  }\n                  this.tableViewManager.propertyMove(this.column.id, {\n                    id: nextId,\n                    before: false,\n                  });\n                },\n              }),\n            ],\n          }),\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Duplicate',\n                prefix: DuplicateIcon(),\n                hide: () =>\n                  !this.column.duplicate || this.column.type$.value === 'title',\n                select: () => {\n                  this.column.duplicate?.();\n                },\n              }),\n              menu.action({\n                name: 'Delete',\n                prefix: DeleteIcon(),\n                hide: () =>\n                  !this.column.delete || this.column.type$.value === 'title',\n                select: () => {\n                  this.column.delete?.();\n                },\n                class: {\n                  'delete-item': true,\n                },\n              }),\n            ],\n          }),\n        ],\n      },\n    });\n  }\n\n  override render() {\n    const column = this.column;\n    const style = styleMap({\n      height: DEFAULT_COLUMN_TITLE_HEIGHT + 'px',\n    });\n    return html`\n      <div\n        style=${style}\n        class=\"mobile-table-column-header\"\n        @click=\"${this._clickColumn}\"\n      >\n        <uni-lit\n          class=\"mobile-table-column-header-icon\"\n          .uni=\"${column.icon}\"\n        ></uni-lit>\n        <div class=\"mobile-table-column-header-name\">${column.name$.value}</div>\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor column!: TableColumn;\n\n  @property({ attribute: false })\n  accessor tableViewManager!: TableSingleView;\n}\n\nfunction numberFormatConfig(column: Property): MenuConfig {\n  return () =>\n    html` <affine-database-number-format-bar\n      .column=\"${column}\"\n    ></affine-database-number-format-bar>`;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'mobile-table-column-header': MobileTableColumnHeader;\n  }\n}\n"]}