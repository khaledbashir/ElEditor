{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../src/view-presets/kanban/define.ts"],"names":[],"mappings":"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","sourcesContent":["import { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\n\nimport type { GroupBy, GroupProperty } from '../../core/common/types.js';\nimport type { FilterGroup } from '../../core/filter/types.js';\nimport type { Sort } from '../../core/sort/types.js';\n\nimport { defaultGroupBy, groupByMatcher, t } from '../../core/index.js';\nimport { type BasicViewDataType, viewType } from '../../core/view/data-view.js';\nimport { KanbanSingleView } from './kanban-view-manager.js';\n\nexport const kanbanViewType = viewType('kanban');\n\nexport type KanbanViewColumn = {\n  id: string;\n  hide?: boolean;\n};\n\ntype DataType = {\n  columns: KanbanViewColumn[];\n  filter: FilterGroup;\n  groupBy?: GroupBy;\n  sort?: Sort;\n  header: {\n    titleColumn?: string;\n    iconColumn?: string;\n    coverColumn?: string;\n  };\n  groupProperties: GroupProperty[];\n};\nexport type KanbanViewData = BasicViewDataType<\n  typeof kanbanViewType.type,\n  DataType\n>;\nexport const kanbanViewModel = kanbanViewType.createModel<KanbanViewData>({\n  defaultName: 'Kanban View',\n  dataViewManager: KanbanSingleView,\n  defaultData: viewManager => {\n    const columns = viewManager.dataSource.properties$.value;\n    const allowList = columns.filter(columnId => {\n      const dataType = viewManager.dataSource.propertyDataTypeGet(columnId);\n      return dataType && !!groupByMatcher.match(dataType);\n    });\n    const getWeight = (columnId: string) => {\n      const dataType = viewManager.dataSource.propertyDataTypeGet(columnId);\n      if (!dataType || t.string.is(dataType) || t.richText.is(dataType)) {\n        return 0;\n      }\n      if (t.tag.is(dataType)) {\n        return 3;\n      }\n      if (t.array.is(dataType)) {\n        return 2;\n      }\n      return 1;\n    };\n    const columnId = allowList.sort((a, b) => getWeight(b) - getWeight(a))[0];\n    const type = viewManager.dataSource.propertyTypeGet(columnId);\n    const meta = type && viewManager.dataSource.propertyMetaGet(type);\n    const data = viewManager.dataSource.propertyDataGet(columnId);\n    if (!columnId || !meta || !data) {\n      throw new BlockSuiteError(\n        ErrorCode.DatabaseBlockError,\n        'not implement yet'\n      );\n    }\n    return {\n      columns: columns.map(id => ({\n        id: id,\n        hide: false,\n      })),\n      filter: {\n        type: 'group',\n        op: 'and',\n        conditions: [],\n      },\n      groupBy: defaultGroupBy(viewManager.dataSource, meta, columnId, data),\n      header: {\n        titleColumn: viewManager.dataSource.properties$.value.find(\n          id => viewManager.dataSource.propertyTypeGet(id) === 'title'\n        ),\n        iconColumn: 'type',\n      },\n      groupProperties: [],\n    };\n  },\n});\n"]}