{"version":3,"file":"kanban-view.js","sourceRoot":"","sources":["../../../../src/view-presets/kanban/mobile/kanban-view.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,IAAI,EACJ,OAAO,EACP,sBAAsB,GACvB,MAAM,4CAA4C,CAAC;AACpD,OAAO,EAAE,cAAc,EAAE,MAAM,iCAAiC,CAAC;AACjE,OAAO,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAC;AACtD,OAAO,EAAE,GAAG,EAAE,MAAM,KAAK,CAAC;AAC1B,OAAO,EAAE,MAAM,EAAE,MAAM,0BAA0B,CAAC;AAClD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,IAAI,EAAE,MAAM,oBAAoB,CAAC;AAK1C,OAAO,EAAyB,YAAY,EAAE,MAAM,wBAAwB,CAAC;AAC7E,OAAO,EAAE,QAAQ,EAAE,MAAM,iDAAiD,CAAC;AAC3E,OAAO,EAAE,YAAY,EAAE,MAAM,sCAAsC,CAAC;AAEpE,MAAM,MAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;aAyBL,cAAc,CAAC,cAAc,CAAC;;CAE1C,CAAC;AAEF,MAAM,OAAO,oBAAqB,SAAQ,YAGzC;IAHD;;QAME,mBAAc,GAAG,GAAG,EAAE;YACpB,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC;YAC5C,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACd,OAAO;YACT,CAAC;YACD,MAAM,GAAG,GAAG,CAAC,CAAa,EAAE,EAAE;gBAC5B,MAAM,GAAG,GAAG,CAAC,CAAC,aAA4B,CAAC;gBAC3C,OAAO,CAAC,sBAAsB,CAAC,GAAG,CAAC,EAAE;oBACnC,OAAO,EAAE;wBACP,KAAK,EAAE;4BACL,IAAI,CAAC,KAAK,CAAC;gCACT,UAAU,EAAE,IAAI,CAAC,EAAE;oCACjB,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,KAAK,CAAC;oCACjD,IAAI,MAAM,EAAE,CAAC;wCACX,MAAM,CAAC,UAAU,CACf,GAAG,EAAE,CACH,QAAQ,CAAC;4CACP,IAAI;4CACJ,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,KAAK;4CAC3B,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU;yCAC/C,CAAU,CACd,CAAC;oCACJ,CAAC;gCACH,CAAC;6BACF,CAAC;yBACH;qBACF;iBACF,CAAC,CAAC;YACL,CAAC,CAAC;YACF,OAAO,IAAI,CAAA,0CAA0C,GAAG;QACpD,aAAa,EAAE;WACZ,CAAC;QACV,CAAC,CAAC;IAyDJ,CAAC;aA3FiB,WAAM,GAAG,MAAM,AAAT,CAAU;IAoChC,IAAI,MAAM;QACR,OAAO;YACL,cAAc,EAAE,GAAG,EAAE,GAAE,CAAC;YACxB,cAAc,EAAE,GAAG,EAAE,GAAE,CAAC;YACxB,YAAY,EAAE,GAAG,EAAE;gBACjB,OAAO,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC;YACrC,CAAC;YACD,aAAa,EAAE,GAAG,EAAE,GAAE,CAAC;YACvB,MAAM,EAAE,GAAG,EAAE,GAAE,CAAC;YAChB,aAAa,EAAE,GAAG,EAAE;gBAClB,OAAO,KAAK,CAAC;YACf,CAAC;YACD,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI;YACrB,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;SAClC,CAAC;IACJ,CAAC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC;IACpC,CAAC;IAEQ,MAAM;QACb,MAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,KAAK,CAAC;QACvD,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO,IAAI,CAAA,EAAE,CAAC;QAChB,CAAC;QACD,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,KAAK,CAAC;QAClD,MAAM,YAAY,GAAG,QAAQ,CAAC;YAC5B,UAAU,EAAE,IAAI,QAAQ,IAAI;YAC5B,WAAW,EAAE,IAAI,QAAQ,IAAI;YAC7B,WAAW,EAAE,GAAG,QAAQ,IAAI;YAC5B,YAAY,EAAE,GAAG,QAAQ,IAAI;SAC9B,CAAC,CAAC;QACH,OAAO,IAAI,CAAA;QACP,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE;YACtC,gBAAgB,EAAE,IAAI,CAAC,MAAM;SAC9B,CAAC;iDACyC,YAAY;UACnD,MAAM,CACN,MAAM,EACN,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,EAClB,KAAK,CAAC,EAAE;YACN,OAAO,IAAI,CAAA;gBACP,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC;0BACT,KAAK,CAAC,GAAG;8BACL,IAAI,CAAC,KAAK,CAAC,WAAW;uBAC7B,IAAI,CAAC,KAAK,CAAC,IAAI;wBACd,KAAK;oCACO,CAAC;QAC3B,CAAC,CACF;UACC,IAAI,CAAC,cAAc,EAAE;;KAE1B,CAAC;IACJ,CAAC","sourcesContent":["import {\n  menu,\n  popMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { AddCursorIcon } from '@blocksuite/icons/lit';\nimport { css } from 'lit';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { KanbanSingleView } from '../kanban-view-manager.js';\nimport type { KanbanViewSelectionWithType } from '../types.js';\n\nimport { type DataViewInstance, renderUniLit } from '../../../core/index.js';\nimport { sortable } from '../../../core/utils/wc-dnd/sort/sort-context.js';\nimport { DataViewBase } from '../../../core/view/data-view-base.js';\n\nconst styles = css`\n  mobile-data-view-kanban {\n    user-select: none;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .mobile-kanban-groups {\n    position: relative;\n    z-index: 1;\n    display: flex;\n    gap: 20px;\n    padding-bottom: 4px;\n    overflow-x: scroll;\n    overflow-y: hidden;\n  }\n\n  .mobile-add-group {\n    height: 32px;\n    flex-shrink: 0;\n    display: flex;\n    align-items: center;\n    padding: 4px;\n    border-radius: 4px;\n    font-size: 16px;\n    color: ${unsafeCSSVarV2('icon/primary')};\n  }\n`;\n\nexport class MobileDataViewKanban extends DataViewBase<\n  KanbanSingleView,\n  KanbanViewSelectionWithType\n> {\n  static override styles = styles;\n\n  renderAddGroup = () => {\n    const addGroup = this.groupManager.addGroup;\n    if (!addGroup) {\n      return;\n    }\n    const add = (e: MouseEvent) => {\n      const ele = e.currentTarget as HTMLElement;\n      popMenu(popupTargetFromElement(ele), {\n        options: {\n          items: [\n            menu.input({\n              onComplete: text => {\n                const column = this.groupManager.property$.value;\n                if (column) {\n                  column.dataUpdate(\n                    () =>\n                      addGroup({\n                        text,\n                        oldData: column.data$.value,\n                        dataSource: this.props.view.manager.dataSource,\n                      }) as never\n                  );\n                }\n              },\n            }),\n          ],\n        },\n      });\n    };\n    return html` <div class=\"mobile-add-group\" @click=\"${add}\">\n      ${AddCursorIcon()}\n    </div>`;\n  };\n\n  get expose(): DataViewInstance {\n    return {\n      clearSelection: () => {},\n      focusFirstCell: () => {},\n      getSelection: () => {\n        return this.props.selection$.value;\n      },\n      hideIndicator: () => {},\n      moveTo: () => {},\n      showIndicator: () => {\n        return false;\n      },\n      view: this.props.view,\n      eventTrace: this.props.eventTrace,\n    };\n  }\n\n  get groupManager() {\n    return this.props.view.groupTrait;\n  }\n\n  override render() {\n    const groups = this.groupManager.groupsDataList$.value;\n    if (!groups) {\n      return html``;\n    }\n    const vPadding = this.props.virtualPadding$.value;\n    const wrapperStyle = styleMap({\n      marginLeft: `-${vPadding}px`,\n      marginRight: `-${vPadding}px`,\n      paddingLeft: `${vPadding}px`,\n      paddingRight: `${vPadding}px`,\n    });\n    return html`\n      ${renderUniLit(this.props.headerWidget, {\n        dataViewInstance: this.expose,\n      })}\n      <div class=\"mobile-kanban-groups\" style=\"${wrapperStyle}\">\n        ${repeat(\n          groups,\n          group => group.key,\n          group => {\n            return html` <mobile-kanban-group\n              ${sortable(group.key)}\n              data-key=\"${group.key}\"\n              .dataViewEle=\"${this.props.dataViewEle}\"\n              .view=\"${this.props.view}\"\n              .group=\"${group}\"\n            ></mobile-kanban-group>`;\n          }\n        )}\n        ${this.renderAddGroup()}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'mobile-data-view-kanban': MobileDataViewKanban;\n  }\n}\n"]}