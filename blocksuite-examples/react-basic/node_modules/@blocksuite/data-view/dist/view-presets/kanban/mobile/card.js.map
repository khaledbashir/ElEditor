{"version":3,"file":"card.js","sourceRoot":"","sources":["../../../../src/view-presets/kanban/mobile/card.ts"],"names":[],"mappings":"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","sourcesContent":["import { popupTargetFromElement } from '@blocksuite/affine-components/context-menu';\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { CenterPeekIcon, MoreHorizontalIcon } from '@blocksuite/icons/lit';\nimport { css } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { DataViewRenderer } from '../../../core/data-view.js';\nimport type { KanbanColumn, KanbanSingleView } from '../kanban-view-manager.js';\n\nimport { popCardMenu } from './menu.js';\n\nconst styles = css`\n  mobile-kanban-card {\n    display: flex;\n    position: relative;\n    flex-direction: column;\n    border: 0.5px solid var(--affine-border-color);\n    box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);\n    border-radius: 8px;\n    background-color: var(--affine-background-kanban-card-color);\n  }\n\n  .mobile-card-header {\n    padding: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n\n  .mobile-card-header-title uni-lit {\n    width: 100%;\n  }\n\n  .mobile-card-header.has-divider {\n    border-bottom: 0.5px solid var(--affine-border-color);\n  }\n\n  .mobile-card-header-title {\n    font-size: var(--data-view-cell-text-size);\n    line-height: var(--data-view-cell-text-line-height);\n  }\n\n  .mobile-card-header-icon {\n    padding: 4px;\n    background-color: var(--affine-background-secondary-color);\n    display: flex;\n    align-items: center;\n    border-radius: 4px;\n    width: max-content;\n    font-size: 16px;\n    color: ${unsafeCSSVarV2('icon/primary')};\n  }\n\n  .mobile-card-body {\n    display: flex;\n    flex-direction: column;\n    padding: 8px;\n    gap: 4px;\n  }\n\n  mobile-kanban-card:has([data-editing='true']) .card-ops {\n    visibility: hidden;\n  }\n\n  .mobile-card-ops {\n    position: absolute;\n    right: 8px;\n    top: 8px;\n    display: flex;\n    gap: 4px;\n  }\n\n  .mobile-card-op {\n    display: flex;\n    position: relative;\n    padding: 4px;\n    border-radius: 4px;\n    box-shadow: 0px 0px 4px 0px rgba(66, 65, 73, 0.14);\n    background-color: var(--affine-background-primary-color);\n    font-size: 16px;\n    color: ${unsafeCSSVarV2('icon/primary')};\n  }\n`;\n\nexport class MobileKanbanCard extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  private clickCenterPeek = (e: MouseEvent) => {\n    e.stopPropagation();\n    this.dataViewEle.openDetailPanel({\n      view: this.view,\n      rowId: this.cardId,\n    });\n  };\n\n  private clickMore = (e: MouseEvent) => {\n    e.stopPropagation();\n    popCardMenu(\n      popupTargetFromElement(e.currentTarget as HTMLElement),\n      this.view,\n      this.groupKey,\n      this.cardId,\n      this.dataViewEle\n    );\n  };\n\n  private renderBody(columns: KanbanColumn[]) {\n    if (columns.length === 0) {\n      return '';\n    }\n    return html` <div class=\"mobile-card-body\">\n      ${repeat(\n        columns,\n        v => v.id,\n        column => {\n          if (this.view.isInHeader(column.id)) {\n            return '';\n          }\n          return html` <mobile-kanban-cell\n            .contentOnly=\"${false}\"\n            data-column-id=\"${column.id}\"\n            .view=\"${this.view}\"\n            .groupKey=\"${this.groupKey}\"\n            .column=\"${column}\"\n            .cardId=\"${this.cardId}\"\n          ></mobile-kanban-cell>`;\n        }\n      )}\n    </div>`;\n  }\n\n  private renderHeader(columns: KanbanColumn[]) {\n    if (!this.view.hasHeader(this.cardId)) {\n      return '';\n    }\n    const classList = classMap({\n      'mobile-card-header': true,\n      'mobile-has-divider': columns.length > 0,\n    });\n    return html`\n      <div class=\"${classList}\">${this.renderTitle()} ${this.renderIcon()}</div>\n    `;\n  }\n\n  private renderIcon() {\n    const icon = this.view.getHeaderIcon(this.cardId);\n    if (!icon) {\n      return;\n    }\n    return html` <div class=\"mobile-card-header-icon\">\n      ${icon.cellGet(this.cardId).value$.value}\n    </div>`;\n  }\n\n  private renderOps() {\n    if (this.view.readonly$.value) {\n      return;\n    }\n    return html`\n      <div class=\"mobile-card-ops\">\n        <div class=\"mobile-card-op\" @click=\"${this.clickCenterPeek}\">\n          ${CenterPeekIcon()}\n        </div>\n        <div class=\"mobile-card-op\" @click=\"${this.clickMore}\">\n          ${MoreHorizontalIcon()}\n        </div>\n      </div>\n    `;\n  }\n\n  private renderTitle() {\n    const title = this.view.getHeaderTitle(this.cardId);\n    if (!title) {\n      return;\n    }\n    return html` <div class=\"mobile-card-header-title\">\n      <mobile-kanban-cell\n        .contentOnly=\"${true}\"\n        data-column-id=\"${title.id}\"\n        .view=\"${this.view}\"\n        .groupKey=\"${this.groupKey}\"\n        .column=\"${title}\"\n        .cardId=\"${this.cardId}\"\n      ></mobile-kanban-cell>\n    </div>`;\n  }\n\n  override render() {\n    const columns = this.view.properties$.value.filter(\n      v => !this.view.isInHeader(v.id)\n    );\n    return html`\n      ${this.renderHeader(columns)} ${this.renderBody(columns)}\n      ${this.renderOps()}\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor cardId!: string;\n\n  @property({ attribute: false })\n  accessor dataViewEle!: DataViewRenderer;\n\n  @property({ attribute: false })\n  accessor groupKey!: string;\n\n  @state()\n  accessor isFocus = false;\n\n  @property({ attribute: false })\n  accessor view!: KanbanSingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'mobile-kanban-card': MobileKanbanCard;\n  }\n}\n"]}