{"version":3,"file":"cell.js","sourceRoot":"","sources":["../../../../src/view-presets/kanban/mobile/cell.ts"],"names":[],"mappings":"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","sourcesContent":["// related component\n\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { computed, effect } from '@preact/signals-core';\nimport { css } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../../../core/property/index.js';\nimport type { Property } from '../../../core/view-manager/property.js';\nimport type { KanbanSingleView } from '../kanban-view-manager.js';\n\nimport { renderUniLit } from '../../../core/utils/uni-component/uni-component.js';\n\nconst styles = css`\n  mobile-kanban-cell {\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    padding: 4px;\n    min-height: 20px;\n    border: 1px solid transparent;\n    box-sizing: border-box;\n  }\n\n  .mobile-kanban-cell {\n    flex: 1;\n    display: block;\n    width: 196px;\n  }\n\n  .mobile-kanban-cell-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    align-self: start;\n    margin-right: 12px;\n    height: var(--data-view-cell-text-line-height);\n    font-size: 16px;\n    color: ${unsafeCSSVarV2('icon/primary')};\n  }\n`;\n\nexport class MobileKanbanCell extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  isEditing$ = computed(() => {\n    const selection = this.kanban?.props.selection$.value;\n    if (selection?.selectionType !== 'cell') {\n      return false;\n    }\n    if (selection.groupKey !== this.groupKey) {\n      return false;\n    }\n    if (selection.cardId !== this.cardId) {\n      return false;\n    }\n    if (selection.columnId !== this.column.id) {\n      return false;\n    }\n    return selection.isEditing;\n  });\n\n  selectCurrentCell = (editing: boolean) => {\n    if (this.view.readonly$.value) {\n      return;\n    }\n    const setSelection = this.kanban?.props.setSelection;\n    const viewId = this.kanban?.props.view.id;\n    if (setSelection && viewId) {\n      if (editing && this.cell?.beforeEnterEditMode() === false) {\n        return;\n      }\n      setSelection({\n        viewId,\n        type: 'kanban',\n        selectionType: 'cell',\n        groupKey: this.groupKey,\n        cardId: this.cardId,\n        columnId: this.column.id,\n        isEditing: editing,\n      });\n    }\n  };\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  get kanban() {\n    return this.closest('mobile-data-view-kanban');\n  }\n\n  get selection() {\n    return this.closest('mobile-data-view-kanban')?.props.selection$.value;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    if (this.column.readonly$.value) return;\n    this.disposables.add(\n      effect(() => {\n        const isEditing = this.isEditing$.value;\n        if (isEditing) {\n          this.isEditing = true;\n          this._cell.value?.onEnterEditMode();\n        } else {\n          this._cell.value?.onExitEditMode();\n          this.isEditing = false;\n        }\n      })\n    );\n    this._disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n      if (!this.isEditing) {\n        this.selectCurrentCell(!this.column.readonly$.value);\n      }\n    });\n  }\n\n  override render() {\n    const props: CellRenderProps = {\n      cell: this.column.cellGet(this.cardId),\n      isEditing: this.isEditing,\n      selectCurrentCell: this.selectCurrentCell,\n    };\n    const renderer = this.column.renderer$.value;\n    if (!renderer) return;\n    const { view, edit } = renderer;\n    this.view.lockRows(this.isEditing);\n    this.dataset['editing'] = `${this.isEditing}`;\n    return html` ${this.renderIcon()}\n    ${renderUniLit(this.isEditing && edit ? edit : view, props, {\n      ref: this._cell,\n      class: 'mobile-kanban-cell',\n      style: { display: 'block', flex: '1', overflow: 'hidden' },\n    })}`;\n  }\n\n  renderIcon() {\n    if (this.contentOnly) {\n      return;\n    }\n    return html` <uni-lit\n      class=\"mobile-kanban-cell-icon\"\n      .uni=\"${this.column.icon}\"\n    ></uni-lit>`;\n  }\n\n  @property({ attribute: false })\n  accessor cardId!: string;\n\n  @property({ attribute: false })\n  accessor column!: Property;\n\n  @property({ attribute: false })\n  accessor contentOnly = false;\n\n  @property({ attribute: false })\n  accessor groupKey!: string;\n\n  @state()\n  accessor isEditing = false;\n\n  @property({ attribute: false })\n  accessor view!: KanbanSingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'mobile-kanban-cell': MobileKanbanCell;\n  }\n}\n"]}