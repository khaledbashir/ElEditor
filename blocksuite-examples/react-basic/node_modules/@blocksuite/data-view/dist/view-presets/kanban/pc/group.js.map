{"version":3,"file":"group.js","sourceRoot":"","sources":["../../../../src/view-presets/kanban/pc/group.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popFilterableSimpleMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { AddCursorIcon } from '@blocksuite/icons/lit';\nimport { css, nothing } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { DataViewRenderer } from '../../../core/data-view.js';\nimport type { GroupData } from '../../../core/group-by/trait.js';\nimport type { KanbanSingleView } from '../kanban-view-manager.js';\n\nimport { GroupTitle } from '../../../core/group-by/group-title.js';\nimport { dragHandler } from '../../../core/utils/wc-dnd/dnd-context.js';\n\nconst styles = css`\n  affine-data-view-kanban-group {\n    width: 260px;\n    flex-shrink: 0;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .group-header {\n    height: 32px;\n    padding: 6px 4px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    overflow: hidden;\n  }\n\n  .group-header-title {\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: var(--data-view-cell-text-size);\n  }\n\n  affine-data-view-kanban-group:hover .group-header-op {\n    visibility: visible;\n    opacity: 1;\n  }\n\n  .group-body {\n    margin-top: 4px;\n    display: flex;\n    flex-direction: column;\n    padding: 0 4px;\n    gap: 12px;\n  }\n\n  .add-card {\n    display: flex;\n    align-items: center;\n    padding: 4px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: var(--data-view-cell-text-size);\n    line-height: var(--data-view-cell-text-line-height);\n    visibility: hidden;\n    opacity: 0;\n    transition: all 150ms cubic-bezier(0.42, 0, 1, 1);\n    color: var(--affine-text-secondary-color);\n  }\n\n  affine-data-view-kanban-group:hover .add-card {\n    visibility: visible;\n    opacity: 1;\n  }\n\n  affine-data-view-kanban-group .add-card:hover {\n    background-color: var(--affine-hover-color);\n    color: var(--affine-text-primary-color);\n  }\n\n  .sortable-ghost {\n    background-color: var(--affine-hover-color);\n    opacity: 0.5;\n  }\n\n  .sortable-drag {\n    background-color: var(--affine-background-primary-color);\n  }\n`;\n\nexport class KanbanGroup extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = styles;\n\n  private clickAddCard = () => {\n    const id = this.view.addCard('end', this.group.key);\n    requestAnimationFrame(() => {\n      const kanban = this.closest('affine-data-view-kanban');\n      if (kanban) {\n        kanban.selectionController.selection = {\n          selectionType: 'cell',\n          groupKey: this.group.key,\n          cardId: id,\n          columnId:\n            this.view.mainProperties$.value.titleColumn ||\n            this.view.propertyIds$.value[0],\n          isEditing: true,\n        };\n      }\n    });\n  };\n\n  private clickAddCardInStart = () => {\n    const id = this.view.addCard('start', this.group.key);\n    requestAnimationFrame(() => {\n      const kanban = this.closest('affine-data-view-kanban');\n      if (kanban) {\n        kanban.selectionController.selection = {\n          selectionType: 'cell',\n          groupKey: this.group.key,\n          cardId: id,\n          columnId:\n            this.view.mainProperties$.value.titleColumn ||\n            this.view.propertyIds$.value[0],\n          isEditing: true,\n        };\n      }\n    });\n  };\n\n  private clickGroupOptions = (e: MouseEvent) => {\n    const ele = e.currentTarget as HTMLElement;\n    popFilterableSimpleMenu(popupTargetFromElement(ele), [\n      menu.action({\n        name: 'Ungroup',\n        hide: () => this.group.value == null,\n        select: () => {\n          this.group.rows.forEach(id => {\n            this.group.manager.removeFromGroup(id, this.group.key);\n          });\n        },\n      }),\n      menu.action({\n        name: 'Delete Cards',\n        select: () => {\n          this.view.rowDelete(this.group.rows);\n        },\n      }),\n    ]);\n  };\n\n  override render() {\n    const cards = this.group.rows;\n    return html`\n      <div class=\"group-header\" ${dragHandler(this.group.key)}>\n        ${GroupTitle(this.group, {\n          readonly: this.view.readonly$.value,\n          clickAdd: this.clickAddCardInStart,\n          clickOps: this.clickGroupOptions,\n        })}\n      </div>\n      <div class=\"group-body\">\n        ${repeat(\n          cards,\n          id => id,\n          id => {\n            return html`\n              <affine-data-view-kanban-card\n                data-card-id=\"${id}\"\n                .groupKey=\"${this.group.key}\"\n                .dataViewEle=\"${this.dataViewEle}\"\n                .view=\"${this.view}\"\n                .cardId=\"${id}\"\n              ></affine-data-view-kanban-card>\n            `;\n          }\n        )}\n        ${this.view.readonly$.value\n          ? nothing\n          : html`<div class=\"add-card\" @click=\"${this.clickAddCard}\">\n              <div\n                style=\"margin-right: 4px;width: 16px;height: 16px;display:flex;align-items:center;\"\n              >\n                ${AddCursorIcon()}\n              </div>\n              Add\n            </div>`}\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor dataViewEle!: DataViewRenderer;\n\n  @property({ attribute: false })\n  accessor group!: GroupData;\n\n  @property({ attribute: false })\n  accessor view!: KanbanSingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-kanban-group': KanbanGroup;\n  }\n}\n"]}