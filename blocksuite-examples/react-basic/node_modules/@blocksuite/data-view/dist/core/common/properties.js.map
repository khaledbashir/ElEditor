{"version":3,"file":"properties.js","sourceRoot":"","sources":["../../../src/core/common/properties.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popMenu,\n  type PopupTarget,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { InvisibleIcon, ViewIcon } from '@blocksuite/icons/lit';\nimport { computed } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { Property } from '../view-manager/property.js';\nimport type { SingleView } from '../view-manager/single-view.js';\n\nimport { dragHandler } from '../utils/wc-dnd/dnd-context.js';\nimport { defaultActivators } from '../utils/wc-dnd/sensors/index.js';\nimport {\n  createSortContext,\n  sortable,\n} from '../utils/wc-dnd/sort/sort-context.js';\nimport { verticalListSortingStrategy } from '../utils/wc-dnd/sort/strategies/index.js';\n\nexport class DataViewPropertiesSettingView extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    .properties-group-header {\n      user-select: none;\n      padding: 4px 12px 12px 12px;\n      margin-bottom: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      border-bottom: 1px solid var(--affine-divider-color);\n    }\n\n    .properties-group-title {\n      font-size: 12px;\n      line-height: 20px;\n      color: var(--affine-text-secondary-color);\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .properties-group-op {\n      padding: 4px 8px;\n      font-size: 12px;\n      line-height: 20px;\n      font-weight: 500;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .properties-group-op:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .properties-group {\n      min-height: 40px;\n    }\n\n    .property-item {\n      padding: 4px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      user-select: none;\n      cursor: pointer;\n      border-radius: 4px;\n    }\n\n    .property-item-drag-bar {\n      width: 4px;\n      height: 12px;\n      border-radius: 1px;\n      background-color: #efeff0;\n    }\n\n    .property-item:hover .property-item-drag-bar {\n      background-color: #c0bfc1;\n    }\n\n    .property-item-icon {\n      display: flex;\n      align-items: center;\n    }\n\n    .property-item-icon svg {\n      color: var(--affine-icon-color);\n      fill: var(--affine-icon-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .property-item-op-icon {\n      display: flex;\n      align-items: center;\n      border-radius: 4px;\n    }\n\n    .property-item-op-icon:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .property-item-op-icon.disabled:hover {\n      background-color: transparent;\n    }\n\n    .property-item-op-icon svg {\n      fill: var(--affine-icon-color);\n      color: var(--affine-icon-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .property-item-op-icon.disabled svg {\n      fill: var(--affine-text-disable-color);\n      color: var(--affine-text-disable-color);\n    }\n\n    .property-item-name {\n      font-size: 14px;\n      line-height: 22px;\n      flex: 1;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n\n  items$ = computed(() => {\n    return this.view.propertiesWithoutFilter$.value;\n  });\n\n  renderProperty = (property: Property) => {\n    const isTitle = property.type$.value === 'title';\n    const icon = property.hide$.value ? InvisibleIcon() : ViewIcon();\n    const changeVisible = () => {\n      if (property.type$.value !== 'title') {\n        property.hideSet(!property.hide$.value);\n      }\n    };\n    const classList = classMap({\n      'property-item-op-icon': true,\n      disabled: isTitle,\n    });\n    return html` <div\n      ${dragHandler(property.id)}\n      ${sortable(property.id)}\n      class=\"property-item\"\n    >\n      <div class=\"property-item-drag-bar\"></div>\n      <uni-lit class=\"property-item-icon\" .uni=\"${property.icon}\"></uni-lit>\n      <div class=\"property-item-name\">${property.name$.value}</div>\n      <div class=\"${classList}\" @click=\"${changeVisible}\">${icon}</div>\n    </div>`;\n  };\n\n  sortContext = createSortContext({\n    activators: defaultActivators,\n    container: this,\n    onDragEnd: evt => {\n      const over = evt.over;\n      const activeId = evt.active.id;\n      if (over && over.id !== activeId) {\n        const properties = this.items$.value;\n        const activeIndex = properties.findIndex(id => id === activeId);\n        const overIndex = properties.findIndex(id => id === over.id);\n\n        this.view.propertyMove(\n          activeId,\n          activeIndex > overIndex\n            ? {\n                before: true,\n                id: over.id,\n              }\n            : {\n                before: false,\n                id: over.id,\n              }\n        );\n      }\n    },\n    modifiers: [\n      ({ transform }) => {\n        return {\n          ...transform,\n          x: 0,\n        };\n      },\n    ],\n    items: this.items$,\n    strategy: verticalListSortingStrategy,\n  });\n\n  private itemsGroup() {\n    return this.view.propertiesWithoutFilter$.value.map(id =>\n      this.view.propertyGet(id)\n    );\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._disposables.addFromEvent(this, 'pointerdown', e => {\n      e.stopPropagation();\n    });\n  }\n\n  override render() {\n    const items = this.itemsGroup();\n    return html`\n      <div class=\"properties-group\">\n        ${repeat(items, v => v.id, this.renderProperty)}\n      </div>\n    `;\n  }\n\n  @query('.properties-group')\n  accessor groupContainer!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor onBack: (() => void) | undefined = undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-properties-setting': DataViewPropertiesSettingView;\n  }\n}\n\nexport const popPropertiesSetting = (\n  target: PopupTarget,\n  props: {\n    view: SingleView;\n    onClose?: () => void;\n    onBack?: () => void;\n  }\n) => {\n  popMenu(target, {\n    options: {\n      title: {\n        text: 'Properties',\n        onBack: props.onBack,\n        postfix: () => {\n          const items = props.view.propertiesWithoutFilter$.value.map(id =>\n            props.view.propertyGet(id)\n          );\n          const isAllShowed = items.every(v => !v.hide$.value);\n          const clickChangeAll = () => {\n            props.view.propertiesWithoutFilter$.value.forEach(id => {\n              if (props.view.propertyTypeGet(id) !== 'title') {\n                props.view.propertyHideSet(id, isAllShowed);\n              }\n            });\n          };\n          return html` <div\n            class=\"properties-group-op\"\n            @click=\"${clickChangeAll}\"\n          >\n            ${isAllShowed ? 'Hide All' : 'Show All'}\n          </div>`;\n        },\n      },\n      items: [\n        menu.group({\n          items: [\n            () =>\n              html` <data-view-properties-setting\n                .view=\"${props.view}\"\n              ></data-view-properties-setting>`,\n          ],\n        }),\n      ],\n    },\n  });\n\n  // const view = new DataViewPropertiesSettingView();\n  // view.view = props.view;\n  // view.onBack = () => {\n  //   close();\n  //   props.onBack?.();\n  // };\n  // const close = createPopup(target, view, { onClose: props.onClose });\n};\n"]}