{"version":3,"file":"field.js","sourceRoot":"","sources":["../../../src/core/detail/field.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport {\n  DeleteIcon,\n  DuplicateIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n} from '@blocksuite/icons/lit';\nimport { computed } from '@preact/signals-core';\nimport { css } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { createRef } from 'lit/directives/ref.js';\nimport { html } from 'lit/static-html.js';\n\nimport type {\n  CellRenderProps,\n  DataViewCellLifeCycle,\n} from '../property/index.js';\nimport type { Property } from '../view-manager/property.js';\nimport type { SingleView } from '../view-manager/single-view.js';\n\nimport { inputConfig, typeConfig } from '../common/property-menu.js';\nimport { renderUniLit } from '../utils/uni-component/uni-component.js';\n\nexport class RecordField extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    affine-data-view-record-field {\n      display: flex;\n      gap: 12px;\n    }\n\n    .field-left {\n      padding: 6px;\n      display: flex;\n      height: max-content;\n      align-items: center;\n      gap: 6px;\n      font-size: var(--data-view-cell-text-size);\n      line-height: var(--data-view-cell-text-line-height);\n      color: var(--affine-text-secondary-color);\n      width: 160px;\n      border-radius: 4px;\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .field-left:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    affine-data-view-record-field .icon {\n      display: flex;\n      align-items: center;\n      width: 16px;\n      height: 16px;\n    }\n\n    affine-data-view-record-field .icon svg {\n      width: 16px;\n      height: 16px;\n      fill: var(--affine-icon-color);\n    }\n\n    .filed-name {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    .field-content {\n      padding: 6px 8px;\n      border-radius: 4px;\n      flex: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      border: 1px solid transparent;\n    }\n\n    .field-content .affine-database-number {\n      text-align: left;\n      justify-content: start;\n    }\n\n    .field-content:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .field-content.is-editing {\n      box-shadow: 0px 0px 0px 2px rgba(30, 150, 235, 0.3);\n    }\n\n    .field-content.is-focus {\n      border: 1px solid var(--affine-primary-color);\n    }\n\n    .field-content.empty::before {\n      content: 'Empty';\n      color: var(--affine-text-disable-color);\n      font-size: 14px;\n      line-height: 22px;\n    }\n  `;\n\n  private _cell = createRef<DataViewCellLifeCycle>();\n\n  _click = (e: MouseEvent) => {\n    e.stopPropagation();\n    if (this.readonly) return;\n\n    this.changeEditing(true);\n  };\n\n  _clickLeft = (e: MouseEvent) => {\n    if (this.readonly) return;\n    const ele = e.currentTarget as HTMLElement;\n    const properties = this.view.detailProperties$.value;\n    popMenu(popupTargetFromElement(ele), {\n      options: {\n        title: {\n          text: 'Property settings',\n        },\n        items: [\n          menu.group({\n            items: [inputConfig(this.column), typeConfig(this.column)],\n          }),\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Move Up',\n                prefix: html` <div\n                  style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n                >\n                  ${MoveLeftIcon()}\n                </div>`,\n                hide: () =>\n                  properties.findIndex(v => v === this.column.id) === 0,\n                select: () => {\n                  const index = properties.findIndex(v => v === this.column.id);\n                  const targetId = properties[index - 1];\n                  if (!targetId) {\n                    return;\n                  }\n                  this.view.propertyMove(this.column.id, {\n                    id: targetId,\n                    before: true,\n                  });\n                },\n              }),\n              menu.action({\n                name: 'Move Down',\n                prefix: html` <div\n                  style=\"transform: rotate(90deg);display:flex;align-items:center;\"\n                >\n                  ${MoveRightIcon()}\n                </div>`,\n                hide: () =>\n                  properties.findIndex(v => v === this.column.id) ===\n                  properties.length - 1,\n                select: () => {\n                  const index = properties.findIndex(v => v === this.column.id);\n                  const targetId = properties[index + 1];\n                  if (!targetId) {\n                    return;\n                  }\n                  this.view.propertyMove(this.column.id, {\n                    id: targetId,\n                    before: false,\n                  });\n                },\n              }),\n            ],\n          }),\n          menu.group({\n            name: 'operation',\n            items: [\n              menu.action({\n                name: 'Duplicate',\n                prefix: DuplicateIcon(),\n                hide: () =>\n                  !this.column.duplicate || this.column.type$.value === 'title',\n                select: () => {\n                  this.column.duplicate?.();\n                },\n              }),\n              menu.action({\n                name: 'Delete',\n                prefix: DeleteIcon(),\n                hide: () =>\n                  !this.column.delete || this.column.type$.value === 'title',\n                select: () => {\n                  this.column.delete?.();\n                },\n                class: { 'delete-item': true },\n              }),\n            ],\n          }),\n        ],\n      },\n    });\n  };\n\n  @property({ attribute: false })\n  accessor column!: Property;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  cell$ = computed(() => {\n    return this.column.cellGet(this.rowId);\n  });\n\n  changeEditing = (editing: boolean) => {\n    const selection = this.closest('affine-data-view-record-detail')?.selection;\n    if (selection) {\n      selection.selection = {\n        propertyId: this.column.id,\n        isEditing: editing,\n      };\n    }\n  };\n\n  get cell(): DataViewCellLifeCycle | undefined {\n    return this._cell.value;\n  }\n\n  private get readonly() {\n    return this.view.readonly$.value;\n  }\n\n  override render() {\n    const column = this.column;\n\n    const props: CellRenderProps = {\n      cell: this.cell$.value,\n      isEditing: this.editing,\n      selectCurrentCell: this.changeEditing,\n    };\n    const renderer = this.column.renderer$.value;\n    if (!renderer) {\n      return;\n    }\n    const { view, edit } = renderer;\n    const contentClass = classMap({\n      'field-content': true,\n      empty: !this.editing && this.cell$.value.isEmpty$.value,\n      'is-editing': this.editing,\n      'is-focus': this.isFocus,\n    });\n    return html`\n      <div>\n        <div class=\"field-left\" @click=\"${this._clickLeft}\">\n          <div class=\"icon\">\n            <uni-lit .uni=\"${this.column.icon}\"></uni-lit>\n          </div>\n          <div class=\"filed-name\">${column.name$.value}</div>\n        </div>\n      </div>\n      <div @click=\"${this._click}\" class=\"${contentClass}\">\n        ${renderUniLit(this.editing && edit ? edit : view, props, {\n          ref: this._cell,\n          class: 'kanban-cell',\n        })}\n      </div>\n    `;\n  }\n\n  @state()\n  accessor editing = false;\n\n  @state()\n  accessor isFocus = false;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-data-view-record-field': RecordField;\n  }\n}\n"]}