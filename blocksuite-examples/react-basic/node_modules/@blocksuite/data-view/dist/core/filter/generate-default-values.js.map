{"version":3,"file":"generate-default-values.js","sourceRoot":"","sources":["../../../src/core/filter/generate-default-values.ts"],"names":[],"mappings":"AAIA,OAAO,EAAE,aAAa,EAAE,MAAM,wBAAwB,CAAC;AAEvD;;;GAGG;AACH,MAAM,UAAU,qBAAqB,CACnC,MAAmB,EACnB,KAAiB;IAEjB,MAAM,aAAa,GAA2B,EAAE,CAAC;IACjD,MAAM,kBAAkB,GAAG,IAAI,GAAG,EAA0B,CAAC;IAE7D,iCAAiC;IACjC,KAAK,MAAM,SAAS,IAAI,MAAM,CAAC,UAAU,EAAE,CAAC;QAC1C,IAAI,SAAS,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YAChC,MAAM,UAAU,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC;YACvC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC;gBACxC,kBAAkB,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YACzC,CAAC;YACD,kBAAkB,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IAED,KAAK,MAAM,CAAC,UAAU,EAAE,UAAU,CAAC,IAAI,kBAAkB,EAAE,CAAC;QAC1D,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAC5B,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,YAAY,GAAG,aAAa,CAAC,eAAe,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;YACvE,IAAI,YAAY,EAAE,YAAY,EAAE,CAAC;gBAC/B,MAAM,SAAS,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACvD,MAAM,YAAY,GAAG,YAAY,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;gBAC1D,IAAI,YAAY,IAAI,IAAI,EAAE,CAAC;oBACzB,aAAa,CAAC,UAAU,CAAC,GAAG,YAAY,CAAC;gBAC3C,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;IAED,OAAO,aAAa,CAAC;AACvB,CAAC","sourcesContent":["import type { Variable } from '../expression/index.js';\nimport type { DVJSON } from '../property/types.js';\nimport type { FilterGroup, SingleFilter } from './types.js';\n\nimport { filterMatcher } from './filter-fn/matcher.js';\n\n/**\n * Generate default values for a new row based on current filter conditions.\n * If a property has multiple conditions, no value will be set to avoid conflicts.\n */\nexport function generateDefaultValues(\n  filter: FilterGroup,\n  _vars: Variable[]\n): Record<string, DVJSON> {\n  const defaultValues: Record<string, DVJSON> = {};\n  const propertyConditions = new Map<string, SingleFilter[]>();\n\n  // Only collect top-level filters\n  for (const condition of filter.conditions) {\n    if (condition.type === 'filter') {\n      const propertyId = condition.left.name;\n      if (!propertyConditions.has(propertyId)) {\n        propertyConditions.set(propertyId, []);\n      }\n      propertyConditions.get(propertyId)?.push(condition);\n    }\n  }\n\n  for (const [propertyId, conditions] of propertyConditions) {\n    if (conditions.length === 1) {\n      const condition = conditions[0];\n      const filterConfig = filterMatcher.getFilterByName(condition.function);\n      if (filterConfig?.defaultValue) {\n        const argValues = condition.args.map(arg => arg.value);\n        const defaultValue = filterConfig.defaultValue(argValues);\n        if (defaultValue != null) {\n          defaultValues[propertyId] = defaultValue;\n        }\n      }\n    }\n  }\n\n  return defaultValues;\n}\n"]}