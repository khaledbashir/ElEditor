{"version":3,"file":"type-variable.js","sourceRoot":"","sources":["../../../src/core/logical/type-variable.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,SAAS,EAAE,MAAM,+BAA+B,CAAC;AAC3E,OAAO,GAAG,MAAM,KAAK,CAAC;AAItB,MAAM,aAAa,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;AAEpC,MAAM,OAAO,yBAAyB;IAMpC,YACW,OAAa,EACb,cAAqB;QADrB,YAAO,GAAP,OAAO,CAAM;QACb,mBAAc,GAAd,cAAc,CAAO;QAJvB,SAAI,GAAG,iBAAiB,CAAC;IAK/B,CAAC;CACL;AAED,MAAM,OAAO,wBAAwB;IASnC,YAAqB,OAAa;QAAb,YAAO,GAAP,OAAO,CAAM;QANzB,cAAS,GAAG,aAAa,CAAC;QAE1B,eAAU,GAAG,SAAoB,CAAC;QAElC,SAAI,GAAG,oBAAoB,CAAC;IAEA,CAAC;IAEtC,KAAK,CAAC,GAAmB;QACvB,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC;IAChC,CAAC;IAED,KAAK,CAAC,IAAoB,EAAE,KAAmB,EAAE,MAAa;QAC5D,MAAM,IAAI,eAAe,CACvB,SAAS,CAAC,kBAAkB,EAC5B,2CAA2C,CAC5C,CAAC;IACJ,CAAC;IAED,aAAa,CAAC,MAAe;QAC3B,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAED,MAAM,CAAC,MAAM,EAAE,GAAG;IAChB,aAAa,EAAE;QACb,MAAM,EAAE,CAIN,IAAU,EACV,cAAqB,EACrB,EAAE;YACF,OAAO,IAAI,yBAAyB,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;QAC7D,CAAC;KACF;IACD,gBAAgB,EAAE;QAChB,MAAM,EAAE,CAAsB,IAAU,EAAE,EAAE;YAC1C,OAAO,IAAI,wBAAwB,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC;QACD,EAAE,EAAE,CAAC,IAAkB,EAAoC,EAAE;YAC3D,OAAO,IAAI,CAAC,IAAI,KAAK,oBAAoB,CAAC;QAC5C,CAAC;KACF;CACF,CAAC;AAQF,MAAM,CAAC,MAAM,IAAI,GAAG,EAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC;AAC/C,MAAM,CAAC,MAAM,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,MAAM,CAAC","sourcesContent":["import { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport Zod from 'zod';\n\nimport type { TypeInstance, Unify } from './type.js';\n\nconst unknownSchema = Zod.unknown();\n\nexport class TypeVarDefinitionInstance<\n  Name extends string = string,\n  Type extends TypeInstance = TypeInstance,\n> {\n  readonly name = '__TypeVarDefine';\n\n  constructor(\n    readonly varName: Name,\n    readonly typeConstraint?: Type\n  ) {}\n}\n\nexport class TypeVarReferenceInstance<Name extends string = string>\n  implements TypeInstance\n{\n  readonly _validate = unknownSchema;\n\n  readonly _valueType = undefined as unknown;\n\n  readonly name = '__TypeVarReference';\n\n  constructor(readonly varName: Name) {}\n\n  subst(ctx: TypeVarContext): void | TypeInstance {\n    return ctx[this.varName].type;\n  }\n\n  unify(_ctx: TypeVarContext, _type: TypeInstance, _unify: Unify): boolean {\n    throw new BlockSuiteError(\n      ErrorCode.DatabaseBlockError,\n      'unexpected type unify, type var reference'\n    );\n  }\n\n  valueValidate(_value: unknown): _value is unknown {\n    return true;\n  }\n}\n\nexport const tv = {\n  typeVarDefine: {\n    create: <\n      Name extends string = string,\n      Type extends TypeInstance = TypeInstance,\n    >(\n      name: Name,\n      typeConstraint?: Type\n    ) => {\n      return new TypeVarDefinitionInstance(name, typeConstraint);\n    },\n  },\n  typeVarReference: {\n    create: <Name extends string>(name: Name) => {\n      return new TypeVarReferenceInstance(name);\n    },\n    is: (type: TypeInstance): type is TypeVarReferenceInstance => {\n      return type.name === '__TypeVarReference';\n    },\n  },\n};\n\nexport type TypeVarDefine = {\n  define: TypeVarDefinitionInstance;\n  type?: TypeInstance;\n};\n\nexport type TypeVarContext = Record<string, TypeVarDefine>;\nexport const tRef = tv.typeVarReference.create;\nexport const tVar = tv.typeVarDefine.create;\n"]}