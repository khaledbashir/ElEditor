{"version":3,"file":"data-type.js","sourceRoot":"","sources":["../../../src/core/logical/data-type.ts"],"names":[],"mappings":"AAYA,MAAM,OAAO,UAAU;IAQrB,YACW,IAAU,EACV,SAAsB,EACtB,IAAW;QAFX,SAAI,GAAJ,IAAI,CAAM;QACV,cAAS,GAAT,SAAS,CAAa;QACtB,SAAI,GAAJ,IAAI,CAAO;QALb,eAAU,GAAG,SAA6C,CAAC;IAMjE,CAAC;IAEJ,KAAK,CAAC,IAAoB;QACxB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,KAAK,CAAC,IAAoB,EAAE,IAAgB,EAAE,MAAa;QACzD,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE,CAAC;YAC5B,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,EAAE,CAAC;YACtB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC;IAC3B,CAAC;IAED,aAAa,CAAC,KAAc;QAC1B,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC;IACjD,CAAC;CACF;AAED,MAAM,OAAO,QAAQ;IAMnB,YACU,IAAU,EAClB,WAAuB,EACf,WAAwB;QAFxB,SAAI,GAAJ,IAAI,CAAM;QAEV,gBAAW,GAAX,WAAW,CAAa;IAC/B,CAAC;IAEJ,QAAQ,CAAC,OAAgC;QACvC,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;IAC9D,CAAC;IAED,EAAE,CACA,IAAqB;QAErB,OAAO,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC;IACjC,CAAC;CACF;AAED,MAAM,CAAC,MAAM,cAAc,GAAG,CAK5B,IAAU,EACV,YAAkB,EAClB,aAAoB,EACpB,EAAE;IACF,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE,YAAY,EAAE,aAAa,CAAC,CAAC;AACzD,CAAC,CAAC","sourcesContent":["import type Zod from 'zod';\n\nimport type {\n  AnyTypeInstance,\n  TypeDefinition,\n  TypeInstance,\n  Unify,\n} from './type.js';\nimport type { TypeVarContext } from './type-variable.js';\n\nexport type DataTypeOf<T extends DataType> = ReturnType<T['instance']>;\n\nexport class DTInstance<\n  Name extends string = string,\n  Data = unknown,\n  ValueSchema extends Zod.ZodType = Zod.ZodType,\n> implements TypeInstance\n{\n  readonly _valueType = undefined as never as Zod.TypeOf<ValueSchema>;\n\n  constructor(\n    readonly name: Name,\n    readonly _validate: ValueSchema,\n    readonly data?: Data\n  ) {}\n\n  subst(_ctx: TypeVarContext): void | TypeInstance {\n    return this;\n  }\n\n  unify(_ctx: TypeVarContext, type: DTInstance, _unify: Unify): boolean {\n    if (this.name !== type.name) {\n      return false;\n    }\n    if (type.data == null) {\n      return true;\n    }\n    return this.data != null;\n  }\n\n  valueValidate(value: unknown): value is this['_valueType'] {\n    return this._validate.safeParse(value).success;\n  }\n}\n\nexport class DataType<\n  Name extends string = string,\n  DataSchema extends Zod.ZodType = Zod.ZodType,\n  ValueSchema extends Zod.ZodType = Zod.ZodType,\n> implements TypeDefinition\n{\n  constructor(\n    private name: Name,\n    _dataSchema: DataSchema,\n    private valueSchema: ValueSchema\n  ) {}\n\n  instance(literal?: Zod.TypeOf<DataSchema>) {\n    return new DTInstance(this.name, this.valueSchema, literal);\n  }\n\n  is(\n    type: AnyTypeInstance\n  ): type is DTInstance<Name, Zod.TypeOf<DataSchema>, ValueSchema> {\n    return type.name === this.name;\n  }\n}\n\nexport const defineDataType = <\n  Name extends string,\n  Data extends Zod.ZodType,\n  Value extends Zod.ZodType,\n>(\n  name: Name,\n  validateData: Data,\n  validateValue: Value\n) => {\n  return new DataType(name, validateData, validateValue);\n};\n"]}