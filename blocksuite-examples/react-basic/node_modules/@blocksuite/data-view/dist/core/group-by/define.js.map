{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../src/core/group-by/define.ts"],"names":[],"mappings":"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","sourcesContent":["import hash from '@emotion/hash';\n\nimport type { GroupByConfig } from './types.js';\n\nimport { MatcherCreator } from '../logical/matcher.js';\nimport { t } from '../logical/type-presets.js';\nimport { createUniComponentFromWebComponent } from '../utils/uni-component/uni-component.js';\nimport { BooleanGroupView } from './renderer/boolean-group.js';\nimport { NumberGroupView } from './renderer/number-group.js';\nimport { SelectGroupView } from './renderer/select-group.js';\nimport { StringGroupView } from './renderer/string-group.js';\n\nconst groupByMatcherCreator = new MatcherCreator<GroupByConfig>();\nconst ungroups = {\n  key: 'Ungroups',\n  value: null,\n};\nexport const groupByMatchers = [\n  groupByMatcherCreator.createMatcher(t.tag.instance(), {\n    name: 'select',\n    groupName: (type, value) => {\n      if (t.tag.is(type) && type.data) {\n        return type.data.find(v => v.id === value)?.value ?? '';\n      }\n      return '';\n    },\n    defaultKeys: type => {\n      if (t.tag.is(type) && type.data) {\n        return [\n          ungroups,\n          ...type.data.map(v => ({\n            key: v.id,\n            value: v.id,\n          })),\n        ];\n      }\n      return [ungroups];\n    },\n    valuesGroup: (value, _type) => {\n      if (value == null) {\n        return [ungroups];\n      }\n      return [\n        {\n          key: `${value}`,\n          value: value.toString(),\n        },\n      ];\n    },\n    view: createUniComponentFromWebComponent(SelectGroupView),\n  }),\n  groupByMatcherCreator.createMatcher(t.array.instance(t.tag.instance()), {\n    name: 'multi-select',\n    groupName: (type, value) => {\n      if (t.tag.is(type) && type.data) {\n        return type.data.find(v => v.id === value)?.value ?? '';\n      }\n      return '';\n    },\n    defaultKeys: type => {\n      if (t.array.is(type) && t.tag.is(type.element) && type.element.data) {\n        return [\n          ungroups,\n          ...type.element.data.map(v => ({\n            key: v.id,\n            value: v.id,\n          })),\n        ];\n      }\n      return [ungroups];\n    },\n    valuesGroup: (value, _type) => {\n      if (value == null) {\n        return [ungroups];\n      }\n      if (Array.isArray(value)) {\n        if (value.length) {\n          return value.map(id => ({\n            key: `${id}`,\n            value: id,\n          }));\n        }\n      }\n      return [ungroups];\n    },\n    addToGroup: (value, old) => {\n      if (value == null) {\n        return old;\n      }\n      return Array.isArray(old) ? [...old, value] : [value];\n    },\n    removeFromGroup: (value, old) => {\n      if (Array.isArray(old)) {\n        return old.filter(v => v !== value);\n      }\n      return old;\n    },\n    view: createUniComponentFromWebComponent(SelectGroupView),\n  }),\n  groupByMatcherCreator.createMatcher(t.string.instance(), {\n    name: 'text',\n    groupName: (_type, value) => {\n      return `${value ?? ''}`;\n    },\n    defaultKeys: _type => {\n      return [ungroups];\n    },\n    valuesGroup: (value, _type) => {\n      if (typeof value !== 'string' || !value) {\n        return [ungroups];\n      }\n      return [\n        {\n          key: hash(value),\n          value,\n        },\n      ];\n    },\n    view: createUniComponentFromWebComponent(StringGroupView),\n  }),\n  groupByMatcherCreator.createMatcher(t.number.instance(), {\n    name: 'number',\n    groupName: (_type, value) => {\n      return `${value ?? ''}`;\n    },\n    defaultKeys: _type => {\n      return [ungroups];\n    },\n    valuesGroup: (value, _type) => {\n      if (typeof value !== 'number') {\n        return [ungroups];\n      }\n      return [\n        {\n          key: `g:${Math.floor(value / 10)}`,\n          value: Math.floor(value / 10),\n        },\n      ];\n    },\n    addToGroup: value => (typeof value === 'number' ? value * 10 : undefined),\n    view: createUniComponentFromWebComponent(NumberGroupView),\n  }),\n  groupByMatcherCreator.createMatcher(t.boolean.instance(), {\n    name: 'boolean',\n    groupName: (_type, value) => {\n      return `${value?.toString() ?? ''}`;\n    },\n    defaultKeys: _type => {\n      return [\n        { key: 'true', value: true },\n        { key: 'false', value: false },\n      ];\n    },\n    valuesGroup: (value, _type) => {\n      if (typeof value !== 'boolean') {\n        return [\n          {\n            key: 'false',\n            value: false,\n          },\n        ];\n      }\n      return [\n        {\n          key: value.toString(),\n          value: value,\n        },\n      ];\n    },\n    view: createUniComponentFromWebComponent(BooleanGroupView),\n  }),\n];\n"]}