{"version":3,"file":"manager.js","sourceRoot":"","sources":["../../../src/core/sort/manager.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAuB,MAAM,sBAAsB,CAAC;AAKrE,OAAO,EAAE,cAAc,EAAE,MAAM,kBAAkB,CAAC;AAClD,OAAO,EAAE,QAAQ,EAAE,MAAM,WAAW,CAAC;AAErC,MAAM,OAAO,WAAW;IA0BtB,YACW,KAAuC,EACvC,IAAgB,EACjB,GAEP;QAJQ,UAAK,GAAL,KAAK,CAAkC;QACvC,SAAI,GAAJ,IAAI,CAAY;QACjB,QAAG,GAAH,GAAG,CAEV;QA9BH,aAAQ,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAEvE,gBAAW,GAAG,CAAC,QAAkB,EAAE,EAAE;YACnC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC;gBACnB,YAAY,EAAE,EAAE;gBAChB,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK;gBACnB,MAAM,EAAE,QAAQ;aACjB,CAAC,CAAC;QACL,CAAC,CAAC;QAEF,SAAI,GAAG,CAAC,IAAc,EAAE,EAAE;YACxB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;gBACtB,OAAO,IAAI,CAAC;YACd,CAAC;YACD,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;YACtD,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,OAAO,IAAI,CAAC;YACd,CAAC;YACD,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC;YAC7B,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACtB,OAAO,OAAO,CAAC;QACjB,CAAC,CAAC;QAEF,cAAS,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,IAAI,EAAE,CAAC,CAAC;IAQxD,CAAC;CACL;AAED,MAAM,CAAC,MAAM,YAAY,GAAG,cAAc,CAAc,MAAM,CAAC,CAAC","sourcesContent":["import { computed, type ReadonlySignal } from '@preact/signals-core';\n\nimport type { SingleView } from '../view-manager/index.js';\nimport type { Sort, SortBy } from './types.js';\n\nimport { createTraitKey } from '../traits/key.js';\nimport { evalSort } from './eval.js';\n\nexport class SortManager {\n  hasSort$ = computed(() => (this.sort$.value?.sortBy?.length ?? 0) > 0);\n\n  setSortList = (sortList: SortBy[]) => {\n    this.ops.setSortList({\n      manuallySort: [],\n      ...this.sort$.value,\n      sortBy: sortList,\n    });\n  };\n\n  sort = (rows: string[]) => {\n    if (!this.sort$.value) {\n      return rows;\n    }\n    const compare = evalSort(this.sort$.value, this.view);\n    if (!compare) {\n      return rows;\n    }\n    const newRows = rows.slice();\n    newRows.sort(compare);\n    return newRows;\n  };\n\n  sortList$ = computed(() => this.sort$.value?.sortBy ?? []);\n\n  constructor(\n    readonly sort$: ReadonlySignal<Sort | undefined>,\n    readonly view: SingleView,\n    private ops: {\n      setSortList: (sortList: Sort) => void;\n    }\n  ) {}\n}\n\nexport const sortTraitKey = createTraitKey<SortManager>('sort');\n"]}