{"version":3,"file":"cell.js","sourceRoot":"","sources":["../../../src/core/view-manager/cell.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAuB,MAAM,sBAAsB,CAAC;AAuBrE,MAAM,OAAO,QAAQ;IAqCnB,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;IAC9B,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACtC,CAAC;IAED,YACS,IAAgB,EAChB,UAAkB,EAClB,KAAa;QAFb,SAAI,GAAJ,IAAI,CAAY;QAChB,eAAU,GAAV,UAAU,CAAQ;QAClB,UAAK,GAAL,KAAK,CAAQ;QA3CtB,UAAK,GAAG,QAAQ,CAAC,GAAG,EAAE;YACpB,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,eAAe,CACjD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAC1B,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,WAAM,GAAG,QAAQ,CAAC,GAAG,EAAE;YACrB,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,YAAY,CAC9C,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,UAAU,CACP,CAAC;QACb,CAAC,CAAC,CAAC;QAEH,aAAQ,GAA4B,QAAQ,CAAC,GAAG,EAAE;YAChD,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC;gBACrC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK;gBACxB,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU;aACzC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,eAAU,GAA4B,QAAQ,CAAC,GAAG,EAAE;YAClD,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACjE,CAAC,CAAC,CAAC;QAEH,cAAS,GAAG,QAAQ,CAAC,GAAG,EAAE;YACxB,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAA0B,CAAC;QACzE,CAAC,CAAC,CAAC;QAEH,iBAAY,GAA2B,QAAQ,CAAC,GAAG,EAAE;YACnD,OAAO,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAE,CAAC;QACpE,CAAC,CAAC,CAAC;IAcA,CAAC;IAEJ,QAAQ,CAAC,KAA0B;QACjC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,eAAe,CAC1C,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,UAAU,EACf,KAAK,CACN,CAAC;IACJ,CAAC;CACF","sourcesContent":["import { computed, type ReadonlySignal } from '@preact/signals-core';\n\nimport type { Property } from './property.js';\nimport type { Row } from './row.js';\nimport type { SingleView } from './single-view.js';\n\nexport interface Cell<\n  Value = unknown,\n  Data extends Record<string, unknown> = Record<string, unknown>,\n> {\n  readonly rowId: string;\n  readonly view: SingleView;\n  readonly row: Row;\n  readonly propertyId: string;\n  readonly property: Property<Value, Data>;\n  readonly isEmpty$: ReadonlySignal<boolean>;\n  readonly stringValue$: ReadonlySignal<string>;\n  readonly jsonValue$: ReadonlySignal<unknown>;\n\n  readonly value$: ReadonlySignal<Value | undefined>;\n  valueSet(value: Value | undefined): void;\n}\n\nexport class CellBase<\n  Value = unknown,\n  Data extends Record<string, unknown> = Record<string, unknown>,\n> implements Cell<Value, Data>\n{\n  meta$ = computed(() => {\n    return this.view.manager.dataSource.propertyMetaGet(\n      this.property.type$.value\n    );\n  });\n\n  value$ = computed(() => {\n    return this.view.manager.dataSource.cellValueGet(\n      this.rowId,\n      this.propertyId\n    ) as Value;\n  });\n\n  isEmpty$: ReadonlySignal<boolean> = computed(() => {\n    return this.meta$.value.config.isEmpty({\n      value: this.value$.value,\n      dataSource: this.view.manager.dataSource,\n    });\n  });\n\n  jsonValue$: ReadonlySignal<unknown> = computed(() => {\n    return this.view.cellJsonValueGet(this.rowId, this.propertyId);\n  });\n\n  property$ = computed(() => {\n    return this.view.propertyGet(this.propertyId) as Property<Value, Data>;\n  });\n\n  stringValue$: ReadonlySignal<string> = computed(() => {\n    return this.view.cellStringValueGet(this.rowId, this.propertyId)!;\n  });\n\n  get property(): Property<Value, Data> {\n    return this.property$.value;\n  }\n\n  get row(): Row {\n    return this.view.rowGet(this.rowId);\n  }\n\n  constructor(\n    public view: SingleView,\n    public propertyId: string,\n    public rowId: string\n  ) {}\n\n  valueSet(value: unknown | undefined): void {\n    this.view.manager.dataSource.cellValueChange(\n      this.rowId,\n      this.propertyId,\n      value\n    );\n  }\n}\n"]}