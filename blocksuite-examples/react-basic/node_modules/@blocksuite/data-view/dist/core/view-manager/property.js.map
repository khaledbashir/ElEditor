{"version":3,"file":"property.js","sourceRoot":"","sources":["../../../src/core/view-manager/property.ts"],"names":[],"mappings":"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","sourcesContent":["import { computed, type ReadonlySignal } from '@preact/signals-core';\n\nimport type { TypeInstance } from '../logical/type.js';\nimport type { CellRenderer } from '../property/index.js';\nimport type { PropertyDataUpdater } from '../types.js';\nimport type { UniComponent } from '../utils/uni-component/index.js';\nimport type { Cell } from './cell.js';\nimport type { SingleView } from './single-view.js';\n\nexport interface Property<\n  Value = unknown,\n  Data extends Record<string, unknown> = Record<string, unknown>,\n> {\n  readonly id: string;\n  readonly index: number;\n  readonly view: SingleView;\n  readonly isFirst: boolean;\n  readonly isLast: boolean;\n  readonly readonly$: ReadonlySignal<boolean>;\n  readonly renderer$: ReadonlySignal<CellRenderer | undefined>;\n  readonly cells$: ReadonlySignal<Cell[]>;\n  readonly dataType$: ReadonlySignal<TypeInstance>;\n  readonly icon?: UniComponent;\n\n  readonly delete?: () => void;\n  readonly duplicate?: () => void;\n\n  cellGet(rowId: string): Cell<Value>;\n\n  readonly data$: ReadonlySignal<Data>;\n  dataUpdate(updater: PropertyDataUpdater<Data>): void;\n\n  readonly type$: ReadonlySignal<string>;\n  readonly typeSet?: (type: string) => void;\n\n  readonly name$: ReadonlySignal<string>;\n  nameSet(name: string): void;\n\n  readonly hide$: ReadonlySignal<boolean>;\n  hideSet(hide: boolean): void;\n\n  valueGet(rowId: string): Value | undefined;\n  valueSet(rowId: string, value: Value | undefined): void;\n\n  stringValueGet(rowId: string): string;\n  valueSetFromString(rowId: string, value: string): void;\n}\n\nexport abstract class PropertyBase<\n  Value = unknown,\n  Data extends Record<string, unknown> = Record<string, unknown>,\n> implements Property<Value, Data>\n{\n  cells$ = computed(() => {\n    return this.view.rows$.value.map(id => this.cellGet(id));\n  });\n\n  data$ = computed(() => {\n    return this.view.propertyDataGet(this.id) as Data;\n  });\n\n  dataType$ = computed(() => {\n    return this.view.propertyDataTypeGet(this.id)!;\n  });\n\n  hide$ = computed(() => {\n    return this.view.propertyHideGet(this.id);\n  });\n\n  name$ = computed(() => {\n    return this.view.propertyNameGet(this.id);\n  });\n\n  readonly$ = computed(() => {\n    return this.view.readonly$.value || this.view.propertyReadonlyGet(this.id);\n  });\n\n  type$ = computed(() => {\n    return this.view.propertyTypeGet(this.id)!;\n  });\n\n  renderer$ = computed(() => {\n    return this.view.propertyMetaGet(this.type$.value)?.renderer.cellRenderer;\n  });\n\n  get delete(): (() => void) | undefined {\n    return () => this.view.propertyDelete(this.id);\n  }\n\n  get duplicate(): (() => void) | undefined {\n    return () => this.view.propertyDuplicate(this.id);\n  }\n\n  get icon(): UniComponent | undefined {\n    if (!this.type$.value) return undefined;\n    return this.view.propertyIconGet(this.type$.value);\n  }\n\n  get id(): string {\n    return this.propertyId;\n  }\n\n  get index(): number {\n    return this.view.propertyIndexGet(this.id);\n  }\n\n  get isFirst(): boolean {\n    return this.view.propertyIndexGet(this.id) === 0;\n  }\n\n  get isLast(): boolean {\n    return (\n      this.view.propertyIndexGet(this.id) ===\n      this.view.properties$.value.length - 1\n    );\n  }\n\n  get typeSet(): undefined | ((type: string) => void) {\n    return type => this.view.propertyTypeSet(this.id, type);\n  }\n\n  constructor(\n    public view: SingleView,\n    public propertyId: string\n  ) {}\n\n  cellGet(rowId: string): Cell<Value> {\n    return this.view.cellGet(rowId, this.id) as Cell<Value>;\n  }\n\n  dataUpdate(updater: PropertyDataUpdater<Data>): void {\n    const data = this.data$.value;\n    this.view.propertyDataSet(this.id, {\n      ...data,\n      ...updater(data),\n    });\n  }\n\n  hideSet(hide: boolean): void {\n    this.view.propertyHideSet(this.id, hide);\n  }\n\n  nameSet(name: string): void {\n    this.view.propertyNameSet(this.id, name);\n  }\n\n  stringValueGet(rowId: string): string {\n    return this.cellGet(rowId).stringValue$.value;\n  }\n\n  valueGet(rowId: string): Value | undefined {\n    return this.cellGet(rowId).value$.value;\n  }\n\n  valueSet(rowId: string, value: Value | undefined): void {\n    return this.cellGet(rowId).valueSet(value);\n  }\n\n  valueSetFromString(rowId: string, value: string): void {\n    const data = this.view.propertyParseValueFromString(this.id, value);\n    if (!data) {\n      return;\n    }\n    if (data.data) {\n      this.dataUpdate(() => data.data as Data);\n    }\n    this.valueSet(rowId, data.value as Value);\n  }\n}\n"]}