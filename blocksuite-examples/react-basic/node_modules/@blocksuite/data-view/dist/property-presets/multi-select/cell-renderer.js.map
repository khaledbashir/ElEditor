{"version":3,"file":"cell-renderer.js","sourceRoot":"","sources":["../../../src/property-presets/multi-select/cell-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { popupTargetFromElement } from '@blocksuite/affine-components/context-menu';\nimport { computed, signal } from '@preact/signals-core';\nimport { html } from 'lit/static-html.js';\n\nimport type { SelectTag } from '../../core/index.js';\nimport type { SelectPropertyData } from '../select/define.js';\n\nimport { popTagSelect } from '../../core/component/tags/multi-tag-select.js';\nimport { BaseCellRenderer } from '../../core/property/index.js';\nimport { createFromBaseCellRenderer } from '../../core/property/renderer.js';\nimport { createIcon } from '../../core/utils/uni-icon.js';\nimport { multiSelectPropertyModelConfig } from './define.js';\n\nexport class MultiSelectCell extends BaseCellRenderer<\n  string[],\n  SelectPropertyData\n> {\n  override render() {\n    return html`\n      <affine-multi-tag-view\n        .value=\"${Array.isArray(this.value) ? this.value : []}\"\n        .options=\"${this.property.data$.value.options}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\nexport class MultiSelectCellEditing extends BaseCellRenderer<\n  string[],\n  SelectPropertyData\n> {\n  private popTagSelect = () => {\n    const value = signal(this._value);\n    this._disposables.add({\n      dispose: popTagSelect(\n        popupTargetFromElement(\n          this.querySelector('affine-multi-tag-view') ?? this\n        ),\n        {\n          name: this.cell.property.name$.value,\n          options: this.options$,\n          onOptionsChange: this._onOptionsChange,\n          value: value,\n          onChange: v => {\n            this._onChange(v);\n            value.value = v;\n          },\n          onComplete: this._editComplete,\n          minWidth: 400,\n        }\n      ),\n    });\n  };\n\n  _editComplete = () => {\n    this.selectCurrentCell(false);\n  };\n\n  _onChange = (ids: string[]) => {\n    this.onChange(ids);\n  };\n\n  _onOptionsChange = (options: SelectTag[]) => {\n    this.property.dataUpdate(data => {\n      return {\n        ...data,\n        options,\n      };\n    });\n  };\n\n  options$ = computed(() => {\n    return this.property.data$.value.options;\n  });\n\n  get _value() {\n    return this.value ?? [];\n  }\n\n  override firstUpdated() {\n    this.popTagSelect();\n  }\n\n  override render() {\n    return html`\n      <affine-multi-tag-view\n        .value=\"${this._value}\"\n        .options=\"${this.options$.value}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\nexport const multiSelectPropertyConfig =\n  multiSelectPropertyModelConfig.createPropertyMeta({\n    icon: createIcon('MultiSelectIcon'),\n    cellRenderer: {\n      view: createFromBaseCellRenderer(MultiSelectCell),\n      edit: createFromBaseCellRenderer(MultiSelectCellEditing),\n    },\n  });\n"]}