{"version":3,"file":"cell-renderer.js","sourceRoot":"","sources":["../../../src/property-presets/select/cell-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import { popupTargetFromElement } from '@blocksuite/affine-components/context-menu';\nimport { computed, signal } from '@preact/signals-core';\nimport { html } from 'lit/static-html.js';\n\nimport type { SelectTag } from '../../core/index.js';\n\nimport { popTagSelect } from '../../core/component/tags/multi-tag-select.js';\nimport { BaseCellRenderer } from '../../core/property/index.js';\nimport { createFromBaseCellRenderer } from '../../core/property/renderer.js';\nimport { createIcon } from '../../core/utils/uni-icon.js';\nimport {\n  type SelectPropertyData,\n  selectPropertyModelConfig,\n} from './define.js';\n\nexport class SelectCell extends BaseCellRenderer<string[], SelectPropertyData> {\n  override render() {\n    const value = this.value ? [this.value] : [];\n    return html`\n      <affine-multi-tag-view\n        .value=\"${value}\"\n        .options=\"${this.property.data$.value.options}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\nexport class SelectCellEditing extends BaseCellRenderer<\n  string,\n  SelectPropertyData\n> {\n  private popTagSelect = () => {\n    const value = signal(this._value);\n    this._disposables.add({\n      dispose: popTagSelect(\n        popupTargetFromElement(\n          this.querySelector('affine-multi-tag-view') ?? this\n        ),\n        {\n          name: this.cell.property.name$.value,\n          mode: 'single',\n          options: this.options$,\n          onOptionsChange: this._onOptionsChange,\n          value: signal(this._value),\n          onChange: v => {\n            this._onChange(v);\n            value.value = v;\n          },\n          onComplete: this._editComplete,\n          minWidth: 400,\n        }\n      ),\n    });\n  };\n\n  _editComplete = () => {\n    this.selectCurrentCell(false);\n  };\n\n  _onChange = ([id]: string[]) => {\n    this.onChange(id);\n  };\n\n  _onOptionsChange = (options: SelectTag[]) => {\n    this.property.dataUpdate(data => {\n      return {\n        ...data,\n        options,\n      };\n    });\n  };\n\n  options$ = computed(() => {\n    return this.property.data$.value.options;\n  });\n\n  get _value() {\n    const value = this.value;\n    return value ? [value] : [];\n  }\n\n  override firstUpdated() {\n    this.popTagSelect();\n  }\n\n  override render() {\n    return html`\n      <affine-multi-tag-view\n        .value=\"${this._value}\"\n        .options=\"${this.options$.value}\"\n      ></affine-multi-tag-view>\n    `;\n  }\n}\n\nexport const selectPropertyConfig =\n  selectPropertyModelConfig.createPropertyMeta({\n    icon: createIcon('SingleSelectIcon'),\n    cellRenderer: {\n      view: createFromBaseCellRenderer(SelectCell),\n      edit: createFromBaseCellRenderer(SelectCellEditing),\n    },\n  });\n"]}