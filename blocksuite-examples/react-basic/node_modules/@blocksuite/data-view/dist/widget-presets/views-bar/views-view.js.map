{"version":3,"file":"views-view.js","sourceRoot":"","sources":["../../../src/widget-presets/views-bar/views-view.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popFilterableSimpleMenu,\n  popMenu,\n  type PopupTarget,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport {\n  DeleteIcon,\n  DuplicateIcon,\n  InfoIcon,\n  MoreHorizontalIcon,\n  MoveLeftIcon,\n  MoveRightIcon,\n  PlusIcon,\n} from '@blocksuite/icons/lit';\nimport { css, html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport { WidgetBase } from '../../core/widget/widget-base.js';\n\nexport class DataViewHeaderViews extends WidgetBase {\n  static override styles = css`\n    data-view-header-views {\n      height: 28px;\n      display: flex;\n      user-select: none;\n      gap: 4px;\n    }\n    data-view-header-views::-webkit-scrollbar-thumb {\n      width: 1px;\n    }\n\n    .database-view-button {\n      height: 100%;\n      cursor: pointer;\n      padding: 2px 4px;\n      border-radius: 4px;\n      font-size: 14px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-text-secondary-color);\n      white-space: nowrap;\n      max-width: 200px;\n      min-width: 28px;\n    }\n\n    .database-view-button .name {\n      align-items: center;\n      font-size: 15px;\n      line-height: 24px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      font-weight: 500;\n      padding-right: 2px;\n    }\n\n    .database-view-button .icon {\n      margin-right: 6px;\n      display: block;\n      flex-shrink: 0;\n    }\n\n    .database-view-button .icon svg {\n      width: 16px;\n      height: 16px;\n    }\n\n    .database-view-button.selected {\n      color: var(--affine-text-primary-color);\n      background-color: var(--affine-hover-color-filled);\n    }\n  `;\n\n  _addViewMenu = (event: MouseEvent) => {\n    popFilterableSimpleMenu(\n      popupTargetFromElement(event.currentTarget as HTMLElement),\n      this.dataSource.viewMetas.map(v => {\n        return menu.action({\n          name: v.model.defaultName,\n          prefix: html`<uni-lit .uni=${v.renderer.icon}></uni-lit>`,\n          select: () => {\n            const id = this.viewManager.viewAdd(v.type);\n            this.viewManager.setCurrentView(id);\n          },\n        });\n      })\n    );\n  };\n\n  _showMore = (event: MouseEvent) => {\n    const views = this.viewManager.views$.value;\n    popFilterableSimpleMenu(\n      popupTargetFromElement(event.currentTarget as HTMLElement),\n      [\n        menu.group({\n          items: views.map(id => {\n            const openViewOption = (event: MouseEvent) => {\n              event.stopPropagation();\n              this.openViewOption(\n                popupTargetFromElement(event.currentTarget as HTMLElement),\n                id\n              );\n            };\n            const view = this.viewManager.viewGet(id);\n            return menu.action({\n              prefix: html`<uni-lit\n                .uni=${this.getRenderer(id).icon}\n              ></uni-lit>`,\n              name: view.name$.value ?? '',\n              label: () => html`${view.name$.value}`,\n              isSelected: this.viewManager.currentViewId$.value === id,\n              select: () => {\n                this.viewManager.setCurrentView(id);\n              },\n              postfix: html`<div\n                class=\"dv-hover dv-round-4\"\n                @click=\"${openViewOption}\"\n                style=\"display:flex;align-items:center;\"\n              >\n                ${MoreHorizontalIcon()}\n              </div>`,\n            });\n          }),\n        }),\n        menu.group({\n          items: this.dataSource.viewMetas.map(v => {\n            return menu.action({\n              name: `Create ${v.model.defaultName}`,\n              hide: () => this.readonly,\n              prefix: PlusIcon(),\n              select: () => {\n                const id = this.viewManager.viewAdd(v.type);\n                this.viewManager.setCurrentView(id);\n              },\n            });\n          }),\n        }),\n      ]\n    );\n  };\n\n  openViewOption = (target: PopupTarget, id: string) => {\n    if (this.readonly) {\n      return;\n    }\n    const views = this.viewManager.views$.value;\n    const index = views.findIndex(v => v === id);\n    const view = this.viewManager.viewGet(views[index]);\n    if (!view) {\n      return;\n    }\n    popMenu(target, {\n      options: {\n        items: [\n          menu.input({\n            initialValue: view.name$.value,\n            onChange: text => {\n              view.nameSet(text);\n            },\n          }),\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Edit View',\n                prefix: InfoIcon(),\n                select: () => {\n                  this.closest('affine-data-view-renderer')\n                    ?.querySelector('data-view-header-tools-view-options')\n                    ?.openMoreAction(target);\n                },\n              }),\n              menu.action({\n                name: 'Move Left',\n                hide: () => index === 0,\n                prefix: MoveLeftIcon(),\n                select: () => {\n                  const targetId = views[index - 1];\n                  this.viewManager.moveTo(\n                    id,\n                    targetId ? { before: true, id: targetId } : 'start'\n                  );\n                },\n              }),\n              menu.action({\n                name: 'Move Right',\n                prefix: MoveRightIcon(),\n                hide: () => index === views.length - 1,\n                select: () => {\n                  const targetId = views[index + 1];\n                  this.viewManager.moveTo(\n                    id,\n                    targetId ? { before: false, id: targetId } : 'end'\n                  );\n                },\n              }),\n            ],\n          }),\n          menu.group({\n            items: [\n              menu.action({\n                name: 'Duplicate',\n                prefix: DuplicateIcon(),\n                select: () => {\n                  this.viewManager.viewDuplicate(id);\n                },\n              }),\n              menu.action({\n                name: 'Delete',\n                prefix: DeleteIcon(),\n                select: () => {\n                  view.delete();\n                },\n                class: { 'delete-item': true },\n              }),\n            ],\n          }),\n        ],\n      },\n    });\n  };\n\n  renderMore = (count: number) => {\n    const views = this.viewManager.views$.value;\n    if (count === views.length) {\n      if (this.readonly) {\n        return;\n      }\n      return html`<div\n        class=\"database-view-button dv-icon-16 dv-hover\"\n        data-testid=\"database-add-view-button\"\n        @click=\"${this._addViewMenu}\"\n      >\n        ${PlusIcon()}\n      </div>`;\n    }\n    return html`\n      <div class=\"database-view-button dv-hover\" @click=\"${this._showMore}\">\n        ${views.length - count} More\n      </div>\n    `;\n  };\n\n  renderViews = () => {\n    const views = this.viewManager.views$.value;\n    return views.map(id => () => {\n      const classList = classMap({\n        'database-view-button': true,\n        'dv-hover': true,\n        selected: this.viewManager.currentViewId$.value === id,\n      });\n      const view = this.viewManager.viewDataGet(id);\n      return html`\n        <div\n          class=\"${classList}\"\n          style=\"margin-right: 4px;\"\n          @click=\"${(event: MouseEvent) => this._clickView(event, id)}\"\n        >\n          <uni-lit class=\"icon\" .uni=\"${this.getRenderer(id).icon}\"></uni-lit>\n          <div class=\"name\">${view?.name}</div>\n        </div>\n      `;\n    });\n  };\n\n  get readonly() {\n    return this.viewManager.readonly$.value;\n  }\n\n  private getRenderer(viewId: string) {\n    return this.dataSource.viewMetaGetById(viewId).renderer;\n  }\n\n  _clickView(event: MouseEvent, id: string) {\n    if (this.viewManager.currentViewId$.value !== id) {\n      this.viewManager.setCurrentView(id);\n      this.onChangeView?.(id);\n      return;\n    }\n    this.openViewOption(\n      popupTargetFromElement(event.currentTarget as HTMLElement),\n      id\n    );\n  }\n\n  override render() {\n    return html`\n      <component-overflow\n        .renderItem=\"${this.renderViews()}\"\n        .renderMore=\"${this.renderMore}\"\n      ></component-overflow>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor onChangeView: ((id: string) => void) | undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-views': DataViewHeaderViews;\n  }\n}\n"]}