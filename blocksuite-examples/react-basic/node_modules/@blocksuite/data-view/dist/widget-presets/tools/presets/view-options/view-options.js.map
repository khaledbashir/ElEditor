{"version":3,"file":"view-options.js","sourceRoot":"","sources":["../../../../../src/widget-presets/tools/presets/view-options/view-options.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  type MenuButtonData,\n  type MenuConfig,\n  popMenu,\n  type PopupTarget,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport {\n  ArrowRightSmallIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  FilterIcon,\n  GroupingIcon,\n  InfoIcon,\n  LayoutIcon,\n  MoreHorizontalIcon,\n  SortIcon,\n} from '@blocksuite/icons/lit';\nimport { css, html } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { popPropertiesSetting } from '../../../../core/common/properties.js';\nimport { filterTraitKey } from '../../../../core/filter/trait.js';\nimport {\n  popGroupSetting,\n  popSelectGroupByProperty,\n} from '../../../../core/group-by/setting.js';\nimport { groupTraitKey } from '../../../../core/group-by/trait.js';\nimport {\n  type DataViewInstance,\n  emptyFilterGroup,\n  popCreateFilter,\n  renderUniLit,\n} from '../../../../core/index.js';\nimport { popCreateSort } from '../../../../core/sort/add-sort.js';\nimport { sortTraitKey } from '../../../../core/sort/manager.js';\nimport { createSortUtils } from '../../../../core/sort/utils.js';\nimport { WidgetBase } from '../../../../core/widget/widget-base.js';\nimport { popFilterRoot } from '../../../quick-setting-bar/filter/root-panel-view.js';\nimport { popSortRoot } from '../../../quick-setting-bar/sort/root-panel.js';\n\nconst styles = css`\n  .affine-database-toolbar-item.more-action {\n    padding: 2px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n  }\n\n  .affine-database-toolbar-item.more-action:hover {\n    background: var(--affine-hover-color);\n  }\n\n  .affine-database-toolbar-item.more-action {\n    font-size: 20px;\n    color: ${unsafeCSSVarV2('icon/primary')};\n  }\n\n  .more-action.active {\n    background: var(--affine-hover-color);\n  }\n`;\n\nexport class DataViewHeaderToolsViewOptions extends WidgetBase {\n  static override styles = styles;\n\n  clickMoreAction = (e: MouseEvent) => {\n    e.stopPropagation();\n    this.openMoreAction(popupTargetFromElement(e.currentTarget as HTMLElement));\n  };\n\n  openMoreAction = (target: PopupTarget) => {\n    popViewOptions(target, this.dataViewInstance);\n  };\n\n  override render() {\n    if (this.view.readonly$.value) {\n      return;\n    }\n    return html` <div\n      class=\"affine-database-toolbar-item more-action\"\n      @click=\"${this.clickMoreAction}\"\n    >\n      ${MoreHorizontalIcon()}\n    </div>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-tools-view-options': DataViewHeaderToolsViewOptions;\n  }\n}\nconst createSettingMenus = (\n  target: PopupTarget,\n  dataViewInstance: DataViewInstance,\n  reopen: () => void\n) => {\n  const view = dataViewInstance.view;\n  const settingItems: MenuConfig[] = [];\n  settingItems.push(\n    menu.action({\n      name: 'Properties',\n      prefix: InfoIcon(),\n      postfix: html` <div style=\"font-size: 14px;\">\n          ${view.properties$.value.length} shown\n        </div>\n        ${ArrowRightSmallIcon()}`,\n      select: () => {\n        popPropertiesSetting(target, {\n          view: view,\n          onBack: reopen,\n        });\n      },\n    })\n  );\n  const filterTrait = view.traitGet(filterTraitKey);\n  if (filterTrait) {\n    const filterCount = filterTrait.filter$.value.conditions.length;\n    settingItems.push(\n      menu.action({\n        name: 'Filter',\n        prefix: FilterIcon(),\n        postfix: html` <div style=\"font-size: 14px;\">\n            ${filterCount === 0\n              ? ''\n              : filterCount === 1\n                ? '1 filter'\n                : `${filterCount} filters`}\n          </div>\n          ${ArrowRightSmallIcon()}`,\n        select: () => {\n          if (!filterTrait.filter$.value.conditions.length) {\n            popCreateFilter(target, {\n              vars: view.vars$,\n              onBack: reopen,\n              onSelect: filter => {\n                filterTrait.filterSet({\n                  ...(filterTrait.filter$.value ?? emptyFilterGroup),\n                  conditions: [...filterTrait.filter$.value.conditions, filter],\n                });\n                popFilterRoot(target, {\n                  filterTrait: filterTrait,\n                  onBack: reopen,\n                });\n              },\n            });\n          } else {\n            popFilterRoot(target, {\n              filterTrait: filterTrait,\n              onBack: reopen,\n            });\n          }\n        },\n      })\n    );\n  }\n  const sortTrait = view.traitGet(sortTraitKey);\n  if (sortTrait) {\n    const sortCount = sortTrait.sortList$.value.length;\n    settingItems.push(\n      menu.action({\n        name: 'Sort',\n        prefix: SortIcon(),\n        postfix: html` <div style=\"font-size: 14px;\">\n            ${sortCount === 0\n              ? ''\n              : sortCount === 1\n                ? '1 sort'\n                : `${sortCount} sorts`}\n          </div>\n          ${ArrowRightSmallIcon()}`,\n        select: () => {\n          const sortList = sortTrait.sortList$.value;\n          const sortUtils = createSortUtils(\n            sortTrait,\n            dataViewInstance.eventTrace\n          );\n          if (!sortList.length) {\n            popCreateSort(target, {\n              sortUtils: sortUtils,\n              onBack: reopen,\n            });\n          } else {\n            popSortRoot(target, {\n              sortUtils: sortUtils,\n              title: {\n                text: 'Sort',\n                onBack: reopen,\n              },\n            });\n          }\n        },\n      })\n    );\n  }\n  const groupTrait = view.traitGet(groupTraitKey);\n  if (groupTrait) {\n    settingItems.push(\n      menu.action({\n        name: 'Group',\n        prefix: GroupingIcon(),\n        postfix: html` <div style=\"font-size: 14px;\">\n            ${groupTrait.property$.value?.name$.value ?? ''}\n          </div>\n          ${ArrowRightSmallIcon()}`,\n        select: () => {\n          const groupBy = groupTrait.property$.value;\n          if (!groupBy) {\n            popSelectGroupByProperty(target, groupTrait, {\n              onSelect: () => popGroupSetting(target, groupTrait, reopen),\n              onBack: reopen,\n            });\n          } else {\n            popGroupSetting(target, groupTrait, reopen);\n          }\n        },\n      })\n    );\n  }\n  return settingItems;\n};\nexport const popViewOptions = (\n  target: PopupTarget,\n  dataViewInstance: DataViewInstance,\n  onClose?: () => void\n) => {\n  const view = dataViewInstance.view;\n  const reopen = () => {\n    popViewOptions(target, dataViewInstance);\n  };\n  const items: MenuConfig[] = [];\n  items.push(\n    menu.input({\n      initialValue: view.name$.value,\n      onChange: text => {\n        view.nameSet(text);\n      },\n    })\n  );\n  items.push(\n    menu.group({\n      items: [\n        menu.action({\n          name: 'Layout',\n          postfix: html` <div\n              style=\"font-size: 14px;text-transform: capitalize;\"\n            >\n              ${view.type}\n            </div>\n            ${ArrowRightSmallIcon()}`,\n          select: () => {\n            const viewTypes = view.manager.viewMetas.map<MenuConfig>(meta => {\n              return menu => {\n                if (!menu.search(meta.model.defaultName)) {\n                  return;\n                }\n                const isSelected =\n                  meta.type === view.manager.currentView$.value.type;\n                const iconStyle = styleMap({\n                  fontSize: '24px',\n                  color: isSelected\n                    ? 'var(--affine-text-emphasis-color)'\n                    : 'var(--affine-icon-secondary)',\n                });\n                const textStyle = styleMap({\n                  fontSize: '14px',\n                  lineHeight: '22px',\n                  color: isSelected\n                    ? 'var(--affine-text-emphasis-color)'\n                    : 'var(--affine-text-secondary-color)',\n                });\n                const data: MenuButtonData = {\n                  content: () => html`\n                    <div\n                      style=\"color:var(--affine-text-emphasis-color);width:100%;display: flex;flex-direction: column;align-items: center;justify-content: center;padding: 6px 16px;\"\n                    >\n                      <div style=\"${iconStyle}\">\n                        ${renderUniLit(meta.renderer.icon)}\n                      </div>\n                      <div style=\"${textStyle}\">${meta.model.defaultName}</div>\n                    </div>\n                  `,\n                  select: () => {\n                    view.manager.viewChangeType(\n                      view.manager.currentViewId$.value,\n                      meta.type\n                    );\n                    dataViewInstance.clearSelection();\n                  },\n                  class: {},\n                };\n                const containerStyle = styleMap({\n                  flex: '1',\n                });\n                return html` <affine-menu-button\n                  style=\"${containerStyle}\"\n                  .data=\"${data}\"\n                  .menu=\"${menu}\"\n                ></affine-menu-button>`;\n              };\n            });\n            popMenu(target, {\n              options: {\n                title: {\n                  onBack: reopen,\n                  text: 'Layout',\n                },\n                items: [\n                  menu => {\n                    const result = menu.renderItems(viewTypes);\n                    if (result.length) {\n                      return html` <div style=\"display: flex\">${result}</div>`;\n                    }\n                    return html``;\n                  },\n                  // menu.toggleSwitch({\n                  //   name: 'Show block icon',\n                  //   on: true,\n                  //   onChange: value => {\n                  //     console.log(value);\n                  //   },\n                  // }),\n                  // menu.toggleSwitch({\n                  //   name: 'Show Vertical lines',\n                  //   on: true,\n                  //   onChange: value => {\n                  //     console.log(value);\n                  //   },\n                  // }),\n                ],\n              },\n            });\n          },\n          prefix: LayoutIcon(),\n        }),\n      ],\n    })\n  );\n\n  items.push(\n    menu.group({\n      items: createSettingMenus(target, dataViewInstance, reopen),\n    })\n  );\n  items.push(\n    menu.group({\n      items: [\n        menu.action({\n          name: 'Duplicate',\n          prefix: DuplicateIcon(),\n          select: () => {\n            view.duplicate();\n          },\n        }),\n        menu.action({\n          name: 'Delete',\n          prefix: DeleteIcon(),\n          select: () => {\n            view.delete();\n          },\n          class: { 'delete-item': true },\n        }),\n      ],\n    })\n  );\n  popMenu(target, {\n    options: {\n      title: {\n        text: 'View settings',\n      },\n      items,\n      onClose: onClose,\n    },\n  });\n};\n"]}