{"version":3,"file":"filter.js","sourceRoot":"","sources":["../../../../../src/widget-presets/tools/presets/filter/filter.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,sBAAsB,EAAE,MAAM,4CAA4C,CAAC;AACpF,OAAO,EAAE,SAAS,EAAE,MAAM,wBAAwB,CAAC;AACnD,OAAO,EAAE,UAAU,EAAE,MAAM,uBAAuB,CAAC;AACnD,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAChD,OAAO,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAClD,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAIvD,OAAO,EAAE,eAAe,EAAE,MAAM,uCAAuC,CAAC;AACxE,OAAO,EAAE,cAAc,EAAE,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,gBAAgB,EAAE,MAAM,kCAAkC,CAAC;AACpE,OAAO,EAAE,UAAU,EAAE,MAAM,wCAAwC,CAAC;AACpE,OAAO,EAAE,6BAA6B,EAAE,MAAM,uCAAuC,CAAC;AAEtF,MAAM,MAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;CAmBjB,CAAC;AAEF,MAAM,OAAO,yBAA0B,SAAQ,UAAU;IAAzD;;QAGE,cAAS,GAAG,QAAQ,CAAC,GAAG,EAAE;YACxB,OAAO,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,KAAK,IAAI,KAAK,CAAC;QACrD,CAAC,CAAC,CAAC;IAmEL,CAAC;aAvEiB,WAAM,GAAG,MAAM,AAAT,CAAU;IAMhC,IAAY,OAAO;QACjB,OAAO,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,KAAK,IAAI,gBAAgB,CAAC;IAC7D,CAAC;IAED,IAAY,OAAO,CAAC,MAAmB;QACrC,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;IACtC,CAAC;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;IAC5C,CAAC;IAED,IAAY,QAAQ;QAClB,OAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;IACnC,CAAC;IAEO,WAAW,CAAC,KAAiB;QACnC,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;YACzB,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACxB,OAAO;QACT,CAAC;QACD,eAAe,CACb,sBAAsB,CAAC,KAAK,CAAC,aAA4B,CAAC,EAC1D;YACE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK;YACrB,QAAQ,EAAE,MAAM,CAAC,EAAE;gBACjB,IAAI,CAAC,OAAO,GAAG;oBACb,GAAG,IAAI,CAAC,OAAO;oBACf,UAAU,EAAE,CAAC,MAAM,CAAC;iBACrB,CAAC;gBACF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC9B,CAAC;SACF,CACF,CAAC;QACF,OAAO;IACT,CAAC;IAEQ,iBAAiB;QACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;IACnD,CAAC;IAEQ,MAAM;QACb,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO,OAAO,CAAC;QAClC,MAAM,KAAK,GAAG,QAAQ,CAAC;YACrB,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK;gBACzB,CAAC,CAAC,QAAQ,CAAC,eAAe,CAAC;gBAC3B,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC;SAC7B,CAAC,CAAC;QACH,OAAO,IAAI,CAAA;gBACC,IAAI,CAAC,WAAW;eACjB,KAAK;;;QAGZ,UAAU,EAAE;WACT,CAAC;IACV,CAAC;IAED,gBAAgB,CAAC,IAAc;QAC7B,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,6BAA6B,CAAC,CAAC;QAChE,GAAG,CAAC,KAAK,GAAG;YACV,GAAG,GAAG,CAAC,KAAK;YACZ,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;SACjD,CAAC;IACJ,CAAC","sourcesContent":["import { popupTargetFromElement } from '@blocksuite/affine-components/context-menu';\nimport { IS_MOBILE } from '@blocksuite/global/env';\nimport { FilterIcon } from '@blocksuite/icons/lit';\nimport { computed } from '@preact/signals-core';\nimport { cssVarV2 } from '@toeverything/theme/v2';\nimport { css, html, nothing } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { FilterGroup } from '../../../../core/filter/types.js';\n\nimport { popCreateFilter } from '../../../../core/filter/add-filter.js';\nimport { filterTraitKey } from '../../../../core/filter/trait.js';\nimport { emptyFilterGroup } from '../../../../core/filter/utils.js';\nimport { WidgetBase } from '../../../../core/widget/widget-base.js';\nimport { ShowQuickSettingBarContextKey } from '../../../quick-setting-bar/context.js';\n\nconst styles = css`\n  .affine-database-filter-button {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    line-height: 20px;\n    padding: 2px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 20px;\n  }\n\n  .affine-database-filter-button:hover,\n  .affine-database-filter-button.active {\n    background-color: var(--affine-hover-color);\n  }\n\n  .affine-database-filter-button {\n  }\n`;\n\nexport class DataViewHeaderToolsFilter extends WidgetBase {\n  static override styles = styles;\n\n  hasFilter = computed(() => {\n    return this.filterTrait?.hasFilter$.value ?? false;\n  });\n\n  private get _filter(): FilterGroup {\n    return this.filterTrait?.filter$.value ?? emptyFilterGroup;\n  }\n\n  private set _filter(filter: FilterGroup) {\n    this.filterTrait?.filterSet(filter);\n  }\n\n  get filterTrait() {\n    return this.view.traitGet(filterTraitKey);\n  }\n\n  private get readonly() {\n    return this.view.readonly$.value;\n  }\n\n  private clickFilter(event: MouseEvent) {\n    if (this.hasFilter.value) {\n      this.toggleShowFilter();\n      return;\n    }\n    popCreateFilter(\n      popupTargetFromElement(event.currentTarget as HTMLElement),\n      {\n        vars: this.view.vars$,\n        onSelect: filter => {\n          this._filter = {\n            ...this._filter,\n            conditions: [filter],\n          };\n          this.toggleShowFilter(true);\n        },\n      }\n    );\n    return;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.style.display = IS_MOBILE ? 'none' : 'flex';\n  }\n\n  override render() {\n    if (this.readonly) return nothing;\n    const style = styleMap({\n      color: this.hasFilter.value\n        ? cssVarV2('text/emphasis')\n        : cssVarV2('icon/primary'),\n    });\n    return html` <div\n      @click=\"${this.clickFilter}\"\n      style=\"${style}\"\n      class=\"affine-database-filter-button\"\n    >\n      ${FilterIcon()}\n    </div>`;\n  }\n\n  toggleShowFilter(show?: boolean) {\n    const map = this.view.contextGet(ShowQuickSettingBarContextKey);\n    map.value = {\n      ...map.value,\n      [this.view.id]: show ?? !map.value[this.view.id],\n    };\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-tools-filter': DataViewHeaderToolsFilter;\n  }\n}\n"]}