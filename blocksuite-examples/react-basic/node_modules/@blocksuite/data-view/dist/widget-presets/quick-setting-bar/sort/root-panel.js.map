{"version":3,"file":"root-panel.js","sourceRoot":"","sources":["../../../../src/widget-presets/quick-setting-bar/sort/root-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popMenu,\n  type PopupTarget,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { unsafeCSSVarV2 } from '@blocksuite/affine-shared/theme';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport {\n  ArrowDownSmallIcon,\n  CloseIcon,\n  DeleteIcon,\n  PlusIcon,\n} from '@blocksuite/icons/lit';\nimport { computed } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { keyed } from 'lit/directives/keyed.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { SortBy } from '../../../core/sort/types.js';\nimport type { SortUtils } from '../../../core/sort/utils.js';\n\nimport { renderUniLit } from '../../../core/index.js';\nimport { popCreateSort } from '../../../core/sort/add-sort.js';\nimport { dragHandler } from '../../../core/utils/wc-dnd/dnd-context.js';\nimport { defaultActivators } from '../../../core/utils/wc-dnd/sensors/index.js';\nimport {\n  createSortContext,\n  sortable,\n} from '../../../core/utils/wc-dnd/sort/sort-context.js';\nimport { verticalListSortingStrategy } from '../../../core/utils/wc-dnd/sort/strategies/index.js';\n\nexport class SortRootView extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = css`\n    .sort-root-container {\n      margin-bottom: 8px;\n      gap: 8px;\n      display: flex;\n      flex-direction: column;\n    }\n\n    .sort-item {\n      display: flex;\n      align-items: center;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor sortUtils!: SortUtils;\n\n  items$ = computed(() => {\n    return this.sortUtils.sortList$.value.map(v => v.ref.name);\n  });\n\n  sortContext = createSortContext({\n    activators: defaultActivators,\n    container: this,\n    onDragEnd: evt => {\n      const over = evt.over;\n      if (over) {\n        const list = this.sortUtils.sortList$.value;\n        this.sortUtils.move(\n          list.findIndex(v => v.ref.name === evt.active.id),\n          list.findIndex(v => v.ref.name === over.id)\n        );\n      }\n    },\n    modifiers: [\n      ({ transform }) => {\n        return {\n          ...transform,\n          x: 0,\n        };\n      },\n    ],\n    items: this.items$,\n    strategy: verticalListSortingStrategy,\n  });\n\n  override render() {\n    const list = this.sortUtils.sortList$.value;\n    return html`\n      <div class=\"sort-root-container\">\n        ${repeat(list, (sort, index) => {\n          const id = sort.ref.name;\n          const variable = this.sortUtils.vars$.value.find(v => v.id === id);\n          let content;\n          const deleteRule = () => {\n            this.sortUtils.remove(index);\n          };\n          const changeRule = (rule: SortBy) => {\n            this.sortUtils.change(index, rule);\n          };\n          if (!variable) {\n            content = html`\n              <data-view-component-button\n                style=\"color: var(--affine-error-color);border-color: color: var(--affine-error-color)\"\n                @click=\"${deleteRule}\"\n                .text=\"${html`This rule is invalid, click to delete`}\"\n              ></data-view-component-button>\n            `;\n          } else {\n            const descName = sort.desc ? 'Descending' : 'Ascending';\n            const clickField = (event: MouseEvent) => {\n              popMenu(\n                popupTargetFromElement(event.currentTarget as HTMLElement),\n                {\n                  options: {\n                    items: this.sortUtils.vars$.value.map(v => {\n                      return menu.action({\n                        name: v.name,\n                        prefix: renderUniLit(v.icon),\n                        isSelected: v.id === id,\n                        select: () => {\n                          changeRule({\n                            ...sort,\n                            ref: { type: 'ref', name: v.id },\n                          });\n                        },\n                      });\n                    }),\n                  },\n                }\n              );\n            };\n            const clickOrder = (event: MouseEvent) => {\n              popMenu(\n                popupTargetFromElement(event.currentTarget as HTMLElement),\n                {\n                  options: {\n                    items: [false, true].map(desc => {\n                      return menu.action({\n                        name: desc ? 'Descending' : 'Ascending',\n                        isSelected: desc === sort.desc,\n                        select: () => {\n                          changeRule({ ...sort, desc });\n                        },\n                      });\n                    }),\n                  },\n                }\n              );\n            };\n            content = html`\n              <data-view-component-button\n                style=\"margin-right: 6px;margin-left: 4px\"\n                @click=\"${clickField}\"\n                .icon=\"${renderUniLit(variable.icon)}\"\n                .text=\"${variable.name}\"\n                .postfix=\"${ArrowDownSmallIcon()}\"\n              ></data-view-component-button>\n              <data-view-component-button\n                @click=\"${clickOrder}\"\n                .text=\"${html` <div style=\"padding: 0 4px\">${descName}</div>`}\"\n                .postfix=\"${ArrowDownSmallIcon()}\"\n              ></data-view-component-button>\n            `;\n          }\n          return keyed(\n            id,\n            html`\n              <div\n                ${sortable(id)}\n                class='sort-item'\n              >\n                <div style='display: flex;align-items: center;flex:1;margin-right: 16px;'>\n                  <div\n                    ${dragHandler(id)}\n                    style='border-radius:2px;cursor:pointer;width: 4px;height: 12px;background-color: ${unsafeCSSVarV2(\n                      'button/grabber/default'\n                    )}'\n                  ></div>\n                  ${content}\n                </div>\n                <div\n                  @click='${deleteRule}'\n                  style='padding: 2px;display: flex;align-items: center;border-radius: 2px;color:${unsafeCSSVarV2('icon/primary')}'\n                  class='dv-hover dv-rounded'>${CloseIcon({ width: '16px', height: '16px' })}\n                </div>\n              </div>\n              </div>\n            `\n          );\n        })}\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'sort-root-view': SortRootView;\n  }\n}\n\nexport const popSortRoot = (\n  target: PopupTarget,\n  props: {\n    sortUtils: SortUtils;\n    title?: {\n      text: string;\n      onBack?: () => void;\n    };\n  }\n) => {\n  const sortUtils = props.sortUtils;\n  popMenu(target, {\n    options: {\n      title: props.title,\n      items: [\n        () => {\n          return html` <sort-root-view\n            .sortUtils=\"${sortUtils}\"\n          ></sort-root-view>`;\n        },\n        menu.action({\n          name: 'Add sort',\n          prefix: PlusIcon(),\n          select: ele => {\n            popCreateSort(popupTargetFromElement(ele), {\n              sortUtils: props.sortUtils,\n            });\n            return false;\n          },\n        }),\n        menu.action({\n          name: 'Delete',\n          class: { 'delete-item': true },\n          prefix: DeleteIcon(),\n          select: () => {\n            props.sortUtils.removeAll();\n          },\n        }),\n      ],\n    },\n  });\n};\n"]}