{"version":3,"file":"group-panel-view.js","sourceRoot":"","sources":["../../../../src/widget-presets/quick-setting-bar/filter/group-panel-view.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popFilterableSimpleMenu,\n  popMenu,\n  type PopupTarget,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher } from '@blocksuite/global/utils';\nimport {\n  ArrowDownSmallIcon,\n  ConvertIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  MoreHorizontalIcon,\n  PlusIcon,\n} from '@blocksuite/icons/lit';\nimport { computed, type ReadonlySignal } from '@preact/signals-core';\nimport { css, html, nothing, type TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { Variable } from '../../../core/expression/types.js';\nimport type { Filter, FilterGroup } from '../../../core/filter/types.js';\n\nimport { firstFilter, firstFilterInGroup } from '../../../core/filter/utils.js';\n\nexport const popAddNewFilter = (\n  target: PopupTarget,\n  props: {\n    value: FilterGroup;\n    onChange: (value: FilterGroup) => void;\n    vars: Variable[];\n  }\n) => {\n  popFilterableSimpleMenu(target, [\n    menu.action({\n      name: 'Add filter',\n      select: () => {\n        props.onChange({\n          ...props.value,\n          conditions: [...props.value.conditions, firstFilter(props.vars)],\n        });\n      },\n    }),\n    menu.action({\n      name: 'Add filter group',\n      select: () => {\n        props.onChange({\n          ...props.value,\n          conditions: [\n            ...props.value.conditions,\n            firstFilterInGroup(props.vars),\n          ],\n        });\n      },\n    }),\n  ]);\n};\n\nexport class FilterGroupView extends SignalWatcher(ShadowlessElement) {\n  static override styles = css`\n    filter-group-view {\n      border-radius: 4px;\n      display: flex;\n      flex-direction: column;\n      user-select: none;\n    }\n\n    .filter-group-op {\n      width: 60px;\n      display: flex;\n      justify-content: end;\n      padding: 4px;\n      height: 34px;\n      align-items: center;\n      font-size: 14px;\n      font-style: normal;\n      font-weight: 400;\n      line-height: 22px;\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-group-op-clickable {\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .filter-group-op-clickable:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .filter-group-container {\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n    }\n\n    .filter-group-button {\n      padding: 8px 12px;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 14px;\n      line-height: 22px;\n      border-radius: 4px;\n      cursor: pointer;\n      color: var(--affine-text-secondary-color);\n    }\n\n    .filter-group-button svg {\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .filter-group-button:hover {\n      background-color: var(--affine-hover-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-group-button:hover svg {\n      fill: var(--affine-text-primary-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-group-item {\n      padding: 4px 0;\n      display: flex;\n      align-items: start;\n      gap: 8px;\n    }\n\n    .filter-group-item-ops {\n      margin-top: 4px;\n      padding: 4px;\n      border-radius: 4px;\n      height: max-content;\n      display: flex;\n      cursor: pointer;\n    }\n\n    .filter-group-item-ops:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .filter-group-item-ops svg {\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      width: 18px;\n      height: 18px;\n    }\n\n    .filter-group-item-ops:hover svg {\n      fill: var(--affine-text-primary-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .delete-style {\n      background-color: var(--affine-background-error-color);\n    }\n\n    .filter-group-border {\n      border: 1px dashed var(--affine-border-color);\n    }\n\n    .filter-group-bg-1 {\n      background-color: var(--affine-background-secondary-color);\n      border: 1px solid var(--affine-border-color);\n    }\n\n    .filter-group-bg-2 {\n      background-color: var(--affine-background-tertiary-color);\n      border: 1px solid var(--affine-border-color);\n    }\n\n    .hover-style {\n      background-color: var(--affine-hover-color);\n    }\n\n    .delete-style {\n      background-color: var(--affine-background-error-color);\n    }\n  `;\n\n  private _addNew = (e: MouseEvent) => {\n    if (this.isMaxDepth) {\n      this.onChange({\n        ...this.filterGroup.value,\n        conditions: [\n          ...this.filterGroup.value.conditions,\n          firstFilter(this.vars.value),\n        ],\n      });\n      return;\n    }\n    popAddNewFilter(popupTargetFromElement(e.currentTarget as HTMLElement), {\n      value: this.filterGroup.value,\n      onChange: this.onChange,\n      vars: this.vars.value,\n    });\n  };\n\n  private _selectOp = (event: MouseEvent) => {\n    popFilterableSimpleMenu(\n      popupTargetFromElement(event.currentTarget as HTMLElement),\n      [\n        menu.action({\n          name: 'And',\n          select: () => {\n            this.onChange({\n              ...this.filterGroup.value,\n              op: 'and',\n            });\n          },\n        }),\n        menu.action({\n          name: 'Or',\n          select: () => {\n            this.onChange({\n              ...this.filterGroup.value,\n              op: 'or',\n            });\n          },\n        }),\n      ]\n    );\n  };\n\n  private _setFilter = (index: number, filter: Filter) => {\n    this.onChange({\n      ...this.filterGroup.value,\n      conditions: this.filterGroup.value.conditions.map((v, i) =>\n        index === i ? filter : v\n      ),\n    });\n  };\n\n  private opMap = {\n    and: 'And',\n    or: 'Or',\n  };\n\n  @property({ attribute: false })\n  accessor filterGroup!: ReadonlySignal<FilterGroup>;\n\n  conditions$ = computed(() => {\n    return this.filterGroup.value.conditions;\n  });\n\n  setConditions = (conditions: Filter[]) => {\n    this.onChange({\n      ...this.filterGroup.value,\n      conditions: conditions,\n    });\n  };\n\n  private get isMaxDepth() {\n    return this.depth === 3;\n  }\n\n  private _clickConditionOps(target: HTMLElement, i: number) {\n    const filter = this.filterGroup.value.conditions[i];\n    popFilterableSimpleMenu(popupTargetFromElement(target), [\n      menu.group({\n        items: [\n          menu.action({\n            name:\n              filter.type === 'filter' ? 'Turn into group' : 'Wrap in group',\n            prefix: ConvertIcon(),\n            onHover: hover => {\n              this.containerClass = hover\n                ? { index: i, class: 'hover-style' }\n                : undefined;\n            },\n            hide: () => this.depth + getDepth(filter) > 3,\n            select: () => {\n              this.onChange({\n                type: 'group',\n                op: 'and',\n                conditions: [this.filterGroup.value],\n              });\n            },\n          }),\n          menu.action({\n            name: 'Duplicate',\n            prefix: DuplicateIcon(),\n            onHover: hover => {\n              this.containerClass = hover\n                ? { index: i, class: 'hover-style' }\n                : undefined;\n            },\n            select: () => {\n              const conditions = [...this.filterGroup.value.conditions];\n              conditions.splice(\n                i + 1,\n                0,\n                JSON.parse(JSON.stringify(conditions[i]))\n              );\n              this.onChange({\n                ...this.filterGroup.value,\n                conditions: conditions,\n              });\n            },\n          }),\n        ],\n      }),\n      menu.group({\n        name: '',\n        items: [\n          menu.action({\n            name: 'Delete',\n            prefix: DeleteIcon(),\n            class: { 'delete-item': true },\n            onHover: hover => {\n              this.containerClass = hover\n                ? { index: i, class: 'delete-style' }\n                : undefined;\n            },\n            select: () => {\n              const conditions = [...this.filterGroup.value.conditions];\n              conditions.splice(i, 1);\n              this.onChange({\n                ...this.filterGroup.value,\n                conditions,\n              });\n            },\n          }),\n        ],\n      }),\n    ]);\n  }\n\n  override render() {\n    const data = this.filterGroup.value;\n    return html`\n      <div class=\"filter-group-container\">\n        ${repeat(data.conditions, (filter, i) => {\n          const clickOps = (e: MouseEvent) => {\n            e.stopPropagation();\n            e.preventDefault();\n            this._clickConditionOps(e.target as HTMLElement, i);\n          };\n          let op: TemplateResult;\n          if (i === 0) {\n            op = html` <div class=\"filter-group-op\">Where</div>`;\n          } else {\n            op = html`\n              <div\n                class=\"filter-group-op filter-group-op-clickable\"\n                @click=\"${this._selectOp}\"\n              >\n                ${this.opMap[data.op]}\n              </div>\n            `;\n          }\n          const classList = classMap({\n            'filter-root-item': true,\n            'filter-exactly-hover-container': true,\n            'dv-pd-4 dv-round-4': true,\n            [this.containerClass?.class ?? '']:\n              this.containerClass?.index === i,\n          });\n          const groupClassList = classMap({\n            [`filter-group-bg-${this.depth}`]: filter.type !== 'filter',\n          });\n          return html` <div class=\"${classList}\" @contextmenu=\"${clickOps}\">\n            ${op}\n            <div\n              style=\"flex:1;display:flex;align-items:start;justify-content: space-between;gap: 8px;\"\n            >\n              ${filter.type === 'filter'\n                ? html`\n                    <filter-condition-view\n                      .vars=\"${this.vars}\"\n                      .index=\"${i}\"\n                      .value=\"${this.conditions$}\"\n                      .onChange=\"${this.setConditions}\"\n                    ></filter-condition-view>\n                  `\n                : html`\n                    <filter-group-view\n                      class=\"${groupClassList}\"\n                      style=\"width: 100%;\"\n                      .depth=\"${this.depth + 1}\"\n                      .onChange=\"${(v: Filter) => this._setFilter(i, v)}\"\n                      .vars=\"${this.vars}\"\n                      .filterGroup=\"${computed(() => filter)}\"\n                    ></filter-group-view>\n                  `}\n              <div class=\"filter-group-item-ops\" @click=\"${clickOps}\">\n                ${MoreHorizontalIcon()}\n              </div>\n            </div>\n          </div>`;\n        })}\n      </div>\n      <div class=\"filter-group-button\" @click=\"${this._addNew}\">\n        ${PlusIcon()} Add ${this.isMaxDepth ? nothing : ArrowDownSmallIcon()}\n      </div>\n    `;\n  }\n\n  @state()\n  accessor containerClass:\n    | {\n        index: number;\n        class: string;\n      }\n    | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor depth = 1;\n\n  @property({ attribute: false })\n  accessor onChange!: (filter: FilterGroup) => void;\n\n  @property({ attribute: false })\n  accessor vars!: ReadonlySignal<Variable[]>;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'filter-group-view': FilterGroupView;\n  }\n}\nexport const getDepth = (filter: Filter): number => {\n  if (filter.type === 'filter') {\n    return 1;\n  }\n  return Math.max(...filter.conditions.map(getDepth)) + 1;\n};\nexport const popFilterGroup = (\n  target: PopupTarget,\n  props: {\n    vars: ReadonlySignal<Variable[]>;\n    value$: ReadonlySignal<FilterGroup>;\n    onChange: (value?: FilterGroup) => void;\n    onBack?: () => void;\n  }\n) => {\n  popMenu(target, {\n    options: {\n      title: {\n        text: 'Filter group',\n        onBack: props.onBack,\n      },\n      items: [\n        menu.group({\n          items: [\n            () => {\n              return html` <filter-group-view\n                .vars=\"${props.vars}\"\n                .filterGroup=\"${props.value$}\"\n                .onChange=\"${props.onChange}\"\n              ></filter-group-view>`;\n            },\n          ],\n        }),\n        menu.group({\n          items: [\n            menu.action({\n              name: 'Delete',\n              class: { 'delete-item': true },\n              prefix: DeleteIcon(),\n              select: () => {\n                props.onChange();\n              },\n            }),\n          ],\n        }),\n      ],\n    },\n  });\n};\n"]}