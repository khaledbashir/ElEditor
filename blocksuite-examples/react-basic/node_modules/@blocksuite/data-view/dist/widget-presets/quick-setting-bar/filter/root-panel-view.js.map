{"version":3,"file":"root-panel-view.js","sourceRoot":"","sources":["../../../../src/widget-presets/quick-setting-bar/filter/root-panel-view.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  menu,\n  popFilterableSimpleMenu,\n  popMenu,\n  type PopupTarget,\n  popupTargetFromElement,\n  subMenuMiddleware,\n} from '@blocksuite/affine-components/context-menu';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher } from '@blocksuite/global/utils';\nimport {\n  ArrowDownSmallIcon,\n  ConvertIcon,\n  DeleteIcon,\n  DuplicateIcon,\n  FilterIcon,\n  MoreHorizontalIcon,\n  PlusIcon,\n} from '@blocksuite/icons/lit';\nimport { computed, type ReadonlySignal } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { Variable } from '../../../core/expression/types.js';\nimport type { FilterTrait } from '../../../core/filter/trait.js';\nimport type { Filter, FilterGroup } from '../../../core/filter/types.js';\n\nimport { popCreateFilter } from '../../../core/index.js';\nimport {\n  type FilterGroupView,\n  getDepth,\n  popFilterGroup,\n} from './group-panel-view.js';\n\nexport class FilterRootView extends SignalWatcher(ShadowlessElement) {\n  static override styles = css`\n    .filter-root-title {\n      padding: 12px;\n      font-size: 14px;\n      font-weight: 600;\n      line-height: 22px;\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-root-op {\n      width: 60px;\n      display: flex;\n      justify-content: end;\n      padding: 4px;\n      height: 34px;\n      align-items: center;\n    }\n\n    .filter-root-op-clickable {\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .filter-root-op-clickable:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .filter-root-container {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      max-height: 400px;\n      overflow: auto;\n    }\n\n    .filter-root-button {\n      margin: 4px 8px 8px;\n      padding: 8px 12px;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 14px;\n      line-height: 22px;\n      border-radius: 4px;\n      cursor: pointer;\n      color: var(--affine-text-secondary-color);\n    }\n\n    .filter-root-button svg {\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      width: 20px;\n      height: 20px;\n    }\n\n    .filter-root-button:hover {\n      background-color: var(--affine-hover-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-root-button:hover svg {\n      fill: var(--affine-text-primary-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-root-item {\n      padding: 4px 0;\n      display: flex;\n      align-items: start;\n      gap: 8px;\n    }\n\n    .filter-group-title {\n      font-size: 14px;\n      font-style: normal;\n      font-weight: 500;\n      line-height: 22px;\n      display: flex;\n      align-items: center;\n      color: var(--affine-text-primary-color);\n      gap: 6px;\n    }\n\n    .filter-root-item-ops {\n      margin-top: 2px;\n      padding: 4px;\n      border-radius: 4px;\n      height: max-content;\n      display: flex;\n      cursor: pointer;\n    }\n\n    .filter-root-item-ops:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    .filter-root-item-ops svg {\n      fill: var(--affine-text-secondary-color);\n      color: var(--affine-text-secondary-color);\n      width: 18px;\n      height: 18px;\n    }\n\n    .filter-root-item-ops:hover svg {\n      fill: var(--affine-text-primary-color);\n      color: var(--affine-text-primary-color);\n    }\n\n    .filter-root-grabber {\n      cursor: grab;\n      width: 4px;\n      height: 12px;\n      background-color: var(--affine-placeholder-color);\n      border-radius: 1px;\n    }\n\n    .divider {\n      height: 1px;\n      background-color: var(--affine-divider-color);\n      flex-shrink: 0;\n      margin: 8px 0;\n    }\n  `;\n\n  private _setFilter = (index: number, filter: Filter) => {\n    this.onChange({\n      ...this.filterGroup.value,\n      conditions: this.filterGroup.value.conditions.map((v, i) =>\n        index === i ? filter : v\n      ),\n    });\n  };\n\n  private expandGroup = (position: PopupTarget, i: number) => {\n    if (this.filterGroup.value.conditions[i]?.type !== 'group') {\n      return;\n    }\n    popFilterGroup(position, {\n      vars: this.vars,\n      value$: computed(() => {\n        return this.filterGroup.value.conditions[i] as FilterGroup;\n      }),\n      onChange: filter => {\n        if (filter) {\n          this._setFilter(i, filter);\n        } else {\n          this.deleteFilter(i);\n        }\n      },\n    });\n  };\n\n  @property({ attribute: false })\n  accessor filterGroup!: ReadonlySignal<FilterGroup>;\n\n  conditions$ = computed(() => {\n    return this.filterGroup.value.conditions;\n  });\n\n  setConditions = (conditions: Filter[]) => {\n    this.onChange({\n      ...this.filterGroup.value,\n      conditions: conditions,\n    });\n  };\n\n  private _clickConditionOps(target: HTMLElement, i: number) {\n    const filter = this.filterGroup.value.conditions[i];\n    popFilterableSimpleMenu(popupTargetFromElement(target), [\n      menu.action({\n        name: filter.type === 'filter' ? 'Turn into group' : 'Wrap in group',\n        prefix: ConvertIcon(),\n        onHover: hover => {\n          this.containerClass = hover\n            ? { index: i, class: 'hover-style' }\n            : undefined;\n        },\n        hide: () => getDepth(filter) > 3,\n        select: () => {\n          this.onChange({\n            type: 'group',\n            op: 'and',\n            conditions: [this.filterGroup.value],\n          });\n        },\n      }),\n      menu.action({\n        name: 'Duplicate',\n        prefix: DuplicateIcon(),\n        onHover: hover => {\n          this.containerClass = hover\n            ? { index: i, class: 'hover-style' }\n            : undefined;\n        },\n        select: () => {\n          const conditions = [...this.filterGroup.value.conditions];\n          conditions.splice(\n            i + 1,\n            0,\n            JSON.parse(JSON.stringify(conditions[i]))\n          );\n          this.onChange({ ...this.filterGroup.value, conditions: conditions });\n        },\n      }),\n      menu.group({\n        name: '',\n        items: [\n          menu.action({\n            name: 'Delete',\n            prefix: DeleteIcon(),\n            class: { 'delete-item': true },\n            onHover: hover => {\n              this.containerClass = hover\n                ? { index: i, class: 'delete-style' }\n                : undefined;\n            },\n            select: () => {\n              const conditions = [...this.filterGroup.value.conditions];\n              conditions.splice(i, 1);\n              this.onChange({\n                ...this.filterGroup.value,\n                conditions,\n              });\n            },\n          }),\n        ],\n      }),\n    ]);\n  }\n\n  private deleteFilter(i: number) {\n    this.onChange({\n      ...this.filterGroup.value,\n      conditions: this.filterGroup.value.conditions.filter(\n        (_, index) => index !== i\n      ),\n    });\n  }\n\n  override render() {\n    const data = this.filterGroup.value;\n    return html`\n      <div class=\"filter-root-container\">\n        ${repeat(data.conditions, (_, i) => {\n          const clickOps = (e: MouseEvent) => {\n            e.stopPropagation();\n            e.preventDefault();\n            this._clickConditionOps(e.target as HTMLElement, i);\n          };\n          const ops = html`\n            <div class=\"filter-root-item-ops\" @click=\"${clickOps}\">\n              ${MoreHorizontalIcon()}\n            </div>\n          `;\n          const content = html`\n            <div\n              style=\"display:flex;align-items:center;justify-content: space-between;width: 100%;gap:8px;\"\n            >\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <div class=\"filter-root-grabber\"></div>\n                ${this.renderCondition(i)}\n              </div>\n              ${ops}\n            </div>\n          `;\n          const classList = classMap({\n            'filter-root-item': true,\n            'filter-exactly-hover-container': true,\n            'dv-pd-4 dv-round-4': true,\n            [this.containerClass?.class ?? '']:\n              this.containerClass?.index === i,\n          });\n          return html` <div @contextmenu=\"${clickOps}\" class=\"${classList}\">\n            ${content}\n          </div>`;\n        })}\n      </div>\n    `;\n  }\n\n  renderCondition(i: number) {\n    const condition = this.conditions$.value[i];\n    if (!condition) {\n      return;\n    }\n    if (condition.type === 'filter') {\n      return html` <filter-condition-view\n        .vars=\"${this.vars}\"\n        .index=\"${i}\"\n        .value=\"${this.conditions$}\"\n        .onChange=\"${this.setConditions}\"\n      ></filter-condition-view>`;\n    }\n    const expandGroup = (e: MouseEvent) => {\n      this.expandGroup(\n        popupTargetFromElement(e.currentTarget as HTMLElement),\n        i\n      );\n    };\n    const length = condition.conditions.length;\n    const text = length > 1 ? `${length} rules` : `${length} rule`;\n    return html` <data-view-component-button\n      hoverType=\"border\"\n      .icon=\"${FilterIcon()}\"\n      @click=\"${expandGroup}\"\n      .text=\"${html`${text}`}\"\n      .postfix=\"${ArrowDownSmallIcon()}\"\n    ></data-view-component-button>`;\n  }\n\n  @state()\n  accessor containerClass:\n    | {\n        index: number;\n        class: string;\n      }\n    | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor onBack!: () => void;\n\n  @property({ attribute: false })\n  accessor onChange!: (filter: FilterGroup) => void;\n\n  @property({ attribute: false })\n  accessor vars!: ReadonlySignal<Variable[]>;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'filter-root-view': FilterGroupView;\n  }\n}\nexport const popFilterRoot = (\n  target: PopupTarget,\n  props: {\n    filterTrait: FilterTrait;\n    onBack: () => void;\n  }\n) => {\n  const filterTrait = props.filterTrait;\n  const view = filterTrait.view;\n  popMenu(target, {\n    options: {\n      title: {\n        text: 'Filters',\n        onBack: props.onBack,\n      },\n      items: [\n        menu.group({\n          items: [\n            () => {\n              return html` <filter-root-view\n                .onBack=\"${props.onBack}\"\n                .vars=\"${view.vars$}\"\n                .filterGroup=\"${filterTrait.filter$}\"\n                .onChange=\"${filterTrait.filterSet}\"\n              ></filter-root-view>`;\n            },\n          ],\n        }),\n        menu.group({\n          items: [\n            menu.action({\n              name: 'Add',\n              prefix: PlusIcon(),\n              select: ele => {\n                const value = filterTrait.filter$.value;\n                popCreateFilter(\n                  popupTargetFromElement(ele),\n                  {\n                    vars: view.vars$,\n                    onSelect: filter => {\n                      filterTrait.filterSet({\n                        ...value,\n                        conditions: [...value.conditions, filter],\n                      });\n                    },\n                  },\n                  { middleware: subMenuMiddleware }\n                );\n                return false;\n              },\n            }),\n          ],\n        }),\n      ],\n    },\n  });\n};\n"]}