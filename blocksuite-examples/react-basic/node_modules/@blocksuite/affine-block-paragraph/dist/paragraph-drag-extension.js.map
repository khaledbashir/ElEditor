{"version":3,"file":"paragraph-drag-extension.js","sourceRoot":"","sources":["../src/paragraph-drag-extension.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,mBAAmB,EACnB,oBAAoB,GACrB,MAAM,0BAA0B,CAAC;AAClC,OAAO,EAAE,yBAAyB,EAAE,MAAM,oCAAoC,CAAC;AAC/E,OAAO,EACL,0BAA0B,EAC1B,kBAAkB,EAClB,aAAa,GACd,MAAM,iCAAiC,CAAC;AAEzC,MAAM,CAAC,MAAM,yBAAyB,GAAG,yBAAyB,CAAC;IACjE,OAAO,EAAE,oBAAoB,CAAC,KAAK,CAAC,OAAO;IAC3C,WAAW,EAAE,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,aAAa,EAAE,UAAU,EAAE,EAAE,EAAE;QACnE,IAAI,CAAC,aAAa;YAAE,OAAO,KAAK,CAAC;QAEjC,MAAM,OAAO,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACrD,MAAM,YAAY,GAAG,CAAC,CAAC,OAAO,EAAE,OAAO,CAAC,2BAA2B,CAAC,CAAC;QACrE,IAAI,CAAC,YAAY;YAAE,OAAO,KAAK,CAAC;QAEhC,MAAM,KAAK,GAAG,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QACrD,IAAI,CAAC,KAAK;YAAE,OAAO,KAAK,CAAC;QACzB,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;QAC1B,IACE,aAAa,CAAC,KAAK,EAAE,CAAC,kBAAkB,CAAC,CAAC;YAC1C,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;YAC1B,KAAK,CAAC,SAAS,EACf,CAAC;YACD,MAAM,iBAAiB,GAAG,0BAA0B,CAAC,KAAK,CAAC,CAAC,OAAO,CACjE,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,EAAE,CACtD,CAAC;YACF,MAAM,YAAY,GAAG,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;YAC7D,IAAI,CAAC,YAAY;gBAAE,OAAO,KAAK,CAAC;YAChC,aAAa,CAAC,CAAC,YAAY,EAAE,GAAG,iBAAiB,CAAC,EAAE,KAAK,CAAC,CAAC;YAC3D,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IACD,SAAS,EAAE,CAAC,EAAE,gBAAgB,EAAE,EAAE,EAAE;QAClC,gBAAgB;aACb,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,kBAAkB,CAAC,CAAC,CAAC;aAC3D,OAAO,CAAC,EAAE,CAAC,EAAE;YACZ,MAAM,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC;YACvB,IAAI,CAAC,CAAC,KAAK,YAAY,mBAAmB,CAAC;gBAAE,OAAO;YACpD,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;QAC1B,CAAC,CAAC,CAAC;QAEL,OAAO,KAAK,CAAC;IACf,CAAC;CACF,CAAC,CAAC","sourcesContent":["import {\n  ParagraphBlockModel,\n  ParagraphBlockSchema,\n} from '@blocksuite/affine-model';\nimport { DragHandleConfigExtension } from '@blocksuite/affine-shared/services';\nimport {\n  calculateCollapsedSiblings,\n  captureEventTarget,\n  matchFlavours,\n} from '@blocksuite/affine-shared/utils';\n\nexport const ParagraphDragHandleOption = DragHandleConfigExtension({\n  flavour: ParagraphBlockSchema.model.flavour,\n  onDragStart: ({ state, startDragging, anchorBlockId, editorHost }) => {\n    if (!anchorBlockId) return false;\n\n    const element = captureEventTarget(state.raw.target);\n    const dragByHandle = !!element?.closest('affine-drag-handle-widget');\n    if (!dragByHandle) return false;\n\n    const block = editorHost.doc.getBlock(anchorBlockId);\n    if (!block) return false;\n    const model = block.model;\n    if (\n      matchFlavours(model, ['affine:paragraph']) &&\n      model.type.startsWith('h') &&\n      model.collapsed\n    ) {\n      const collapsedSiblings = calculateCollapsedSiblings(model).flatMap(\n        sibling => editorHost.view.getBlock(sibling.id) ?? []\n      );\n      const modelElement = editorHost.view.getBlock(anchorBlockId);\n      if (!modelElement) return false;\n      startDragging([modelElement, ...collapsedSiblings], state);\n      return true;\n    }\n\n    return false;\n  },\n  onDragEnd: ({ draggingElements }) => {\n    draggingElements\n      .filter(el => matchFlavours(el.model, ['affine:paragraph']))\n      .forEach(el => {\n        const model = el.model;\n        if (!(model instanceof ParagraphBlockModel)) return;\n        model.collapsed = false;\n      });\n\n    return false;\n  },\n});\n"]}