{"version":3,"file":"plain-text.js","sourceRoot":"","sources":["../../../src/adapters/plain-text/plain-text.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,8BAA8B,GAE/B,MAAM,oCAAoC,CAAC;AAE5C,OAAO,EAAE,iBAAiB,EAAE,MAAM,qBAAqB,CAAC;AACxD,OAAO,EAAE,4BAA4B,EAAE,MAAM,4BAA4B,CAAC;AAE1E,MAAM,CAAC,MAAM,mCAAmC,GAC9C;IACE,OAAO,EAAE,gBAAgB;IACzB,OAAO,EAAE,GAAG,EAAE,CAAC,KAAK;IACpB,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,gBAAgB;IACnD,eAAe,EAAE,EAAE;IACnB,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,OAAO,CAAC,aAAa,CAAC,eAAe,EAAE,CAAC;QAC1C,CAAC;KACF;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,qCAAqC,GAChD,8BAA8B,CAAC,mCAAmC,CAAC,CAAC;AAEtE,MAAM,CAAC,MAAM,2CAA2C,GACtD;IACE,OAAO,EAAE,gBAAgB;IACzB,OAAO,EAAE,GAAG,EAAE,CAAC,KAAK;IACpB,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,gBAAgB;IACnD,eAAe,EAAE,EAAE;IACnB,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,MAAM,4BAA4B,GAAG,IAAI,4BAA4B,EAAE,CAAC;YACxE,IAAI,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;gBAC/B,MAAM,QAAQ,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAG7B,CAAC;gBACF,4CAA4C;gBAC5C,MAAM,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;qBAC1C,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,CAAC;qBACpD,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;gBACrD,aAAa,CAAC,gBAAgB,CAC5B,8BAA8B,EAC9B,YAAY,CACb,CAAC;gBAEF,MAAM,CAAC,OAAO,CACZ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAmD,CACjE,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE;oBACzB,MAAM,SAAS,GAAG,4BAA4B,CAAC,gBAAgB,CAC7D,OAAO,EACP,EAAE,aAAa,EAAE,QAAQ,EAAE,CAC5B,CAAC;oBACF,IAAI,SAAS,EAAE,CAAC;wBACd,OAAO,CAAC,UAAU,CAAC,OAAO,IAAI,SAAS,GAAG,IAAI,CAAC;oBACjD,CAAC;gBACH,CAAC,CAAC,CAAC;YACL,CAAC;QACH,CAAC;KACF;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,6CAA6C,GACxD,8BAA8B,CAAC,2CAA2C,CAAC,CAAC","sourcesContent":["import {\n  BlockPlainTextAdapterExtension,\n  type BlockPlainTextAdapterMatcher,\n} from '@blocksuite/affine-shared/adapters';\n\nimport { getMindMapNodeMap } from '../utils/mindmap.js';\nimport { PlainTextElementModelAdapter } from './element-adapter/index.js';\n\nexport const surfaceBlockPlainTextAdapterMatcher: BlockPlainTextAdapterMatcher =\n  {\n    flavour: 'affine:surface',\n    toMatch: () => false,\n    fromMatch: o => o.node.flavour === 'affine:surface',\n    toBlockSnapshot: {},\n    fromBlockSnapshot: {\n      enter: (_, context) => {\n        context.walkerContext.skipAllChildren();\n      },\n    },\n  };\n\nexport const SurfaceBlockPlainTextAdapterExtension =\n  BlockPlainTextAdapterExtension(surfaceBlockPlainTextAdapterMatcher);\n\nexport const edgelessSurfaceBlockPlainTextAdapterMatcher: BlockPlainTextAdapterMatcher =\n  {\n    flavour: 'affine:surface',\n    toMatch: () => false,\n    fromMatch: o => o.node.flavour === 'affine:surface',\n    toBlockSnapshot: {},\n    fromBlockSnapshot: {\n      enter: (o, context) => {\n        const { walkerContext } = context;\n        const plainTextElementModelAdapter = new PlainTextElementModelAdapter();\n        if ('elements' in o.node.props) {\n          const elements = o.node.props.elements as Record<\n            string,\n            Record<string, unknown>\n          >;\n          // Get all the node maps of mindMap elements\n          const mindMapArray = Object.entries(elements)\n            .filter(([_, element]) => element.type === 'mindmap')\n            .map(([_, element]) => getMindMapNodeMap(element));\n          walkerContext.setGlobalContext(\n            'surface:mindMap:nodeMapArray',\n            mindMapArray\n          );\n\n          Object.entries(\n            o.node.props.elements as Record<string, Record<string, unknown>>\n          ).forEach(([_, element]) => {\n            const plainText = plainTextElementModelAdapter.fromElementModel(\n              element,\n              { walkerContext, elements }\n            );\n            if (plainText) {\n              context.textBuffer.content += plainText + '\\n';\n            }\n          });\n        }\n      },\n    },\n  };\n\nexport const EdgelessSurfaceBlockPlainTextAdapterExtension =\n  BlockPlainTextAdapterExtension(edgelessSurfaceBlockPlainTextAdapterMatcher);\n"]}