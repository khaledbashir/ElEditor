{"version":3,"file":"markdown.js","sourceRoot":"","sources":["../../../src/adapters/markdown/markdown.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,6BAA6B,GAE9B,MAAM,oCAAoC,CAAC;AAE5C,OAAO,EAAE,iBAAiB,EAAE,MAAM,qBAAqB,CAAC;AACxD,OAAO,EAAE,2BAA2B,EAAE,MAAM,4BAA4B,CAAC;AAEzE,MAAM,CAAC,MAAM,kCAAkC,GAAgC;IAC7E,OAAO,EAAE,gBAAgB;IACzB,OAAO,EAAE,GAAG,EAAE,CAAC,KAAK;IACpB,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,gBAAgB;IACnD,eAAe,EAAE,EAAE;IACnB,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,OAAO,CAAC,aAAa,CAAC,eAAe,EAAE,CAAC;QAC1C,CAAC;KACF;CACF,CAAC;AAEF,MAAM,CAAC,MAAM,oCAAoC,GAC/C,6BAA6B,CAAC,kCAAkC,CAAC,CAAC;AAEpE,MAAM,CAAC,MAAM,0CAA0C,GACrD;IACE,OAAO,EAAE,gBAAgB;IACzB,OAAO,EAAE,GAAG,EAAE,CAAC,KAAK;IACpB,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,gBAAgB;IACnD,eAAe,EAAE,EAAE;IACnB,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,MAAM,2BAA2B,GAAG,IAAI,2BAA2B,EAAE,CAAC;YACtE,IAAI,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;gBAC/B,MAAM,QAAQ,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAG7B,CAAC;gBACF,4CAA4C;gBAC5C,MAAM,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;qBAC1C,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,CAAC;qBACpD,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;gBACrD,aAAa,CAAC,gBAAgB,CAC5B,8BAA8B,EAC9B,YAAY,CACb,CAAC;gBAEF,MAAM,CAAC,OAAO,CACZ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAmD,CACjE,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,EAAE;oBACzB,MAAM,WAAW,GAAG,2BAA2B,CAAC,gBAAgB,CAC9D,OAAO,EACP,EAAE,aAAa,EAAE,QAAQ,EAAE,CAC5B,CAAC;oBACF,IAAI,WAAW,EAAE,CAAC;wBAChB,aAAa,CAAC,QAAQ,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC,SAAS,EAAE,CAAC;oBAC9D,CAAC;gBACH,CAAC,CAAC,CAAC;YACL,CAAC;QACH,CAAC;KACF;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,4CAA4C,GACvD,6BAA6B,CAAC,0CAA0C,CAAC,CAAC","sourcesContent":["import {\n  BlockMarkdownAdapterExtension,\n  type BlockMarkdownAdapterMatcher,\n} from '@blocksuite/affine-shared/adapters';\n\nimport { getMindMapNodeMap } from '../utils/mindmap.js';\nimport { MarkdownElementModelAdapter } from './element-adapter/index.js';\n\nexport const surfaceBlockMarkdownAdapterMatcher: BlockMarkdownAdapterMatcher = {\n  flavour: 'affine:surface',\n  toMatch: () => false,\n  fromMatch: o => o.node.flavour === 'affine:surface',\n  toBlockSnapshot: {},\n  fromBlockSnapshot: {\n    enter: (_, context) => {\n      context.walkerContext.skipAllChildren();\n    },\n  },\n};\n\nexport const SurfaceBlockMarkdownAdapterExtension =\n  BlockMarkdownAdapterExtension(surfaceBlockMarkdownAdapterMatcher);\n\nexport const edgelessSurfaceBlockMarkdownAdapterMatcher: BlockMarkdownAdapterMatcher =\n  {\n    flavour: 'affine:surface',\n    toMatch: () => false,\n    fromMatch: o => o.node.flavour === 'affine:surface',\n    toBlockSnapshot: {},\n    fromBlockSnapshot: {\n      enter: (o, context) => {\n        const { walkerContext } = context;\n        const markdownElementModelAdapter = new MarkdownElementModelAdapter();\n        if ('elements' in o.node.props) {\n          const elements = o.node.props.elements as Record<\n            string,\n            Record<string, unknown>\n          >;\n          // Get all the node maps of mindMap elements\n          const mindMapArray = Object.entries(elements)\n            .filter(([_, element]) => element.type === 'mindmap')\n            .map(([_, element]) => getMindMapNodeMap(element));\n          walkerContext.setGlobalContext(\n            'surface:mindMap:nodeMapArray',\n            mindMapArray\n          );\n\n          Object.entries(\n            o.node.props.elements as Record<string, Record<string, unknown>>\n          ).forEach(([_, element]) => {\n            const markdownAST = markdownElementModelAdapter.fromElementModel(\n              element,\n              { walkerContext, elements }\n            );\n            if (markdownAST) {\n              walkerContext.openNode(markdownAST, 'children').closeNode();\n            }\n          });\n        }\n      },\n    },\n  };\n\nexport const EdgelessSurfaceBlockMarkdownAdapterExtension =\n  BlockMarkdownAdapterExtension(edgelessSurfaceBlockMarkdownAdapterMatcher);\n"]}