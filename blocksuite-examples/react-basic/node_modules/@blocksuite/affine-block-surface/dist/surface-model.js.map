{"version":3,"file":"surface-model.js","sourceRoot":"","sources":["../src/surface-model.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,iBAAiB,IAAI,gBAAgB,EAAE,MAAM,2BAA2B,CAAC;AAClF,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAC3D,OAAO,EAAE,iBAAiB,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAErE,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAC3D,OAAO,EAAE,uBAAuB,EAAE,MAAM,0BAA0B,CAAC;AACnE,OAAO,EAAE,gBAAgB,EAAE,MAAM,yBAAyB,CAAC;AAC3D,OAAO,EAAE,oBAAoB,EAAE,MAAM,qBAAqB,CAAC;AAE3D,MAAM,CAAC,MAAM,kBAAkB,GAAG,iBAAiB,CAAC;IAClD,OAAO,EAAE,gBAAgB;IACzB,KAAK,EAAE,CAAC,kBAAkB,EAAqB,EAAE,CAAC,CAAC;QACjD,QAAQ,EAAE,kBAAkB,CAAC,KAAK,CAAC,IAAI,aAAa,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;KAC9D,CAAC;IACF,QAAQ,EAAE;QACR,OAAO,EAAE,CAAC;QACV,IAAI,EAAE,KAAK;QACX,MAAM,EAAE,CAAC,aAAa,CAAC;QACvB,QAAQ,EAAE;YACR,cAAc;YACd,cAAc;YACd,iBAAiB;YACjB,mBAAmB;YACnB,gBAAgB;YAChB,sBAAsB;SACvB;KACF;IACD,WAAW,EAAE,GAAG,EAAE,CAAC,IAAI,uBAAuB,EAAE;IAChD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,iBAAiB,EAAE;CACvC,CAAC,CAAC;AAIH,MAAM,OAAO,iBAAkB,SAAQ,gBAAgB;IAAvD;;QACU,iBAAY,GAAoB,IAAI,eAAe,EAAE,CAAC;IA2BhE,CAAC;IAzBU,KAAK;QACZ,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;QACrC,KAAK,CAAC,KAAK,EAAE,CAAC;QACd,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE,CACxE,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAClC,CAAC;IACJ,CAAC;IAED,aAAa,CAAC,EAAU;QACtB,MAAM,UAAU,GAAG,IAAI,CAAC,iBAAiB,CACvC,WAAW,CAC4B,CAAC;QAE1C,OAAO,UAAU,CAAC,MAAM,CACtB,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,SAAS,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,CACxE,CAAC;IACJ,CAAC;IAEQ,iBAAiB,CACxB,IAAO;QAEP,OAAO,KAAK,CAAC,iBAAiB,CAC5B,IAAI,CACqC,CAAC;IAC9C,CAAC;CACF","sourcesContent":["import type { ConnectorElementModel } from '@blocksuite/affine-model';\nimport type { SurfaceBlockProps } from '@blocksuite/block-std/gfx';\n\nimport { SurfaceBlockModel as BaseSurfaceModel } from '@blocksuite/block-std/gfx';\nimport { DisposableGroup } from '@blocksuite/global/utils';\nimport { defineBlockSchema, DocCollection } from '@blocksuite/store';\n\nimport { elementsCtorMap } from './element-model/index.js';\nimport { SurfaceBlockTransformer } from './surface-transformer.js';\nimport { connectorWatcher } from './watchers/connector.js';\nimport { groupRelationWatcher } from './watchers/group.js';\n\nexport const SurfaceBlockSchema = defineBlockSchema({\n  flavour: 'affine:surface',\n  props: (internalPrimitives): SurfaceBlockProps => ({\n    elements: internalPrimitives.Boxed(new DocCollection.Y.Map()),\n  }),\n  metadata: {\n    version: 5,\n    role: 'hub',\n    parent: ['affine:page'],\n    children: [\n      'affine:frame',\n      'affine:image',\n      'affine:bookmark',\n      'affine:attachment',\n      'affine:embed-*',\n      'affine:edgeless-text',\n    ],\n  },\n  transformer: () => new SurfaceBlockTransformer(),\n  toModel: () => new SurfaceBlockModel(),\n});\n\nexport type SurfaceMiddleware = (surface: SurfaceBlockModel) => () => void;\n\nexport class SurfaceBlockModel extends BaseSurfaceModel {\n  private _disposables: DisposableGroup = new DisposableGroup();\n\n  override _init() {\n    this._extendElement(elementsCtorMap);\n    super._init();\n    [connectorWatcher(this), groupRelationWatcher(this)].forEach(disposable =>\n      this._disposables.add(disposable)\n    );\n  }\n\n  getConnectors(id: string) {\n    const connectors = this.getElementsByType(\n      'connector'\n    ) as unknown[] as ConnectorElementModel[];\n\n    return connectors.filter(\n      connector => connector.source?.id === id || connector.target?.id === id\n    );\n  }\n\n  override getElementsByType<K extends keyof BlockSuite.SurfaceElementModelMap>(\n    type: K\n  ): BlockSuite.SurfaceElementModelMap[K][] {\n    return super.getElementsByType(\n      type\n    ) as BlockSuite.SurfaceElementModelMap[K][];\n  }\n}\n"]}