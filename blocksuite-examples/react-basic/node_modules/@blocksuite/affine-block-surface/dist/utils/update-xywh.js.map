{"version":3,"file":"update-xywh.js","sourceRoot":"","sources":["../../src/utils/update-xywh.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockModel, BlockProps } from '@blocksuite/store';\n\nimport {\n  ConnectorElementModel,\n  MindmapElementModel,\n  NOTE_MIN_HEIGHT,\n  NOTE_MIN_WIDTH,\n  NoteBlockModel,\n} from '@blocksuite/affine-model';\nimport {\n  type GfxGroupCompatibleInterface,\n  type GfxModel,\n  isGfxGroupCompatibleModel,\n} from '@blocksuite/block-std/gfx';\nimport { Bound, clamp } from '@blocksuite/global/utils';\n\nfunction updatChildElementsXYWH(\n  container: GfxGroupCompatibleInterface,\n  targetBound: Bound,\n  updateElement: (id: string, props: Record<string, unknown>) => void,\n  updateBlock: (\n    model: BlockModel,\n    callBackOrProps: (() => void) | Partial<BlockProps>\n  ) => void\n) {\n  const containerBound = Bound.deserialize(container.xywh);\n  const scaleX = targetBound.w / containerBound.w;\n  const scaleY = targetBound.h / containerBound.h;\n  container.childElements.forEach(child => {\n    const childBound = Bound.deserialize(child.xywh);\n    childBound.x = targetBound.x + scaleX * (childBound.x - containerBound.x);\n    childBound.y = targetBound.y + scaleY * (childBound.y - containerBound.y);\n    childBound.w = scaleX * childBound.w;\n    childBound.h = scaleY * childBound.h;\n    updateXYWH(child, childBound, updateElement, updateBlock);\n  });\n}\n\nexport function updateXYWH(\n  ele: GfxModel,\n  bound: Bound,\n  updateElement: (id: string, props: Record<string, unknown>) => void,\n  updateBlock: (\n    model: BlockModel,\n    callBackOrProps: (() => void) | Partial<BlockProps>\n  ) => void\n) {\n  if (ele instanceof ConnectorElementModel) {\n    ele.moveTo(bound);\n  } else if (ele instanceof NoteBlockModel) {\n    const scale = ele.edgeless.scale ?? 1;\n    bound.w = clamp(bound.w, NOTE_MIN_WIDTH * scale, Infinity);\n    bound.h = clamp(bound.h, NOTE_MIN_HEIGHT * scale, Infinity);\n    if (bound.h >= NOTE_MIN_HEIGHT * scale) {\n      updateBlock(ele, () => {\n        ele.edgeless.collapse = true;\n        ele.edgeless.collapsedHeight = bound.h / scale;\n      });\n    }\n    updateElement(ele.id, {\n      xywh: bound.serialize(),\n    });\n  } else if (ele instanceof MindmapElementModel) {\n    const rootId = ele.tree.id;\n    const rootEle = ele.childElements.find(child => child.id === rootId);\n    if (rootEle) {\n      const rootBound = Bound.deserialize(rootEle.xywh);\n      rootBound.x += bound.x - ele.x;\n      rootBound.y += bound.y - ele.y;\n      updateXYWH(rootEle, rootBound, updateElement, updateBlock);\n    }\n    ele.layout();\n  } else if (isGfxGroupCompatibleModel(ele)) {\n    updatChildElementsXYWH(ele, bound, updateElement, updateBlock);\n    updateElement(ele.id, {\n      xywh: bound.serialize(),\n    });\n  } else {\n    updateElement(ele.id, {\n      xywh: bound.serialize(),\n    });\n  }\n}\n"]}