{"version":3,"file":"frame-card.js","sourceRoot":"","sources":["../../../../src/fragments/frame-panel/card/frame-card.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAwB,EAAE,EAAE,IAAI,EAAE,MAAM,oBAAoB,CAAC;AACpE,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AA0BvD,MAAM,MAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAsEjB,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,mBAAmB,CAAC;IAExC,SAAS;sBAAS,cAAc,CAAC,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;iBAAnD,SAAU,SAAQ,WAAiC;;;qCA6G7D,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;4CAG9B,KAAK,CAAC,uBAAuB,CAAC;8CAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;iCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;sCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;+BAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;sCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;kCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;iCAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAvB/B,gLAAS,SAAS,6BAAT,SAAS,6FAAU;YAG5B,qMAAS,gBAAgB,6BAAhB,gBAAgB,2GAAe;YAGxC,2MAAS,kBAAkB,6BAAlB,kBAAkB,+GAAiC;YAG5D,oKAAS,KAAK,6BAAL,KAAK,qFAAmB;YAGjC,mLAAS,UAAU,6BAAV,UAAU,+FAAU;YAG7B,8JAAS,GAAG,6BAAH,GAAG,iFAA4B;YAGxC,mLAAS,UAAU,6BAAV,UAAU,+FAAU;YAG7B,uKAAS,MAAM,6BAAN,MAAM,uFAA4D;YAG3E,oKAAS,KAAK,6BAAL,KAAK,qFAAiC;;;iBArI/B,WAAM,GAAG,MAAM,CAAC;QAExB,kBAAkB,CAAC,CAAa;YACtC,CAAC,CAAC,cAAc,EAAE,CAAC;YACnB,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC;gBAAE,OAAO;YAE3B,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,CAAC,CAAC;YAC/C,MAAM,gBAAgB,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE,WAAW,EAAE,CAAC,CAAC,EAAE;gBAC/D,IACE,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC;oBAChC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAChC,CAAC;oBACD,OAAO;gBACT,CAAC;gBACD,IAAI,IAAI,CAAC,MAAM,KAAK,UAAU,EAAE,CAAC;oBAC/B,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC;gBAC/B,CAAC;gBAED,MAAM,KAAK,GAAG,IAAI,WAAW,CAAC,MAAM,EAAE;oBACpC,MAAM,EAAE;wBACN,OAAO,EAAE,CAAC,CAAC,OAAO;wBAClB,OAAO,EAAE,CAAC,CAAC,OAAO;wBAClB,KAAK,EAAE,CAAC,CAAC,KAAK;wBACd,KAAK,EAAE,CAAC,CAAC,KAAK;qBACf;iBACF,CAAC,CAAC;gBAEH,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBAC1B,gBAAgB,EAAE,CAAC;YACrB,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,SAAS,EAAE,GAAG,EAAE;gBACvC,gBAAgB,EAAE,CAAC;YACrB,CAAC,CAAC,CAAC;QACL,CAAC;QAEO,qBAAqB,CAAC,CAAa;YACzC,CAAC,CAAC,eAAe,EAAE,CAAC;YAEpB,MAAM,KAAK,GAAG,IAAI,WAAW,CAAC,SAAS,EAAE;gBACvC,MAAM,EAAE;oBACN,KAAK,EAAE,IAAI,CAAC,KAAK;iBAClB;aACF,CAAC,CAAC;YAEH,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC;QAEO,oBAAoB,CAAC,CAAa;YACxC,CAAC,CAAC,eAAe,EAAE,CAAC;YACpB,MAAM,KAAK,GAAG,IAAI,WAAW,CAAC,QAAQ,EAAE;gBACtC,MAAM,EAAE;oBACN,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE;oBACjB,QAAQ,EAAE,IAAI,CAAC,MAAM,KAAK,UAAU;oBACpC,KAAK,EAAE,IAAI,CAAC,SAAS;oBACrB,WAAW,EAAE,CAAC,CAAC,QAAQ;iBACxB;aACF,CAAgB,CAAC;YAElB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5B,CAAC;QAEO,mBAAmB;YACzB,IAAI,IAAI,CAAC,kBAAkB,KAAK,SAAS;gBAAE,OAAO,OAAO,CAAC;YAE1D,OAAO,IAAI,CAAA;QACP,IAAI,CAAC,kBAAkB;WACpB,CAAC;QACV,CAAC;QAEQ,MAAM;YACb,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;YACxC,MAAM,cAAc,GAClB,IAAI,CAAC,MAAM,KAAK,UAAU;gBACxB,CAAC,CAAC,QAAQ,CAAC;oBACP,SAAS,EAAE,GACT,UAAU,KAAK,CAAC;wBACd,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,GAAG,EAAE,OAAO,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK;wBAC9C,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,GAAG,EAAE,OAAO,GAAG,CAAC,CAAC,GAAG,EAAE,iBAC9C,EAAE;oBACF,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC,SAAS;iBACxC,CAAC;gBACJ,CAAC,CAAC,EAAE,CAAC;YAET,OAAO,IAAI,CAAA;oCACqB,IAAI,CAAC,MAAM,IAAI,EAAE;cACvC,cAAc;;QAEpB,IAAI,CAAC,MAAM,KAAK,UAAU;gBAC1B,CAAC,CAAC,OAAO;gBACT,CAAC,CAAC,IAAI,CAAA;yBACW,IAAI,CAAC,SAAS;qBAClB,IAAI,CAAC,KAAK;sCACO;;;iBAGrB,IAAI,CAAC,oBAAoB;oBACtB,IAAI,CAAC,qBAAqB;qBACzB,IAAI,CAAC,kBAAkB;;UAElC,IAAI,CAAC,MAAM,KAAK,UAAU,IAAI,UAAU,KAAK,CAAC;gBAC9C,CAAC,CAAC,OAAO;gBACT,CAAC,CAAC,IAAI,CAAA,yBAAyB,IAAI,CAAC,KAAK,mBAAmB;UAC5D,IAAI,CAAC,mBAAmB,EAAE;;WAEzB,CAAC;QACV,CAAC;QAGD,uFAA4B;QAA5B,IAAS,SAAS,+CAAU;QAA5B,IAAS,SAAS,qDAAU;QAG5B,8JAAwC;QAAxC,IAAS,gBAAgB,sDAAe;QAAxC,IAAS,gBAAgB,4DAAe;QAGxC,gKAAkD,SAAS,GAAC;QAA5D,IAAS,kBAAkB,wDAAiC;QAA5D,IAAS,kBAAkB,8DAAiC;QAG5D,iJAAiC;QAAjC,IAAS,KAAK,2CAAmB;QAAjC,IAAS,KAAK,iDAAmB;QAGjC,8IAA6B;QAA7B,IAAS,UAAU,gDAAU;QAA7B,IAAS,UAAU,sDAAU;QAG7B,qIAAwC;QAAxC,IAAS,GAAG,yCAA4B;QAAxC,IAAS,GAAG,+CAA4B;QAGxC,4IAA6B;QAA7B,IAAS,UAAU,gDAAU;QAA7B,IAAS,UAAU,sDAAU;QAG7B,kIAAoE,MAAM,GAAC;QAA3E,IAAS,MAAM,4CAA4D;QAA3E,IAAS,MAAM,kDAA4D;QAG3E,4HAAqC,SAAS,GAAC;QAA/C,IAAS,KAAK,2CAAiC;QAA/C,IAAS,KAAK,iDAAiC;;;;;;;SAtIpC,SAAS","sourcesContent":["import { ShadowlessElement } from '@blocksuite/block-std';\nimport { type FrameBlockModel, on, once } from '@blocksuite/blocks';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { css, html, nothing } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nexport type ReorderEvent = CustomEvent<{\n  currentNumber: number;\n  targetNumber: number;\n  realIndex: number;\n}>;\n\nexport type SelectEvent = CustomEvent<{\n  id: string;\n  selected: boolean;\n  index: number;\n  multiselect: boolean;\n}>;\n\nexport type DragEvent = CustomEvent<{\n  clientX: number;\n  clientY: number;\n  pageX: number;\n  pageY: number;\n}>;\n\nexport type FitViewEvent = CustomEvent<{\n  block: FrameBlockModel;\n}>;\n\nconst styles = css`\n  :host {\n    display: block;\n  }\n\n  .frame-card-container {\n    display: flex;\n    flex-direction: column;\n    width: 284px;\n    height: 198px;\n    gap: 8px;\n\n    position: relative;\n  }\n\n  .frame-card-body {\n    display: flex;\n    width: 100%;\n    height: 170px;\n    box-sizing: border-box;\n    justify-content: center;\n    align-items: center;\n    border-radius: 8px;\n    border: 1px solid var(--affine-border-color);\n    background: var(--affine-background-primary-color);\n    box-shadow: 0px 0px 12px 0px rgba(66, 65, 73, 0.18);\n    cursor: pointer;\n    position: relative;\n  }\n\n  .frame-card-container.selected .frame-card-body {\n    border: 2px solid var(--light-brand-color, #1e96eb);\n  }\n\n  .frame-card-container.dragging {\n    pointer-events: none;\n    transform-origin: 16px 8px;\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: calc(var(--affine-z-index-popover, 0) + 3);\n  }\n\n  .frame-card-container.dragging frame-card-title {\n    display: none;\n  }\n\n  .frame-card-container.dragging .dragging-card-number {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    transform: translate(-30%, 30%);\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    background: var(--affine-black);\n    color: var(--affine-white);\n    font-size: 15px;\n    line-height: 24px;\n    text-align: center;\n    font-weight: 400;\n  }\n\n  .frame-card-container.placeholder {\n    opacity: 0.5;\n  }\n`;\n\nexport const AFFINE_FRAME_CARD = 'affine-frame-card';\n\nexport class FrameCard extends WithDisposable(ShadowlessElement) {\n  static override styles = styles;\n\n  private _dispatchDragEvent(e: MouseEvent) {\n    e.preventDefault();\n    if (e.button !== 0) return;\n\n    const { clientX: startX, clientY: startY } = e;\n    const disposeDragStart = on(this.ownerDocument, 'mousemove', e => {\n      if (\n        Math.abs(startX - e.clientX) < 5 &&\n        Math.abs(startY - e.clientY) < 5\n      ) {\n        return;\n      }\n      if (this.status !== 'selected') {\n        this._dispatchSelectEvent(e);\n      }\n\n      const event = new CustomEvent('drag', {\n        detail: {\n          clientX: e.clientX,\n          clientY: e.clientY,\n          pageX: e.pageX,\n          pageY: e.pageY,\n        },\n      });\n\n      this.dispatchEvent(event);\n      disposeDragStart();\n    });\n\n    once(this.ownerDocument, 'mouseup', () => {\n      disposeDragStart();\n    });\n  }\n\n  private _dispatchFitViewEvent(e: MouseEvent) {\n    e.stopPropagation();\n\n    const event = new CustomEvent('fitview', {\n      detail: {\n        block: this.frame,\n      },\n    });\n\n    this.dispatchEvent(event);\n  }\n\n  private _dispatchSelectEvent(e: MouseEvent) {\n    e.stopPropagation();\n    const event = new CustomEvent('select', {\n      detail: {\n        id: this.frame.id,\n        selected: this.status !== 'selected',\n        index: this.cardIndex,\n        multiselect: e.shiftKey,\n      },\n    }) as SelectEvent;\n\n    this.dispatchEvent(event);\n  }\n\n  private _DraggingCardNumber() {\n    if (this.draggingCardNumber === undefined) return nothing;\n\n    return html`<div class=\"dragging-card-number\">\n      ${this.draggingCardNumber}\n    </div>`;\n  }\n\n  override render() {\n    const { pos, stackOrder, width } = this;\n    const containerStyle =\n      this.status === 'dragging'\n        ? styleMap({\n            transform: `${\n              stackOrder === 0\n                ? `translate(${pos.x - 16}px, ${pos.y - 8}px)`\n                : `translate(${pos.x - 10}px, ${pos.y - 16}px) scale(0.96)`\n            }`,\n            width: width ? `${width}px` : undefined,\n          })\n        : {};\n\n    return html`<div\n      class=\"frame-card-container ${this.status ?? ''}\"\n      style=${containerStyle}\n    >\n      ${this.status === 'dragging'\n        ? nothing\n        : html`<affine-frame-card-title\n            .cardIndex=${this.cardIndex}\n            .frame=${this.frame}\n          ></affine-frame-card-title>`}\n      <div\n        class=\"frame-card-body\"\n        @click=${this._dispatchSelectEvent}\n        @dblclick=${this._dispatchFitViewEvent}\n        @mousedown=${this._dispatchDragEvent}\n      >\n        ${this.status === 'dragging' && stackOrder !== 0\n          ? nothing\n          : html`<frame-preview .frame=${this.frame}></frame-preview>`}\n        ${this._DraggingCardNumber()}\n      </div>\n    </div>`;\n  }\n\n  @property({ attribute: false })\n  accessor cardIndex!: number;\n\n  @query('.frame-card-container')\n  accessor containerElement!: HTMLElement;\n\n  @property({ attribute: false })\n  accessor draggingCardNumber: number | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor frame!: FrameBlockModel;\n\n  @property({ attribute: false })\n  accessor frameIndex!: string;\n\n  @property({ attribute: false })\n  accessor pos!: { x: number; y: number };\n\n  @property({ attribute: false })\n  accessor stackOrder!: number;\n\n  @property({ attribute: false })\n  accessor status: 'selected' | 'dragging' | 'placeholder' | 'none' = 'none';\n\n  @property({ attribute: false })\n  accessor width: number | undefined = undefined;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_FRAME_CARD]: FrameCard;\n  }\n}\n"]}