{"version":3,"file":"embed-edgeless-linked-doc-block.js","sourceRoot":"","sources":["../../src/embed-linked-doc-block/embed-edgeless-linked-doc-block.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,iBAAiB,EACjB,gBAAgB,GACjB,MAAM,kCAAkC,CAAC;AAC1C,OAAO,EAAE,gCAAgC,EAAE,MAAM,iCAAiC,CAAC;AACnF,OAAO,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AAEjD,OAAO,EAAE,oBAAoB,EAAE,MAAM,sCAAsC,CAAC;AAC5E,OAAO,EAAE,4BAA4B,EAAE,MAAM,6BAA6B,CAAC;AAE3E,MAAM,OAAO,oCAAqC,SAAQ,oBAAoB,CAC5E,4BAA4B,CAC7B;IAFD;;QAGW,mBAAc,GAAG,GAAG,EAAE;YAC7B,MAAM,EAAE,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YAE9C,gDAAgD;YAChD,MAAM,kBAAkB,GAAG,GAAG,CAAC,cAAc,CAAC,OAAO,CACnD,yBAAyB,CAC1B,CAAC;YACF,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBACxB,OAAO;YACT,CAAC;YAED,MAAM,KAAK,GAAG,WAAW,CAAC;YAC1B,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACtC,KAAK,CAAC,CAAC,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC;YAClC,KAAK,CAAC,CAAC,GAAG,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAEnC,MAAM,eAAe,GAAG,IAAI,CAAC,WAAW,CAAC;YAEzC,IAAI,CAAC,eAAe,EAAE,CAAC;gBACrB,OAAO;YACT,CAAC;YAED,qDAAqD;YACrD,MAAM,KAAK,GAAG,eAAe,CAAC,QAAQ,CACpC,yBAAyB,EACzB;gBACE,IAAI,EAAE,KAAK,CAAC,SAAS,EAAE;gBACvB,OAAO;gBACP,GAAG,gCAAgC,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;aAChE;YACD,qDAAqD;YACrD,eAAe,CAAC,OAAO,CACxB,CAAC;YAEF,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,uBAAuB,EAAE;gBAC7C,KAAK,EAAE,EAAE;gBACT,KAAK;aACN,CAAC,CAAC;YAEH,qDAAqD;YACrD,eAAe,CAAC,SAAS,CAAC,GAAG,CAAC;gBAC5B,OAAO,EAAE,KAAK;gBACd,QAAQ,EAAE,CAAC,KAAK,CAAC;aAClB,CAAC,CAAC;YAEH,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9B,CAAC,CAAC;IAYJ,CAAC;IAVC,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;IAC5C,CAAC;IAEkB,YAAY,CAAC,GAAe;QAC7C,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;YAC5B,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,CAAC;YACpE,OAAO;QACT,CAAC;IACH,CAAC;CACF","sourcesContent":["import {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '@blocksuite/affine-shared/consts';\nimport { cloneReferenceInfoWithoutAliases } from '@blocksuite/affine-shared/utils';\nimport { Bound } from '@blocksuite/global/utils';\n\nimport { toEdgelessEmbedBlock } from '../common/to-edgeless-embed-block.js';\nimport { EmbedLinkedDocBlockComponent } from './embed-linked-doc-block.js';\n\nexport class EmbedEdgelessLinkedDocBlockComponent extends toEdgelessEmbedBlock(\n  EmbedLinkedDocBlockComponent\n) {\n  override convertToEmbed = () => {\n    const { id, doc, caption, xywh } = this.model;\n\n    // synced doc entry controlled by awareness flag\n    const isSyncedDocEnabled = doc.awarenessStore.getFlag(\n      'enable_synced_doc_block'\n    );\n    if (!isSyncedDocEnabled) {\n      return;\n    }\n\n    const style = 'syncedDoc';\n    const bound = Bound.deserialize(xywh);\n    bound.w = EMBED_CARD_WIDTH[style];\n    bound.h = EMBED_CARD_HEIGHT[style];\n\n    const edgelessService = this.rootService;\n\n    if (!edgelessService) {\n      return;\n    }\n\n    // @ts-expect-error TODO: fix after edgeless refactor\n    const newId = edgelessService.addBlock(\n      'affine:embed-synced-doc',\n      {\n        xywh: bound.serialize(),\n        caption,\n        ...cloneReferenceInfoWithoutAliases(this.referenceInfo$.peek()),\n      },\n      // @ts-expect-error TODO: fix after edgeless refactor\n      edgelessService.surface\n    );\n\n    this.std.command.exec('reassociateConnectors', {\n      oldId: id,\n      newId,\n    });\n\n    // @ts-expect-error TODO: fix after edgeless refactor\n    edgelessService.selection.set({\n      editing: false,\n      elements: [newId],\n    });\n\n    doc.deleteBlock(this.model);\n  };\n\n  get rootService() {\n    return this.std.getService('affine:page');\n  }\n\n  protected override _handleClick(evt: MouseEvent): void {\n    if (this.config.handleClick) {\n      this.config.handleClick(evt, this.host, this.referenceInfo$.peek());\n      return;\n    }\n  }\n}\n"]}