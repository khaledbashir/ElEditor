{"version":3,"file":"markdown.js","sourceRoot":"","sources":["../../../src/embed-linked-doc-block/adapters/markdown.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,yBAAyB,EAAE,MAAM,0BAA0B,CAAC;AACrE,OAAO,EACL,6BAA6B,GAE9B,MAAM,oCAAoC,CAAC;AAE5C,OAAO,EAAE,cAAc,EAAE,MAAM,gCAAgC,CAAC;AAEhE,MAAM,CAAC,MAAM,yCAAyC,GACpD;IACE,OAAO,EAAE,yBAAyB,CAAC,KAAK,CAAC,OAAO;IAChD,OAAO,EAAE,GAAG,EAAE,CAAC,KAAK;IACpB,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,yBAAyB,CAAC,KAAK,CAAC,OAAO;IAC1E,eAAe,EAAE,EAAE;IACnB,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,MAAM,EAAE,OAAO,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAC3C,gBAAgB;YAChB,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;gBACzB,OAAO;YACT,CAAC;YACD,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC;YACxE,MAAM,GAAG,GAAG,cAAc,CACxB,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,EACnC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAC3B,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAC3C,CAAC;YACF,aAAa;iBACV,QAAQ,CACP;gBACE,IAAI,EAAE,WAAW;gBACjB,QAAQ,EAAE,EAAE;aACb,EACD,UAAU,CACX;iBACA,QAAQ,CACP;gBACE,IAAI,EAAE,MAAM;gBACZ,GAAG;gBACH,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAwB;gBAC5C,QAAQ,EAAE;oBACR;wBACE,IAAI,EAAE,MAAM;wBACZ,KAAK,EAAE,KAAK;qBACb;iBACF;aACF,EACD,UAAU,CACX;iBACA,SAAS,EAAE;iBACX,SAAS,EAAE,CAAC;QACjB,CAAC;KACF;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,sCAAsC,GACjD,6BAA6B,CAAC,yCAAyC,CAAC,CAAC","sourcesContent":["import { EmbedLinkedDocBlockSchema } from '@blocksuite/affine-model';\nimport {\n  BlockMarkdownAdapterExtension,\n  type BlockMarkdownAdapterMatcher,\n} from '@blocksuite/affine-shared/adapters';\n\nimport { generateDocUrl } from '../../common/adapters/utils.js';\n\nexport const embedLinkedDocBlockMarkdownAdapterMatcher: BlockMarkdownAdapterMatcher =\n  {\n    flavour: EmbedLinkedDocBlockSchema.model.flavour,\n    toMatch: () => false,\n    fromMatch: o => o.node.flavour === EmbedLinkedDocBlockSchema.model.flavour,\n    toBlockSnapshot: {},\n    fromBlockSnapshot: {\n      enter: (o, context) => {\n        const { configs, walkerContext } = context;\n        // Parse as link\n        if (!o.node.props.pageId) {\n          return;\n        }\n        const title = configs.get('title:' + o.node.props.pageId) ?? 'untitled';\n        const url = generateDocUrl(\n          configs.get('docLinkBaseUrl') ?? '',\n          String(o.node.props.pageId),\n          o.node.props.params ?? Object.create(null)\n        );\n        walkerContext\n          .openNode(\n            {\n              type: 'paragraph',\n              children: [],\n            },\n            'children'\n          )\n          .openNode(\n            {\n              type: 'link',\n              url,\n              title: o.node.props.caption as string | null,\n              children: [\n                {\n                  type: 'text',\n                  value: title,\n                },\n              ],\n            },\n            'children'\n          )\n          .closeNode()\n          .closeNode();\n      },\n    },\n  };\n\nexport const EmbedLinkedDocMarkdownAdapterExtension =\n  BlockMarkdownAdapterExtension(embedLinkedDocBlockMarkdownAdapterMatcher);\n"]}