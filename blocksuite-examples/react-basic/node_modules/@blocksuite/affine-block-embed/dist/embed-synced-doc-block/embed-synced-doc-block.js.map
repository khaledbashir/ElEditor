{"version":3,"file":"embed-synced-doc-block.js","sourceRoot":"","sources":["../../src/embed-synced-doc-block/embed-synced-doc-block.ts"],"names":[],"mappings":"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","sourcesContent":["import { Peekable } from '@blocksuite/affine-components/peek';\nimport {\n  REFERENCE_NODE,\n  RefNodeSlotsProvider,\n} from '@blocksuite/affine-components/rich-text';\nimport {\n  type AliasInfo,\n  type DocMode,\n  type EmbedSyncedDocModel,\n  NoteDisplayMode,\n  type ReferenceInfo,\n} from '@blocksuite/affine-model';\nimport {\n  DocDisplayMetaProvider,\n  DocModeProvider,\n  ThemeExtensionIdentifier,\n  ThemeProvider,\n} from '@blocksuite/affine-shared/services';\nimport {\n  cloneReferenceInfo,\n  SpecProvider,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  BlockServiceWatcher,\n  BlockStdScope,\n  type EditorHost,\n} from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport { assertExists, Bound, getCommonBound } from '@blocksuite/global/utils';\nimport {\n  BlockViewType,\n  DocCollection,\n  type GetDocOptions,\n  type Query,\n} from '@blocksuite/store';\nimport { computed } from '@preact/signals-core';\nimport { html, type PropertyValues } from 'lit';\nimport { query, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { guard } from 'lit/directives/guard.js';\nimport { type StyleInfo, styleMap } from 'lit/directives/style-map.js';\n\nimport type { EmbedSyncedDocCard } from './components/embed-synced-doc-card.js';\n\nimport { EmbedBlockComponent } from '../common/embed-block-element.js';\nimport { isEmptyDoc } from '../common/render-linked-doc.js';\nimport { blockStyles } from './styles.js';\n\n@Peekable({\n  enableOn: ({ doc }: EmbedSyncedDocBlockComponent) => !doc.readonly,\n})\nexport class EmbedSyncedDocBlockComponent extends EmbedBlockComponent<EmbedSyncedDocModel> {\n  static override styles = blockStyles;\n\n  // Caches total bounds, includes all blocks and elements.\n  private _cachedBounds: Bound | null = null;\n\n  private _initEdgelessFitEffect = () => {\n    const fitToContent = () => {\n      if (this.isPageMode) return;\n\n      const controller = this.syncedDocEditorHost?.std.getOptional(\n        GfxControllerIdentifier\n      );\n      if (!controller) return;\n\n      const viewport = controller.viewport;\n      if (!viewport) return;\n\n      if (!this._cachedBounds) {\n        this._cachedBounds = getCommonBound([\n          ...controller.layer.blocks.map(block =>\n            Bound.deserialize(block.xywh)\n          ),\n          ...controller.layer.canvasElements,\n        ]);\n      }\n\n      viewport.onResize();\n\n      const { centerX, centerY, zoom } = viewport.getFitToScreenData(\n        this._cachedBounds\n      );\n      viewport.setCenter(centerX, centerY);\n      viewport.setZoom(zoom);\n    };\n\n    const observer = new ResizeObserver(fitToContent);\n    const block = this.embedBlock;\n\n    observer.observe(block);\n\n    this._disposables.add(() => {\n      observer.disconnect();\n    });\n\n    this.syncedDocEditorHost?.updateComplete\n      .then(() => fitToContent())\n      .catch(() => {});\n  };\n\n  private _pageFilter: Query = {\n    mode: 'loose',\n    match: [\n      {\n        flavour: 'affine:note',\n        props: {\n          displayMode: NoteDisplayMode.EdgelessOnly,\n        },\n        viewType: BlockViewType.Hidden,\n      },\n    ],\n  };\n\n  protected _buildPreviewSpec = (name: 'page:preview' | 'edgeless:preview') => {\n    const nextDepth = this.depth + 1;\n    const previewSpecBuilder = SpecProvider.getInstance().getSpec(name);\n    const currentDisposables = this.disposables;\n\n    class EmbedSyncedDocWatcher extends BlockServiceWatcher {\n      static override readonly flavour = 'affine:embed-synced-doc';\n\n      override mounted() {\n        const disposableGroup = this.blockService.disposables;\n        const slots = this.blockService.specSlots;\n        disposableGroup.add(\n          slots.viewConnected.on(({ component }) => {\n            const nextComponent = component as EmbedSyncedDocBlockComponent;\n            nextComponent.depth = nextDepth;\n            currentDisposables.add(() => {\n              nextComponent.depth = 0;\n            });\n          })\n        );\n        disposableGroup.add(\n          slots.viewDisconnected.on(({ component }) => {\n            const nextComponent = component as EmbedSyncedDocBlockComponent;\n            nextComponent.depth = 0;\n          })\n        );\n      }\n    }\n\n    previewSpecBuilder.extend([EmbedSyncedDocWatcher]);\n\n    return previewSpecBuilder.value;\n  };\n\n  protected _renderSyncedView = () => {\n    const syncedDoc = this.syncedDoc;\n    const editorMode = this.editorMode;\n    const isPageMode = this.isPageMode;\n\n    assertExists(syncedDoc);\n\n    if (isPageMode) {\n      this.dataset.pageMode = '';\n    }\n\n    const containerStyleMap = styleMap({\n      position: 'relative',\n      width: '100%',\n    });\n\n    const themeService = this.std.get(ThemeProvider);\n    const themeExtension = this.std.getOptional(ThemeExtensionIdentifier);\n    const appTheme = themeService.app$.value;\n    let edgelessTheme = themeService.edgeless$.value;\n    if (themeExtension?.getEdgelessTheme && this.syncedDoc?.id) {\n      edgelessTheme = themeExtension.getEdgelessTheme(this.syncedDoc.id).value;\n    }\n    const theme = isPageMode ? appTheme : edgelessTheme;\n    const isSelected = !!this.selected?.is('block');\n\n    this.dataset.nestedEditor = '';\n\n    const renderEditor = () => {\n      return choose(editorMode, [\n        [\n          'page',\n          () => html`\n            <div class=\"affine-page-viewport\" data-theme=${appTheme}>\n              ${new BlockStdScope({\n                doc: syncedDoc,\n                extensions: this._buildPreviewSpec('page:preview'),\n              }).render()}\n            </div>\n          `,\n        ],\n        [\n          'edgeless',\n          () => html`\n            <div class=\"affine-edgeless-viewport\" data-theme=${edgelessTheme}>\n              ${new BlockStdScope({\n                doc: syncedDoc,\n                extensions: this._buildPreviewSpec('edgeless:preview'),\n              }).render()}\n            </div>\n          `,\n        ],\n      ]);\n    };\n\n    return this.renderEmbed(\n      () => html`\n        <div\n          class=${classMap({\n            'affine-embed-synced-doc-container': true,\n            [editorMode]: true,\n            [theme]: true,\n            selected: isSelected,\n            surface: false,\n          })}\n          @click=${this._handleClick}\n          style=${containerStyleMap}\n          ?data-scale=${undefined}\n        >\n          <div class=\"affine-embed-synced-doc-editor\">\n            ${isPageMode && this._isEmptySyncedDoc\n              ? html`\n                  <div class=\"affine-embed-synced-doc-editor-empty\">\n                    <span>\n                      This is a linked doc, you can add content here.\n                    </span>\n                  </div>\n                `\n              : guard([editorMode, syncedDoc], renderEditor)}\n          </div>\n          <div\n            class=${classMap({\n              'affine-embed-synced-doc-header-wrapper': true,\n              selected: isSelected,\n            })}\n          >\n            <div class=\"affine-embed-synced-doc-header\">\n              <span class=\"affine-embed-synced-doc-icon\"\n                >${this.icon$.value}</span\n              >\n              <span class=\"affine-embed-synced-doc-title\">${this.title$}</span>\n            </div>\n          </div>\n        </div>\n      `\n    );\n  };\n\n  protected cardStyleMap = styleMap({\n    position: 'relative',\n    display: 'block',\n    width: '100%',\n  });\n\n  convertToCard = (aliasInfo?: AliasInfo) => {\n    const { doc, caption } = this.model;\n\n    const parent = doc.getParent(this.model);\n    assertExists(parent);\n    const index = parent.children.indexOf(this.model);\n\n    doc.addBlock(\n      'affine:embed-linked-doc',\n      { caption, ...this.referenceInfo, ...aliasInfo },\n      parent,\n      index\n    );\n\n    this.std.selection.setGroup('note', []);\n    doc.deleteBlock(this.model);\n  };\n\n  covertToInline = () => {\n    const { doc } = this.model;\n    const parent = doc.getParent(this.model);\n    assertExists(parent);\n    const index = parent.children.indexOf(this.model);\n\n    const yText = new DocCollection.Y.Text();\n    yText.insert(0, REFERENCE_NODE);\n    yText.format(0, REFERENCE_NODE.length, {\n      reference: {\n        type: 'LinkedPage',\n        ...this.referenceInfo,\n      },\n    });\n    const text = new doc.Text(yText);\n\n    doc.addBlock(\n      'affine:paragraph',\n      {\n        text,\n      },\n      parent,\n      index\n    );\n\n    doc.deleteBlock(this.model);\n  };\n\n  protected override embedContainerStyle: StyleInfo = {\n    height: 'unset',\n  };\n\n  icon$ = computed(() => {\n    const { pageId, params } = this.model;\n    return this.std\n      .get(DocDisplayMetaProvider)\n      .icon(pageId, { params, referenced: true }).value;\n  });\n\n  open = () => {\n    const pageId = this.model.pageId;\n    if (pageId === this.doc.id) return;\n\n    this.std.getOptional(RefNodeSlotsProvider)?.docLinkClicked.emit({ pageId });\n  };\n\n  refreshData = () => {\n    this._load().catch(e => {\n      console.error(e);\n      this._error = true;\n    });\n  };\n\n  title$ = computed(() => {\n    const { pageId, params } = this.model;\n    return this.std\n      .get(DocDisplayMetaProvider)\n      .title(pageId, { params, referenced: true });\n  });\n\n  private get _rootService() {\n    return this.std.getService('affine:page');\n  }\n\n  get blockState() {\n    return {\n      isLoading: this._loading,\n      isError: this._error,\n      isDeleted: this._deleted,\n      isCycle: this._cycle,\n    };\n  }\n\n  get docTitle() {\n    return this.syncedDoc?.meta?.title || 'Untitled';\n  }\n\n  get docUpdatedAt() {\n    return this._docUpdatedAt;\n  }\n\n  get editorMode() {\n    return this.linkedMode ?? this.syncedDocMode;\n  }\n\n  protected get isPageMode() {\n    return this.editorMode === 'page';\n  }\n\n  get linkedMode() {\n    return this.referenceInfo.params?.mode;\n  }\n\n  get referenceInfo(): ReferenceInfo {\n    return cloneReferenceInfo(this.model);\n  }\n\n  get syncedDoc() {\n    const options: GetDocOptions = { readonly: true };\n    if (this.isPageMode) options.query = this._pageFilter;\n    return this.std.collection.getDoc(this.model.pageId, options);\n  }\n\n  private _checkCycle() {\n    let editorHost: EditorHost | null = this.host;\n    while (editorHost && !this._cycle) {\n      this._cycle = !!editorHost && editorHost.doc.id === this.model.pageId;\n      editorHost =\n        editorHost.parentElement?.closest<EditorHost>('editor-host') ?? null;\n    }\n  }\n\n  private _isClickAtBorder(\n    event: MouseEvent,\n    element: HTMLElement,\n    tolerance = 8\n  ): boolean {\n    const { x, y } = event;\n    const rect = element.getBoundingClientRect();\n    if (!rect) {\n      return false;\n    }\n\n    return (\n      Math.abs(x - rect.left) < tolerance ||\n      Math.abs(x - rect.right) < tolerance ||\n      Math.abs(y - rect.top) < tolerance ||\n      Math.abs(y - rect.bottom) < tolerance\n    );\n  }\n\n  private async _load() {\n    this._loading = true;\n    this._error = false;\n    this._deleted = false;\n    this._cycle = false;\n\n    const syncedDoc = this.syncedDoc;\n    if (!syncedDoc) {\n      this._deleted = true;\n      this._loading = false;\n      return;\n    }\n\n    this._checkCycle();\n\n    if (!syncedDoc.loaded) {\n      try {\n        syncedDoc.load();\n      } catch (e) {\n        console.error(e);\n        this._error = true;\n      }\n    }\n\n    if (!this._error && !syncedDoc.root) {\n      await new Promise<void>(resolve => {\n        syncedDoc.slots.rootAdded.once(() => resolve());\n      });\n    }\n\n    this._loading = false;\n  }\n\n  private _selectBlock() {\n    const selectionManager = this.host.selection;\n    const blockSelection = selectionManager.create('block', {\n      blockId: this.blockId,\n    });\n    selectionManager.setGroup('note', [blockSelection]);\n  }\n\n  private _setDocUpdatedAt() {\n    const meta = this.doc.collection.meta.getDocMeta(this.model.pageId);\n    if (meta) {\n      const date = meta.updatedDate || meta.createDate;\n      this._docUpdatedAt = new Date(date);\n    }\n  }\n\n  protected _handleClick(_event: MouseEvent) {\n    this._selectBlock();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._cardStyle = this.model.style;\n\n    this.style.display = 'block';\n    this._load().catch(e => {\n      console.error(e);\n      this._error = true;\n    });\n\n    this.contentEditable = 'false';\n\n    this.disposables.add(\n      this.model.propsUpdated.on(({ key }) => {\n        if (key === 'pageId' || key === 'style') {\n          this._load().catch(e => {\n            console.error(e);\n            this._error = true;\n          });\n        }\n      })\n    );\n\n    this._setDocUpdatedAt();\n    this.disposables.add(\n      this.doc.collection.meta.docMetaUpdated.on(() => {\n        this._setDocUpdatedAt();\n      })\n    );\n\n    if (this._rootService && !this.linkedMode) {\n      const docMode = this._rootService.std.get(DocModeProvider);\n      this.syncedDocMode = docMode.getPrimaryMode(this.model.pageId);\n      this._isEmptySyncedDoc = isEmptyDoc(this.syncedDoc, this.editorMode);\n      this.disposables.add(\n        docMode.onPrimaryModeChange(mode => {\n          this.syncedDocMode = mode;\n          this._isEmptySyncedDoc = isEmptyDoc(this.syncedDoc, this.editorMode);\n        }, this.model.pageId)\n      );\n    }\n\n    this.syncedDoc &&\n      this.disposables.add(\n        this.syncedDoc.slots.blockUpdated.on(() => {\n          this._isEmptySyncedDoc = isEmptyDoc(this.syncedDoc, this.editorMode);\n        })\n      );\n  }\n\n  override firstUpdated() {\n    this.disposables.addFromEvent(this, 'click', e => {\n      e.stopPropagation();\n      if (this._isClickAtBorder(e, this)) {\n        e.preventDefault();\n        this._selectBlock();\n      }\n    });\n\n    // Forward docLinkClicked event from the synced doc\n    const refNodeProvider =\n      this.syncedDocEditorHost?.std.getOptional(RefNodeSlotsProvider);\n    if (refNodeProvider) {\n      this.disposables.add(\n        refNodeProvider.docLinkClicked.on(args => {\n          this.std.getOptional(RefNodeSlotsProvider)?.docLinkClicked.emit(args);\n        })\n      );\n    }\n\n    this._initEdgelessFitEffect();\n  }\n\n  override renderBlock() {\n    delete this.dataset.nestedEditor;\n\n    const syncedDoc = this.syncedDoc;\n    const { isLoading, isError, isDeleted, isCycle } = this.blockState;\n    const isCardOnly = this.depth >= 1;\n\n    if (\n      isLoading ||\n      isError ||\n      isDeleted ||\n      isCardOnly ||\n      isCycle ||\n      !syncedDoc\n    ) {\n      return this.renderEmbed(\n        () => html`\n          <affine-embed-synced-doc-card\n            style=${this.cardStyleMap}\n            .block=${this}\n          ></affine-embed-synced-doc-card>\n        `\n      );\n    }\n\n    return this._renderSyncedView();\n  }\n\n  override updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    this.syncedDocCard?.requestUpdate();\n  }\n\n  @state()\n  private accessor _cycle = false;\n\n  @state()\n  private accessor _deleted = false;\n\n  @state()\n  private accessor _docUpdatedAt: Date = new Date();\n\n  @state()\n  private accessor _error = false;\n\n  @state()\n  protected accessor _isEmptySyncedDoc: boolean = true;\n\n  @state()\n  private accessor _loading = false;\n\n  @state()\n  accessor depth = 0;\n\n  @query(\n    ':scope > .affine-block-component > .embed-block-container > affine-embed-synced-doc-card'\n  )\n  accessor syncedDocCard: EmbedSyncedDocCard | null = null;\n\n  @query(\n    ':scope > .affine-block-component > .embed-block-container > .affine-embed-synced-doc-container > .affine-embed-synced-doc-editor > div > editor-host'\n  )\n  accessor syncedDocEditorHost: EditorHost | null = null;\n\n  @state()\n  accessor syncedDocMode: DocMode = 'page';\n\n  override accessor useCaptionEditor = true;\n}\n"]}