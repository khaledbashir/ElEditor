{"version":3,"file":"html.js","sourceRoot":"","sources":["../../../src/embed-youtube-block/adapters/html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,uBAAuB,EAAE,MAAM,0BAA0B,CAAC;AACnE,OAAO,EACL,yBAAyB,EACzB,SAAS,GACV,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,mBAAmB,CAAC;AAE3C,OAAO,EAAE,kCAAkC,EAAE,MAAM,+BAA+B,CAAC;AAEnF,MAAM,CAAC,MAAM,mCAAmC,GAC9C,kCAAkC,CAAC,uBAAuB,CAAC,KAAK,CAAC,OAAO,EAAE;IACxE,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,QAAQ;IACxE,eAAe,EAAE;QACf,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;gBACjC,OAAO;YACT,CAAC;YAED,MAAM,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,GAAG,CAAC;YACnC,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,CAAC;gBAC5B,OAAO;YACT,CAAC;YAED,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,IAAI,GAAG,CAAC,UAAU,CAAC,gCAAgC,CAAC,EAAE,CAAC;gBACrD,MAAM,OAAO,GAAG,GAAG,CAAC,SAAS,CAC3B,gCAAgC,CAAC,MAAM,EACvC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CACvD,CAAC;gBACF,aAAa;qBACV,QAAQ,CACP;oBACE,IAAI,EAAE,OAAO;oBACb,EAAE,EAAE,MAAM,EAAE;oBACZ,OAAO,EAAE,sBAAsB;oBAC/B,KAAK,EAAE;wBACL,GAAG,EAAE,mCAAmC,OAAO,EAAE;qBAClD;oBACD,QAAQ,EAAE,EAAE;iBACb,EACD,UAAU,CACX;qBACA,SAAS,EAAE,CAAC;YACjB,CAAC;QACH,CAAC;KACF;CACF,CAAC,CAAC;AAEL,MAAM,CAAC,MAAM,qCAAqC,GAAG,yBAAyB,CAC5E,mCAAmC,CACpC,CAAC","sourcesContent":["import { EmbedYoutubeBlockSchema } from '@blocksuite/affine-model';\nimport {\n  BlockHtmlAdapterExtension,\n  HastUtils,\n} from '@blocksuite/affine-shared/adapters';\nimport { nanoid } from '@blocksuite/store';\n\nimport { createEmbedBlockHtmlAdapterMatcher } from '../../common/adapters/html.js';\n\nexport const embedYoutubeBlockHtmlAdapterMatcher =\n  createEmbedBlockHtmlAdapterMatcher(EmbedYoutubeBlockSchema.model.flavour, {\n    toMatch: o => HastUtils.isElement(o.node) && o.node.tagName === 'iframe',\n    toBlockSnapshot: {\n      enter: (o, context) => {\n        if (!HastUtils.isElement(o.node)) {\n          return;\n        }\n\n        const src = o.node.properties?.src;\n        if (typeof src !== 'string') {\n          return;\n        }\n\n        const { walkerContext } = context;\n        if (src.startsWith('https://www.youtube.com/embed/')) {\n          const videoId = src.substring(\n            'https://www.youtube.com/embed/'.length,\n            src.indexOf('?') !== -1 ? src.indexOf('?') : undefined\n          );\n          walkerContext\n            .openNode(\n              {\n                type: 'block',\n                id: nanoid(),\n                flavour: 'affine:embed-youtube',\n                props: {\n                  url: `https://www.youtube.com/watch?v=${videoId}`,\n                },\n                children: [],\n              },\n              'children'\n            )\n            .closeNode();\n        }\n      },\n    },\n  });\n\nexport const EmbedYoutubeBlockHtmlAdapterExtension = BlockHtmlAdapterExtension(\n  embedYoutubeBlockHtmlAdapterMatcher\n);\n"]}