{"version":3,"file":"to-edgeless-embed-block.js","sourceRoot":"","sources":["../../src/common/to-edgeless-embed-block.ts"],"names":[],"mappings":"AAMA,OAAO,EACL,oBAAoB,EAGpB,gBAAgB,EAChB,mBAAmB,GACpB,MAAM,uBAAuB,CAAC;AAC/B,OAAO,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AAIjD,MAAM,UAAU,oBAAoB,CAKlC,KAAQ;;IACR,OAAO,KAAM,SAAQ,mBAAmB,CAAC,KAAK,CAAC;QAAxC;;YACL,gBAAW,GAAG,KAAK,CAAC;YAEpB,gBAAW,GAAG,KAAK,CAAC;YAEpB,gBAAW,GAAG,KAAK,CAAC;YAEpB,iBAAY,GAAG,KAAK,CAAC;YAEZ,QAAsB,GAAG,IAAI,CAAC;YAE9B,mBAAc,GAAG,KAAK,CAAC;YAEb,wBAAmB,GAAc,EAAE,CAAC;YAE9C,QAAkB,GAAG,IAAI,CAAC;YAiDP,8CAC1B,SAAS,CAAC;QACd,CAAC;sBAzDW,oBAAoB,OAMpB,gBAAgB;QAE1B,IAAI,KAAK;YACP,OAAO,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC;QAED,IAAI,WAAW;YACb,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;QAC5C,CAAC;QAED,YAAY,CAAC,CAAa;YACxB,OAAO;QACT,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAC1B,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;YAErC,IAAI,CAAC,YAAY,CAAC,GAAG;YACnB,4EAA4E;YAC5E,WAAW,CAAC,KAAK,CAAC,kBAAkB,CAAC,EAAE,CAAC,GAAG,EAAE;gBAC3C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAC3B,CAAC,CAAC,CACH,CAAC;YAEF,IAAI,CAAC,YAAY,CAAC,GAAG;YACnB,4EAA4E;YAC5E,WAAW,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAE,CAAC,GAAG,EAAE;gBACzC,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;gBACzB,IAAI,CAAC,YAAY;oBACf,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC;YAC9D,CAAC,CAAC,CACH,CAAC;QACJ,CAAC;QAEQ,cAAc;YACrB,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAEjD,IAAI,CAAC,mBAAmB,CAAC,KAAK,GAAG,GAAG,KAAK,CAAC,CAAC,IAAI,CAAC;YAChD,IAAI,CAAC,mBAAmB,CAAC,MAAM,GAAG,GAAG,KAAK,CAAC,CAAC,IAAI,CAAC;YACjD,IAAI,CAAC,oBAAoB,GAAG;gBAC1B,KAAK,EAAE,GAAG,KAAK,CAAC,CAAC,IAAI;aACtB,CAAC;YACF,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;YAExC,OAAO,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAClC,CAAC;QAED,uCACY;QADZ,IAA4B,oBAAoB,0DACpC;QADZ,IAA4B,oBAAoB,gEACpC;KAMb,CAAC;AACJ,CAAC","sourcesContent":["import type {\n  GfxBlockElementModel,\n  GfxCompatibleProps,\n} from '@blocksuite/block-std/gfx';\nimport type { StyleInfo } from 'lit/directives/style-map.js';\n\nimport {\n  blockComponentSymbol,\n  type BlockService,\n  type GfxBlockComponent,\n  GfxElementSymbol,\n  toGfxBlockComponent,\n} from '@blocksuite/block-std';\nimport { Bound } from '@blocksuite/global/utils';\n\nimport type { EmbedBlockComponent } from './embed-block-element.js';\n\nexport function toEdgelessEmbedBlock<\n  Model extends GfxBlockElementModel<GfxCompatibleProps>,\n  Service extends BlockService,\n  WidgetName extends string,\n  B extends typeof EmbedBlockComponent<Model, Service, WidgetName>,\n>(block: B) {\n  return class extends toGfxBlockComponent(block) {\n    _isDragging = false;\n\n    _isResizing = false;\n\n    _isSelected = false;\n\n    _showOverlay = false;\n\n    override [blockComponentSymbol] = true;\n\n    override blockDraggable = false;\n\n    protected override embedContainerStyle: StyleInfo = {};\n\n    override [GfxElementSymbol] = true;\n\n    get bound(): Bound {\n      return Bound.deserialize(this.model.xywh);\n    }\n\n    get rootService() {\n      return this.std.getService('affine:page');\n    }\n\n    _handleClick(_: MouseEvent): void {\n      return;\n    }\n\n    override connectedCallback(): void {\n      super.connectedCallback();\n      const rootService = this.rootService;\n\n      this._disposables.add(\n        // @ts-expect-error TODO: fix after edgeless slots are migrated to extension\n        rootService.slots.elementResizeStart.on(() => {\n          this._isResizing = true;\n          this._showOverlay = true;\n        })\n      );\n\n      this._disposables.add(\n        // @ts-expect-error TODO: fix after edgeless slots are migrated to extension\n        rootService.slots.elementResizeEnd.on(() => {\n          this._isResizing = false;\n          this._showOverlay =\n            this._isResizing || this._isDragging || !this._isSelected;\n        })\n      );\n    }\n\n    override renderGfxBlock() {\n      const bound = Bound.deserialize(this.model.xywh);\n\n      this.embedContainerStyle.width = `${bound.w}px`;\n      this.embedContainerStyle.height = `${bound.h}px`;\n      this.blockContainerStyles = {\n        width: `${bound.w}px`,\n      };\n      this._scale = bound.w / this._cardWidth;\n\n      return this.renderPageContent();\n    }\n\n    protected override accessor blockContainerStyles: StyleInfo | undefined =\n      undefined;\n  } as B & {\n    new (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ...args: any[]\n    ): GfxBlockComponent;\n  };\n}\n"]}