{"version":3,"file":"notion-html.js","sourceRoot":"","sources":["../../../src/code-block/adapters/notion-html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAC3D,OAAO,EACL,+BAA+B,EAE/B,SAAS,GACV,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,mBAAmB,CAAC;AAE3C,MAAM,CAAC,MAAM,iCAAiC,GAC5C;IACE,OAAO,EAAE,eAAe,CAAC,KAAK,CAAC,OAAO;IACtC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,KAAK;IACrE,SAAS,EAAE,GAAG,EAAE,CAAC,KAAK;IACtB,eAAe,EAAE;QACf,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;gBACjC,OAAO;YACT,CAAC;YACD,MAAM,IAAI,GAAG,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YACrD,IAAI,CAAC,IAAI,EAAE,CAAC;gBACV,OAAO;YACT,CAAC;YACD,MAAM,EAAE,aAAa,EAAE,cAAc,EAAE,GAAG,OAAO,CAAC;YAClD,MAAM,QAAQ,GACZ,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,MAAM;gBAC5D,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAClB,CAAC,CAAC,EAAE,GAAG,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC;YAC9B,aAAa;iBACV,QAAQ,CACP;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,MAAM,EAAE;gBACZ,OAAO,EAAE,eAAe,CAAC,KAAK,CAAC,OAAO;gBACtC,KAAK,EAAE;oBACL,QAAQ,EAAE,YAAY;oBACtB,IAAI,EAAE;wBACJ,4BAA4B,EAAE,IAAI;wBAClC,KAAK,EAAE,cAAc,CAAC,UAAU,CAAC,QAAQ,EAAE;4BACzC,IAAI,EAAE,KAAK;4BACX,GAAG,EAAE,IAAI;yBACV,CAAC;qBACH;iBACF;gBACD,QAAQ,EAAE,EAAE;aACb,EACD,UAAU,CACX;iBACA,SAAS,EAAE,CAAC;YACf,aAAa,CAAC,eAAe,EAAE,CAAC;QAClC,CAAC;KACF;IACD,iBAAiB,EAAE,EAAE;CACtB,CAAC;AAEJ,MAAM,CAAC,MAAM,mCAAmC,GAC9C,+BAA+B,CAAC,iCAAiC,CAAC,CAAC","sourcesContent":["import { CodeBlockSchema } from '@blocksuite/affine-model';\nimport {\n  BlockNotionHtmlAdapterExtension,\n  type BlockNotionHtmlAdapterMatcher,\n  HastUtils,\n} from '@blocksuite/affine-shared/adapters';\nimport { nanoid } from '@blocksuite/store';\n\nexport const codeBlockNotionHtmlAdapterMatcher: BlockNotionHtmlAdapterMatcher =\n  {\n    flavour: CodeBlockSchema.model.flavour,\n    toMatch: o => HastUtils.isElement(o.node) && o.node.tagName === 'pre',\n    fromMatch: () => false,\n    toBlockSnapshot: {\n      enter: (o, context) => {\n        if (!HastUtils.isElement(o.node)) {\n          return;\n        }\n        const code = HastUtils.querySelector(o.node, 'code');\n        if (!code) {\n          return;\n        }\n        const { walkerContext, deltaConverter } = context;\n        const codeText =\n          code.children.length === 1 && code.children[0].type === 'text'\n            ? code.children[0]\n            : { ...code, tag: 'div' };\n        walkerContext\n          .openNode(\n            {\n              type: 'block',\n              id: nanoid(),\n              flavour: CodeBlockSchema.model.flavour,\n              props: {\n                language: 'Plain Text',\n                text: {\n                  '$blocksuite:internal:text$': true,\n                  delta: deltaConverter.astToDelta(codeText, {\n                    trim: false,\n                    pre: true,\n                  }),\n                },\n              },\n              children: [],\n            },\n            'children'\n          )\n          .closeNode();\n        walkerContext.skipAllChildren();\n      },\n    },\n    fromBlockSnapshot: {},\n  };\n\nexport const CodeBlockNotionHtmlAdapterExtension =\n  BlockNotionHtmlAdapterExtension(codeBlockNotionHtmlAdapterMatcher);\n"]}