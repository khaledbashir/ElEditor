{"version":3,"file":"commands.js","sourceRoot":"","sources":["../../src/latex-block/commands.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAE5D,OAAO,EAAE,mBAAmB,EAAE,MAAM,kBAAkB,CAAC;AAEvD,MAAM,CAAC,MAAM,uBAAuB,GAQhC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,EAAE,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;IACnE,IAAI,CAAC,cAAc,EAAE,MAAM;QAAE,OAAO;IAEpC,MAAM,WAAW,GACf,KAAK,KAAK,QAAQ;QAChB,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAEhD,MAAM,eAAe,GAEjB;QACF,OAAO,EAAE,cAAc;QACvB,KAAK,EAAE,KAAK,IAAI,EAAE;KACnB,CAAC;IAEF,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,gBAAgB,CACrC,WAAW,EACX,CAAC,eAAe,CAAC,EACjB,KAAK,CACN,CAAC;IACF,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO;IAEhC,IAAI,eAAe,IAAI,WAAW,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,EAAE,CAAC;QACtD,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,CAAC;QACH,oBAAoB,EAAE,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE;YAC5D,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,MAAM,cAAc,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBACpD,gBAAgB,CAAC,cAAc,EAAE,mBAAmB,CAAC,CAAC;gBACtD,MAAM,cAAc,CAAC,cAAc,CAAC;gBACpC,cAAc,CAAC,YAAY,EAAE,CAAC;YAChC,CAAC;YACD,OAAO,MAAM,CAAC,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC;KACH,CAAC,CAAC;AACL,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,QAAQ,GAAkB;IACrC,gBAAgB,EAAE,uBAAuB;CAC1C,CAAC","sourcesContent":["import type { LatexProps } from '@blocksuite/affine-model';\nimport type { BlockCommands, Command } from '@blocksuite/block-std';\n\nimport { assertInstanceOf } from '@blocksuite/global/utils';\n\nimport { LatexBlockComponent } from './latex-block.js';\n\nexport const insertLatexBlockCommand: Command<\n  'selectedModels',\n  'insertedLatexBlockId',\n  {\n    latex?: string;\n    place?: 'after' | 'before';\n    removeEmptyLine?: boolean;\n  }\n> = (ctx, next) => {\n  const { selectedModels, latex, place, removeEmptyLine, std } = ctx;\n  if (!selectedModels?.length) return;\n\n  const targetModel =\n    place === 'before'\n      ? selectedModels[0]\n      : selectedModels[selectedModels.length - 1];\n\n  const latexBlockProps: Partial<LatexProps> & {\n    flavour: 'affine:latex';\n  } = {\n    flavour: 'affine:latex',\n    latex: latex ?? '',\n  };\n\n  const result = std.doc.addSiblingBlocks(\n    targetModel,\n    [latexBlockProps],\n    place\n  );\n  if (result.length === 0) return;\n\n  if (removeEmptyLine && targetModel.text?.length === 0) {\n    std.doc.deleteBlock(targetModel);\n  }\n\n  next({\n    insertedLatexBlockId: std.host.updateComplete.then(async () => {\n      if (!latex) {\n        const blockComponent = std.view.getBlock(result[0]);\n        assertInstanceOf(blockComponent, LatexBlockComponent);\n        await blockComponent.updateComplete;\n        blockComponent.toggleEditor();\n      }\n      return result[0];\n    }),\n  });\n};\n\nexport const commands: BlockCommands = {\n  insertLatexBlock: insertLatexBlockCommand,\n};\n"]}