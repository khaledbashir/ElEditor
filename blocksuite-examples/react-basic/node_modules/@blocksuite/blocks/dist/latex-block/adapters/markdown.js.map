{"version":3,"file":"markdown.js","sourceRoot":"","sources":["../../../src/latex-block/adapters/markdown.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAC5D,OAAO,EACL,6BAA6B,GAG9B,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,mBAAmB,CAAC;AAE3C,MAAM,WAAW,GAAG,CAAC,IAAiB,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,KAAK,MAAM,CAAC;AAEhE,MAAM,CAAC,MAAM,gCAAgC,GAAgC;IAC3E,OAAO,EAAE,gBAAgB,CAAC,KAAK,CAAC,OAAO;IACvC,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC;IACjC,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,gBAAgB,CAAC,KAAK,CAAC,OAAO;IACjE,eAAe,EAAE;QACf,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,MAAM,KAAK,GAAG,OAAO,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;YACpD,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,aAAa;iBACV,QAAQ,CACP;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,MAAM,EAAE;gBACZ,OAAO,EAAE,cAAc;gBACvB,KAAK,EAAE;oBACL,KAAK;iBACN;gBACD,QAAQ,EAAE,EAAE;aACb,EACD,UAAU,CACX;iBACA,SAAS,EAAE,CAAC;QACjB,CAAC;KACF;IACD,iBAAiB,EAAE;QACjB,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,MAAM,KAAK,GACT,OAAO,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAgB,CAAC,CAAC,CAAC,EAAE,CAAC;YAChE,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,aAAa;iBACV,QAAQ,CACP;gBACE,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,KAAK;aACb,EACD,UAAU,CACX;iBACA,SAAS,EAAE,CAAC;QACjB,CAAC;KACF;CACF,CAAC;AAEF,MAAM,CAAC,MAAM,kCAAkC,GAAG,6BAA6B,CAC7E,gCAAgC,CACjC,CAAC","sourcesContent":["import { LatexBlockSchema } from '@blocksuite/affine-model';\nimport {\n  BlockMarkdownAdapterExtension,\n  type BlockMarkdownAdapterMatcher,\n  type MarkdownAST,\n} from '@blocksuite/affine-shared/adapters';\nimport { nanoid } from '@blocksuite/store';\n\nconst isLatexNode = (node: MarkdownAST) => node.type === 'math';\n\nexport const latexBlockMarkdownAdapterMatcher: BlockMarkdownAdapterMatcher = {\n  flavour: LatexBlockSchema.model.flavour,\n  toMatch: o => isLatexNode(o.node),\n  fromMatch: o => o.node.flavour === LatexBlockSchema.model.flavour,\n  toBlockSnapshot: {\n    enter: (o, context) => {\n      const latex = 'value' in o.node ? o.node.value : '';\n      const { walkerContext } = context;\n      walkerContext\n        .openNode(\n          {\n            type: 'block',\n            id: nanoid(),\n            flavour: 'affine:latex',\n            props: {\n              latex,\n            },\n            children: [],\n          },\n          'children'\n        )\n        .closeNode();\n    },\n  },\n  fromBlockSnapshot: {\n    enter: (o, context) => {\n      const latex =\n        'latex' in o.node.props ? (o.node.props.latex as string) : '';\n      const { walkerContext } = context;\n      walkerContext\n        .openNode(\n          {\n            type: 'math',\n            value: latex,\n          },\n          'children'\n        )\n        .closeNode();\n    },\n  },\n};\n\nexport const LatexBlockMarkdownAdapterExtension = BlockMarkdownAdapterExtension(\n  latexBlockMarkdownAdapterMatcher\n);\n"]}