{"version":3,"file":"commands.js","sourceRoot":"","sources":["../../src/surface-ref-block/commands.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,aAAa,EAAE,MAAM,iCAAiC,CAAC;AAEhE,OAAO,EAAE,eAAe,EAAE,MAAM,YAAY,CAAC;AAE7C,MAAM,CAAC,MAAM,4BAA4B,GAQrC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;IACvE,IAAI,CAAC,cAAc,EAAE,MAAM;QAAE,OAAO;IAEpC,MAAM,WAAW,GACf,KAAK,KAAK,QAAQ;QAChB,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAEhD,MAAM,eAAe,GAEjB;QACF,OAAO,EAAE,oBAAoB;QAC7B,SAAS;KACV,CAAC;IAEF,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACzC,IAAI,CAAC,OAAO;QAAE,OAAO;IAErB,MAAM,OAAO,GAAG,OAAO,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;IAClD,MAAM,UAAU,GAAG,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,KAAK,IAAI,IAAI,CAAC;IAE9D,IAAI,OAAO,EAAE,IAAI,KAAK,OAAO,EAAE,CAAC;QAC9B,eAAe,CAAC,UAAU,GAAG,OAAO,CAAC;IACvC,CAAC;SAAM,IAAI,aAAa,CAAC,UAAU,EAAE,CAAC,cAAc,CAAC,CAAC,EAAE,CAAC;QACvD,eAAe,CAAC,UAAU,GAAG,OAAO,CAAC;IACvC,CAAC;SAAM,CAAC;QACN,OAAO,CAAC,KAAK,CAAC,uBAAuB,SAAS,EAAE,CAAC,CAAC;QAClD,OAAO;IACT,CAAC;IAED,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,gBAAgB,CACrC,WAAW,EACX,CAAC,eAAe,CAAC,EACjB,KAAK,CACN,CAAC;IACF,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO;IAEhC,IAAI,eAAe,IAAI,WAAW,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,EAAE,CAAC;QACtD,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,CAAC;QACH,yBAAyB,EAAE,MAAM,CAAC,CAAC,CAAC;KACrC,CAAC,CAAC;AACL,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,QAAQ,GAAkB;IACrC,qBAAqB,EAAE,4BAA4B;CACpD,CAAC","sourcesContent":["import type { SurfaceRefProps } from '@blocksuite/affine-model';\nimport type { BlockCommands, Command } from '@blocksuite/block-std';\n\nimport { matchFlavours } from '@blocksuite/affine-shared/utils';\n\nimport { getSurfaceBlock } from './utils.js';\n\nexport const insertSurfaceRefBlockCommand: Command<\n  'selectedModels',\n  'insertedSurfaceRefBlockId',\n  {\n    reference: string;\n    place: 'after' | 'before';\n    removeEmptyLine?: boolean;\n  }\n> = (ctx, next) => {\n  const { selectedModels, reference, place, removeEmptyLine, std } = ctx;\n  if (!selectedModels?.length) return;\n\n  const targetModel =\n    place === 'before'\n      ? selectedModels[0]\n      : selectedModels[selectedModels.length - 1];\n\n  const surfaceRefProps: Partial<SurfaceRefProps> & {\n    flavour: 'affine:surface-ref';\n  } = {\n    flavour: 'affine:surface-ref',\n    reference,\n  };\n\n  const surface = getSurfaceBlock(std.doc);\n  if (!surface) return;\n\n  const element = surface.getElementById(reference);\n  const blockModel = std.doc.getBlock(reference)?.model ?? null;\n\n  if (element?.type === 'group') {\n    surfaceRefProps.refFlavour = 'group';\n  } else if (matchFlavours(blockModel, ['affine:frame'])) {\n    surfaceRefProps.refFlavour = 'frame';\n  } else {\n    console.error(`reference not found ${reference}`);\n    return;\n  }\n\n  const result = std.doc.addSiblingBlocks(\n    targetModel,\n    [surfaceRefProps],\n    place\n  );\n  if (result.length === 0) return;\n\n  if (removeEmptyLine && targetModel.text?.length === 0) {\n    std.doc.deleteBlock(targetModel);\n  }\n\n  next({\n    insertedSurfaceRefBlockId: result[0],\n  });\n};\n\nexport const commands: BlockCommands = {\n  insertSurfaceRefBlock: insertSurfaceRefBlockCommand,\n};\n"]}