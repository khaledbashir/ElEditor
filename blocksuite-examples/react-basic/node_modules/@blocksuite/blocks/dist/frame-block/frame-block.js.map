{"version":3,"file":"frame-block.js","sourceRoot":"","sources":["../../src/frame-block/frame-block.ts"],"names":[],"mappings":"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","sourcesContent":["import type { FrameBlockModel } from '@blocksuite/affine-model';\n\nimport { ThemeProvider } from '@blocksuite/affine-shared/services';\nimport { GfxBlockComponent } from '@blocksuite/block-std';\nimport { Bound } from '@blocksuite/global/utils';\nimport { cssVarV2 } from '@toeverything/theme/v2';\nimport { html } from 'lit';\nimport { state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessRootService } from '../root-block/index.js';\n\nexport class FrameBlockComponent extends GfxBlockComponent<FrameBlockModel> {\n  get rootService() {\n    return this.std.getService('affine:page') as EdgelessRootService;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._disposables.add(\n      this.doc.slots.blockUpdated.on(({ type, id }) => {\n        if (id === this.model.id && type === 'update') {\n          this.requestUpdate();\n        }\n      })\n    );\n    this._disposables.add(\n      this.gfx.viewport.viewportUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n  }\n\n  /**\n   * Due to potentially very large frame sizes, CSS scaling can cause iOS Safari to crash.\n   * To mitigate this issue, we combine size calculations within the rendering rect.\n   */\n  override getCSSTransform(): string {\n    return '';\n  }\n\n  override getRenderingRect() {\n    const viewport = this.gfx.viewport;\n    const { translateX, translateY, zoom } = viewport;\n    const { xywh, rotate } = this.model;\n    const bound = Bound.deserialize(xywh);\n\n    const scaledX = bound.x * zoom + translateX;\n    const scaledY = bound.y * zoom + translateY;\n\n    return {\n      x: scaledX,\n      y: scaledY,\n      w: bound.w * zoom,\n      h: bound.h * zoom,\n      rotate,\n      zIndex: this.toZIndex(),\n    };\n  }\n\n  override renderGfxBlock() {\n    const { model, showBorder, rootService, std } = this;\n    const backgroundColor = std\n      .get(ThemeProvider)\n      .generateColorProperty(model.background, '--affine-platte-transparent');\n    const _isNavigator =\n      this.gfx.tool.currentToolName$.value === 'frameNavigator';\n    const frameIndex = rootService.layer.getZIndex(model);\n\n    return html`\n      <div\n        class=\"affine-frame-container\"\n        style=${styleMap({\n          zIndex: `${frameIndex}`,\n          backgroundColor,\n          height: '100%',\n          width: '100%',\n          borderRadius: '2px',\n          border:\n            _isNavigator || !showBorder\n              ? 'none'\n              : `1px solid ${cssVarV2('edgeless/frame/border/default')}`,\n        })}\n      ></div>\n    `;\n  }\n\n  @state()\n  accessor showBorder = true;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-frame': FrameBlockComponent;\n  }\n}\n"]}