{"version":3,"file":"notion-text.js","sourceRoot":"","sources":["../../../src/_common/adapters/notion-text.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { ExtensionType } from '@blocksuite/block-std';\nimport type { DeltaInsert } from '@blocksuite/inline';\n\nimport { DEFAULT_NOTE_BACKGROUND_COLOR } from '@blocksuite/affine-model';\nimport { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport {\n  type AssetsManager,\n  BaseAdapter,\n  type BlockSnapshot,\n  type DocSnapshot,\n  type FromBlockSnapshotResult,\n  type FromDocSnapshotResult,\n  type FromSliceSnapshotResult,\n  type Job,\n  nanoid,\n  type SliceSnapshot,\n} from '@blocksuite/store';\n\nimport { AdapterFactoryIdentifier } from './type.js';\n\ntype NotionEditingStyle = {\n  0: string;\n};\n\ntype NotionEditing = {\n  0: string;\n  1: Array<NotionEditingStyle>;\n};\n\nexport type NotionTextSerialized = {\n  blockType: string;\n  editing: Array<NotionEditing>;\n};\n\nexport type NotionText = string;\n\ntype NotionHtmlToSliceSnapshotPayload = {\n  file: NotionText;\n  assets?: AssetsManager;\n  workspaceId: string;\n  pageId: string;\n};\n\nexport class NotionTextAdapter extends BaseAdapter<NotionText> {\n  override fromBlockSnapshot():\n    | FromBlockSnapshotResult<NotionText>\n    | Promise<FromBlockSnapshotResult<NotionText>> {\n    throw new BlockSuiteError(\n      ErrorCode.TransformerNotImplementedError,\n      'NotionTextAdapter.fromBlockSnapshot is not implemented.'\n    );\n  }\n\n  override fromDocSnapshot():\n    | FromDocSnapshotResult<NotionText>\n    | Promise<FromDocSnapshotResult<NotionText>> {\n    throw new BlockSuiteError(\n      ErrorCode.TransformerNotImplementedError,\n      'NotionTextAdapter.fromDocSnapshot is not implemented.'\n    );\n  }\n\n  override fromSliceSnapshot():\n    | FromSliceSnapshotResult<NotionText>\n    | Promise<FromSliceSnapshotResult<NotionText>> {\n    return {\n      file: JSON.stringify({\n        blockType: 'text',\n        editing: [\n          ['Notion Text is not supported to be exported from BlockSuite', []],\n        ],\n      }),\n      assetsIds: [],\n    };\n  }\n\n  override toBlockSnapshot(): Promise<BlockSnapshot> | BlockSnapshot {\n    throw new BlockSuiteError(\n      ErrorCode.TransformerNotImplementedError,\n      'NotionTextAdapter.toBlockSnapshot is not implemented.'\n    );\n  }\n\n  override toDocSnapshot(): Promise<DocSnapshot> | DocSnapshot {\n    throw new BlockSuiteError(\n      ErrorCode.TransformerNotImplementedError,\n      'NotionTextAdapter.toDocSnapshot is not implemented.'\n    );\n  }\n\n  override toSliceSnapshot(\n    payload: NotionHtmlToSliceSnapshotPayload\n  ): SliceSnapshot | null {\n    const notionText = JSON.parse(payload.file) as NotionTextSerialized;\n    const content: SliceSnapshot['content'] = [];\n    const deltas: DeltaInsert<AffineTextAttributes>[] = [];\n    for (const editing of notionText.editing) {\n      const delta: DeltaInsert<AffineTextAttributes> = {\n        insert: editing[0],\n        attributes: Object.create(null),\n      };\n      for (const styleElement of editing[1]) {\n        switch (styleElement[0]) {\n          case 'b':\n            delta.attributes!.bold = true;\n            break;\n          case 'i':\n            delta.attributes!.italic = true;\n            break;\n          case '_':\n            delta.attributes!.underline = true;\n            break;\n          case 'c':\n            delta.attributes!.code = true;\n            break;\n          case 's':\n            delta.attributes!.strike = true;\n            break;\n        }\n      }\n      deltas.push(delta);\n    }\n\n    content.push({\n      type: 'block',\n      id: nanoid(),\n      flavour: 'affine:note',\n      props: {\n        xywh: '[0,0,800,95]',\n        background: DEFAULT_NOTE_BACKGROUND_COLOR,\n        index: 'a0',\n        hidden: false,\n        displayMode: 'both',\n      },\n      children: [\n        {\n          type: 'block',\n          id: nanoid(),\n          flavour: 'affine:paragraph',\n          props: {\n            type: 'text',\n            text: {\n              '$blocksuite:internal:text$': true,\n              delta: deltas,\n            },\n          },\n          children: [],\n        },\n      ],\n    });\n\n    return {\n      type: 'slice',\n      content,\n      workspaceId: payload.workspaceId,\n      pageId: payload.pageId,\n    };\n  }\n}\n\nexport const NotionTextAdapterFactoryIdentifier =\n  AdapterFactoryIdentifier('NotionText');\n\nexport const NotionTextAdapterFactoryExtension: ExtensionType = {\n  setup: di => {\n    di.addImpl(NotionTextAdapterFactoryIdentifier, () => ({\n      get: (job: Job) => new NotionTextAdapter(job),\n    }));\n  },\n};\n"]}