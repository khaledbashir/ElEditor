{"version":3,"file":"markdown-inline.js","sourceRoot":"","sources":["../../../../../src/_common/adapters/markdown/delta-converter/markdown-inline.ts"],"names":[],"mappings":"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","sourcesContent":["import type { MarkdownASTToDeltaMatcher } from '@blocksuite/affine-shared/adapters';\n\nexport const markdownTextToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'text',\n  match: ast => ast.type === 'text',\n  toDelta: ast => {\n    if (!('value' in ast)) {\n      return [];\n    }\n    return [{ insert: ast.value }];\n  },\n};\n\nexport const markdownInlineCodeToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'inlineCode',\n  match: ast => ast.type === 'inlineCode',\n  toDelta: ast => {\n    if (!('value' in ast)) {\n      return [];\n    }\n    return [{ insert: ast.value, attributes: { code: true } }];\n  },\n};\n\nexport const markdownStrongToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'strong',\n  match: ast => ast.type === 'strong',\n  toDelta: (ast, context) => {\n    if (!('children' in ast)) {\n      return [];\n    }\n    return ast.children.flatMap(child =>\n      context.toDelta(child).map(delta => {\n        delta.attributes = { ...delta.attributes, bold: true };\n        return delta;\n      })\n    );\n  },\n};\n\nexport const markdownEmphasisToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'emphasis',\n  match: ast => ast.type === 'emphasis',\n  toDelta: (ast, context) => {\n    if (!('children' in ast)) {\n      return [];\n    }\n    return ast.children.flatMap(child =>\n      context.toDelta(child).map(delta => {\n        delta.attributes = { ...delta.attributes, italic: true };\n        return delta;\n      })\n    );\n  },\n};\n\nexport const markdownDeleteToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'delete',\n  match: ast => ast.type === 'delete',\n  toDelta: (ast, context) => {\n    if (!('children' in ast)) {\n      return [];\n    }\n    return ast.children.flatMap(child =>\n      context.toDelta(child).map(delta => {\n        delta.attributes = { ...delta.attributes, strike: true };\n        return delta;\n      })\n    );\n  },\n};\n\nexport const markdownLinkToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'link',\n  match: ast => ast.type === 'link',\n  toDelta: (ast, context) => {\n    if (!('children' in ast) || !('url' in ast)) {\n      return [];\n    }\n    const { configs } = context;\n    const baseUrl = configs.get('docLinkBaseUrl') ?? '';\n    if (baseUrl && ast.url.startsWith(baseUrl)) {\n      const path = ast.url.substring(baseUrl.length);\n      //    ^ - /{pageId}?mode={mode}&blockIds={blockIds}&elementIds={elementIds}\n      const match = path.match(/^\\/([^?]+)(\\?.*)?$/);\n      if (match) {\n        const pageId = match?.[1];\n        const search = match?.[2];\n        const searchParams = search ? new URLSearchParams(search) : undefined;\n        const mode = searchParams?.get('mode');\n        const blockIds = searchParams?.get('blockIds')?.split(',');\n        const elementIds = searchParams?.get('elementIds')?.split(',');\n\n        return [\n          {\n            insert: ' ',\n            attributes: {\n              reference: {\n                type: 'LinkedPage',\n                pageId,\n                params: {\n                  mode:\n                    mode && ['edgeless', 'page'].includes(mode)\n                      ? (mode as 'edgeless' | 'page')\n                      : undefined,\n                  blockIds,\n                  elementIds,\n                },\n              },\n            },\n          },\n        ];\n      }\n    }\n    return ast.children.flatMap(child =>\n      context.toDelta(child).map(delta => {\n        delta.attributes = { ...delta.attributes, link: ast.url };\n        return delta;\n      })\n    );\n  },\n};\n\nexport const markdownListToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'list',\n  match: ast => ast.type === 'list',\n  toDelta: () => [],\n};\n\nexport const markdownInlineMathToDeltaMatcher: MarkdownASTToDeltaMatcher = {\n  name: 'inlineMath',\n  match: ast => ast.type === 'inlineMath',\n  toDelta: ast => {\n    if (!('value' in ast)) {\n      return [];\n    }\n    return [{ insert: ' ', attributes: { latex: ast.value } }];\n  },\n};\n\nexport const markdownInlineToDeltaMatchers: MarkdownASTToDeltaMatcher[] = [\n  markdownTextToDeltaMatcher,\n  markdownInlineCodeToDeltaMatcher,\n  markdownStrongToDeltaMatcher,\n  markdownEmphasisToDeltaMatcher,\n  markdownDeleteToDeltaMatcher,\n  markdownLinkToDeltaMatcher,\n  markdownInlineMathToDeltaMatcher,\n  markdownListToDeltaMatcher,\n];\n"]}