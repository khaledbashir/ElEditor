{"version":3,"file":"html-inline.js","sourceRoot":"","sources":["../../../../../src/_common/adapters/notion-html/delta-converter/html-inline.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Element, Text } from 'hast';\n\nimport {\n  HastUtils,\n  type HtmlAST,\n  type NotionHtmlASTToDeltaMatcher,\n} from '@blocksuite/affine-shared/adapters';\nimport { collapseWhiteSpace } from 'collapse-white-space';\n\nconst isElement = (ast: HtmlAST): ast is Element => {\n  return ast.type === 'element';\n};\n\nconst isText = (ast: HtmlAST): ast is Text => {\n  return ast.type === 'text';\n};\n\nconst listElementTags = ['ol', 'ul'];\nconst strongElementTags = ['strong', 'b'];\nconst italicElementTags = ['i', 'em'];\n\nconst NotionInlineEquationToken = 'notion-text-equation-token';\nconst NotionUnderlineStyleToken = 'border-bottom:0.05em solid';\n\nexport const notionHtmlTextToDeltaMatcher: NotionHtmlASTToDeltaMatcher = {\n  name: 'text',\n  match: ast => isText(ast),\n  toDelta: (ast, context) => {\n    if (!isText(ast)) {\n      return [];\n    }\n    const { options } = context;\n    options.trim ??= true;\n    if (options.pre || ast.value === ' ') {\n      return [{ insert: ast.value }];\n    }\n    if (options.trim) {\n      const value = collapseWhiteSpace(ast.value, { trim: options.trim });\n      if (value) {\n        return [{ insert: value }];\n      }\n      return [];\n    }\n    if (ast.value) {\n      return [{ insert: collapseWhiteSpace(ast.value) }];\n    }\n    return [];\n  },\n};\n\nexport const notionHtmlSpanElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'span-element',\n    match: ast => isElement(ast) && ast.tagName === 'span',\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n\n      const { toDelta, options } = context;\n      if (\n        Array.isArray(ast.properties?.className) &&\n        ast.properties?.className.includes(NotionInlineEquationToken)\n      ) {\n        const latex = HastUtils.getTextContent(\n          HastUtils.querySelector(ast, 'annotation')\n        );\n        return [{ insert: ' ', attributes: { latex } }];\n      }\n\n      // Add underline style detection\n      if (\n        typeof ast.properties?.style === 'string' &&\n        ast.properties?.style?.includes(NotionUnderlineStyleToken)\n      ) {\n        return ast.children.flatMap(child =>\n          context.toDelta(child, options).map(delta => {\n            delta.attributes = { ...delta.attributes, underline: true };\n            return delta;\n          })\n        );\n      }\n\n      return ast.children.flatMap(child => toDelta(child, options));\n    },\n  };\n\nexport const notionHtmlListToDeltaMatcher: NotionHtmlASTToDeltaMatcher = {\n  name: 'list-element',\n  match: ast => isElement(ast) && listElementTags.includes(ast.tagName),\n  toDelta: () => {\n    return [];\n  },\n};\n\nexport const notionHtmlStrongElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'strong-element',\n    match: ast => isElement(ast) && strongElementTags.includes(ast.tagName),\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          delta.attributes = { ...delta.attributes, bold: true };\n          return delta;\n        })\n      );\n    },\n  };\n\nexport const notionHtmlItalicElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'italic-element',\n    match: ast => isElement(ast) && italicElementTags.includes(ast.tagName),\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          delta.attributes = { ...delta.attributes, italic: true };\n          return delta;\n        })\n      );\n    },\n  };\nexport const notionHtmlCodeElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'code-element',\n    match: ast => isElement(ast) && ast.tagName === 'code',\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          delta.attributes = { ...delta.attributes, code: true };\n          return delta;\n        })\n      );\n    },\n  };\n\nexport const notionHtmlDelElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher = {\n  name: 'del-element',\n  match: ast => isElement(ast) && ast.tagName === 'del',\n  toDelta: (ast, context) => {\n    if (!isElement(ast)) {\n      return [];\n    }\n    const { toDelta, options } = context;\n    return ast.children.flatMap(child =>\n      toDelta(child, options).map(delta => {\n        delta.attributes = { ...delta.attributes, strike: true };\n        return delta;\n      })\n    );\n  },\n};\n\nexport const notionHtmlUnderlineElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'underline-element',\n    match: ast => isElement(ast) && ast.tagName === 'u',\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          delta.attributes = { ...delta.attributes, underline: true };\n          return delta;\n        })\n      );\n    },\n  };\n\nexport const notionHtmlLinkElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'link-element',\n    match: ast => isElement(ast) && ast.tagName === 'a',\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n\n      const href = ast.properties?.href;\n      if (typeof href !== 'string') {\n        return [];\n      }\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          if (options.pageMap) {\n            const pageId = options.pageMap.get(decodeURIComponent(href));\n            if (pageId) {\n              delta.attributes = {\n                ...delta.attributes,\n                reference: {\n                  type: 'LinkedPage',\n                  pageId,\n                },\n              };\n              delta.insert = ' ';\n              return delta;\n            }\n          }\n          if (href.startsWith('http')) {\n            delta.attributes = {\n              ...delta.attributes,\n              link: href,\n            };\n            return delta;\n          }\n          return delta;\n        })\n      );\n    },\n  };\n\nexport const notionHtmlMarkElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'mark-element',\n    match: ast => isElement(ast) && ast.tagName === 'mark',\n    toDelta: (ast, context) => {\n      if (!isElement(ast)) {\n        return [];\n      }\n      const { toDelta, options } = context;\n      return ast.children.flatMap(child =>\n        toDelta(child, options).map(delta => {\n          delta.attributes = { ...delta.attributes };\n          return delta;\n        })\n      );\n    },\n  };\n\nexport const notionHtmlLiElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher = {\n  name: 'li-element',\n  match: ast =>\n    isElement(ast) &&\n    ast.tagName === 'li' &&\n    !!HastUtils.querySelector(ast, '.checkbox'),\n  toDelta: (ast, context) => {\n    if (!isElement(ast) || !HastUtils.querySelector(ast, '.checkbox')) {\n      return [];\n    }\n    const { toDelta, options } = context;\n    // Should ignore the children of to do list which is the checkbox and the space following it\n    const checkBox = HastUtils.querySelector(ast, '.checkbox');\n    const checkBoxIndex = ast.children.findIndex(child => child === checkBox);\n    return ast.children\n      .slice(checkBoxIndex + 2)\n      .flatMap(child => toDelta(child, options));\n  },\n};\n\nexport const notionHtmlBrElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher = {\n  name: 'br-element',\n  match: ast => isElement(ast) && ast.tagName === 'br',\n  toDelta: () => {\n    return [{ insert: '\\n' }];\n  },\n};\n\nexport const notionHtmlStyleElementToDeltaMatcher: NotionHtmlASTToDeltaMatcher =\n  {\n    name: 'style-element',\n    match: ast => isElement(ast) && ast.tagName === 'style',\n    toDelta: () => {\n      return [];\n    },\n  };\n\nexport const notionHtmlInlineToDeltaMatchers: NotionHtmlASTToDeltaMatcher[] = [\n  notionHtmlTextToDeltaMatcher,\n  notionHtmlSpanElementToDeltaMatcher,\n  notionHtmlStrongElementToDeltaMatcher,\n  notionHtmlItalicElementToDeltaMatcher,\n  notionHtmlCodeElementToDeltaMatcher,\n  notionHtmlDelElementToDeltaMatcher,\n  notionHtmlUnderlineElementToDeltaMatcher,\n  notionHtmlLinkElementToDeltaMatcher,\n  notionHtmlMarkElementToDeltaMatcher,\n  notionHtmlListToDeltaMatcher,\n  notionHtmlLiElementToDeltaMatcher,\n  notionHtmlBrElementToDeltaMatcher,\n  notionHtmlStyleElementToDeltaMatcher,\n];\n"]}