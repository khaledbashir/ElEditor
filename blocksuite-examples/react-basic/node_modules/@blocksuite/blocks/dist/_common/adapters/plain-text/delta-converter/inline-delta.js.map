{"version":3,"file":"inline-delta.js","sourceRoot":"","sources":["../../../../../src/_common/adapters/plain-text/delta-converter/inline-delta.ts"],"names":[],"mappings":"AAKA,OAAO,EAAE,cAAc,EAAE,MAAM,gCAAgC,CAAC;AAEhE,MAAM,CAAC,MAAM,kCAAkC,GAC7C;IACE,IAAI,EAAE,WAAW;IACjB,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,EAAE,SAAS;IAC7C,KAAK,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;QACxB,MAAM,IAAI,GAAe;YACvB,OAAO,EAAE,KAAK,CAAC,MAAM;SACtB,CAAC;QACF,MAAM,SAAS,GAAG,KAAK,CAAC,UAAU,EAAE,SAAS,CAAC;QAC9C,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;QAC5B,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,SAAS,SAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC;QAC7D,MAAM,GAAG,GAAG,cAAc,CACxB,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,EACnC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,EACxB,SAAS,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CACxC,CAAC;QACF,MAAM,OAAO,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC;QAErD,OAAO;YACL,OAAO;SACR,CAAC;IACJ,CAAC;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,6BAA6B,GACxC;IACE,IAAI,EAAE,MAAM;IACZ,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,EAAE,IAAI;IACxC,KAAK,EAAE,KAAK,CAAC,EAAE;QACb,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC;QAC9B,MAAM,IAAI,GAAe;YACvB,OAAO,EAAE,QAAQ;SAClB,CAAC;QACF,MAAM,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE,IAAI,CAAC;QACpC,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,OAAO,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,QAAQ,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,IAAI,EAAE,CAAC;QAC5D,OAAO;YACL,OAAO;SACR,CAAC;IACJ,CAAC;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,8BAA8B,GACzC;IACE,IAAI,EAAE,aAAa;IACnB,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK;IACzC,KAAK,EAAE,KAAK,CAAC,EAAE;QACb,MAAM,IAAI,GAAe;YACvB,OAAO,EAAE,KAAK,CAAC,MAAM;SACtB,CAAC;QACF,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,EAAE,CAAC;YAC7B,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO;YACL,OAAO,EAAE,KAAK,CAAC,UAAU,EAAE,KAAK;SACjC,CAAC;IACJ,CAAC;CACF,CAAC;AAEJ,MAAM,CAAC,MAAM,qCAAqC,GAChD;IACE,kCAAkC;IAClC,6BAA6B;IAC7B,8BAA8B;CAC/B,CAAC","sourcesContent":["import type {\n  InlineDeltaToPlainTextAdapterMatcher,\n  TextBuffer,\n} from '@blocksuite/affine-shared/adapters';\n\nimport { generateDocUrl } from '@blocksuite/affine-block-embed';\n\nexport const referenceDeltaMarkdownAdapterMatch: InlineDeltaToPlainTextAdapterMatcher =\n  {\n    name: 'reference',\n    match: delta => !!delta.attributes?.reference,\n    toAST: (delta, context) => {\n      const node: TextBuffer = {\n        content: delta.insert,\n      };\n      const reference = delta.attributes?.reference;\n      if (!reference) {\n        return node;\n      }\n\n      const { configs } = context;\n      const title = configs.get(`title:${reference.pageId}`) ?? '';\n      const url = generateDocUrl(\n        configs.get('docLinkBaseUrl') ?? '',\n        String(reference.pageId),\n        reference.params ?? Object.create(null)\n      );\n      const content = `${title ? `${title}: ` : ''}${url}`;\n\n      return {\n        content,\n      };\n    },\n  };\n\nexport const linkDeltaMarkdownAdapterMatch: InlineDeltaToPlainTextAdapterMatcher =\n  {\n    name: 'link',\n    match: delta => !!delta.attributes?.link,\n    toAST: delta => {\n      const linkText = delta.insert;\n      const node: TextBuffer = {\n        content: linkText,\n      };\n      const link = delta.attributes?.link;\n      if (!link) {\n        return node;\n      }\n\n      const content = `${linkText ? `${linkText}: ` : ''}${link}`;\n      return {\n        content,\n      };\n    },\n  };\n\nexport const latexDeltaMarkdownAdapterMatch: InlineDeltaToPlainTextAdapterMatcher =\n  {\n    name: 'inlineLatex',\n    match: delta => !!delta.attributes?.latex,\n    toAST: delta => {\n      const node: TextBuffer = {\n        content: delta.insert,\n      };\n      if (!delta.attributes?.latex) {\n        return node;\n      }\n      return {\n        content: delta.attributes?.latex,\n      };\n    },\n  };\n\nexport const inlineDeltaToPlainTextAdapterMatchers: InlineDeltaToPlainTextAdapterMatcher[] =\n  [\n    referenceDeltaMarkdownAdapterMatch,\n    linkDeltaMarkdownAdapterMatch,\n    latexDeltaMarkdownAdapterMatch,\n  ];\n"]}