{"version":3,"file":"inline-delta.js","sourceRoot":"","sources":["../../../../../src/_common/adapters/html-adapter/delta-converter/inline-delta.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  InlineDeltaToHtmlAdapterMatcher,\n  InlineHtmlAST,\n} from '@blocksuite/affine-shared/adapters';\n\nimport { generateDocUrl } from '@blocksuite/affine-block-embed';\n\nexport const boldDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher = {\n  name: 'bold',\n  match: delta => !!delta.attributes?.bold,\n  toAST: (_, context) => {\n    return {\n      type: 'element',\n      tagName: 'strong',\n      properties: {},\n      children: [context.current],\n    };\n  },\n};\n\nexport const italicDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher =\n  {\n    name: 'italic',\n    match: delta => !!delta.attributes?.italic,\n    toAST: (_, context) => {\n      return {\n        type: 'element',\n        tagName: 'em',\n        properties: {},\n        children: [context.current],\n      };\n    },\n  };\n\nexport const strikeDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher =\n  {\n    name: 'strike',\n    match: delta => !!delta.attributes?.strike,\n    toAST: (_, context) => {\n      return {\n        type: 'element',\n        tagName: 'del',\n        properties: {},\n        children: [context.current],\n      };\n    },\n  };\n\nexport const inlineCodeDeltaToMarkdownAdapterMatcher: InlineDeltaToHtmlAdapterMatcher =\n  {\n    name: 'inlineCode',\n    match: delta => !!delta.attributes?.code,\n    toAST: (_, context) => {\n      return {\n        type: 'element',\n        tagName: 'code',\n        properties: {},\n        children: [context.current],\n      };\n    },\n  };\n\nexport const underlineDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher =\n  {\n    name: 'underline',\n    match: delta => !!delta.attributes?.underline,\n    toAST: (_, context) => {\n      return {\n        type: 'element',\n        tagName: 'u',\n        properties: {},\n        children: [context.current],\n      };\n    },\n  };\n\nexport const referenceDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher =\n  {\n    name: 'reference',\n    match: delta => !!delta.attributes?.reference,\n    toAST: (delta, context) => {\n      let hast: InlineHtmlAST = {\n        type: 'text',\n        value: delta.insert,\n      };\n      const reference = delta.attributes?.reference;\n      if (!reference) {\n        return hast;\n      }\n\n      const { configs } = context;\n      const title = configs.get(`title:${reference.pageId}`);\n      const url = generateDocUrl(\n        configs.get('docLinkBaseUrl') ?? '',\n        String(reference.pageId),\n        reference.params ?? Object.create(null)\n      );\n      if (title) {\n        hast.value = title;\n      }\n      hast = {\n        type: 'element',\n        tagName: 'a',\n        properties: {\n          href: url,\n        },\n        children: [hast],\n      };\n\n      return hast;\n    },\n  };\n\nexport const linkDeltaToHtmlAdapterMatcher: InlineDeltaToHtmlAdapterMatcher = {\n  name: 'link',\n  match: delta => !!delta.attributes?.link,\n  toAST: (delta, _) => {\n    const hast: InlineHtmlAST = {\n      type: 'text',\n      value: delta.insert,\n    };\n    const link = delta.attributes?.link;\n    if (!link) {\n      return hast;\n    }\n    return {\n      type: 'element',\n      tagName: 'a',\n      properties: {\n        href: link,\n      },\n      children: [hast],\n    };\n  },\n};\n\nexport const inlineDeltaToHtmlAdapterMatchers: InlineDeltaToHtmlAdapterMatcher[] =\n  [\n    boldDeltaToHtmlAdapterMatcher,\n    italicDeltaToHtmlAdapterMatcher,\n    strikeDeltaToHtmlAdapterMatcher,\n    underlineDeltaToHtmlAdapterMatcher,\n    inlineCodeDeltaToMarkdownAdapterMatcher,\n    referenceDeltaToHtmlAdapterMatcher,\n    linkDeltaToHtmlAdapterMatcher,\n  ];\n"]}