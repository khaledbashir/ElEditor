{"version":3,"file":"bookmark-service.js","sourceRoot":"","sources":["../../src/bookmark-block/bookmark-service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,gCAAgC,CAAC;AAC/D,OAAO,EAAE,mBAAmB,EAAE,MAAM,0BAA0B,CAAC;AAC/D,OAAO,EACL,iBAAiB,EACjB,gBAAgB,GACjB,MAAM,kCAAkC,CAAC;AAC1C,OAAO,EAAE,yBAAyB,EAAE,MAAM,oCAAoC,CAAC;AAC/E,OAAO,EACL,kBAAkB,EAClB,+BAA+B,EAC/B,+BAA+B,EAC/B,aAAa,GACd,MAAM,iCAAiC,CAAC;AACzC,OAAO,EAAE,YAAY,EAAE,MAAM,uBAAuB,CAAC;AAIrD,OAAO,EAAE,8BAA8B,EAAE,MAAM,8BAA8B,CAAC;AAE9E,MAAM,OAAO,oBAAqB,SAAQ,YAAY;IAAtD;;QAQE,iBAAY,GAAG,CAAC,GAAW,EAAE,MAAoB,EAAE,EAAE;YACnD,OAAO,oBAAoB,CAAC,aAAa,CAAC,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QAC/D,CAAC,CAAC;IACJ,CAAC;aAV0B,YAAO,GAAG,mBAAmB,CAAC,KAAK,CAAC,OAAO,AAApC,CAAqC;aAE7C,kBAAa,GAAG,IAAI,aAAa,EAAE,AAAtB,CAAuB;aAErD,2BAAsB,GAC3B,oBAAoB,CAAC,aAAa,CAAC,WAAW,AADnB,CACoB;;AAOnD,MAAM,CAAC,MAAM,wBAAwB,GAAG,yBAAyB,CAAC;IAChE,OAAO,EAAE,mBAAmB,CAAC,KAAK,CAAC,OAAO;IAC1C,QAAQ,EAAE,IAAI;IACd,SAAS,EAAE,KAAK,CAAC,EAAE;QACjB,MAAM,EAAE,KAAK,EAAE,gBAAgB,EAAE,GAAG,KAAK,CAAC;QAC1C,IACE,gBAAgB,CAAC,MAAM,KAAK,CAAC;YAC7B,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE;gBACxC,mBAAmB,CAAC,KAAK,CAAC,OAAO;aAClC,CAAC;YAEF,OAAO,KAAK,CAAC;QAEf,MAAM,cAAc,GAAG,gBAAgB,CAAC,CAAC,CAEP,CAAC;QACnC,MAAM,WAAW,GACf,cAAc,YAAY,8BAA8B,CAAC;QAC3D,MAAM,MAAM,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpD,MAAM,yBAAyB,GAC7B,MAAM,EAAE,SAAS,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;QAEnD,IAAI,WAAW,EAAE,CAAC;YAChB,MAAM,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC;YACzC,MAAM,WAAW,GACf,KAAK,KAAK,UAAU,IAAI,KAAK,KAAK,MAAM,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC;YAClE,OAAO,+BAA+B,CAAC;gBACrC,cAAc;gBACd,KAAK,EAAE,WAAW;gBAClB,GAAG,KAAK;aACT,CAAC,CAAC;QACL,CAAC;aAAM,IAAI,yBAAyB,EAAE,CAAC;YACrC,MAAM,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC;YAEzC,OAAO,+BAA+B,CAAC;gBACrC,cAAc;gBACd,WAAW,EAAE,eAAe;gBAC5B,KAAK,EAAE,gBAAgB,CAAC,KAAK,CAAC;gBAC9B,MAAM,EAAE,iBAAiB,CAAC,KAAK,CAAC;gBAChC,GAAG,KAAK;aACT,CAAC,CAAC;QACL,CAAC;QAED,OAAO,KAAK,CAAC;IACf,CAAC;CACF,CAAC,CAAC","sourcesContent":["import { LinkPreviewer } from '@blocksuite/affine-block-embed';\nimport { BookmarkBlockSchema } from '@blocksuite/affine-model';\nimport {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '@blocksuite/affine-shared/consts';\nimport { DragHandleConfigExtension } from '@blocksuite/affine-shared/services';\nimport {\n  captureEventTarget,\n  convertDragPreviewDocToEdgeless,\n  convertDragPreviewEdgelessToDoc,\n  matchFlavours,\n} from '@blocksuite/affine-shared/utils';\nimport { BlockService } from '@blocksuite/block-std';\n\nimport type { BookmarkBlockComponent } from './bookmark-block.js';\n\nimport { BookmarkEdgelessBlockComponent } from './bookmark-edgeless-block.js';\n\nexport class BookmarkBlockService extends BlockService {\n  static override readonly flavour = BookmarkBlockSchema.model.flavour;\n\n  private static readonly linkPreviewer = new LinkPreviewer();\n\n  static setLinkPreviewEndpoint =\n    BookmarkBlockService.linkPreviewer.setEndpoint;\n\n  queryUrlData = (url: string, signal?: AbortSignal) => {\n    return BookmarkBlockService.linkPreviewer.query(url, signal);\n  };\n}\n\nexport const BookmarkDragHandleOption = DragHandleConfigExtension({\n  flavour: BookmarkBlockSchema.model.flavour,\n  edgeless: true,\n  onDragEnd: props => {\n    const { state, draggingElements } = props;\n    if (\n      draggingElements.length !== 1 ||\n      !matchFlavours(draggingElements[0].model, [\n        BookmarkBlockSchema.model.flavour,\n      ])\n    )\n      return false;\n\n    const blockComponent = draggingElements[0] as\n      | BookmarkBlockComponent\n      | BookmarkEdgelessBlockComponent;\n    const isInSurface =\n      blockComponent instanceof BookmarkEdgelessBlockComponent;\n    const target = captureEventTarget(state.raw.target);\n    const isTargetEdgelessContainer =\n      target?.classList.contains('edgeless-container');\n\n    if (isInSurface) {\n      const style = blockComponent.model.style;\n      const targetStyle =\n        style === 'vertical' || style === 'cube' ? 'horizontal' : style;\n      return convertDragPreviewEdgelessToDoc({\n        blockComponent,\n        style: targetStyle,\n        ...props,\n      });\n    } else if (isTargetEdgelessContainer) {\n      const style = blockComponent.model.style;\n\n      return convertDragPreviewDocToEdgeless({\n        blockComponent,\n        cssSelector: 'bookmark-card',\n        width: EMBED_CARD_WIDTH[style],\n        height: EMBED_CARD_HEIGHT[style],\n        ...props,\n      });\n    }\n\n    return false;\n  },\n});\n"]}