{"version":3,"file":"notion-html.js","sourceRoot":"","sources":["../../../src/bookmark-block/adapters/notion-html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,mBAAmB,EAAE,MAAM,0BAA0B,CAAC;AAC/D,OAAO,EACL,+BAA+B,EAE/B,SAAS,GACV,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,mBAAmB,CAAC;AAE3C,MAAM,CAAC,MAAM,qCAAqC,GAChD;IACE,OAAO,EAAE,mBAAmB,CAAC,KAAK,CAAC,OAAO;IAC1C,OAAO,EAAE,CAAC,CAAC,EAAE;QACX,OAAO,CACL,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC;YAC3B,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,QAAQ;YAC3B,CAAC,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,EAAE,WAAW,CAAC,CAC/C,CAAC;IACJ,CAAC;IACD,SAAS,EAAE,GAAG,EAAE,CAAC,KAAK;IACtB,eAAe,EAAE;QACf,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;YACpB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;gBACjC,OAAO;YACT,CAAC;YACD,MAAM,QAAQ,GAAG,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;YAC9D,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACd,OAAO;YACT,CAAC;YAED,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO,CAAC;YAClC,MAAM,WAAW,GAAG,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC;YAC9C,MAAM,aAAa,GAAG,SAAS,CAAC,cAAc,CAC5C,SAAS,CAAC,aAAa,CAAC,QAAQ,EAAE,iBAAiB,CAAC,CACrD,CAAC;YACF,MAAM,mBAAmB,GAAG,SAAS,CAAC,cAAc,CAClD,SAAS,CAAC,aAAa,CAAC,QAAQ,EAAE,uBAAuB,CAAC,CAC3D,CAAC;YACF,MAAM,YAAY,GAAG,SAAS,CAAC,aAAa,CAC1C,QAAQ,EACR,gBAAgB,CACjB,CAAC;YACF,MAAM,eAAe,GACnB,OAAO,YAAY,EAAE,UAAU,EAAE,GAAG,KAAK,QAAQ;gBAC/C,CAAC,CAAC,YAAY,CAAC,UAAU,CAAC,GAAG;gBAC7B,CAAC,CAAC,EAAE,CAAC;YACT,aAAa;iBACV,QAAQ,CACP;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,MAAM,EAAE;gBACZ,OAAO,EAAE,mBAAmB,CAAC,KAAK,CAAC,OAAO;gBAC1C,KAAK,EAAE;oBACL,IAAI,EAAE,MAAM;oBACZ,GAAG,EAAE,WAAW,IAAI,EAAE;oBACtB,KAAK,EAAE,aAAa;oBACpB,WAAW,EAAE,mBAAmB;oBAChC,IAAI,EAAE,eAAe;iBACtB;gBACD,QAAQ,EAAE,EAAE;aACb,EACD,UAAU,CACX;iBACA,SAAS,EAAE,CAAC;YACf,aAAa,CAAC,eAAe,EAAE,CAAC;QAClC,CAAC;KACF;IACD,iBAAiB,EAAE,EAAE;CACtB,CAAC;AAEJ,MAAM,CAAC,MAAM,uCAAuC,GAClD,+BAA+B,CAAC,qCAAqC,CAAC,CAAC","sourcesContent":["import { BookmarkBlockSchema } from '@blocksuite/affine-model';\nimport {\n  BlockNotionHtmlAdapterExtension,\n  type BlockNotionHtmlAdapterMatcher,\n  HastUtils,\n} from '@blocksuite/affine-shared/adapters';\nimport { nanoid } from '@blocksuite/store';\n\nexport const bookmarkBlockNotionHtmlAdapterMatcher: BlockNotionHtmlAdapterMatcher =\n  {\n    flavour: BookmarkBlockSchema.model.flavour,\n    toMatch: o => {\n      return (\n        HastUtils.isElement(o.node) &&\n        o.node.tagName === 'figure' &&\n        !!HastUtils.querySelector(o.node, '.bookmark')\n      );\n    },\n    fromMatch: () => false,\n    toBlockSnapshot: {\n      enter: (o, context) => {\n        if (!HastUtils.isElement(o.node)) {\n          return;\n        }\n        const bookmark = HastUtils.querySelector(o.node, '.bookmark');\n        if (!bookmark) {\n          return;\n        }\n\n        const { walkerContext } = context;\n        const bookmarkURL = bookmark.properties?.href;\n        const bookmarkTitle = HastUtils.getTextContent(\n          HastUtils.querySelector(bookmark, '.bookmark-title')\n        );\n        const bookmarkDescription = HastUtils.getTextContent(\n          HastUtils.querySelector(bookmark, '.bookmark-description')\n        );\n        const bookmarkIcon = HastUtils.querySelector(\n          bookmark,\n          '.bookmark-icon'\n        );\n        const bookmarkIconURL =\n          typeof bookmarkIcon?.properties?.src === 'string'\n            ? bookmarkIcon.properties.src\n            : '';\n        walkerContext\n          .openNode(\n            {\n              type: 'block',\n              id: nanoid(),\n              flavour: BookmarkBlockSchema.model.flavour,\n              props: {\n                type: 'card',\n                url: bookmarkURL ?? '',\n                title: bookmarkTitle,\n                description: bookmarkDescription,\n                icon: bookmarkIconURL,\n              },\n              children: [],\n            },\n            'children'\n          )\n          .closeNode();\n        walkerContext.skipAllChildren();\n      },\n    },\n    fromBlockSnapshot: {},\n  };\n\nexport const BookmarkBlockNotionHtmlAdapterExtension =\n  BlockNotionHtmlAdapterExtension(bookmarkBlockNotionHtmlAdapterMatcher);\n"]}