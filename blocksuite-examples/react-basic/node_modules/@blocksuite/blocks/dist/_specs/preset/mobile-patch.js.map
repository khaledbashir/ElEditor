{"version":3,"file":"mobile-patch.js","sourceRoot":"","sources":["../../../src/_specs/preset/mobile-patch.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Container } from '@blocksuite/global/di';\n\nimport {\n  type ReferenceNodeConfig,\n  ReferenceNodeConfigIdentifier,\n} from '@blocksuite/affine-components/rich-text';\nimport {\n  type BlockStdScope,\n  ConfigIdentifier,\n  LifeCycleWatcher,\n  WidgetViewMapIdentifier,\n  type WidgetViewMapType,\n} from '@blocksuite/block-std';\n\nimport type { CodeBlockConfig } from '../../code-block/code-block-config.js';\n\nimport { AFFINE_EMBED_CARD_TOOLBAR_WIDGET } from '../../root-block/widgets/embed-card-toolbar/embed-card-toolbar.js';\nimport { AFFINE_FORMAT_BAR_WIDGET } from '../../root-block/widgets/format-bar/format-bar.js';\nimport { AFFINE_SLASH_MENU_WIDGET } from '../../root-block/widgets/slash-menu/index.js';\n\nexport class MobileSpecsPatches extends LifeCycleWatcher {\n  static override key = 'mobile-patches';\n\n  constructor(std: BlockStdScope) {\n    super(std);\n\n    std.doc.awarenessStore.setFlag('enable_mobile_keyboard_toolbar', true);\n    std.doc.awarenessStore.setFlag('enable_mobile_linked_doc_menu', true);\n  }\n\n  static override setup(di: Container) {\n    super.setup(di);\n\n    // Hide reference popup on mobile.\n    {\n      const prev = di.getFactory(ReferenceNodeConfigIdentifier);\n      di.override(ReferenceNodeConfigIdentifier, provider => {\n        return {\n          ...prev?.(provider),\n          hidePopup: true,\n        } satisfies ReferenceNodeConfig;\n      });\n    }\n\n    // Hide number lines for code block on mobile.\n    {\n      const codeConfigIdentifier = ConfigIdentifier('affine:code');\n      const prev = di.getFactory(codeConfigIdentifier);\n      di.override(codeConfigIdentifier, provider => {\n        return {\n          ...prev?.(provider),\n          showLineNumbers: false,\n        } satisfies CodeBlockConfig;\n      });\n    }\n\n    // Disable root level widgets for mobile.\n    {\n      const rootWidgetViewMapIdentifier =\n        WidgetViewMapIdentifier('affine:page');\n\n      const prev = di.getFactory(rootWidgetViewMapIdentifier);\n\n      di.override(rootWidgetViewMapIdentifier, provider => {\n        const ignoreWidgets = [\n          AFFINE_FORMAT_BAR_WIDGET,\n          AFFINE_EMBED_CARD_TOOLBAR_WIDGET,\n          AFFINE_SLASH_MENU_WIDGET,\n        ];\n\n        const newMap = { ...prev?.(provider) };\n\n        ignoreWidgets.forEach(widget => {\n          if (widget in newMap) delete newMap[widget];\n        });\n\n        return newMap;\n      });\n    }\n\n    // Disable block level toolbar widgets for mobile.\n    {\n      di.override(\n        WidgetViewMapIdentifier('affine:code'),\n        (): WidgetViewMapType => ({})\n      );\n\n      di.override(\n        WidgetViewMapIdentifier('affine:image'),\n        (): WidgetViewMapType => ({})\n      );\n\n      di.override(\n        WidgetViewMapIdentifier('affine:surface-ref'),\n        (): WidgetViewMapType => ({})\n      );\n    }\n  }\n\n  override mounted() {\n    // remove slash placeholder for mobile: `type / ...`\n    {\n      const paragraphService = this.std.getService('affine:paragraph');\n      if (!paragraphService) return;\n\n      paragraphService.placeholderGenerator = model => {\n        const placeholders = {\n          text: '',\n          h1: 'Heading 1',\n          h2: 'Heading 2',\n          h3: 'Heading 3',\n          h4: 'Heading 4',\n          h5: 'Heading 5',\n          h6: 'Heading 6',\n          quote: '',\n        };\n        return placeholders[model.type];\n      };\n    }\n  }\n}\n"]}