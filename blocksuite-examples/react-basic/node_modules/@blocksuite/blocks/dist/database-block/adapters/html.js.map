{"version":3,"file":"html.js","sourceRoot":"","sources":["../../../src/database-block/adapters/html.ts"],"names":[],"mappings":"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","sourcesContent":["import type { DeltaInsert } from '@blocksuite/inline';\nimport type { Element } from 'hast';\n\nimport {\n  type Column,\n  DatabaseBlockSchema,\n  type SerializedCells,\n} from '@blocksuite/affine-model';\nimport {\n  BlockHtmlAdapterExtension,\n  type BlockHtmlAdapterMatcher,\n  HastUtils,\n  type InlineHtmlAST,\n  TextUtils,\n} from '@blocksuite/affine-shared/adapters';\nimport { type BlockSnapshot, nanoid } from '@blocksuite/store';\nimport { format } from 'date-fns/format';\n\nconst DATABASE_NODE_TYPES = ['table', 'thead', 'tbody', 'th', 'tr'];\n\nexport const databaseBlockHtmlAdapterMatcher: BlockHtmlAdapterMatcher = {\n  flavour: DatabaseBlockSchema.model.flavour,\n  toMatch: o =>\n    HastUtils.isElement(o.node) && DATABASE_NODE_TYPES.includes(o.node.tagName),\n  fromMatch: o => o.node.flavour === DatabaseBlockSchema.model.flavour,\n  toBlockSnapshot: {\n    enter: (o, context) => {\n      if (!HastUtils.isElement(o.node)) {\n        return;\n      }\n      const { walkerContext } = context;\n      if (o.node.tagName === 'table') {\n        const tableHeader = HastUtils.querySelector(o.node, 'thead');\n        if (!tableHeader) {\n          return;\n        }\n        const tableHeaderRow = HastUtils.querySelector(tableHeader, 'tr');\n        if (!tableHeaderRow) {\n          return;\n        }\n        // Table header row as database header row\n        const viewsColumns = tableHeaderRow.children.map(() => {\n          return {\n            id: nanoid(),\n            hide: false,\n            width: 180,\n          };\n        });\n\n        // Build database cells from table body rows\n        const cells = Object.create(null);\n        const tableBody = HastUtils.querySelector(o.node, 'tbody');\n        tableBody?.children.forEach(row => {\n          const rowId = nanoid();\n          cells[rowId] = Object.create(null);\n          (row as Element).children.forEach((cell, index) => {\n            cells[rowId][viewsColumns[index].id] = {\n              columnId: viewsColumns[index].id,\n              value: TextUtils.createText(\n                (cell as Element).children\n                  .map(child => ('value' in child ? child.value : ''))\n                  .join('')\n              ),\n            };\n          });\n        });\n\n        // Build database columns from table header row\n        const columns = tableHeaderRow.children.map((_child, index) => {\n          return {\n            type: index === 0 ? 'title' : 'rich-text',\n            name: (_child as Element).children\n              .map(child => ('value' in child ? child.value : ''))\n              .join(''),\n            data: {},\n            id: viewsColumns[index].id,\n          };\n        });\n\n        walkerContext.openNode(\n          {\n            type: 'block',\n            id: nanoid(),\n            flavour: 'affine:database',\n            props: {\n              views: [\n                {\n                  id: nanoid(),\n                  name: 'Table View',\n                  mode: 'table',\n                  columns: [],\n                  filter: {\n                    type: 'group',\n                    op: 'and',\n                    conditions: [],\n                  },\n                  header: {\n                    titleColumn: viewsColumns[0]?.id,\n                    iconColumn: 'type',\n                  },\n                },\n              ],\n              title: {\n                '$blocksuite:internal:text$': true,\n                delta: [],\n              },\n              cells,\n              columns,\n            },\n            children: [],\n          },\n          'children'\n        );\n        walkerContext.setNodeContext('affine:table:rowid', Object.keys(cells));\n        walkerContext.skipChildren(1);\n      }\n\n      // The first child of each table body row is the database title cell\n      if (o.node.tagName === 'tr') {\n        const { deltaConverter } = context;\n        walkerContext\n          .openNode({\n            type: 'block',\n            id:\n              (\n                walkerContext.getNodeContext(\n                  'affine:table:rowid'\n                ) as Array<string>\n              ).shift() ?? nanoid(),\n            flavour: 'affine:paragraph',\n            props: {\n              text: {\n                '$blocksuite:internal:text$': true,\n                delta: deltaConverter.astToDelta(o.node.children[0]),\n              },\n              type: 'text',\n            },\n            children: [],\n          })\n          .closeNode();\n        walkerContext.skipAllChildren();\n      }\n    },\n    leave: (o, context) => {\n      if (!HastUtils.isElement(o.node)) {\n        return;\n      }\n      const { walkerContext } = context;\n      if (o.node.tagName === 'table') {\n        walkerContext.closeNode();\n      }\n    },\n  },\n  fromBlockSnapshot: {\n    enter: (o, context) => {\n      const { walkerContext } = context;\n      const columns = o.node.props.columns as Array<Column>;\n      const children = o.node.children;\n      const cells = o.node.props.cells as SerializedCells;\n\n      const createAstTableCell = (\n        children: InlineHtmlAST[]\n      ): InlineHtmlAST => ({\n        type: 'element',\n        tagName: 'td',\n        properties: Object.create(null),\n        children,\n      });\n\n      const createAstTableHeaderCell = (\n        children: InlineHtmlAST[]\n      ): InlineHtmlAST => ({\n        type: 'element',\n        tagName: 'th',\n        properties: Object.create(null),\n        children,\n      });\n\n      const createAstTableRow = (cells: InlineHtmlAST[]): Element => ({\n        type: 'element',\n        tagName: 'tr',\n        properties: Object.create(null),\n        children: cells,\n      });\n\n      const { deltaConverter } = context;\n      const htmlAstRows = Array.prototype.map.call(\n        children,\n        (v: BlockSnapshot) => {\n          const rowCells = Array.prototype.map.call(columns, col => {\n            const cell = cells[v.id]?.[col.id];\n            if (!cell && col.type !== 'title') {\n              return createAstTableCell([{ type: 'text', value: '' }]);\n            }\n            switch (col.type) {\n              case 'rich-text':\n                return createAstTableCell(\n                  deltaConverter.deltaToAST(\n                    (cell.value as { delta: DeltaInsert[] }).delta\n                  )\n                );\n              case 'title':\n                return createAstTableCell(\n                  deltaConverter.deltaToAST(\n                    (v.props.text as { delta: DeltaInsert[] }).delta\n                  )\n                );\n              case 'date':\n                return createAstTableCell([\n                  {\n                    type: 'text',\n                    value: format(new Date(cell.value as number), 'yyyy-MM-dd'),\n                  },\n                ]);\n              case 'select': {\n                const value =\n                  (col.data.options.find(\n                    (opt: Record<string, string>) => opt.id === cell.value\n                  )?.value as string) ?? '';\n                return createAstTableCell([{ type: 'text', value }]);\n              }\n              case 'multi-select': {\n                const value = Array.prototype.map\n                  .call(\n                    cell.value,\n                    val =>\n                      col.data.options.find(\n                        (opt: Record<string, string>) => val === opt.id\n                      ).value ?? ''\n                  )\n                  .filter(Boolean)\n                  .join(',');\n                return createAstTableCell([{ type: 'text', value }]);\n              }\n              case 'checkbox': {\n                return createAstTableCell([\n                  { type: 'text', value: String(cell.value) },\n                ]);\n              }\n              default:\n                return createAstTableCell([\n                  { type: 'text', value: String(cell.value) },\n                ]);\n            }\n          }) as InlineHtmlAST[];\n          return createAstTableRow(rowCells);\n        }\n      ) as Element[];\n\n      // Handle first row (header).\n      const headerRow = createAstTableRow(\n        Array.prototype.map.call(columns, v =>\n          createAstTableHeaderCell([\n            {\n              type: 'text',\n              value: v.name ?? '',\n            },\n          ])\n        ) as Element[]\n      );\n\n      const tableHeaderAst: Element = {\n        type: 'element',\n        tagName: 'thead',\n        properties: Object.create(null),\n        children: [headerRow],\n      };\n\n      const tableBodyAst: Element = {\n        type: 'element',\n        tagName: 'tbody',\n        properties: Object.create(null),\n        children: [...htmlAstRows],\n      };\n\n      walkerContext\n        .openNode({\n          type: 'element',\n          tagName: 'table',\n          properties: Object.create(null),\n          children: [tableHeaderAst, tableBodyAst],\n        })\n        .closeNode();\n\n      walkerContext.skipAllChildren();\n    },\n  },\n};\n\nexport const DatabaseBlockHtmlAdapterExtension = BlockHtmlAdapterExtension(\n  databaseBlockHtmlAdapterMatcher\n);\n"]}