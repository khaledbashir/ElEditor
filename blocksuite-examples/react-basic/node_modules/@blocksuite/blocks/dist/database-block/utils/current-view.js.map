{"version":3,"file":"current-view.js","sourceRoot":"","sources":["../../../src/database-block/utils/current-view.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AAExB,MAAM,qBAAqB,GAAG,CAAC,CAAC,KAAK,CACnC,CAAC,CAAC,MAAM,CAAC;IACP,OAAO,EAAE,CAAC,CAAC,MAAM,EAAE;IACnB,MAAM,EAAE,CAAC,CAAC,MAAM,EAAE;CACnB,CAAC,CACH,CAAC;AACF,MAAM,SAAS,GAAG,EAAE,CAAC;AACrB,MAAM,kBAAkB,GAAG,+CAA+C,CAAC;AAC3E,MAAM,OAAO,GAAG,UAAU,CAAC,cAAc,CAAC;AAC1C,MAAM,wBAAwB,GAAG,GAAG,EAAE;IACpC,MAAM,OAAO,GAAG,GAAG,EAAE;QACnB,MAAM,MAAM,GAAG,OAAO,EAAE,OAAO,CAAC,kBAAkB,CAAC,CAAC;QACpD,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO;QACT,CAAC;QACD,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,qBAAqB,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;YACnE,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;gBACnB,OAAO,MAAM,CAAC,IAAI,CAAC;YACrB,CAAC;QACH,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,aAAa;QACf,CAAC;QACD,OAAO;IACT,CAAC,CAAC;IACF,MAAM,QAAQ,GAAG,GAAG,EAAE;QACpB,OAAO,CAAC,OAAO,CAAC,kBAAkB,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;IAC5D,CAAC,CAAC;IAEF,MAAM,IAAI,GAAG,OAAO,EAAE,IAAI,EAAE,CAAC;IAE7B,OAAO;QACL,cAAc,EAAE,CAAC,OAAe,EAAE,EAAE;YAClC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,EAAE,MAAM,CAAC;QAC7D,CAAC;QACD,cAAc,EAAE,CAAC,OAAe,EAAE,MAAc,EAAE,EAAE;YAClD,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,CAAC;YACrE,IAAI,WAAW,IAAI,CAAC,EAAE,CAAC;gBACrB,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAC9B,CAAC;YACD,IAAI,IAAI,CAAC,MAAM,IAAI,SAAS,EAAE,CAAC;gBAC7B,IAAI,CAAC,GAAG,EAAE,CAAC;YACb,CAAC;YACD,IAAI,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;YAClC,QAAQ,EAAE,CAAC;QACb,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,kBAAkB,GAAG,wBAAwB,EAAE,CAAC","sourcesContent":["import { z } from 'zod';\n\nconst currentViewListSchema = z.array(\n  z.object({\n    blockId: z.string(),\n    viewId: z.string(),\n  })\n);\nconst maxLength = 20;\nconst currentViewListKey = 'blocksuite:databaseBlock:view:currentViewList';\nconst storage = globalThis.sessionStorage;\nconst createCurrentViewStorage = () => {\n  const getList = () => {\n    const string = storage?.getItem(currentViewListKey);\n    if (!string) {\n      return;\n    }\n    try {\n      const result = currentViewListSchema.safeParse(JSON.parse(string));\n      if (result.success) {\n        return result.data;\n      }\n    } catch (_) {\n      // do nothing\n    }\n    return;\n  };\n  const saveList = () => {\n    storage.setItem(currentViewListKey, JSON.stringify(list));\n  };\n\n  const list = getList() ?? [];\n\n  return {\n    getCurrentView: (blockId: string) => {\n      return list.find(item => item.blockId === blockId)?.viewId;\n    },\n    setCurrentView: (blockId: string, viewId: string) => {\n      const configIndex = list.findIndex(item => item.blockId === blockId);\n      if (configIndex >= 0) {\n        list.splice(configIndex, 1);\n      }\n      if (list.length >= maxLength) {\n        list.pop();\n      }\n      list.unshift({ blockId, viewId });\n      saveList();\n    },\n  };\n};\n\nexport const currentViewStorage = createCurrentViewStorage();\n"]}