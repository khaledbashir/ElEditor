{"version":3,"file":"database-service.js","sourceRoot":"","sources":["../../src/database-block/database-service.ts"],"names":[],"mappings":"AAEA,OAAO,EAEL,mBAAmB,GACpB,MAAM,0BAA0B,CAAC;AAClC,OAAO,EAAE,YAAY,EAAE,MAAM,uBAAuB,CAAC;AACrD,OAAO,EAAE,WAAW,EAAE,MAAM,oCAAoC,CAAC;AAEjE,OAAO,EACL,mBAAmB,EACnB,qBAAqB,EACrB,wBAAwB,GACzB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EACL,WAAW,EACX,mBAAmB,EACnB,UAAU,EACV,UAAU,GACX,MAAM,wBAAwB,CAAC;AAEhC,MAAM,OAAO,oBAAqB,SAAQ,YAAY;IAAtD;;QAGE,cAAS,GAAG,WAAW,CAAC;QAExB,sBAAiB,GAAG,mBAAmB,CAAC;QAExC,wBAAmB,GAAG,mBAAmB,CAAC;QAE1C,0BAAqB,GAAG,qBAAqB,CAAC;QAE9C,eAAU,GAAG,UAAU,CAAC;QAExB,eAAU,GAAG,UAAU,CAAC;QAExB,gBAAW,GAAG,WAAW,CAAC;IAuB5B,CAAC;aArC0B,YAAO,GAAG,mBAAmB,CAAC,KAAK,CAAC,OAAO,AAApC,CAAqC;IAgBrE,iBAAiB,CACf,GAAQ,EACR,KAAiB,EACjB,UAAkB,EAClB,QAAgB,EAChB,cAAc,GAAG,IAAI;QAErB,MAAM,UAAU,GAAG,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,KAEhC,CAAC;QACd,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,OAAO;QACT,CAAC;QACD,wBAAwB,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;QAC/C,IAAI,cAAc,EAAE,CAAC;YACnB,MAAM,MAAM,GAAG,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;YACpC,IAAI,CAAC,MAAM;gBAAE,OAAO;YACpB,GAAG,CAAC,QAAQ,CAAC,kBAAkB,EAAE,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;QAClD,CAAC;QACD,mBAAmB,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC","sourcesContent":["import type { BlockModel, Doc } from '@blocksuite/store';\n\nimport {\n  type DatabaseBlockModel,\n  DatabaseBlockSchema,\n} from '@blocksuite/affine-model';\nimport { BlockService } from '@blocksuite/block-std';\nimport { viewPresets } from '@blocksuite/data-view/view-presets';\n\nimport {\n  databaseViewAddView,\n  databaseViewInitEmpty,\n  databaseViewInitTemplate,\n} from './data-source.js';\nimport {\n  addProperty,\n  applyPropertyUpdate,\n  updateCell,\n  updateView,\n} from './utils/block-utils.js';\n\nexport class DatabaseBlockService extends BlockService {\n  static override readonly flavour = DatabaseBlockSchema.model.flavour;\n\n  addColumn = addProperty;\n\n  applyColumnUpdate = applyPropertyUpdate;\n\n  databaseViewAddView = databaseViewAddView;\n\n  databaseViewInitEmpty = databaseViewInitEmpty;\n\n  updateCell = updateCell;\n\n  updateView = updateView;\n\n  viewPresets = viewPresets;\n\n  initDatabaseBlock(\n    doc: Doc,\n    model: BlockModel,\n    databaseId: string,\n    viewType: string,\n    isAppendNewRow = true\n  ) {\n    const blockModel = doc.getBlock(databaseId)?.model as\n      | DatabaseBlockModel\n      | undefined;\n    if (!blockModel) {\n      return;\n    }\n    databaseViewInitTemplate(blockModel, viewType);\n    if (isAppendNewRow) {\n      const parent = doc.getParent(model);\n      if (!parent) return;\n      doc.addBlock('affine:paragraph', {}, parent.id);\n    }\n    applyPropertyUpdate(blockModel);\n  }\n}\n"]}