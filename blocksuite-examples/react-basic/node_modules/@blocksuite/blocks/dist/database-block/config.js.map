{"version":3,"file":"config.js","sourceRoot":"","sources":["../../src/database-block/config.ts"],"names":[],"mappings":"AAEA,OAAO,EAEL,mBAAmB,GACpB,MAAM,0BAA0B,CAAC;AAClC,OAAO,EAAE,yBAAyB,EAAE,MAAM,oCAAoC,CAAC;AAC/E,OAAO,EAAE,kBAAkB,EAAE,MAAM,iCAAiC,CAAC;AAMrE,IAAI,OAAO,GAAG,KAAK,CAAC;AACpB,MAAM,CAAC,MAAM,wBAAwB,GAAG,yBAAyB,CAAC;IAChE,OAAO,EAAE,mBAAmB,CAAC,KAAK,CAAC,OAAO;IAC1C,UAAU,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE;QACxB,MAAM,MAAM,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpD,MAAM,QAAQ,GAAG,MAAM,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;QACpD,IAAI,CAAC,QAAQ;YAAE,OAAO,KAAK,CAAC;QAC5B,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;QAC3B,IAAI,IAAI,IAAI,MAAM,YAAY,WAAW,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;YACvE,OAAO,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC;YACnD,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,OAAO,EAAE,CAAC;YACZ,IAAI,EAAE,aAAa,EAAE,EAAE,CAAC;YACxB,OAAO,GAAG,KAAK,CAAC;QAClB,CAAC;QACD,OAAO,KAAK,CAAC;IACf,CAAC;IACD,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,gBAAgB,EAAE,UAAU,EAAE,EAAE,EAAE;QACrD,MAAM,MAAM,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC;QAChC,MAAM,QAAQ,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACtD,MAAM,QAAQ,GAAG,QAAQ,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;QACtD,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,OAAO,KAAK,CAAC;QACf,CAAC;QACD,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;QAC3B,IACE,OAAO;YACP,IAAI;YACJ,IAAI,CAAC,MAAM;YACX,MAAM,YAAY,WAAW;YAC7B,QAAQ,CAAC,aAAa,EAAE,QAAQ,CAAC,MAAM,CAAC,EACxC,CAAC;YACD,MAAM,MAAM,GAAG,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;YAClD,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;YAClD,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrB,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;YACvB,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,OAAO,EAAE,CAAC;YACZ,IAAI,EAAE,aAAa,EAAE,EAAE,CAAC;YACxB,OAAO,GAAG,KAAK,CAAC;QAClB,CAAC;QACD,OAAO,KAAK,CAAC;IACf,CAAC;CACF,CAAC,CAAC","sourcesContent":["import type { MenuOptions } from '@blocksuite/affine-components/context-menu';\n\nimport {\n  type DatabaseBlockModel,\n  DatabaseBlockSchema,\n} from '@blocksuite/affine-model';\nimport { DragHandleConfigExtension } from '@blocksuite/affine-shared/services';\nimport { captureEventTarget } from '@blocksuite/affine-shared/utils';\n\nexport interface DatabaseOptionsConfig {\n  configure: (model: DatabaseBlockModel, options: MenuOptions) => MenuOptions;\n}\n\nlet canDrop = false;\nexport const DatabaseDragHandleOption = DragHandleConfigExtension({\n  flavour: DatabaseBlockSchema.model.flavour,\n  onDragMove: ({ state }) => {\n    const target = captureEventTarget(state.raw.target);\n    const database = target?.closest('affine-database');\n    if (!database) return false;\n    const view = database.view;\n    if (view && target instanceof HTMLElement && database.contains(target)) {\n      canDrop = view.showIndicator?.(state.raw) ?? false;\n      return false;\n    }\n    if (canDrop) {\n      view?.hideIndicator?.();\n      canDrop = false;\n    }\n    return false;\n  },\n  onDragEnd: ({ state, draggingElements, editorHost }) => {\n    const target = state.raw.target;\n    const targetEl = captureEventTarget(state.raw.target);\n    const database = targetEl?.closest('affine-database');\n    if (!database) {\n      return false;\n    }\n    const view = database.view;\n    if (\n      canDrop &&\n      view &&\n      view.moveTo &&\n      target instanceof HTMLElement &&\n      database.parentElement?.contains(target)\n    ) {\n      const blocks = draggingElements.map(v => v.model);\n      editorHost.doc.moveBlocks(blocks, database.model);\n      blocks.forEach(model => {\n        view.moveTo?.(model.id, state.raw);\n      });\n      view.hideIndicator?.();\n      return false;\n    }\n    if (canDrop) {\n      view?.hideIndicator?.();\n      canDrop = false;\n    }\n    return false;\n  },\n});\n"]}