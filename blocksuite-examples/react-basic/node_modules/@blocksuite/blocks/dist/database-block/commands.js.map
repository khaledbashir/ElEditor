{"version":3,"file":"commands.js","sourceRoot":"","sources":["../../src/database-block/commands.ts"],"names":[],"mappings":"AAEA,MAAM,CAAC,MAAM,0BAA0B,GAQnC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;IAChB,MAAM,EAAE,cAAc,EAAE,QAAQ,EAAE,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;IACtE,IAAI,CAAC,cAAc,EAAE,MAAM;QAAE,OAAO;IAEpC,MAAM,WAAW,GACf,KAAK,KAAK,QAAQ;QAChB,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,cAAc,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAEhD,MAAM,OAAO,GAAG,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;IAClD,IAAI,CAAC,OAAO;QAAE,OAAO;IAErB,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC,gBAAgB,CACrC,WAAW,EACX,CAAC,EAAE,OAAO,EAAE,iBAAiB,EAAE,CAAC,EAChC,KAAK,CACN,CAAC;IACF,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO;IAEhC,OAAO,CAAC,iBAAiB,CAAC,GAAG,CAAC,GAAG,EAAE,WAAW,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;IAE5E,IAAI,eAAe,IAAI,WAAW,CAAC,IAAI,EAAE,MAAM,KAAK,CAAC,EAAE,CAAC;QACtD,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;IACnC,CAAC;IAED,IAAI,CAAC,EAAE,uBAAuB,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;AAC/C,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,QAAQ,GAAkB;IACrC,mBAAmB,EAAE,0BAA0B;CAChD,CAAC","sourcesContent":["import type { BlockCommands, Command } from '@blocksuite/block-std';\n\nexport const insertDatabaseBlockCommand: Command<\n  'selectedModels',\n  'insertedDatabaseBlockId',\n  {\n    viewType: string;\n    place?: 'after' | 'before';\n    removeEmptyLine?: boolean;\n  }\n> = (ctx, next) => {\n  const { selectedModels, viewType, place, removeEmptyLine, std } = ctx;\n  if (!selectedModels?.length) return;\n\n  const targetModel =\n    place === 'before'\n      ? selectedModels[0]\n      : selectedModels[selectedModels.length - 1];\n\n  const service = std.getService('affine:database');\n  if (!service) return;\n\n  const result = std.doc.addSiblingBlocks(\n    targetModel,\n    [{ flavour: 'affine:database' }],\n    place\n  );\n  if (result.length === 0) return;\n\n  service.initDatabaseBlock(std.doc, targetModel, result[0], viewType, false);\n\n  if (removeEmptyLine && targetModel.text?.length === 0) {\n    std.doc.deleteBlock(targetModel);\n  }\n\n  next({ insertedDatabaseBlockId: result[0] });\n};\n\nexport const commands: BlockCommands = {\n  insertDatabaseBlock: insertDatabaseBlockCommand,\n};\n"]}