{"version":3,"file":"define.js","sourceRoot":"","sources":["../../../../src/database-block/properties/title/define.ts"],"names":[],"mappings":"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","sourcesContent":["import { propertyType, t } from '@blocksuite/data-view';\nimport { Text } from '@blocksuite/store';\n\nimport { HostContextKey } from '../../context/host-context.js';\nimport { isLinkedDoc } from '../../utils/title-doc.js';\n\nexport const titleColumnType = propertyType('title');\n\nexport const titlePurePropertyConfig = titleColumnType.modelConfig<Text>({\n  name: 'Title',\n  type: () => t.richText.instance(),\n  defaultData: () => ({}),\n  cellToString: ({ value }) => value?.toString() ?? '',\n  cellFromString: ({ value }) => {\n    return {\n      value: value,\n    };\n  },\n  cellToJson: ({ value, dataSource }) => {\n    const host = dataSource.contextGet(HostContextKey);\n    if (host) {\n      const collection = host.std.collection;\n      const deltas = value.deltas$.value;\n      const text = deltas\n        .map(delta => {\n          if (isLinkedDoc(delta)) {\n            const linkedDocId = delta.attributes?.reference?.pageId as string;\n            return collection.getDoc(linkedDocId)?.meta?.title;\n          }\n          return delta.insert;\n        })\n        .join('');\n      return text;\n    }\n    return value?.toString() ?? null;\n  },\n  cellFromJson: ({ value }) =>\n    typeof value !== 'string' ? undefined : new Text(value),\n  onUpdate: ({ value, callback }) => {\n    value.yText.observe(callback);\n    callback();\n    return {\n      dispose: () => {\n        value.yText.unobserve(callback);\n      },\n    };\n  },\n  valueUpdate: ({ value, newValue }) => {\n    const v = newValue as unknown;\n    if (typeof v === 'string') {\n      value.replace(0, value.length, v);\n      return value;\n    }\n    if (v == null) {\n      value.replace(0, value.length, '');\n      return value;\n    }\n    return newValue;\n  },\n  isEmpty: ({ value }) => value == null || value.length === 0,\n  values: ({ value }) => (value?.toString() ? [value.toString()] : []),\n});\n"]}