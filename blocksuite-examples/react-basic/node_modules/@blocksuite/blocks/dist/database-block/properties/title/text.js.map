{"version":3,"file":"text.js","sourceRoot":"","sources":["../../../../src/database-block/properties/title/text.ts"],"names":[],"mappings":"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","sourcesContent":["import type { RootBlockModel } from '@blocksuite/affine-model';\nimport type { DeltaInsert } from '@blocksuite/inline';\nimport type { BlockSnapshot, Text } from '@blocksuite/store';\n\nimport {\n  DefaultInlineManagerExtension,\n  type RichText,\n} from '@blocksuite/affine-components/rich-text';\nimport { ParseDocUrlProvider } from '@blocksuite/affine-shared/services';\nimport {\n  getViewportElement,\n  isValidUrl,\n} from '@blocksuite/affine-shared/utils';\nimport { BaseCellRenderer } from '@blocksuite/data-view';\nimport { IS_MAC } from '@blocksuite/global/env';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { LinkedPageIcon } from '@blocksuite/icons/lit';\nimport { computed, effect, signal } from '@preact/signals-core';\nimport { css, type TemplateResult } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { html } from 'lit/static-html.js';\n\nimport type { DatabaseBlockComponent } from '../../database-block.js';\n\nimport { ClipboardAdapter } from '../../../root-block/clipboard/adapter.js';\nimport { HostContextKey } from '../../context/host-context.js';\nimport { getSingleDocIdFromText } from '../../utils/title-doc.js';\n\nconst styles = css`\n  data-view-header-area-text {\n    width: 100%;\n    display: flex;\n  }\n\n  data-view-header-area-text rich-text {\n    pointer-events: none;\n    user-select: none;\n  }\n\n  data-view-header-area-text-editing {\n    width: 100%;\n    display: flex;\n    cursor: text;\n  }\n\n  .data-view-header-area-rich-text {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n    outline: none;\n    word-break: break-all;\n    font-size: var(--data-view-cell-text-size);\n    line-height: var(--data-view-cell-text-line-height);\n  }\n\n  .data-view-header-area-rich-text v-line {\n    display: flex !important;\n    align-items: center;\n    height: 100%;\n    width: 100%;\n  }\n\n  .data-view-header-area-rich-text v-line > div {\n    flex-grow: 1;\n  }\n\n  .data-view-header-area-icon {\n    height: max-content;\n    display: flex;\n    align-items: center;\n    margin-right: 8px;\n    padding: 2px;\n    border-radius: 4px;\n    margin-top: 2px;\n    background-color: var(--affine-background-secondary-color);\n  }\n\n  .data-view-header-area-icon svg {\n    width: 14px;\n    height: 14px;\n    fill: var(--affine-icon-color);\n    color: var(--affine-icon-color);\n  }\n`;\n\nabstract class BaseTextCell extends BaseCellRenderer<Text> {\n  static override styles = styles;\n\n  activity = true;\n\n  docId$ = signal<string>();\n\n  isLinkedDoc$ = computed(() => false);\n\n  linkedDocTitle$ = computed(() => {\n    if (!this.docId$.value) {\n      return this.value;\n    }\n    const doc = this.host?.std.collection.getDoc(this.docId$.value);\n    const root = doc?.root as RootBlockModel;\n    return root.title;\n  });\n\n  get attributeRenderer() {\n    return this.inlineManager?.getRenderer();\n  }\n\n  get attributesSchema() {\n    return this.inlineManager?.getSchema();\n  }\n\n  get host() {\n    return this.view.contextGet(HostContextKey);\n  }\n\n  get inlineEditor() {\n    return this.richText.inlineEditor;\n  }\n\n  get inlineManager() {\n    return this.host?.std.get(DefaultInlineManagerExtension.identifier);\n  }\n\n  get service() {\n    return this.host?.std.getService('affine:database');\n  }\n\n  get topContenteditableElement() {\n    const databaseBlock =\n      this.closest<DatabaseBlockComponent>('affine-database');\n    return databaseBlock?.topContenteditableElement;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const yText = this.value?.yText;\n    if (yText) {\n      const cb = () => {\n        const id = getSingleDocIdFromText(this.value);\n        this.docId$.value = id;\n      };\n      cb();\n      if (this.activity) {\n        yText.observe(cb);\n        this.disposables.add(() => {\n          yText.unobserve(cb);\n        });\n      }\n    }\n  }\n\n  protected override render(): unknown {\n    return html`${this.renderIcon()}${this.renderBlockText()}`;\n  }\n\n  abstract renderBlockText(): TemplateResult;\n\n  renderIcon() {\n    if (this.docId$.value) {\n      return html` <div class=\"data-view-header-area-icon\">\n        ${LinkedPageIcon()}\n      </div>`;\n    }\n    if (!this.showIcon) {\n      return;\n    }\n    const iconColumn = this.view.mainProperties$.value.iconColumn;\n    if (!iconColumn) return;\n\n    const icon = this.view.cellValueGet(this.cell.rowId, iconColumn) as string;\n    if (!icon) return;\n\n    return html` <div class=\"data-view-header-area-icon\">${icon}</div>`;\n  }\n\n  abstract renderLinkedDoc(): TemplateResult;\n\n  @query('rich-text')\n  accessor richText!: RichText;\n\n  @property({ attribute: false })\n  accessor showIcon = false;\n}\n\nexport class HeaderAreaTextCell extends BaseTextCell {\n  override renderBlockText() {\n    return html` <rich-text\n      .yText=\"${this.value}\"\n      .attributesSchema=\"${this.attributesSchema}\"\n      .attributeRenderer=\"${this.attributeRenderer}\"\n      .embedChecker=\"${this.inlineManager?.embedChecker}\"\n      .markdownShortcutHandler=\"${this.inlineManager?.markdownShortcutHandler}\"\n      .readonly=\"${true}\"\n      class=\"data-view-header-area-rich-text\"\n    ></rich-text>`;\n  }\n\n  override renderLinkedDoc(): TemplateResult {\n    return html` <rich-text\n      .yText=\"${this.linkedDocTitle$.value}\"\n      .readonly=\"${true}\"\n      class=\"data-view-header-area-rich-text\"\n    ></rich-text>`;\n  }\n}\n\nexport class HeaderAreaTextCellEditing extends BaseTextCell {\n  private _onCopy = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    assertExists(inlineEditor);\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const text = inlineEditor.yTextString.slice(\n      inlineRange.index,\n      inlineRange.index + inlineRange.length\n    );\n\n    e.clipboardData?.setData('text/plain', text);\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  private _onCut = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    assertExists(inlineEditor);\n\n    const inlineRange = inlineEditor.getInlineRange();\n    if (!inlineRange) return;\n\n    const text = inlineEditor.yTextString.slice(\n      inlineRange.index,\n      inlineRange.index + inlineRange.length\n    );\n    inlineEditor.deleteText(inlineRange);\n    inlineEditor.setInlineRange({\n      index: inlineRange.index,\n      length: 0,\n    });\n\n    e.clipboardData?.setData('text/plain', text);\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  private _onPaste = (e: ClipboardEvent) => {\n    const inlineEditor = this.inlineEditor;\n    const inlineRange = inlineEditor?.getInlineRange();\n    if (!inlineRange) return;\n    if (e.clipboardData) {\n      try {\n        const getDeltas = (snapshot: BlockSnapshot): DeltaInsert[] => {\n          // @ts-ignore\n          const text = snapshot.props?.text?.delta;\n          return text\n            ? [...text, ...(snapshot.children?.flatMap(getDeltas) ?? [])]\n            : snapshot.children?.flatMap(getDeltas);\n        };\n        const snapshot = this.std?.clipboard?.readFromClipboard(\n          e.clipboardData\n        )[ClipboardAdapter.MIME];\n        const deltas = (\n          JSON.parse(snapshot).snapshot.content as BlockSnapshot[]\n        ).flatMap(getDeltas);\n        deltas.forEach(delta => this.insertDelta(delta));\n        return;\n      } catch (_e) {\n        //\n      }\n    }\n    const text = e.clipboardData\n      ?.getData('text/plain')\n      ?.replace(/\\r?\\n|\\r/g, '\\n');\n    if (!text) return;\n    e.preventDefault();\n    e.stopPropagation();\n    if (isValidUrl(text)) {\n      const std = this.std;\n      const result = std?.getOptional(ParseDocUrlProvider)?.parseDocUrl(text);\n      if (result) {\n        const text = ' ';\n        inlineEditor?.insertText(inlineRange, text, {\n          reference: {\n            type: 'LinkedPage',\n            pageId: result.docId,\n            params: {\n              blockIds: result.blockIds,\n              elementIds: result.elementIds,\n              mode: result.mode,\n            },\n          },\n        });\n        inlineEditor?.setInlineRange({\n          index: inlineRange.index + text.length,\n          length: 0,\n        });\n      } else {\n        inlineEditor?.insertText(inlineRange, text, {\n          link: text,\n        });\n        inlineEditor?.setInlineRange({\n          index: inlineRange.index + text.length,\n          length: 0,\n        });\n      }\n    } else {\n      inlineEditor?.insertText(inlineRange, text);\n      inlineEditor?.setInlineRange({\n        index: inlineRange.index + text.length,\n        length: 0,\n      });\n    }\n  };\n\n  override activity = false;\n\n  insertDelta = (delta: DeltaInsert) => {\n    const inlineEditor = this.inlineEditor;\n    const range = inlineEditor?.getInlineRange();\n    if (!range || !delta.insert) {\n      return;\n    }\n    inlineEditor?.insertText(range, delta.insert, delta.attributes);\n    inlineEditor?.setInlineRange({\n      index: range.index + delta.insert.length,\n      length: 0,\n    });\n  };\n\n  private get std() {\n    return this.host?.std;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const selectAll = (e: KeyboardEvent) => {\n      if (e.key === 'a' && (IS_MAC ? e.metaKey : e.ctrlKey)) {\n        e.stopPropagation();\n        e.preventDefault();\n        this.inlineEditor?.selectAll();\n      }\n    };\n    this.addEventListener('keydown', selectAll);\n    this.disposables.add(() => {\n      this.removeEventListener('keydown', selectAll);\n    });\n  }\n\n  override firstUpdated(props: Map<string, unknown>) {\n    super.firstUpdated(props);\n    if (!this.isLinkedDoc$.value) {\n      this.disposables.addFromEvent(this.richText, 'copy', this._onCopy);\n      this.disposables.addFromEvent(this.richText, 'cut', this._onCut);\n      this.disposables.addFromEvent(this.richText, 'paste', this._onPaste);\n    }\n    this.richText.updateComplete\n      .then(() => {\n        this.inlineEditor?.focusEnd();\n\n        this.disposables.add(\n          effect(() => {\n            const inlineRange = this.inlineEditor?.inlineRange$.value;\n            if (inlineRange) {\n              if (!this.isEditing) {\n                this.selectCurrentCell(true);\n              }\n            } else {\n              if (this.isEditing) {\n                this.selectCurrentCell(false);\n              }\n            }\n          })\n        );\n      })\n      .catch(console.error);\n  }\n\n  override renderBlockText() {\n    return html` <rich-text\n      .yText=\"${this.value}\"\n      .inlineEventSource=\"${this.topContenteditableElement}\"\n      .attributesSchema=\"${this.attributesSchema}\"\n      .attributeRenderer=\"${this.attributeRenderer}\"\n      .embedChecker=\"${this.inlineManager?.embedChecker}\"\n      .markdownShortcutHandler=\"${this.inlineManager?.markdownShortcutHandler}\"\n      .readonly=\"${this.readonly}\"\n      .enableClipboard=\"${false}\"\n      .verticalScrollContainerGetter=\"${() =>\n        this.topContenteditableElement?.host\n          ? getViewportElement(this.topContenteditableElement.host)\n          : null}\"\n      class=\"data-view-header-area-rich-text can-link-doc\"\n    ></rich-text>`;\n  }\n\n  override renderLinkedDoc(): TemplateResult {\n    return html` <rich-text\n      .yText=\"${this.linkedDocTitle$.value}\"\n      .inlineEventSource=\"${this.topContenteditableElement}\"\n      .readonly=\"${this.readonly}\"\n      .enableClipboard=\"${true}\"\n      .verticalScrollContainerGetter=\"${() =>\n        this.topContenteditableElement?.host\n          ? getViewportElement(this.topContenteditableElement.host)\n          : null}\"\n      class=\"data-view-header-area-rich-text\"\n    ></rich-text>`;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'data-view-header-area-text': HeaderAreaTextCell;\n    'data-view-header-area-text-editing': HeaderAreaTextCellEditing;\n  }\n}\n"]}