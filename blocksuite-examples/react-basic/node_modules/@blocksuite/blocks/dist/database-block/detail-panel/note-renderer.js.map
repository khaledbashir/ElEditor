{"version":3,"file":"note-renderer.js","sourceRoot":"","sources":["../../../src/database-block/detail-panel/note-renderer.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  DatabaseBlockModel,\n  RootBlockModel,\n} from '@blocksuite/affine-model';\nimport type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { DetailSlotProps, SingleView } from '@blocksuite/data-view';\nimport type { BaseTextAttributes } from '@blocksuite/inline';\n\nimport { REFERENCE_NODE } from '@blocksuite/affine-components/rich-text';\nimport {\n  createDefaultDoc,\n  matchFlavours,\n} from '@blocksuite/affine-shared/utils';\nimport { type EditorHost, ShadowlessElement } from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { computed } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nimport { isPureText } from '../utils/title-doc.js';\n\nexport class NoteRenderer\n  extends SignalWatcher(WithDisposable(ShadowlessElement))\n  implements DetailSlotProps\n{\n  static override styles = css`\n    database-datasource-note-renderer {\n      width: 100%;\n      --affine-editor-side-padding: 0;\n      flex: 1;\n    }\n  `;\n\n  @property({ attribute: false })\n  accessor rowId!: string;\n\n  rowText$ = computed(() => {\n    return this.databaseBlock.doc.getBlock(this.rowId)?.model?.text;\n  });\n\n  allowCreateDoc$ = computed(() => {\n    return isPureText(this.rowText$.value);\n  });\n\n  get databaseBlock(): DatabaseBlockModel {\n    return this.model;\n  }\n\n  addNote() {\n    const collection = this.host?.std.collection;\n    if (!collection) {\n      return;\n    }\n    const note = createDefaultDoc(collection);\n    if (note) {\n      this.openDoc(note.id);\n      const rowContent = this.rowText$.value?.toString();\n      this.rowText$.value?.replace(\n        0,\n        this.rowText$.value.length,\n        REFERENCE_NODE,\n        {\n          reference: {\n            type: 'LinkedPage',\n            pageId: note.id,\n          },\n        } satisfies AffineTextAttributes as BaseTextAttributes\n      );\n      collection.setDocMeta(note.id, { title: rowContent });\n      if (note.root) {\n        (note.root as RootBlockModel).title.insert(rowContent ?? '', 0);\n        note.root.children\n          .find(child => child.flavour === 'affine:note')\n          ?.children.find(block =>\n            matchFlavours(block, [\n              'affine:paragraph',\n              'affine:list',\n              'affine:code',\n            ])\n          );\n      }\n    }\n  }\n\n  protected override render(): unknown {\n    return html`\n      <div\n        style=\"height: 1px;max-width: var(--affine-editor-width);background-color: var(--affine-border-color);margin: auto;margin-bottom: 16px\"\n      ></div>\n      ${this.renderNote()}\n    `;\n  }\n\n  renderNote() {\n    if (this.allowCreateDoc$.value) {\n      return html` <div>\n        <div\n          @click=\"${this.addNote}\"\n          style=\"max-width: var(--affine-editor-width);margin: auto;cursor: pointer;color: var(--affine-text-disable-color)\"\n        >\n          Click to create a linked doc in center peek.\n        </div>\n      </div>`;\n    }\n    return;\n  }\n\n  @property({ attribute: false })\n  accessor host!: EditorHost;\n\n  @property({ attribute: false })\n  accessor model!: DatabaseBlockModel;\n\n  @property({ attribute: false })\n  accessor openDoc!: (docId: string) => void;\n\n  @property({ attribute: false })\n  accessor view!: SingleView;\n}\n"]}