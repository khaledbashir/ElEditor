{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/database-block/components/title/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Text } from '@blocksuite/store';\n\nimport { stopPropagation } from '@blocksuite/affine-shared/utils';\nimport { ShadowlessElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { css, html } from 'lit';\nimport { property, query, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { DatabaseBlockComponent } from '../../database-block.js';\n\nexport class DatabaseTitle extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-database-title {\n      position: relative;\n      flex: 1;\n      font-family: inherit;\n      font-size: 20px;\n      line-height: 28px;\n      font-weight: 600;\n      color: var(--affine-text-primary-color);\n      overflow: hidden;\n    }\n\n    .affine-database-title textarea {\n      font-size: inherit;\n      line-height: inherit;\n      font-weight: inherit;\n      letter-spacing: inherit;\n      font-family: inherit;\n      border: none;\n      background-color: transparent;\n      padding: 0;\n      position: absolute;\n      left: 0;\n      top: 0;\n      bottom: 0;\n      right: 0;\n      outline: none;\n      resize: none;\n      scrollbar-width: none;\n    }\n\n    .affine-database-title .text {\n      user-select: none;\n      opacity: 0;\n      white-space: pre-wrap;\n    }\n\n    .affine-database-title[data-title-focus='false'] textarea {\n      opacity: 0;\n    }\n\n    .affine-database-title[data-title-focus='false'] .text {\n      text-overflow: ellipsis;\n      overflow: hidden;\n      opacity: 1;\n      white-space: pre;\n    }\n\n    .affine-database-title [data-title-empty='true']::before {\n      content: 'Untitled';\n      position: absolute;\n      pointer-events: none;\n      color: var(--affine-text-primary-color);\n    }\n\n    .affine-database-title [data-title-focus='true']::before {\n      color: var(--affine-placeholder-color);\n    }\n  `;\n\n  private compositionEnd = () => {\n    this.titleText.replace(0, this.titleText.length, this.input.value);\n  };\n\n  private onBlur = () => {\n    this.isFocus = false;\n  };\n\n  private onFocus = () => {\n    this.isFocus = true;\n    if (this.database?.viewSelection$?.value) {\n      this.database?.setSelection(undefined);\n    }\n  };\n\n  private onInput = (e: InputEvent) => {\n    this.text = this.input.value;\n    if (!e.isComposing) {\n      this.titleText.replace(0, this.titleText.length, this.input.value);\n    }\n  };\n\n  private onKeyDown = (event: KeyboardEvent) => {\n    event.stopPropagation();\n    if (event.key === 'Enter' && !event.isComposing) {\n      event.preventDefault();\n      this.onPressEnterKey?.();\n      return;\n    }\n  };\n\n  updateText = () => {\n    if (!this.isFocus) {\n      this.input.value = this.titleText.toString();\n      this.text = this.input.value;\n    }\n  };\n\n  get database() {\n    return this.closest<DatabaseBlockComponent>('affine-database');\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    requestAnimationFrame(() => {\n      this.updateText();\n    });\n    this.titleText.yText.observe(this.updateText);\n    this.disposables.add(() => {\n      this.titleText.yText.unobserve(this.updateText);\n    });\n  }\n\n  override render() {\n    const isEmpty = !this.text;\n\n    const classList = classMap({\n      'affine-database-title': true,\n      ellipsis: !this.isFocus,\n    });\n    const untitledStyle = styleMap({\n      height: isEmpty ? 'auto' : 0,\n      opacity: isEmpty && !this.isFocus ? 1 : 0,\n    });\n    return html` <div\n      class=\"${classList}\"\n      data-title-empty=\"${isEmpty}\"\n      data-title-focus=\"${this.isFocus}\"\n    >\n      <div class=\"text\" style=\"${untitledStyle}\">Untitled</div>\n      <div class=\"text\">${this.text}</div>\n      <textarea\n        .disabled=\"${this.readonly}\"\n        @input=\"${this.onInput}\"\n        @keydown=\"${this.onKeyDown}\"\n        @copy=\"${stopPropagation}\"\n        @paste=\"${stopPropagation}\"\n        @focus=\"${this.onFocus}\"\n        @blur=\"${this.onBlur}\"\n        @compositionend=\"${this.compositionEnd}\"\n        data-block-is-database-title=\"true\"\n        title=\"${this.titleText.toString()}\"\n      ></textarea>\n    </div>`;\n  }\n\n  @query('textarea')\n  private accessor input!: HTMLTextAreaElement;\n\n  @state()\n  accessor isComposing = false;\n\n  @state()\n  private accessor isFocus = false;\n\n  @property({ attribute: false })\n  accessor onPressEnterKey: (() => void) | undefined = undefined;\n\n  @property({ attribute: false })\n  accessor readonly!: boolean;\n\n  @state()\n  private accessor text = '';\n\n  @property({ attribute: false })\n  accessor titleText!: Text;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database-title': DatabaseTitle;\n  }\n}\n"]}