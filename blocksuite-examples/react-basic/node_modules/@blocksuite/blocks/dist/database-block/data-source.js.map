{"version":3,"file":"data-source.js","sourceRoot":"","sources":["../../src/database-block/data-source.ts"],"names":[],"mappings":"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","sourcesContent":["import type { DatabaseBlockModel } from '@blocksuite/affine-model';\nimport type { EditorHost } from '@blocksuite/block-std';\n\nimport {\n  insertPositionToIndex,\n  type InsertToPosition,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  type DatabaseFlags,\n  DataSourceBase,\n  type DataViewDataType,\n  getTagColor,\n  type PropertyMetaConfig,\n  type TypeInstance,\n  type ViewManager,\n  ViewManagerBase,\n  type ViewMeta,\n} from '@blocksuite/data-view';\nimport { propertyPresets } from '@blocksuite/data-view/property-presets';\nimport { IS_MOBILE } from '@blocksuite/global/env';\nimport { assertExists } from '@blocksuite/global/utils';\nimport { type BlockModel, nanoid, Text } from '@blocksuite/store';\nimport { computed, type ReadonlySignal } from '@preact/signals-core';\n\nimport { getIcon } from './block-icons.js';\nimport {\n  databaseBlockAllPropertyMap,\n  databaseBlockPropertyList,\n  databasePropertyConverts,\n} from './properties/index.js';\nimport { titlePurePropertyConfig } from './properties/title/define.js';\nimport {\n  addProperty,\n  applyCellsUpdate,\n  applyPropertyUpdate,\n  copyCellsByProperty,\n  deleteRows,\n  deleteView,\n  duplicateView,\n  findPropertyIndex,\n  getCell,\n  getProperty,\n  moveViewTo,\n  updateCell,\n  updateCells,\n  updateProperty,\n  updateView,\n} from './utils/block-utils.js';\nimport {\n  databaseBlockViewConverts,\n  databaseBlockViewMap,\n  databaseBlockViews,\n} from './views/index.js';\n\nexport class DatabaseBlockDataSource extends DataSourceBase {\n  private _batch = 0;\n\n  private readonly _model: DatabaseBlockModel;\n\n  override featureFlags$: ReadonlySignal<DatabaseFlags> = computed(() => {\n    return {\n      enable_number_formatting:\n        this.doc.awarenessStore.getFlag('enable_database_number_formatting') ??\n        false,\n    };\n  });\n\n  properties$: ReadonlySignal<string[]> = computed(() => {\n    return this._model.columns$.value.map(column => column.id);\n  });\n\n  readonly$: ReadonlySignal<boolean> = computed(() => {\n    return (\n      this._model.doc.readonly ||\n      // TODO(@L-Sun): use block level readonly\n      IS_MOBILE\n    );\n  });\n\n  rows$: ReadonlySignal<string[]> = computed(() => {\n    return this._model.children.map(v => v.id);\n  });\n\n  viewConverts = databaseBlockViewConverts;\n\n  viewDataList$: ReadonlySignal<DataViewDataType[]> = computed(() => {\n    return this._model.views$.value as DataViewDataType[];\n  });\n\n  override viewManager: ViewManager = new ViewManagerBase(this);\n\n  viewMetas = databaseBlockViews;\n\n  get doc() {\n    return this._model.doc;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get propertyMetas(): PropertyMetaConfig<any, any, any>[] {\n    return databaseBlockPropertyList;\n  }\n\n  constructor(model: DatabaseBlockModel) {\n    super();\n    this._model = model;\n  }\n\n  private _runCapture() {\n    if (this._batch) {\n      return;\n    }\n\n    this._batch = requestAnimationFrame(() => {\n      this.doc.captureSync();\n      this._batch = 0;\n    });\n  }\n\n  private getModelById(rowId: string): BlockModel | undefined {\n    return this._model.children[this._model.childMap.value.get(rowId) ?? -1];\n  }\n\n  private newPropertyName() {\n    let i = 1;\n    while (\n      this._model.columns$.value.some(column => column.name === `Column ${i}`)\n    ) {\n      i++;\n    }\n    return `Column ${i}`;\n  }\n\n  cellValueChange(rowId: string, propertyId: string, value: unknown): void {\n    this._runCapture();\n\n    const type = this.propertyTypeGet(propertyId);\n    const update = this.propertyMetaGet(type).config.valueUpdate;\n    let newValue = value;\n    if (update) {\n      const old = this.cellValueGet(rowId, propertyId);\n      newValue = update({\n        value: old,\n        data: this.propertyDataGet(propertyId),\n        dataSource: this,\n        newValue: value,\n      });\n    }\n    if (type === 'title' && newValue instanceof Text) {\n      this._model.doc.transact(() => {\n        this._model.text?.clear();\n        this._model.text?.join(newValue);\n      });\n      return;\n    }\n    if (this._model.columns$.value.some(v => v.id === propertyId)) {\n      updateCell(this._model, rowId, {\n        columnId: propertyId,\n        value: newValue,\n      });\n      applyCellsUpdate(this._model);\n    }\n  }\n\n  cellValueGet(rowId: string, propertyId: string): unknown {\n    if (propertyId === 'type') {\n      const model = this.getModelById(rowId);\n      if (!model) {\n        return;\n      }\n      return getIcon(model);\n    }\n    const type = this.propertyTypeGet(propertyId);\n    if (type === 'title') {\n      const model = this.getModelById(rowId);\n      return model?.text;\n    }\n    return getCell(this._model, rowId, propertyId)?.value;\n  }\n\n  propertyAdd(insertToPosition: InsertToPosition, type?: string): string {\n    this.doc.captureSync();\n    const result = addProperty(\n      this._model,\n      insertToPosition,\n      databaseBlockAllPropertyMap[\n        type ?? propertyPresets.multiSelectPropertyConfig.type\n      ].create(this.newPropertyName())\n    );\n    applyPropertyUpdate(this._model);\n    return result;\n  }\n\n  propertyDataGet(propertyId: string): Record<string, unknown> {\n    return (\n      this._model.columns$.value.find(v => v.id === propertyId)?.data ?? {}\n    );\n  }\n\n  propertyDataSet(propertyId: string, data: Record<string, unknown>): void {\n    this._runCapture();\n\n    updateProperty(this._model, propertyId, () => ({ data }));\n    applyPropertyUpdate(this._model);\n  }\n\n  propertyDataTypeGet(propertyId: string): TypeInstance | undefined {\n    const data = this._model.columns$.value.find(v => v.id === propertyId);\n    if (!data) {\n      return;\n    }\n    const meta = this.propertyMetaGet(data.type);\n    return meta.config.type({\n      data: data.data,\n      dataSource: this,\n    });\n  }\n\n  propertyDelete(id: string): void {\n    this.doc.captureSync();\n    const index = findPropertyIndex(this._model, id);\n    if (index < 0) return;\n\n    this.doc.transact(() => {\n      this._model.columns = this._model.columns.filter((_, i) => i !== index);\n    });\n  }\n\n  propertyDuplicate(propertyId: string): string {\n    this.doc.captureSync();\n    const currentSchema = getProperty(this._model, propertyId);\n    assertExists(currentSchema);\n    const { id: copyId, ...nonIdProps } = currentSchema;\n    const names = new Set(this._model.columns$.value.map(v => v.name));\n    let index = 1;\n    while (names.has(`${nonIdProps.name}(${index})`)) {\n      index++;\n    }\n    const schema = { ...nonIdProps, name: `${nonIdProps.name}(${index})` };\n    const id = addProperty(\n      this._model,\n      {\n        before: false,\n        id: propertyId,\n      },\n      schema\n    );\n    copyCellsByProperty(this._model, copyId, id);\n    applyPropertyUpdate(this._model);\n    return id;\n  }\n\n  propertyMetaGet(type: string): PropertyMetaConfig {\n    return databaseBlockAllPropertyMap[type];\n  }\n\n  propertyNameGet(propertyId: string): string {\n    if (propertyId === 'type') {\n      return 'Block Type';\n    }\n    return (\n      this._model.columns$.value.find(v => v.id === propertyId)?.name ?? ''\n    );\n  }\n\n  propertyNameSet(propertyId: string, name: string): void {\n    this.doc.captureSync();\n    updateProperty(this._model, propertyId, () => ({ name }));\n    applyPropertyUpdate(this._model);\n  }\n\n  override propertyReadonlyGet(propertyId: string): boolean {\n    if (propertyId === 'type') return true;\n    return false;\n  }\n\n  propertyTypeGet(propertyId: string): string {\n    if (propertyId === 'type') {\n      return 'image';\n    }\n    return (\n      this._model.columns$.value.find(v => v.id === propertyId)?.type ?? ''\n    );\n  }\n\n  propertyTypeSet(propertyId: string, toType: string): void {\n    const currentType = this.propertyTypeGet(propertyId);\n    const currentData = this.propertyDataGet(propertyId);\n    const rows = this.rows$.value;\n    const currentCells = rows.map(rowId =>\n      this.cellValueGet(rowId, propertyId)\n    );\n    const convertFunction = databasePropertyConverts.find(\n      v => v.from === currentType && v.to === toType\n    )?.convert;\n    const result = convertFunction?.(\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      currentData as any,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      currentCells as any\n    ) ?? {\n      property: databaseBlockAllPropertyMap[toType].config.defaultData(),\n      cells: currentCells.map(() => undefined),\n    };\n    this.doc.captureSync();\n    updateProperty(this._model, propertyId, () => ({\n      type: toType,\n      data: result.property,\n    }));\n    const cells: Record<string, unknown> = {};\n    currentCells.forEach((value, i) => {\n      if (value != null || result.cells[i] != null) {\n        cells[rows[i]] = result.cells[i];\n      }\n    });\n    updateCells(this._model, propertyId, cells);\n    applyPropertyUpdate(this._model);\n  }\n\n  rowAdd(insertPosition: InsertToPosition | number): string {\n    this.doc.captureSync();\n    const index =\n      typeof insertPosition === 'number'\n        ? insertPosition\n        : insertPositionToIndex(insertPosition, this._model.children);\n    return this.doc.addBlock('affine:paragraph', {}, this._model.id, index);\n  }\n\n  rowDelete(ids: string[]): void {\n    this.doc.captureSync();\n    for (const id of ids) {\n      const block = this.doc.getBlock(id);\n      if (block) {\n        this.doc.deleteBlock(block.model);\n      }\n    }\n    deleteRows(this._model, ids);\n  }\n\n  rowMove(rowId: string, position: InsertToPosition): void {\n    const model = this.doc.getBlockById(rowId);\n    if (model) {\n      const index = insertPositionToIndex(position, this._model.children);\n      const target = this._model.children[index];\n      if (target?.id === rowId) {\n        return;\n      }\n      this.doc.moveBlocks([model], this._model, target);\n    }\n  }\n\n  viewDataAdd(viewData: DataViewDataType): string {\n    this._model.doc.captureSync();\n    this._model.doc.transact(() => {\n      this._model.views = [...this._model.views, viewData];\n    });\n    return viewData.id;\n  }\n\n  viewDataDelete(viewId: string): void {\n    this._model.doc.captureSync();\n    deleteView(this._model, viewId);\n  }\n\n  viewDataDuplicate(id: string): string {\n    return duplicateView(this._model, id);\n  }\n\n  viewDataGet(viewId: string): DataViewDataType {\n    return this.viewDataList$.value.find(data => data.id === viewId)!;\n  }\n\n  viewDataMoveTo(id: string, position: InsertToPosition): void {\n    moveViewTo(this._model, id, position);\n  }\n\n  viewDataUpdate<ViewData extends DataViewDataType>(\n    id: string,\n    updater: (data: ViewData) => Partial<ViewData>\n  ): void {\n    updateView(this._model, id, updater);\n  }\n\n  viewMetaGet(type: string): ViewMeta {\n    return databaseBlockViewMap[type];\n  }\n\n  viewMetaGetById(viewId: string): ViewMeta {\n    const view = this.viewDataGet(viewId);\n    return this.viewMetaGet(view.mode);\n  }\n}\n\nexport const databaseViewAddView = (\n  model: DatabaseBlockModel,\n  viewType: string\n) => {\n  const dataSource = new DatabaseBlockDataSource(model);\n  dataSource.viewManager.viewAdd(viewType);\n};\nexport const databaseViewInitEmpty = (\n  model: DatabaseBlockModel,\n  viewType: string\n) => {\n  addProperty(\n    model,\n    'start',\n    titlePurePropertyConfig.create(titlePurePropertyConfig.config.name)\n  );\n  databaseViewAddView(model, viewType);\n};\nexport const databaseViewInitConvert = (\n  model: DatabaseBlockModel,\n  viewType: string\n) => {\n  addProperty(\n    model,\n    'end',\n    propertyPresets.multiSelectPropertyConfig.create('Tag', { options: [] })\n  );\n  databaseViewInitEmpty(model, viewType);\n};\nexport const databaseViewInitTemplate = (\n  model: DatabaseBlockModel,\n  viewType: string\n) => {\n  const ids = [nanoid(), nanoid(), nanoid()];\n  const statusId = addProperty(\n    model,\n    'end',\n    propertyPresets.selectPropertyConfig.create('Status', {\n      options: [\n        {\n          id: ids[0],\n          color: getTagColor(),\n          value: 'TODO',\n        },\n        {\n          id: ids[1],\n          color: getTagColor(),\n          value: 'In Progress',\n        },\n        {\n          id: ids[2],\n          color: getTagColor(),\n          value: 'Done',\n        },\n      ],\n    })\n  );\n  for (let i = 0; i < 4; i++) {\n    const rowId = model.doc.addBlock(\n      'affine:paragraph',\n      {\n        text: new model.doc.Text(`Task ${i + 1}`),\n      },\n      model.id\n    );\n    updateCell(model, rowId, {\n      columnId: statusId,\n      value: ids[i],\n    });\n  }\n  databaseViewInitEmpty(model, viewType);\n};\nexport const convertToDatabase = (host: EditorHost, viewType: string) => {\n  const [_, ctx] = host.std.command\n    .chain()\n    .getSelectedModels({\n      types: ['block', 'text'],\n    })\n    .run();\n  const { selectedModels } = ctx;\n  if (!selectedModels || selectedModels.length === 0) return;\n\n  host.doc.captureSync();\n\n  const parentModel = host.doc.getParent(selectedModels[0]);\n  if (!parentModel) {\n    return;\n  }\n\n  const id = host.doc.addBlock(\n    'affine:database',\n    {},\n    parentModel,\n    parentModel.children.indexOf(selectedModels[0])\n  );\n  const databaseModel = host.doc.getBlock(id)?.model as\n    | DatabaseBlockModel\n    | undefined;\n  if (!databaseModel) {\n    return;\n  }\n  databaseViewInitConvert(databaseModel, viewType);\n  applyPropertyUpdate(databaseModel);\n  host.doc.moveBlocks(selectedModels, databaseModel);\n\n  const selectionManager = host.selection;\n  selectionManager.clear();\n};\n"]}