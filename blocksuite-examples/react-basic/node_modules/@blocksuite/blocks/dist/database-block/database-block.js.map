{"version":3,"file":"database-block.js","sourceRoot":"","sources":["../../src/database-block/database-block.ts"],"names":[],"mappings":"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","sourcesContent":["import type { DatabaseBlockModel } from '@blocksuite/affine-model';\n\nimport { CaptionedBlockComponent } from '@blocksuite/affine-components/caption';\nimport {\n  menu,\n  popMenu,\n  popupTargetFromElement,\n} from '@blocksuite/affine-components/context-menu';\nimport { DragIndicator } from '@blocksuite/affine-components/drag-indicator';\nimport { PeekViewProvider } from '@blocksuite/affine-components/peek';\nimport { toast } from '@blocksuite/affine-components/toast';\nimport { NOTE_SELECTOR } from '@blocksuite/affine-shared/consts';\nimport {\n  DocModeProvider,\n  NotificationProvider,\n  type TelemetryEventMap,\n  TelemetryProvider,\n} from '@blocksuite/affine-shared/services';\nimport { RANGE_SYNC_EXCLUDE_ATTR } from '@blocksuite/block-std';\nimport {\n  createRecordDetail,\n  createUniComponentFromWebComponent,\n  DatabaseSelection,\n  DataView,\n  dataViewCommonStyle,\n  type DataViewInstance,\n  type DataViewProps,\n  type DataViewSelection,\n  type DataViewWidget,\n  type DataViewWidgetProps,\n  defineUniComponent,\n  renderUniLit,\n  type SingleView,\n  uniMap,\n} from '@blocksuite/data-view';\nimport { widgetPresets } from '@blocksuite/data-view/widget-presets';\nimport { Rect } from '@blocksuite/global/utils';\nimport {\n  CopyIcon,\n  DeleteIcon,\n  MoreHorizontalIcon,\n} from '@blocksuite/icons/lit';\nimport { Slice } from '@blocksuite/store';\nimport { autoUpdate } from '@floating-ui/dom';\nimport { computed, signal } from '@preact/signals-core';\nimport { css, html, nothing, unsafeCSS } from 'lit';\n\nimport type { NoteBlockComponent } from '../note-block/index.js';\nimport type { DatabaseOptionsConfig } from './config.js';\nimport type { DatabaseBlockService } from './database-service.js';\n\nimport { EdgelessRootBlockComponent } from '../root-block/index.js';\nimport { getDropResult } from '../root-block/widgets/drag-handle/utils.js';\nimport { popSideDetail } from './components/layout.js';\nimport { HostContextKey } from './context/host-context.js';\nimport { DatabaseBlockDataSource } from './data-source.js';\nimport { BlockRenderer } from './detail-panel/block-renderer.js';\nimport { NoteRenderer } from './detail-panel/note-renderer.js';\nimport { currentViewStorage } from './utils/current-view.js';\nimport { getSingleDocIdFromText } from './utils/title-doc.js';\n\nexport class DatabaseBlockComponent extends CaptionedBlockComponent<\n  DatabaseBlockModel,\n  DatabaseBlockService\n> {\n  static override styles = css`\n    ${unsafeCSS(dataViewCommonStyle('affine-database'))}\n    affine-database {\n      display: block;\n      border-radius: 8px;\n      background-color: var(--affine-background-primary-color);\n      padding: 8px;\n      margin: 8px -8px -8px;\n    }\n\n    .database-block-selected {\n      background-color: var(--affine-hover-color);\n      border-radius: 4px;\n    }\n\n    .database-ops {\n      padding: 2px;\n      border-radius: 4px;\n      display: flex;\n      cursor: pointer;\n      align-items: center;\n      height: max-content;\n    }\n\n    .database-ops svg {\n      width: 16px;\n      height: 16px;\n      color: var(--affine-icon-color);\n    }\n\n    .database-ops:hover {\n      background-color: var(--affine-hover-color);\n    }\n\n    @media print {\n      .database-ops {\n        display: none;\n      }\n\n      .database-header-bar {\n        display: none !important;\n      }\n    }\n  `;\n\n  private _clickDatabaseOps = (e: MouseEvent) => {\n    const options = this.optionsConfig.configure(this.model, {\n      items: [\n        menu.input({\n          initialValue: this.model.title.toString(),\n          placeholder: 'Untitled',\n          onChange: text => {\n            this.model.title.replace(0, this.model.title.length, text);\n          },\n        }),\n        menu.action({\n          prefix: CopyIcon(),\n          name: 'Copy',\n          select: () => {\n            const slice = Slice.fromModels(this.doc, [this.model]);\n            this.std.clipboard\n              .copySlice(slice)\n              .then(() => {\n                toast(this.host, 'Copied to clipboard');\n              })\n              .catch(console.error);\n          },\n        }),\n        menu.group({\n          items: [\n            menu.action({\n              prefix: DeleteIcon(),\n              class: {\n                'delete-item': true,\n              },\n              name: 'Delete Database',\n              select: () => {\n                this.model.children.slice().forEach(block => {\n                  this.doc.deleteBlock(block);\n                });\n                this.doc.deleteBlock(this.model);\n              },\n            }),\n          ],\n        }),\n      ],\n    });\n\n    popMenu(popupTargetFromElement(e.currentTarget as HTMLElement), {\n      options,\n    });\n  };\n\n  private _dataSource?: DatabaseBlockDataSource;\n\n  private dataView = new DataView();\n\n  private renderTitle = (dataViewMethod: DataViewInstance) => {\n    const addRow = () => dataViewMethod.addRow?.('start');\n    return html` <affine-database-title\n      style=\"overflow: hidden\"\n      .titleText=\"${this.model.title}\"\n      .readonly=\"${this.dataSource.readonly$.value}\"\n      .onPressEnterKey=\"${addRow}\"\n    ></affine-database-title>`;\n  };\n\n  _bindHotkey: DataViewProps['bindHotkey'] = hotkeys => {\n    return {\n      dispose: this.host.event.bindHotkey(hotkeys, {\n        blockId: this.topContenteditableElement?.blockId ?? this.blockId,\n      }),\n    };\n  };\n\n  _handleEvent: DataViewProps['handleEvent'] = (name, handler) => {\n    return {\n      dispose: this.host.event.add(name, handler, {\n        blockId: this.blockId,\n      }),\n    };\n  };\n\n  createTemplate = (\n    data: {\n      view: SingleView;\n      rowId: string;\n    },\n    openDoc: (docId: string) => void\n  ) => {\n    return createRecordDetail({\n      ...data,\n      openDoc,\n      detail: {\n        header: uniMap(\n          createUniComponentFromWebComponent(BlockRenderer),\n          props => ({\n            ...props,\n            host: this.host,\n          })\n        ),\n        note: uniMap(\n          createUniComponentFromWebComponent(NoteRenderer),\n          props => ({\n            ...props,\n            model: this.model,\n            host: this.host,\n          })\n        ),\n      },\n    });\n  };\n\n  headerWidget: DataViewWidget = defineUniComponent(\n    (props: DataViewWidgetProps) => {\n      return html`\n        <div style=\"margin-bottom: 16px;display:flex;flex-direction: column\">\n          <div\n            style=\"display:flex;gap:12px;margin-bottom: 8px;align-items: center\"\n          >\n            ${this.renderTitle(props.dataViewInstance)}\n            ${this.renderDatabaseOps()}\n          </div>\n          <div\n            style=\"display:flex;align-items:center;justify-content: space-between;gap: 12px\"\n            class=\"database-header-bar\"\n          >\n            <div style=\"flex:1\">\n              ${renderUniLit(widgetPresets.viewBar, {\n                ...props,\n                onChangeView: id => {\n                  currentViewStorage.setCurrentView(this.blockId, id);\n                },\n              })}\n            </div>\n            ${renderUniLit(this.toolsWidget, props)}\n          </div>\n          ${renderUniLit(widgetPresets.quickSettingBar, props)}\n        </div>\n      `;\n    }\n  );\n\n  indicator = new DragIndicator();\n\n  onDrag = (evt: MouseEvent, id: string): (() => void) => {\n    const result = getDropResult(evt);\n    if (result && result.rect) {\n      document.body.append(this.indicator);\n      this.indicator.rect = Rect.fromLWTH(\n        result.rect.left,\n        result.rect.width,\n        result.rect.top,\n        result.rect.height\n      );\n      return () => {\n        this.indicator.remove();\n        const model = this.doc.getBlock(id)?.model;\n        const target = this.doc.getBlock(result.dropBlockId)?.model ?? null;\n        let parent = this.doc.getParent(result.dropBlockId);\n        const shouldInsertIn = result.dropType === 'in';\n        if (shouldInsertIn) {\n          parent = target;\n        }\n        if (model && target && parent) {\n          if (shouldInsertIn) {\n            this.doc.moveBlocks([model], parent);\n          } else {\n            this.doc.moveBlocks(\n              [model],\n              parent,\n              target,\n              result.dropType === 'before'\n            );\n          }\n        }\n      };\n    }\n    this.indicator.remove();\n    return () => {};\n  };\n\n  setSelection = (selection: DataViewSelection | undefined) => {\n    if (selection) {\n      getSelection()?.removeAllRanges();\n    }\n    this.selection.setGroup(\n      'note',\n      selection\n        ? [\n            new DatabaseSelection({\n              blockId: this.blockId,\n              viewSelection: selection,\n            }),\n          ]\n        : []\n    );\n  };\n\n  toolsWidget: DataViewWidget = widgetPresets.createTools({\n    table: [\n      widgetPresets.tools.filter,\n      widgetPresets.tools.sort,\n      widgetPresets.tools.search,\n      widgetPresets.tools.viewOptions,\n      widgetPresets.tools.tableAddRow,\n    ],\n    kanban: [\n      widgetPresets.tools.filter,\n      widgetPresets.tools.sort,\n      widgetPresets.tools.search,\n      widgetPresets.tools.viewOptions,\n      widgetPresets.tools.tableAddRow,\n    ],\n  });\n\n  viewSelection$ = computed(() => {\n    const databaseSelection = this.selection.value.find(\n      (selection): selection is DatabaseSelection => {\n        if (selection.blockId !== this.blockId) {\n          return false;\n        }\n        return selection instanceof DatabaseSelection;\n      }\n    );\n    return databaseSelection?.viewSelection;\n  });\n\n  virtualPadding$ = signal(0);\n\n  get dataSource(): DatabaseBlockDataSource {\n    if (!this._dataSource) {\n      this._dataSource = new DatabaseBlockDataSource(this.model);\n      this._dataSource.contextSet(HostContextKey, this.host);\n      const id = currentViewStorage.getCurrentView(this.model.id);\n      if (id) {\n        this.dataSource.viewManager.setCurrentView(id);\n      }\n    }\n    return this._dataSource;\n  }\n\n  get optionsConfig(): DatabaseOptionsConfig {\n    return {\n      configure: (_model, options) => options,\n      ...this.std.getConfig('affine:page')?.databaseOptions,\n    };\n  }\n\n  override get topContenteditableElement() {\n    if (this.rootComponent instanceof EdgelessRootBlockComponent) {\n      const note = this.closest<NoteBlockComponent>(NOTE_SELECTOR);\n      return note;\n    }\n    return this.rootComponent;\n  }\n\n  get view() {\n    return this.dataView.expose;\n  }\n\n  private renderDatabaseOps() {\n    if (this.dataSource.readonly$.value) {\n      return nothing;\n    }\n    return html` <div class=\"database-ops\" @click=\"${this._clickDatabaseOps}\">\n      ${MoreHorizontalIcon()}\n    </div>`;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.setAttribute(RANGE_SYNC_EXCLUDE_ATTR, 'true');\n    this.listenFullWidthChange();\n  }\n\n  listenFullWidthChange() {\n    if (!this.doc.awarenessStore.getFlag('enable_database_full_width')) {\n      return;\n    }\n    if (this.std.get(DocModeProvider).getEditorMode() === 'edgeless') {\n      return;\n    }\n    this.disposables.add(\n      autoUpdate(this.host, this, () => {\n        const padding =\n          this.getBoundingClientRect().left -\n          this.host.getBoundingClientRect().left;\n        this.virtualPadding$.value = Math.max(0, padding - 72);\n      })\n    );\n  }\n\n  override renderBlock() {\n    const peekViewService = this.std.getOptional(PeekViewProvider);\n    const telemetryService = this.std.getOptional(TelemetryProvider);\n    return html`\n      <div\n        contenteditable=\"false\"\n        style=\"position: relative;background-color: var(--affine-background-primary-color);border-radius: 4px\"\n      >\n        ${this.dataView.render({\n          virtualPadding$: this.virtualPadding$,\n          bindHotkey: this._bindHotkey,\n          handleEvent: this._handleEvent,\n          selection$: this.viewSelection$,\n          setSelection: this.setSelection,\n          dataSource: this.dataSource,\n          headerWidget: this.headerWidget,\n          onDrag: this.onDrag,\n          clipboard: this.std.clipboard,\n          notification: {\n            toast: message => {\n              const notification = this.std.getOptional(NotificationProvider);\n              if (notification) {\n                notification.toast(message);\n              } else {\n                toast(this.host, message);\n              }\n            },\n          },\n          eventTrace: (key, params) => {\n            telemetryService?.track(key, {\n              ...(params as TelemetryEventMap[typeof key]),\n              blockId: this.blockId,\n            });\n          },\n          detailPanelConfig: {\n            openDetailPanel: (target, data) => {\n              if (peekViewService) {\n                const openDoc = (docId: string) => {\n                  return peekViewService.peek({\n                    docId,\n                    databaseId: this.blockId,\n                    databaseDocId: this.model.doc.id,\n                    databaseRowId: data.rowId,\n                    target: this,\n                  });\n                };\n                const doc = getSingleDocIdFromText(\n                  this.model.doc.getBlock(data.rowId)?.model?.text\n                );\n                if (doc) {\n                  return openDoc(doc);\n                }\n                const abort = new AbortController();\n                return new Promise<void>(focusBack => {\n                  peekViewService\n                    .peek(\n                      {\n                        target,\n                        template: this.createTemplate(data, docId => {\n                          // abort.abort();\n                          openDoc(docId).then(focusBack).catch(focusBack);\n                        }),\n                      },\n                      { abortSignal: abort.signal }\n                    )\n                    .then(focusBack)\n                    .catch(focusBack);\n                });\n              } else {\n                return popSideDetail(\n                  this.createTemplate(data, () => {\n                    //\n                  })\n                );\n              }\n            },\n          },\n        })}\n      </div>\n    `;\n  }\n\n  override accessor useZeroWidth = true;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-database': DatabaseBlockComponent;\n  }\n}\n"]}