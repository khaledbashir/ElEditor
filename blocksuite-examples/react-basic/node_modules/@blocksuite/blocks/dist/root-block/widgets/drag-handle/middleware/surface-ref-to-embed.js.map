{"version":3,"file":"surface-ref-to-embed.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/drag-handle/middleware/surface-ref-to-embed.ts"],"names":[],"mappings":"AAGA,MAAM,CAAC,MAAM,iBAAiB,GAC5B,CAAC,GAAkB,EAAiB,EAAE,CACtC,CAAC,EAAE,KAAK,EAAE,UAAU,EAAE,EAAE,EAAE;IACxB,IAAI,MAAM,GAAkB,IAAI,CAAC;IACjC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE;QAC9B,IAAI,OAAO,CAAC,IAAI,KAAK,OAAO,EAAE,CAAC;YAC7B,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;QACnC,CAAC;IACH,CAAC,CAAC,CAAC;IACH,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE;QAC9B,IACE,MAAM;YACN,OAAO,CAAC,IAAI,KAAK,OAAO;YACxB,OAAO,CAAC,QAAQ,CAAC,OAAO,KAAK,oBAAoB;YACjD,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,EACtC,CAAC;YACD,MAAM,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC/B,OAAO,CAAC,QAAQ,CAAC,EAAE,GAAG,UAAU,CAAC,WAAW,EAAE,CAAC;YAC/C,OAAO,CAAC,QAAQ,CAAC,OAAO,GAAG,yBAAyB,CAAC;YACrD,OAAO,CAAC,QAAQ,CAAC,KAAK,GAAG;gBACvB,OAAO,EAAE,EAAE;gBACX,MAAM;aACP,CAAC;QACJ,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import type { BlockStdScope } from '@blocksuite/block-std';\nimport type { JobMiddleware } from '@blocksuite/store';\n\nexport const surfaceRefToEmbed =\n  (std: BlockStdScope): JobMiddleware =>\n  ({ slots, collection }) => {\n    let pageId: string | null = null;\n    slots.beforeImport.on(payload => {\n      if (payload.type === 'slice') {\n        pageId = payload.snapshot.pageId;\n      }\n    });\n    slots.beforeImport.on(payload => {\n      if (\n        pageId &&\n        payload.type === 'block' &&\n        payload.snapshot.flavour === 'affine:surface-ref' &&\n        !std.doc.hasBlock(payload.snapshot.id)\n      ) {\n        const id = payload.snapshot.id;\n        payload.snapshot.id = collection.idGenerator();\n        payload.snapshot.flavour = 'affine:embed-linked-doc';\n        payload.snapshot.props = {\n          blockId: id,\n          pageId,\n        };\n      }\n    });\n  };\n"]}