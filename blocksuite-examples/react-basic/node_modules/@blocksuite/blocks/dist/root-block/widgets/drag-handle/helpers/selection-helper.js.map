{"version":3,"file":"selection-helper.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/drag-handle/helpers/selection-helper.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,kBAAkB,EAAE,MAAM,iCAAiC,CAAC;AAIrE,MAAM,OAAO,eAAe;IAqC1B,IAAI,uBAAuB;QACzB,OAAO,IAAI,CAAC,cAAc;aACvB,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;aAC1D,MAAM,CAAC,CAAC,KAAK,EAA2B,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;IACzD,CAAC;IAED,IAAI,gBAAgB;QAClB,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IACzD,CAAC;IAED,IAAI,cAAc;QAChB,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QACjC,qDAAqD;QACrD,OAAO,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC;YAC3B,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC;YAC1B,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAChC,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC;IACnC,CAAC;IAED,YAAqB,MAA8B;QAA9B,WAAM,GAAN,MAAM,CAAwB;QA1DnD,iDAAiD;QACjD,oBAAe,GAAG,CAAC,KAAsB,EAAE,EAAE;YAC3C,IAAI,CAAC,KAAK;gBAAE,OAAO,KAAK,CAAC;YACzB,OAAO,IAAI,CAAC,cAAc,CAAC,IAAI,CAC7B,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,KAAK,KAAK,CAAC,KAAK,CAAC,EAAE,CAClD,CAAC;QACJ,CAAC,CAAC;QAEF,sBAAiB,GAAG,CAAC,MAAwB,EAAE,MAAe,EAAE,EAAE;YAChE,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC;YAC3B,MAAM,UAAU,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CACpC,SAAS,CAAC,MAAM,CAAC,OAAO,EAAE;gBACxB,OAAO,EAAE,KAAK,CAAC,OAAO;aACvB,CAAC,CACH,CAAC;YAEF,qCAAqC;YACrC,8DAA8D;YAC9D,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE,CAAC;gBACpC,MAAM,gBAAgB,GAAG,MAAM;oBAC7B,CAAC,CAAC,MAAM;oBACR,CAAC,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC;gBAC5C,IAAI,CAAC,gBAAgB;oBAAE,OAAO;gBAC9B,MAAM,gBAAgB,GAAG,SAAS,CAAC,MAAM,CACvC,SAAS,EACT,MAAM,CAAC,CAAC,CAAE,CAAC,OAAO,EAClB,CAAC,gBAAgB,CAAC,EAClB,IAAI,CACL,CAAC;gBAEF,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACpC,CAAC;YAED,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC5B,CAAC,CAAC;IAwBoD,CAAC;CACxD","sourcesContent":["import type { BlockComponent } from '@blocksuite/block-std';\n\nimport { findNoteBlockModel } from '@blocksuite/affine-shared/utils';\n\nimport type { AffineDragHandleWidget } from '../drag-handle.js';\n\nexport class SelectionHelper {\n  /** Check if given block component is selected */\n  isBlockSelected = (block?: BlockComponent) => {\n    if (!block) return false;\n    return this.selectedBlocks.some(\n      selection => selection.blockId === block.model.id\n    );\n  };\n\n  setSelectedBlocks = (blocks: BlockComponent[], noteId?: string) => {\n    const { selection } = this;\n    const selections = blocks.map(block =>\n      selection.create('block', {\n        blockId: block.blockId,\n      })\n    );\n\n    // When current page is edgeless page\n    // We need to remain surface selection and set editing as true\n    if (this.widget.mode === 'edgeless') {\n      const surfaceElementId = noteId\n        ? noteId\n        : findNoteBlockModel(blocks[0].model)?.id;\n      if (!surfaceElementId) return;\n      const surfaceSelection = selection.create(\n        'surface',\n        blocks[0]!.blockId,\n        [surfaceElementId],\n        true\n      );\n\n      selections.push(surfaceSelection);\n    }\n\n    selection.set(selections);\n  };\n\n  get selectedBlockComponents() {\n    return this.selectedBlocks\n      .map(block => this.widget.std.view.getBlock(block.blockId))\n      .filter((block): block is BlockComponent => !!block);\n  }\n\n  get selectedBlockIds() {\n    return this.selectedBlocks.map(block => block.blockId);\n  }\n\n  get selectedBlocks() {\n    const selection = this.selection;\n    // eslint-disable-next-line unicorn/prefer-array-some\n    return selection.find('text')\n      ? selection.filter('text')\n      : selection.filter('block');\n  }\n\n  get selection() {\n    return this.widget.std.selection;\n  }\n\n  constructor(readonly widget: AffineDragHandleWidget) {}\n}\n"]}