{"version":3,"file":"change-embed-card-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-embed-card-button.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BlockStdScope } from '@blocksuite/block-std';\n\nimport { getDocContentWithMaxLength } from '@blocksuite/affine-block-embed';\nimport {\n  CaptionIcon,\n  CenterPeekIcon,\n  CopyIcon,\n  EditIcon,\n  ExpandFullSmallIcon,\n  OpenIcon,\n  PaletteIcon,\n  SmallArrowDownIcon,\n} from '@blocksuite/affine-components/icons';\nimport { notifyLinkedDocSwitchedToEmbed } from '@blocksuite/affine-components/notification';\nimport { isPeekable, peek } from '@blocksuite/affine-components/peek';\nimport { toast } from '@blocksuite/affine-components/toast';\nimport {\n  type MenuItem,\n  renderToolbarSeparator,\n} from '@blocksuite/affine-components/toolbar';\nimport { type AliasInfo, BookmarkStyles } from '@blocksuite/affine-model';\nimport {\n  EmbedOptionProvider,\n  type EmbedOptions,\n  GenerateDocUrlProvider,\n  type GenerateDocUrlService,\n  type LinkEventType,\n  type TelemetryEvent,\n  TelemetryProvider,\n  ThemeProvider,\n} from '@blocksuite/affine-shared/services';\nimport { getHostName, referenceToNode } from '@blocksuite/affine-shared/utils';\nimport { Bound, WithDisposable } from '@blocksuite/global/utils';\nimport { css, html, LitElement, nothing, type TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type {\n  EmbedBlockComponent,\n  EmbedModel,\n} from '../../../_common/components/embed-card/type.js';\nimport type { EmbedCardStyle } from '../../../_common/types.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nimport { toggleEmbedCardEditModal } from '../../../_common/components/embed-card/modal/embed-card-edit-modal.js';\nimport { isInternalEmbedModel } from '../../../_common/components/embed-card/type.js';\nimport {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '../../../_common/consts.js';\nimport { getEmbedCardIcons } from '../../../_common/utils/url.js';\nimport {\n  isBookmarkBlock,\n  isEmbedGithubBlock,\n  isEmbedHtmlBlock,\n  isEmbedLinkedDocBlock,\n  isEmbedSyncedDocBlock,\n} from '../../edgeless/utils/query.js';\n\nexport class EdgelessChangeEmbedCardButton extends WithDisposable(LitElement) {\n  static override styles = css`\n    .affine-link-preview {\n      display: flex;\n      justify-content: flex-start;\n      width: 140px;\n      padding: var(--1, 0px);\n      border-radius: var(--1, 0px);\n      opacity: var(--add, 1);\n      user-select: none;\n      cursor: pointer;\n\n      color: var(--affine-link-color);\n      font-feature-settings:\n        'clig' off,\n        'liga' off;\n      font-family: var(--affine-font-family);\n      font-size: var(--affine-font-sm);\n      font-style: normal;\n      font-weight: 400;\n      text-decoration: none;\n      text-wrap: nowrap;\n    }\n\n    .affine-link-preview > span {\n      display: inline-block;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n\n      text-overflow: ellipsis;\n      overflow: hidden;\n      opacity: var(--add, 1);\n    }\n\n    editor-icon-button.doc-title .label {\n      max-width: 110px;\n      display: inline-block;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      user-select: none;\n      cursor: pointer;\n      color: var(--affine-link-color);\n      font-feature-settings:\n        'clig' off,\n        'liga' off;\n      font-family: var(--affine-font-family);\n      font-size: var(--affine-font-sm);\n      font-style: normal;\n      font-weight: 400;\n      text-decoration: none;\n      text-wrap: nowrap;\n    }\n  `;\n\n  private _convertToCardView = () => {\n    if (this._isCardView) {\n      return;\n    }\n\n    const block = this._blockComponent;\n    if (block && 'convertToCard' in block) {\n      block.convertToCard();\n      return;\n    }\n\n    if (!('url' in this.model)) {\n      return;\n    }\n\n    const { id, url, xywh, style, caption } = this.model;\n\n    let targetFlavour = 'affine:bookmark',\n      targetStyle = style;\n\n    if (this._embedOptions && this._embedOptions.viewType === 'card') {\n      const { flavour, styles } = this._embedOptions;\n      targetFlavour = flavour;\n      targetStyle = styles.includes(style) ? style : styles[0];\n    } else {\n      targetStyle = BookmarkStyles.includes(style) ? style : BookmarkStyles[0];\n    }\n\n    const bound = Bound.deserialize(xywh);\n    bound.w = EMBED_CARD_WIDTH[targetStyle];\n    bound.h = EMBED_CARD_HEIGHT[targetStyle];\n\n    const newId = this.edgeless.service.addBlock(\n      targetFlavour,\n      { url, xywh: bound.serialize(), style: targetStyle, caption },\n      this.edgeless.surface.model\n    );\n\n    this.std.command.exec('reassociateConnectors', {\n      oldId: id,\n      newId,\n    });\n\n    this.edgeless.service.selection.set({\n      editing: false,\n      elements: [newId],\n    });\n    this._doc.deleteBlock(this.model);\n  };\n\n  private _convertToEmbedView = () => {\n    if (this._isEmbedView) {\n      return;\n    }\n\n    const block = this._blockComponent;\n    if (block && 'convertToEmbed' in block) {\n      const referenceInfo = block.referenceInfo$.peek();\n\n      block.convertToEmbed();\n\n      if (referenceInfo.title || referenceInfo.description)\n        notifyLinkedDocSwitchedToEmbed(this.std);\n\n      return;\n    }\n\n    if (!('url' in this.model)) {\n      return;\n    }\n\n    if (!this._embedOptions) return;\n\n    const { flavour, styles } = this._embedOptions;\n\n    const { id, url, xywh, style } = this.model;\n\n    const targetStyle = styles.includes(style) ? style : styles[0];\n\n    const bound = Bound.deserialize(xywh);\n    bound.w = EMBED_CARD_WIDTH[targetStyle];\n    bound.h = EMBED_CARD_HEIGHT[targetStyle];\n\n    const newId = this.edgeless.service.addBlock(\n      flavour,\n      {\n        url,\n        xywh: bound.serialize(),\n        style: targetStyle,\n      },\n      this.edgeless.surface.model\n    );\n\n    this.std.command.exec('reassociateConnectors', {\n      oldId: id,\n      newId,\n    });\n\n    this.edgeless.service.selection.set({\n      editing: false,\n      elements: [newId],\n    });\n    this._doc.deleteBlock(this.model);\n  };\n\n  private _copyUrl = () => {\n    let url!: ReturnType<GenerateDocUrlService['generateDocUrl']>;\n\n    if ('url' in this.model) {\n      url = this.model.url;\n    } else if (isInternalEmbedModel(this.model)) {\n      url = this.std\n        .getOptional(GenerateDocUrlProvider)\n        ?.generateDocUrl(this.model.pageId, this.model.params);\n    }\n\n    if (!url) return;\n\n    navigator.clipboard.writeText(url).catch(console.error);\n    toast(this.std.host, 'Copied link to clipboard');\n    this.edgeless.service.selection.clear();\n\n    track(this.std, this.model, this._viewType, 'CopiedLink', {\n      control: 'copy link',\n    });\n  };\n\n  private _embedOptions: EmbedOptions | null = null;\n\n  private _getScale = () => {\n    if ('scale' in this.model) {\n      return this.model.scale ?? 1;\n    } else if (isEmbedHtmlBlock(this.model)) {\n      return 1;\n    }\n\n    const bound = Bound.deserialize(this.model.xywh);\n    return bound.h / EMBED_CARD_HEIGHT[this.model.style];\n  };\n\n  private _open = () => {\n    this._blockComponent?.open();\n  };\n\n  private _openEditPopup = (e: MouseEvent) => {\n    e.stopPropagation();\n\n    if (isEmbedHtmlBlock(this.model)) return;\n\n    this.std.selection.clear();\n\n    const originalDocInfo = this._originalDocInfo;\n\n    toggleEmbedCardEditModal(\n      this.std.host,\n      this.model,\n      this._viewType,\n      originalDocInfo\n    );\n\n    track(this.std, this.model, this._viewType, 'OpenedAliasPopup', {\n      control: 'edit',\n    });\n  };\n\n  private _peek = () => {\n    if (!this._blockComponent) return;\n    peek(this._blockComponent);\n  };\n\n  private _setCardStyle = (style: EmbedCardStyle) => {\n    const bounds = Bound.deserialize(this.model.xywh);\n    bounds.w = EMBED_CARD_WIDTH[style];\n    bounds.h = EMBED_CARD_HEIGHT[style];\n    const xywh = bounds.serialize();\n    this.model.doc.updateBlock(this.model, { style, xywh });\n\n    track(this.std, this.model, this._viewType, 'SelectedCardStyle', {\n      control: 'select card style',\n      type: style,\n    });\n  };\n\n  private _setEmbedScale = (scale: number) => {\n    if (isEmbedHtmlBlock(this.model)) return;\n\n    const bound = Bound.deserialize(this.model.xywh);\n    if ('scale' in this.model) {\n      const oldScale = this.model.scale ?? 1;\n      const ratio = scale / oldScale;\n      bound.w *= ratio;\n      bound.h *= ratio;\n      const xywh = bound.serialize();\n      this.model.doc.updateBlock(this.model, { scale, xywh });\n    } else {\n      bound.h = EMBED_CARD_HEIGHT[this.model.style] * scale;\n      bound.w = EMBED_CARD_WIDTH[this.model.style] * scale;\n      const xywh = bound.serialize();\n      this.model.doc.updateBlock(this.model, { xywh });\n    }\n    this._embedScale = scale;\n\n    track(this.std, this.model, this._viewType, 'SelectedCardScale', {\n      control: 'select card scale',\n      type: `${scale}`,\n    });\n  };\n\n  private _toggleCardScaleSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, this.model, this._viewType, 'OpenedCardScaleSelector', {\n      control: 'switch card scale',\n    });\n  };\n\n  private _toggleCardStyleSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, this.model, this._viewType, 'OpenedCardStyleSelector', {\n      control: 'switch card style',\n    });\n  };\n\n  private _toggleViewSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, this.model, this._viewType, 'OpenedViewSelector', {\n      control: 'switch view',\n    });\n  };\n\n  private _trackViewSelected = (type: string) => {\n    track(this.std, this.model, this._viewType, 'SelectedView', {\n      control: 'select view',\n      type: `${type} view`,\n    });\n  };\n\n  private get _blockComponent() {\n    const blockSelection =\n      this.edgeless.service.selection.surfaceSelections.filter(sel =>\n        sel.elements.includes(this.model.id)\n      );\n    if (blockSelection.length !== 1) {\n      return;\n    }\n\n    const blockComponent = this.std.view.getBlock(\n      blockSelection[0].blockId\n    ) as EmbedBlockComponent | null;\n\n    if (!blockComponent) return;\n\n    return blockComponent;\n  }\n\n  private get _canConvertToEmbedView() {\n    const block = this._blockComponent;\n\n    // synced doc entry controlled by awareness flag\n    if (!!block && isEmbedLinkedDocBlock(block.model)) {\n      const isSyncedDocEnabled = block.doc.awarenessStore.getFlag(\n        'enable_synced_doc_block'\n      );\n      if (!isSyncedDocEnabled) {\n        return false;\n      }\n    }\n\n    return (\n      (block && 'convertToEmbed' in block) ||\n      this._embedOptions?.viewType === 'embed'\n    );\n  }\n\n  private get _canShowCardStylePanel() {\n    return (\n      isBookmarkBlock(this.model) ||\n      isEmbedGithubBlock(this.model) ||\n      isEmbedLinkedDocBlock(this.model)\n    );\n  }\n\n  private get _canShowFullScreenButton() {\n    return isEmbedHtmlBlock(this.model);\n  }\n\n  private get _canShowUrlOptions() {\n    return (\n      'url' in this.model &&\n      (isBookmarkBlock(this.model) ||\n        isEmbedGithubBlock(this.model) ||\n        isEmbedLinkedDocBlock(this.model))\n    );\n  }\n\n  private get _doc() {\n    return this.model.doc;\n  }\n\n  private get _embedViewButtonDisabled() {\n    if (this._doc.readonly) {\n      return true;\n    }\n    return (\n      isEmbedLinkedDocBlock(this.model) &&\n      (referenceToNode(this.model) ||\n        !!this._blockComponent?.closest('affine-embed-synced-doc-block') ||\n        this.model.pageId === this._doc.id)\n    );\n  }\n\n  private get _getCardStyleOptions(): {\n    style: EmbedCardStyle;\n    Icon: TemplateResult<1>;\n    tooltip: string;\n  }[] {\n    const theme = this.std.get(ThemeProvider).theme;\n    const {\n      EmbedCardHorizontalIcon,\n      EmbedCardListIcon,\n      EmbedCardVerticalIcon,\n      EmbedCardCubeIcon,\n    } = getEmbedCardIcons(theme);\n    return [\n      {\n        style: 'horizontal',\n        Icon: EmbedCardHorizontalIcon,\n        tooltip: 'Large horizontal style',\n      },\n      {\n        style: 'list',\n        Icon: EmbedCardListIcon,\n        tooltip: 'Small horizontal style',\n      },\n      {\n        style: 'vertical',\n        Icon: EmbedCardVerticalIcon,\n        tooltip: 'Large vertical style',\n      },\n      {\n        style: 'cube',\n        Icon: EmbedCardCubeIcon,\n        tooltip: 'Small vertical style',\n      },\n    ];\n  }\n\n  private get _isCardView() {\n    if (isBookmarkBlock(this.model) || isEmbedLinkedDocBlock(this.model)) {\n      return true;\n    }\n    return this._embedOptions?.viewType === 'card';\n  }\n\n  private get _isEmbedView() {\n    return (\n      !isBookmarkBlock(this.model) &&\n      (isEmbedSyncedDocBlock(this.model) ||\n        this._embedOptions?.viewType === 'embed')\n    );\n  }\n\n  get _openButtonDisabled() {\n    return (\n      isEmbedLinkedDocBlock(this.model) && this.model.pageId === this._doc.id\n    );\n  }\n\n  get _originalDocInfo(): AliasInfo | undefined {\n    const model = this.model;\n    const doc = isInternalEmbedModel(model)\n      ? this.std.collection.getDoc(model.pageId)\n      : null;\n\n    if (doc) {\n      const title = doc.meta?.title;\n      const description = isEmbedLinkedDocBlock(model)\n        ? getDocContentWithMaxLength(doc)\n        : undefined;\n      return { title, description };\n    }\n\n    return undefined;\n  }\n\n  get _originalDocTitle() {\n    const model = this.model;\n    const doc = isInternalEmbedModel(model)\n      ? this.std.collection.getDoc(model.pageId)\n      : null;\n\n    return doc?.meta?.title || 'Untitled';\n  }\n\n  private get _viewType(): 'inline' | 'embed' | 'card' {\n    if (this._isCardView) {\n      return 'card';\n    }\n\n    if (this._isEmbedView) {\n      return 'embed';\n    }\n\n    // unreachable\n    return 'inline';\n  }\n\n  private get std() {\n    return this.edgeless.std;\n  }\n\n  private _openMenuButton() {\n    const buttons: MenuItem[] = [];\n\n    if (\n      isEmbedLinkedDocBlock(this.model) ||\n      isEmbedSyncedDocBlock(this.model)\n    ) {\n      buttons.push({\n        type: 'open-this-doc',\n        label: 'Open this doc',\n        icon: ExpandFullSmallIcon,\n        action: this._open,\n        disabled: this._openButtonDisabled,\n      });\n    } else if (this._canShowFullScreenButton) {\n      buttons.push({\n        type: 'open-this-doc',\n        label: 'Open this doc',\n        icon: ExpandFullSmallIcon,\n        action: this._open,\n      });\n    }\n\n    // open in new tab\n\n    if (this._blockComponent && isPeekable(this._blockComponent)) {\n      buttons.push({\n        type: 'open-in-center-peek',\n        label: 'Open in center peek',\n        icon: CenterPeekIcon,\n        action: () => this._peek(),\n      });\n    }\n\n    // open in split view\n\n    if (buttons.length === 0) {\n      return nothing;\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Open\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n          >\n            ${OpenIcon}${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.label,\n            ({ label, icon, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${ifDefined(label)}\n                ?disabled=${disabled}\n                @click=${action}\n              >\n                ${icon}<span class=\"label\">${label}</span>\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  private _showCaption() {\n    this._blockComponent?.captionEditor?.show();\n\n    track(this.std, this.model, this._viewType, 'OpenedCaptionEditor', {\n      control: 'add caption',\n    });\n  }\n\n  private _viewSelector() {\n    if (this._canConvertToEmbedView || this._isEmbedView) {\n      const buttons = [\n        {\n          type: 'card',\n          label: 'Card view',\n          action: () => this._convertToCardView(),\n          disabled: this.model.doc.readonly,\n        },\n        {\n          type: 'embed',\n          label: 'Embed view',\n          action: () => this._convertToEmbedView(),\n          disabled: this.model.doc.readonly || this._embedViewButtonDisabled,\n        },\n      ];\n\n      return html`\n        <editor-menu-button\n          .contentPadding=${'8px'}\n          .button=${html`\n            <editor-icon-button\n              aria-label=\"Switch view\"\n              .justify=${'space-between'}\n              .labelHeight=${'20px'}\n              .iconContainerWidth=${'110px'}\n            >\n              <div class=\"label\">\n                <span style=\"text-transform: capitalize\"\n                  >${this._viewType}</span\n                >\n                view\n              </div>\n              ${SmallArrowDownIcon}\n            </editor-icon-button>\n          `}\n          @toggle=${this._toggleViewSelector}\n        >\n          <div data-size=\"small\" data-orientation=\"vertical\">\n            ${repeat(\n              buttons,\n              button => button.type,\n              ({ type, label, action, disabled }) => html`\n                <editor-menu-action\n                  data-testid=${`link-to-${type}`}\n                  aria-label=${ifDefined(label)}\n                  ?data-selected=${this._viewType === type}\n                  ?disabled=${disabled || this._viewType === type}\n                  @click=${() => {\n                    action();\n                    this._trackViewSelected(type);\n                  }}\n                >\n                  ${label}\n                </editor-menu-action>\n              `\n            )}\n          </div>\n        </editor-menu-button>\n      `;\n    }\n\n    return nothing;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._embedScale = this._getScale();\n  }\n\n  override render() {\n    const model = this.model;\n    const isHtmlBlockModel = isEmbedHtmlBlock(model);\n\n    if ('url' in this.model) {\n      this._embedOptions = this.std\n        .get(EmbedOptionProvider)\n        .getEmbedBlockOptions(this.model.url);\n    }\n\n    const buttons = [\n      this._openMenuButton(),\n\n      this._canShowUrlOptions && 'url' in model\n        ? html`\n            <a\n              class=\"affine-link-preview\"\n              href=${model.url}\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n            >\n              <span>${getHostName(model.url)}</span>\n            </a>\n          `\n        : nothing,\n\n      // internal embed model\n      isEmbedLinkedDocBlock(model) && model.title\n        ? html`\n            <editor-icon-button\n              class=\"doc-title\"\n              aria-label=\"Doc title\"\n              .hover=${false}\n              .labelHeight=${'20px'}\n              .tooltip=${this._originalDocTitle}\n              @click=${this._open}\n            >\n              <span class=\"label\">${this._originalDocTitle}</span>\n            </editor-icon-button>\n          `\n        : nothing,\n\n      isHtmlBlockModel\n        ? nothing\n        : html`\n            <editor-icon-button\n              aria-label=\"Click link\"\n              .tooltip=${'Click link'}\n              class=\"change-embed-card-button copy\"\n              ?disabled=${this._doc.readonly}\n              @click=${this._copyUrl}\n            >\n              ${CopyIcon}\n            </editor-icon-button>\n\n            <editor-icon-button\n              aria-label=\"Edit\"\n              .tooltip=${'Edit'}\n              class=\"change-embed-card-button edit\"\n              ?disabled=${this._doc.readonly}\n              @click=${this._openEditPopup}\n            >\n              ${EditIcon}\n            </editor-icon-button>\n          `,\n\n      this._viewSelector(),\n\n      'style' in model && this._canShowCardStylePanel\n        ? html`\n            <editor-menu-button\n              .contentPadding=${'8px'}\n              .button=${html`\n                <editor-icon-button\n                  aria-label=\"Card style\"\n                  .tooltip=${'Card style'}\n                >\n                  ${PaletteIcon}\n                </editor-icon-button>\n              `}\n              @toggle=${this._toggleCardStyleSelector}\n            >\n              <card-style-panel\n                .value=${model.style}\n                .options=${this._getCardStyleOptions}\n                .onSelect=${this._setCardStyle}\n              >\n              </card-style-panel>\n            </editor-menu-button>\n          `\n        : nothing,\n\n      'caption' in model\n        ? html`\n            <editor-icon-button\n              aria-label=\"Add caption\"\n              .tooltip=${'Add caption'}\n              class=\"change-embed-card-button caption\"\n              ?disabled=${this._doc.readonly}\n              @click=${this._showCaption}\n            >\n              ${CaptionIcon}\n            </editor-icon-button>\n          `\n        : nothing,\n\n      this.quickConnectButton,\n\n      isHtmlBlockModel\n        ? nothing\n        : html`\n            <editor-menu-button\n              .contentPadding=${'8px'}\n              .button=${html`\n                <editor-icon-button\n                  aria-label=\"Scale\"\n                  .tooltip=${'Scale'}\n                  .justify=${'space-between'}\n                  .iconContainerWidth=${'65px'}\n                  .labelHeight=${'20px'}\n                >\n                  <span class=\"label\">\n                    ${Math.round(this._embedScale * 100) + '%'}\n                  </span>\n                  ${SmallArrowDownIcon}\n                </editor-icon-button>\n              `}\n              @toggle=${this._toggleCardScaleSelector}\n            >\n              <edgeless-scale-panel\n                class=\"embed-scale-popper\"\n                .scale=${Math.round(this._embedScale * 100)}\n                .onSelect=${this._setEmbedScale}\n              ></edgeless-scale-panel>\n            </editor-menu-button>\n          `,\n    ];\n\n    return join(\n      buttons.filter(button => button !== nothing),\n      renderToolbarSeparator\n    );\n  }\n\n  @state()\n  private accessor _embedScale = 1;\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor model!: EmbedModel;\n\n  @property({ attribute: false })\n  accessor quickConnectButton!: TemplateResult<1> | typeof nothing;\n}\n\nexport function renderEmbedButton(\n  edgeless: EdgelessRootBlockComponent,\n  models?: EdgelessChangeEmbedCardButton['model'][],\n  quickConnectButton?: TemplateResult<1>[]\n) {\n  if (models?.length !== 1) return nothing;\n\n  return html`\n    <edgeless-change-embed-card-button\n      .model=${models[0]}\n      .edgeless=${edgeless}\n      .quickConnectButton=${quickConnectButton?.pop() ?? nothing}\n    ></edgeless-change-embed-card-button>\n  `;\n}\n\nfunction track(\n  std: BlockStdScope,\n  model: EmbedModel,\n  viewType: string,\n  event: LinkEventType,\n  props: Partial<TelemetryEvent>\n) {\n  std.getOptional(TelemetryProvider)?.track(event, {\n    segment: 'toolbar',\n    page: 'whiteboard editor',\n    module: 'element toolbar',\n    type: `${viewType} view`,\n    category: isInternalEmbedModel(model) ? 'linked doc' : 'link',\n    ...props,\n  });\n}\n"]}