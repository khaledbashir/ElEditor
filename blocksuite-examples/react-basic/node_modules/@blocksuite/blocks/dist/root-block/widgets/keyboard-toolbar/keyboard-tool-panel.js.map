{"version":3,"file":"keyboard-tool-panel.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/keyboard-toolbar/keyboard-tool-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  PropTypes,\n  requiredProperties,\n  ShadowlessElement,\n} from '@blocksuite/block-std';\nimport { SignalWatcher, WithDisposable } from '@blocksuite/global/utils';\nimport { html, nothing, type PropertyValues } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type {\n  KeyboardIconType,\n  KeyboardToolbarActionItem,\n  KeyboardToolbarContext,\n  KeyboardToolPanelConfig,\n  KeyboardToolPanelGroup,\n} from './config.js';\n\nimport { keyboardToolPanelStyles } from './styles.js';\n\nexport const AFFINE_KEYBOARD_TOOL_PANEL = 'affine-keyboard-tool-panel';\n\n@requiredProperties({\n  context: PropTypes.object,\n})\nexport class AffineKeyboardToolPanel extends SignalWatcher(\n  WithDisposable(ShadowlessElement)\n) {\n  static override styles = keyboardToolPanelStyles;\n\n  private readonly _handleItemClick = (item: KeyboardToolbarActionItem) => {\n    if (item.disableWhen && item.disableWhen(this.context)) return;\n    if (item.action) {\n      Promise.resolve(item.action(this.context)).catch(console.error);\n    }\n  };\n\n  private _renderGroup(group: KeyboardToolPanelGroup) {\n    const items = group.items.filter(\n      item => item.showWhen?.(this.context) ?? true\n    );\n\n    return html`<div class=\"keyboard-tool-panel-group\">\n      <div class=\"keyboard-tool-panel-group-header\">${group.name}</div>\n      <div class=\"keyboard-tool-panel-group-item-container\">\n        ${repeat(\n          items,\n          item => item.name,\n          item => this._renderItem(item)\n        )}\n      </div>\n    </div>`;\n  }\n\n  private _renderIcon(icon: KeyboardIconType) {\n    return typeof icon === 'function' ? icon(this.context) : icon;\n  }\n\n  private _renderItem(item: KeyboardToolbarActionItem) {\n    return html`<div class=\"keyboard-tool-panel-item\">\n      <button @click=${() => this._handleItemClick(item)}>\n        ${this._renderIcon(item.icon)}\n      </button>\n      <span>${item.name}</span>\n    </div>`;\n  }\n\n  override render() {\n    if (!this.config) return nothing;\n\n    const groups = this.config.groups\n      .map(group => (typeof group === 'function' ? group(this.context) : group))\n      .filter((group): group is KeyboardToolPanelGroup => group !== null);\n\n    return repeat(\n      groups,\n      group => group.name,\n      group => this._renderGroup(group)\n    );\n  }\n\n  protected override willUpdate(changedProperties: PropertyValues<this>) {\n    if (changedProperties.has('height')) {\n      this.style.height = `${this.height}px`;\n      if (this.height === 0) {\n        this.style.padding = '0';\n      } else {\n        this.style.padding = '';\n      }\n    }\n  }\n\n  @property({ attribute: false })\n  accessor config: KeyboardToolPanelConfig | null = null;\n\n  @property({ attribute: false })\n  accessor context!: KeyboardToolbarContext;\n\n  @property({ type: Number })\n  accessor height = 0;\n}\n"]}