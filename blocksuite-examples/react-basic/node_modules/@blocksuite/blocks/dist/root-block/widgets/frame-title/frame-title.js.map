{"version":3,"file":"frame-title.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/frame-title/frame-title.ts"],"names":[],"mappings":"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","sourcesContent":["import { ColorScheme, FrameBlockModel } from '@blocksuite/affine-model';\nimport { ThemeProvider } from '@blocksuite/affine-shared/services';\nimport {\n  type BlockStdScope,\n  PropTypes,\n  requiredProperties,\n  stdContext,\n} from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport {\n  Bound,\n  type SerializedXYWH,\n  SignalWatcher,\n  WithDisposable,\n} from '@blocksuite/global/utils';\nimport { consume } from '@lit/context';\nimport { themeToVar } from '@toeverything/theme/v2';\nimport { LitElement } from 'lit';\nimport { property, state } from 'lit/decorators.js';\n\nimport type { EdgelessRootService } from '../../edgeless/index.js';\n\nimport { parseStringToRgba } from '../../edgeless/components/color-picker/utils.js';\nimport { isTransparent } from '../../edgeless/components/panel/color-panel.js';\nimport { frameTitleStyle, frameTitleStyleVars } from './styles.js';\n\nexport const AFFINE_FRAME_TITLE = 'affine-frame-title';\n\n@requiredProperties({\n  model: PropTypes.instanceOf(FrameBlockModel),\n})\nexport class AffineFrameTitle extends SignalWatcher(\n  WithDisposable(LitElement)\n) {\n  static override styles = frameTitleStyle;\n\n  private _cachedHeight = 0;\n\n  private _cachedWidth = 0;\n\n  get colors() {\n    let backgroundColor = this.std\n      .get(ThemeProvider)\n      .getColorValue(this.model.background, undefined, true);\n    if (isTransparent(backgroundColor)) {\n      backgroundColor = this.std\n        .get(ThemeProvider)\n        .getCssVariableColor(themeToVar('edgeless/frame/background/white'));\n    }\n\n    const { r, g, b, a } = parseStringToRgba(backgroundColor);\n\n    const theme = this.std.get(ThemeProvider).theme;\n    let textColor: string;\n    {\n      let rPrime, gPrime, bPrime;\n      if (theme === ColorScheme.Light) {\n        rPrime = 1 - a + a * r;\n        gPrime = 1 - a + a * g;\n        bPrime = 1 - a + a * b;\n      } else {\n        rPrime = a * r;\n        gPrime = a * g;\n        bPrime = a * b;\n      }\n\n      // light\n      const L = 0.299 * rPrime + 0.587 * gPrime + 0.114 * bPrime;\n      textColor = L > 0.5 ? 'black' : 'white';\n    }\n\n    return {\n      background: backgroundColor,\n      text: textColor,\n    };\n  }\n\n  get doc() {\n    return this.model.doc;\n  }\n\n  get gfx() {\n    return this.std.get(GfxControllerIdentifier);\n  }\n\n  get rootService() {\n    return this.std.getService('affine:page') as EdgelessRootService;\n  }\n\n  private _isInsideFrame() {\n    return this.gfx.grid.has(\n      this.model.elementBound,\n      true,\n      true,\n      model => model !== this.model && model instanceof FrameBlockModel\n    );\n  }\n\n  private _updateFrameTitleSize() {\n    const { _nestedFrame, _zoom: zoom } = this;\n    const { elementBound } = this.model;\n    const width = this._cachedWidth / zoom;\n    const height = this._cachedHeight / zoom;\n\n    const { nestedFrameOffset } = frameTitleStyleVars;\n    if (width && height) {\n      this.model.externalXYWH = `[${\n        elementBound.x + (_nestedFrame ? nestedFrameOffset / zoom : 0)\n      },${\n        elementBound.y +\n        (_nestedFrame\n          ? nestedFrameOffset / zoom\n          : -(height + nestedFrameOffset / zoom))\n      },${width},${height}]`;\n\n      this.gfx.grid.update(this.model);\n    } else {\n      this.model.externalXYWH = undefined;\n    }\n  }\n\n  private _updateStyle() {\n    if (\n      this._frameTitle.length === 0 ||\n      this._editing ||\n      this.gfx.tool.currentToolName$.value === 'frameNavigator'\n    ) {\n      this.style.display = 'none';\n      return;\n    }\n\n    const model = this.model;\n    const bound = Bound.deserialize(model.xywh);\n\n    const { _zoom: zoom } = this;\n    const { nestedFrameOffset, height } = frameTitleStyleVars;\n\n    const nestedFrame = this._nestedFrame;\n    const maxWidth = nestedFrame\n      ? bound.w * zoom - nestedFrameOffset / zoom\n      : bound.w * zoom;\n    const hidden = height / zoom >= bound.h;\n    const transformOperation = [\n      `translate(0%, ${nestedFrame ? 0 : -100}%)`,\n      `translate(${nestedFrame ? nestedFrameOffset : 0}px, ${\n        nestedFrame ? nestedFrameOffset : -nestedFrameOffset\n      }px)`,\n    ];\n\n    const anchor = this.gfx.viewport.toViewCoord(bound.x, bound.y);\n\n    this.style.display = '';\n    this.style.setProperty('--bg-color', this.colors.background);\n    this.style.left = `${anchor[0]}px`;\n    this.style.top = `${anchor[1]}px`;\n    this.style.display = hidden ? 'none' : 'flex';\n    this.style.transform = transformOperation.join(' ');\n    this.style.maxWidth = `${maxWidth}px`;\n    this.style.transformOrigin = nestedFrame ? 'top left' : 'bottom left';\n    this.style.color = this.colors.text;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    const { _disposables, doc, gfx, rootService } = this;\n\n    this._nestedFrame = this._isInsideFrame();\n\n    _disposables.add(\n      doc.slots.blockUpdated.on(payload => {\n        if (\n          (payload.type === 'update' &&\n            payload.props.key === 'xywh' &&\n            doc.getBlock(payload.id)?.model instanceof FrameBlockModel) ||\n          (payload.type === 'add' && payload.flavour === 'affine:frame')\n        ) {\n          this._nestedFrame = this._isInsideFrame();\n        }\n\n        if (\n          payload.type === 'delete' &&\n          payload.model instanceof FrameBlockModel &&\n          payload.model !== this.model\n        ) {\n          this._nestedFrame = this._isInsideFrame();\n        }\n      })\n    );\n\n    _disposables.add(\n      this.model.propsUpdated.on(() => {\n        this._xywh = this.model.xywh;\n        this.requestUpdate();\n      })\n    );\n\n    _disposables.add(\n      rootService.selection.slots.updated.on(() => {\n        this._editing =\n          rootService.selection.selectedIds[0] === this.model.id &&\n          rootService.selection.editing;\n      })\n    );\n\n    _disposables.add(\n      gfx.viewport.viewportUpdated.on(({ zoom }) => {\n        this._zoom = zoom;\n        this.requestUpdate();\n      })\n    );\n\n    this._zoom = gfx.viewport.zoom;\n\n    const updateTitle = () => {\n      this._frameTitle = this.model.title.toString().trim();\n    };\n    _disposables.add(() => {\n      this.model.title.yText.unobserve(updateTitle);\n    });\n    this.model.title.yText.observe(updateTitle);\n\n    this._frameTitle = this.model.title.toString().trim();\n    this._xywh = this.model.xywh;\n  }\n\n  override firstUpdated() {\n    this._cachedWidth = this.clientWidth;\n    this._cachedHeight = this.clientHeight;\n    this._updateFrameTitleSize();\n  }\n\n  override render() {\n    this._updateStyle();\n    return this._frameTitle;\n  }\n\n  override updated(_changedProperties: Map<string, unknown>) {\n    if (\n      !this.gfx.viewport.viewportBounds.contains(this.model.elementBound) &&\n      !this.gfx.viewport.viewportBounds.isIntersectWithBound(\n        this.model.elementBound\n      )\n    ) {\n      return;\n    }\n\n    let sizeChanged = false;\n    if (\n      this._cachedWidth === 0 ||\n      this._cachedHeight === 0 ||\n      _changedProperties.has('_frameTitle') ||\n      _changedProperties.has('_nestedFrame') ||\n      _changedProperties.has('_xywh') ||\n      _changedProperties.has('_editing')\n    ) {\n      this._cachedWidth = this.clientWidth;\n      this._cachedHeight = this.clientHeight;\n      sizeChanged = true;\n    }\n    if (sizeChanged || _changedProperties.has('_zoom')) {\n      this._updateFrameTitleSize();\n    }\n  }\n\n  @state()\n  private accessor _editing = false;\n\n  @state()\n  private accessor _frameTitle = '';\n\n  @state()\n  private accessor _nestedFrame = false;\n\n  @state()\n  private accessor _xywh: SerializedXYWH | null = null;\n\n  @state()\n  private accessor _zoom = 1;\n\n  @property({ attribute: false })\n  accessor model!: FrameBlockModel;\n\n  @consume({ context: stdContext })\n  accessor std!: BlockStdScope;\n}\n"]}