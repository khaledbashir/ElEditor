{"version":3,"file":"handle-event-watcher.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/drag-handle/watchers/handle-event-watcher.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AffineDragHandleWidget } from '../drag-handle.js';\n\nimport {\n  DRAG_HANDLE_CONTAINER_PADDING,\n  DRAG_HANDLE_GRABBER_BORDER_RADIUS,\n  DRAG_HANDLE_GRABBER_WIDTH_HOVERED,\n} from '../config.js';\n\nexport class HandleEventWatcher {\n  private _onDragHandlePointerDown = () => {\n    if (!this.widget.isHoverDragHandleVisible || !this.widget.anchorBlockId)\n      return;\n\n    this.widget.dragHoverRect = this.widget.draggingAreaRect.value;\n  };\n\n  private _onDragHandlePointerEnter = () => {\n    const container = this.widget.dragHandleContainer;\n    const grabber = this.widget.dragHandleGrabber;\n    if (!container || !grabber) return;\n\n    if (this.widget.isHoverDragHandleVisible && this.widget.anchorBlockId) {\n      const block = this.widget.anchorBlockComponent;\n      if (!block) return;\n\n      const padding = DRAG_HANDLE_CONTAINER_PADDING * this.widget.scale.peek();\n      container.style.paddingTop = `${padding}px`;\n      container.style.paddingBottom = `${padding}px`;\n      container.style.transition = `padding 0.25s ease`;\n\n      grabber.style.width = `${\n        DRAG_HANDLE_GRABBER_WIDTH_HOVERED * this.widget.scaleInNote.peek()\n      }px`;\n      grabber.style.borderRadius = `${\n        DRAG_HANDLE_GRABBER_BORDER_RADIUS * this.widget.scaleInNote.peek()\n      }px`;\n\n      this.widget.isDragHandleHovered = true;\n    } else if (this.widget.isTopLevelDragHandleVisible) {\n      this.widget.dragHoverRect =\n        this.widget.edgelessWatcher.hoverAreaRectTopLevelBlock;\n      this.widget.isDragHandleHovered = true;\n    }\n  };\n\n  private _onDragHandlePointerLeave = () => {\n    this.widget.isDragHandleHovered = false;\n    this.widget.dragHoverRect = null;\n\n    if (this.widget.isTopLevelDragHandleVisible) return;\n\n    if (this.widget.dragging) return;\n\n    this.widget.pointerEventWatcher.showDragHandleOnHoverBlock();\n  };\n\n  private _onDragHandlePointerUp = () => {\n    if (!this.widget.isHoverDragHandleVisible) return;\n    this.widget.dragHoverRect = null;\n  };\n\n  constructor(readonly widget: AffineDragHandleWidget) {}\n\n  watch() {\n    const { dragHandleContainer, disposables } = this.widget;\n\n    // When pointer enter drag handle grabber\n    // Extend drag handle grabber to the height of the hovered block\n    disposables.addFromEvent(\n      dragHandleContainer,\n      'pointerenter',\n      this._onDragHandlePointerEnter\n    );\n\n    disposables.addFromEvent(\n      dragHandleContainer,\n      'pointerdown',\n      this._onDragHandlePointerDown\n    );\n\n    disposables.addFromEvent(\n      dragHandleContainer,\n      'pointerup',\n      this._onDragHandlePointerUp\n    );\n\n    // When pointer leave drag handle grabber, should reset drag handle grabber style\n    disposables.addFromEvent(\n      dragHandleContainer,\n      'pointerleave',\n      this._onDragHandlePointerLeave\n    );\n  }\n}\n"]}