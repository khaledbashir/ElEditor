{"version":3,"file":"legacy-drag-event-watcher.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/drag-handle/watchers/legacy-drag-event-watcher.ts"],"names":[],"mappings":"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","sourcesContent":["import type { NoteBlockModel } from '@blocksuite/affine-model';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport {\n  captureEventTarget,\n  findNoteBlockModel,\n  getBlockComponentsExcludeSubtrees,\n  matchFlavours,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  type BlockComponent,\n  isGfxBlockComponent,\n  type PointerEventState,\n  type UIEventHandler,\n} from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport { IS_MOBILE } from '@blocksuite/global/env';\nimport { Bound, Point } from '@blocksuite/global/utils';\nimport { render } from 'lit';\n\nimport type { EdgelessRootBlockComponent } from '../../../edgeless/index.js';\nimport type { AffineDragHandleWidget } from '../drag-handle.js';\n\nimport { addNoteAtPoint } from '../../../edgeless/utils/common.js';\nimport { DropIndicator } from '../components/drop-indicator.js';\nimport { AFFINE_DRAG_HANDLE_WIDGET } from '../consts.js';\nimport {\n  containBlock,\n  getDuplicateBlocks,\n  includeTextSelection,\n} from '../utils.js';\n\nexport class LegacyDragEventWatcher {\n  private _changeCursorToGrabbing = () => {\n    document.documentElement.classList.add('affine-drag-preview-grabbing');\n  };\n\n  private _createDropIndicator = () => {\n    if (!this.widget.dropIndicator) {\n      this.widget.dropIndicator = new DropIndicator();\n      this.widget.rootComponent.append(this.widget.dropIndicator);\n    }\n  };\n\n  /**\n   * When drag end, should move blocks to drop position\n   */\n  private _dragEndHandler: UIEventHandler = ctx => {\n    this.widget.clearRaf();\n    if (!this.widget.dragging || !this.widget.dragPreview) return false;\n    if (this.widget.draggingElements.length === 0 || this.widget.doc.readonly) {\n      this.widget.hide(true);\n      return false;\n    }\n\n    const state = ctx.get('pointerState');\n    const { target } = state.raw;\n    if (!this.widget.host.contains(target as Node)) {\n      this.widget.hide(true);\n      return true;\n    }\n\n    for (const option of this.widget.optionRunner.options) {\n      if (\n        option.onDragEnd?.({\n          // @ts-ignore\n          state,\n          draggingElements: this.widget.draggingElements,\n          dropBlockId: this.widget.dropBlockId,\n          dropType: this.widget.dropType,\n          dragPreview: this.widget.dragPreview,\n          noteScale: this.widget.noteScale.peek(),\n          editorHost: this.widget.host,\n        })\n      ) {\n        this.widget.hide(true);\n        if (this.widget.mode === 'edgeless') {\n          this.widget.edgelessWatcher.checkTopLevelBlockSelection();\n        }\n        return true;\n      }\n    }\n\n    // call default drag end handler if no option return true\n    this._onDragEnd(state);\n\n    if (this.widget.mode === 'edgeless') {\n      this.widget.edgelessWatcher.checkTopLevelBlockSelection();\n    }\n\n    return true;\n  };\n\n  /**\n   * When dragging, should:\n   * Update drag preview position\n   * Update indicator position\n   * Update drop block id\n   */\n  private _dragMoveHandler: UIEventHandler = ctx => {\n    if (\n      this.widget.isHoverDragHandleVisible ||\n      this.widget.isTopLevelDragHandleVisible\n    ) {\n      this.widget.hide();\n    }\n\n    if (!this.widget.dragging || this.widget.draggingElements.length === 0) {\n      return false;\n    }\n\n    ctx.get('defaultState').event.preventDefault();\n    const state = ctx.get('pointerState');\n\n    for (const option of this.widget.optionRunner.options) {\n      if (\n        option.onDragMove?.({\n          // @ts-ignore\n          state,\n          draggingElements: this.widget.draggingElements,\n        })\n      ) {\n        return true;\n      }\n    }\n\n    // call default drag move handler if no option return true\n    return this._onDragMove(state);\n  };\n\n  /**\n   * When start dragging, should set dragging elements and create drag preview\n   */\n  private _dragStartHandler: UIEventHandler = ctx => {\n    const state = ctx.get('pointerState');\n    // If not click left button to start dragging, should do nothing\n    const { button } = state.raw;\n    if (button !== 0) {\n      return false;\n    }\n\n    // call default drag start handler if no option return true\n    for (const option of this.widget.optionRunner.options) {\n      if (\n        option.onDragStart?.({\n          // @ts-ignore\n          state,\n          // @ts-ignore\n          startDragging: this._startDragging,\n          anchorBlockId: this.widget.anchorBlockId.peek() ?? '',\n          editorHost: this.widget.host,\n        })\n      ) {\n        return true;\n      }\n    }\n    return this._onDragStart(state);\n  };\n\n  private _onDragEnd = (state: PointerEventState) => {\n    const targetBlockId = this.widget.dropBlockId;\n    const dropType = this.widget.dropType;\n    const draggingElements = this.widget.draggingElements;\n    this.widget.hide(true);\n\n    // handle drop of blocks from note onto edgeless container\n    if (!targetBlockId) {\n      const target = captureEventTarget(state.raw.target);\n      if (!target) return false;\n\n      const isTargetEdgelessContainer =\n        target.classList.contains('edgeless-container');\n      if (!isTargetEdgelessContainer) return false;\n\n      const selectedBlocks = getBlockComponentsExcludeSubtrees(draggingElements)\n        .map(element => element.model)\n        .filter((x): x is BlockModel => !!x);\n      if (selectedBlocks.length === 0) return false;\n\n      const isSurfaceComponent = selectedBlocks.some(block => {\n        const parent = this.widget.doc.getParent(block.id);\n        return matchFlavours(parent, ['affine:surface']);\n      });\n      if (isSurfaceComponent) return true;\n\n      const edgelessRoot = this.widget\n        .rootComponent as EdgelessRootBlockComponent;\n\n      const { left: viewportLeft, top: viewportTop } = edgelessRoot.viewport;\n\n      const newNoteId = addNoteAtPoint(\n        edgelessRoot.std,\n        new Point(state.raw.x - viewportLeft, state.raw.y - viewportTop),\n        {\n          scale: this.widget.noteScale.peek(),\n        }\n      );\n      const newNoteBlock = this.widget.doc.getBlockById(\n        newNoteId\n      ) as NoteBlockModel;\n      if (!newNoteBlock) return;\n\n      const bound = Bound.deserialize(newNoteBlock.xywh);\n      bound.h *= this.widget.noteScale.peek();\n      bound.w *= this.widget.noteScale.peek();\n      this.widget.doc.updateBlock(newNoteBlock, {\n        xywh: bound.serialize(),\n        edgeless: {\n          ...newNoteBlock.edgeless,\n          scale: this.widget.noteScale.peek(),\n        },\n      });\n\n      const altKey = state.raw.altKey;\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        this.widget.doc.addBlocks(duplicateBlocks, newNoteBlock);\n      } else {\n        this.widget.doc.moveBlocks(selectedBlocks, newNoteBlock);\n      }\n\n      edgelessRoot.service.selection.set({\n        elements: [newNoteBlock.id],\n        editing: true,\n      });\n\n      return true;\n    }\n\n    // Should make sure drop block id is not in selected blocks\n    if (\n      containBlock(this.widget.selectionHelper.selectedBlockIds, targetBlockId)\n    ) {\n      return false;\n    }\n\n    const selectedBlocks = getBlockComponentsExcludeSubtrees(draggingElements)\n      .map(element => element.model)\n      .filter((x): x is BlockModel => !!x);\n    if (!selectedBlocks.length) {\n      return false;\n    }\n\n    const targetBlock = this.widget.doc.getBlockById(targetBlockId);\n    if (!targetBlock) return;\n\n    const shouldInsertIn = dropType === 'in';\n\n    const parent = shouldInsertIn\n      ? targetBlock\n      : this.widget.doc.getParent(targetBlockId);\n    if (!parent) return;\n\n    const altKey = state.raw.altKey;\n\n    if (shouldInsertIn) {\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        this.widget.doc.addBlocks(duplicateBlocks, targetBlock);\n      } else {\n        this.widget.doc.moveBlocks(selectedBlocks, targetBlock);\n      }\n    } else {\n      if (altKey) {\n        const duplicateBlocks = getDuplicateBlocks(selectedBlocks);\n\n        const parentIndex =\n          parent.children.indexOf(targetBlock) + (dropType === 'after' ? 1 : 0);\n\n        this.widget.doc.addBlocks(duplicateBlocks, parent, parentIndex);\n      } else {\n        this.widget.doc.moveBlocks(\n          selectedBlocks,\n          parent,\n          targetBlock,\n          dropType === 'before'\n        );\n      }\n    }\n\n    // TODO: need a better way to update selection\n    // Should update selection after moving blocks\n    // In doc page mode, update selected blocks\n    // In edgeless mode, focus on the first block\n    setTimeout(() => {\n      if (!parent) return;\n      // Need to update selection when moving blocks successfully\n      // Because the block path may be changed after moving\n      const parentElement = this.widget.std.view.getBlock(parent.id);\n      if (parentElement) {\n        const newSelectedBlocks = selectedBlocks.map(block => {\n          return this.widget.std.view.getBlock(block.id);\n        });\n        if (!newSelectedBlocks) return;\n\n        const note = findNoteBlockModel(parentElement.model);\n        if (!note) return;\n        this.widget.selectionHelper.setSelectedBlocks(\n          newSelectedBlocks as BlockComponent[],\n          note.id\n        );\n      }\n    }, 0);\n\n    return true;\n  };\n\n  private _onDragMove = (state: PointerEventState) => {\n    this.widget.clearRaf();\n\n    this.widget.rafID = requestAnimationFrame(() => {\n      // @ts-ignore\n      this.widget.edgelessWatcher.updateDragPreviewPosition(state);\n      // @ts-ignore\n      this.widget.updateDropIndicator(state, true);\n    });\n    return true;\n  };\n\n  private _onDragStart = (state: PointerEventState) => {\n    // Get current hover block element by path\n    const hoverBlock = this.widget.anchorBlockComponent.peek();\n    if (!hoverBlock) return false;\n\n    const element = captureEventTarget(state.raw.target);\n    const dragByHandle = !!element?.closest(AFFINE_DRAG_HANDLE_WIDGET);\n    const isInSurface = isGfxBlockComponent(hoverBlock);\n\n    if (isInSurface && dragByHandle) {\n      const viewport = this.widget.std.get(GfxControllerIdentifier).viewport;\n      const zoom = viewport.zoom ?? 1;\n      const dragPreviewEl = document.createElement('div');\n      const bound = Bound.deserialize(hoverBlock.model.xywh);\n      const offset = new Point(bound.x * zoom, bound.y * zoom);\n\n      // TODO: not use `dangerouslyRenderModel` to render drag preview\n      render(\n        this.widget.std.host.dangerouslyRenderModel(hoverBlock.model),\n        dragPreviewEl\n      );\n\n      this._startDragging([hoverBlock], state, dragPreviewEl, offset);\n      return true;\n    }\n\n    const selectBlockAndStartDragging = () => {\n      this.widget.std.selection.setGroup('note', [\n        this.widget.std.selection.create('block', {\n          blockId: hoverBlock.blockId,\n        }),\n      ]);\n      this._startDragging([hoverBlock], state);\n    };\n\n    if (this.widget.draggingElements.length === 0) {\n      const dragByBlock =\n        hoverBlock.contains(element) && !hoverBlock.model.text;\n\n      const canDragByBlock =\n        matchFlavours(hoverBlock.model, [\n          'affine:attachment',\n          'affine:bookmark',\n        ]) || hoverBlock.model.flavour.startsWith('affine:embed-');\n\n      if (!isInSurface && dragByBlock && canDragByBlock) {\n        selectBlockAndStartDragging();\n        return true;\n      }\n    }\n\n    // Should only start dragging when pointer down on drag handle\n    // And current mouse button is left button\n    if (!dragByHandle) {\n      this.widget.hide();\n      return false;\n    }\n\n    if (this.widget.draggingElements.length === 1) {\n      if (!isInSurface) {\n        selectBlockAndStartDragging();\n        return true;\n      }\n    }\n\n    if (!this.widget.isHoverDragHandleVisible) return false;\n\n    let selections = this.widget.selectionHelper.selectedBlocks;\n\n    // When current selection is TextSelection\n    // Should set BlockSelection for the blocks in native range\n    if (selections.length > 0 && includeTextSelection(selections)) {\n      const nativeSelection = document.getSelection();\n      const rangeManager = this.widget.std.range;\n      if (nativeSelection && nativeSelection.rangeCount > 0 && rangeManager) {\n        const range = nativeSelection.getRangeAt(0);\n        const blocks = rangeManager.getSelectedBlockComponentsByRange(range, {\n          match: el => el.model.role === 'content',\n          mode: 'highest',\n        });\n        this.widget.selectionHelper.setSelectedBlocks(blocks);\n        selections = this.widget.selectionHelper.selectedBlocks;\n      }\n    }\n\n    // When there is no selected blocks\n    // Or selected blocks not including current hover block\n    // Set current hover block as selected\n    if (\n      selections.length === 0 ||\n      !containBlock(\n        selections.map(selection => selection.blockId),\n        this.widget.anchorBlockId.peek()!\n      )\n    ) {\n      const block = this.widget.anchorBlockComponent.peek();\n      if (block) {\n        this.widget.selectionHelper.setSelectedBlocks([block]);\n      }\n    }\n\n    const blocks = this.widget.selectionHelper.selectedBlockComponents;\n\n    // This could be skip if we can ensure that all selected blocks are on the same level\n    // Which means not selecting parent block and child block at the same time\n    const blocksExcludingChildren = getBlockComponentsExcludeSubtrees(\n      blocks\n    ) as BlockComponent[];\n\n    if (blocksExcludingChildren.length === 0) return false;\n\n    this._startDragging(blocksExcludingChildren, state);\n    this.widget.hide();\n    return true;\n  };\n\n  private _startDragging = (\n    blocks: BlockComponent[],\n    state: PointerEventState,\n    dragPreviewEl?: HTMLElement,\n    dragPreviewOffset?: Point\n  ) => {\n    if (!blocks.length) {\n      return;\n    }\n\n    this.widget.draggingElements = blocks;\n\n    this.widget.dragPreview = this.widget.previewHelper.createDragPreview(\n      blocks,\n      // @ts-ignore\n      state,\n      dragPreviewEl,\n      dragPreviewOffset\n    );\n\n    this.widget.dragging = true;\n    this._changeCursorToGrabbing();\n    this._createDropIndicator();\n    this.widget.hide();\n  };\n\n  constructor(readonly widget: AffineDragHandleWidget) {}\n\n  watch() {\n    this.widget.disposables.addFromEvent(this.widget, 'pointerdown', e => {\n      e.preventDefault();\n    });\n\n    if (IS_MOBILE) return;\n\n    this.widget.handleEvent('dragStart', this._dragStartHandler);\n    this.widget.handleEvent('dragMove', this._dragMoveHandler);\n    this.widget.handleEvent('dragEnd', this._dragEndHandler, { global: true });\n  }\n}\n"]}