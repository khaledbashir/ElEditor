{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/slash-menu/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { TextFormatConfig } from '@blocksuite/affine-components/rich-text';\nimport type { BlockModel } from '@blocksuite/store';\n\nimport { isInsideBlockByFlavour } from '@blocksuite/affine-shared/utils';\nimport { assertType } from '@blocksuite/global/utils';\n\nimport type { TextConversionConfig } from '../../../_common/configs/text-conversion.js';\nimport type {\n  SlashMenuActionItem,\n  SlashMenuContext,\n  SlashMenuGroupDivider,\n  SlashMenuItem,\n  SlashMenuItemGenerator,\n  SlashMenuStaticItem,\n  SlashSubMenu,\n} from './config.js';\n\nimport { slashMenuToolTips } from './tooltips/index.js';\n\nexport function isGroupDivider(\n  item: SlashMenuStaticItem\n): item is SlashMenuGroupDivider {\n  return 'groupName' in item;\n}\n\nexport function notGroupDivider(\n  item: SlashMenuStaticItem\n): item is Exclude<SlashMenuStaticItem, SlashMenuGroupDivider> {\n  return !isGroupDivider(item);\n}\n\nexport function isActionItem(\n  item: SlashMenuStaticItem\n): item is SlashMenuActionItem {\n  return 'action' in item;\n}\n\nexport function isSubMenuItem(item: SlashMenuStaticItem): item is SlashSubMenu {\n  return 'subMenu' in item;\n}\n\nexport function isMenuItemGenerator(\n  item: SlashMenuItem\n): item is SlashMenuItemGenerator {\n  return typeof item === 'function';\n}\n\nexport function slashItemClassName(item: SlashMenuStaticItem) {\n  const name = isGroupDivider(item) ? item.groupName : item.name;\n\n  return name.split(' ').join('-').toLocaleLowerCase();\n}\n\nexport function filterEnabledSlashMenuItems(\n  items: SlashMenuItem[],\n  context: SlashMenuContext\n): SlashMenuStaticItem[] {\n  const result = items\n    .map(item => (isMenuItemGenerator(item) ? item(context) : item))\n    .flat()\n    .filter(item => (item.showWhen ? item.showWhen(context) : true))\n    .map(item => {\n      if (isSubMenuItem(item)) {\n        return {\n          ...item,\n          subMenu: filterEnabledSlashMenuItems(item.subMenu, context),\n        };\n      } else {\n        return { ...item };\n      }\n    });\n  return result;\n}\n\nexport function getFirstNotDividerItem(\n  items: SlashMenuStaticItem[]\n): SlashMenuActionItem | SlashSubMenu | null {\n  const firstItem = items.find(item => !isGroupDivider(item));\n  assertType<SlashMenuActionItem | SlashSubMenu | undefined>(firstItem);\n  return firstItem ?? null;\n}\n\nexport function insideEdgelessText(model: BlockModel) {\n  return isInsideBlockByFlavour(model.doc, model, 'affine:edgeless-text');\n}\n\nexport function tryRemoveEmptyLine(model: BlockModel) {\n  if (model.text?.length === 0) {\n    model.doc.deleteBlock(model);\n  }\n}\n\nexport function createConversionItem(\n  config: TextConversionConfig\n): SlashMenuActionItem {\n  const { name, description, icon, flavour, type } = config;\n  return {\n    name,\n    description,\n    icon,\n    tooltip: slashMenuToolTips[name],\n    showWhen: ({ model }) => model.doc.schema.flavourSchemaMap.has(flavour),\n    action: ({ rootComponent }) => {\n      rootComponent.std.command\n        .chain()\n        .updateBlockType({\n          flavour,\n          props: { type },\n        })\n        .run();\n    },\n  };\n}\n\nexport function createTextFormatItem(\n  config: TextFormatConfig\n): SlashMenuActionItem {\n  const { name, icon, id, action } = config;\n  return {\n    name,\n    icon,\n    tooltip: slashMenuToolTips[name],\n    action: ({ rootComponent, model }) => {\n      const { std, host } = rootComponent;\n\n      if (model.text?.length !== 0) {\n        std.command\n          .chain()\n          .formatBlock({\n            blockSelections: [\n              std.selection.create('block', {\n                blockId: model.id,\n              }),\n            ],\n            styles: { [id]: true },\n          })\n          .run();\n      } else {\n        // like format bar when the line is empty\n        action(host);\n      }\n    },\n  };\n}\n"]}