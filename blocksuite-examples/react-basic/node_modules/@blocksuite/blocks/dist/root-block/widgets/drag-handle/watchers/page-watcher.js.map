{"version":3,"file":"page-watcher.js","sourceRoot":"","sources":["../../../../../src/root-block/widgets/drag-handle/watchers/page-watcher.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,kBAAkB,EAAE,MAAM,iCAAiC,CAAC;AAKrE,MAAM,OAAO,WAAW;IACtB,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,MAAM,CAAC,aAAuC,CAAC;IAC7D,CAAC;IAED,YAAqB,MAA8B;QAA9B,WAAM,GAAN,MAAM,CAAwB;IAAG,CAAC;IAEvD,KAAK;QACH,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;QAC1B,MAAM,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC;QACpC,MAAM,eAAe,GAAG,kBAAkB,CAAC,QAAQ,CAAC,CAAC;QAErD,WAAW,CAAC,GAAG,CACb,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAChE,CAAC;QAEF,WAAW,CAAC,GAAG,CACb,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,EAAE,CAAC,GAAG,EAAE;YACrC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;YACnB,IAAI,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;gBAC9B,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,GAAG,IAAI,CAAC;YACxC,CAAC;QACH,CAAC,CAAC,CACH,CAAC;QAEF,WAAW,CAAC,YAAY,CACtB,eAAe,EACf,WAAW,EACX,IAAI,CAAC,MAAM,CAAC,2BAA2B,CACxC,CAAC;IACJ,CAAC;CACF","sourcesContent":["import { getScrollContainer } from '@blocksuite/affine-shared/utils';\n\nimport type { PageRootBlockComponent } from '../../../page/page-root-block.js';\nimport type { AffineDragHandleWidget } from '../drag-handle.js';\n\nexport class PageWatcher {\n  get pageRoot() {\n    return this.widget.rootComponent as PageRootBlockComponent;\n  }\n\n  constructor(readonly widget: AffineDragHandleWidget) {}\n\n  watch() {\n    const { pageRoot } = this;\n    const { disposables } = this.widget;\n    const scrollContainer = getScrollContainer(pageRoot);\n\n    disposables.add(\n      this.widget.doc.slots.blockUpdated.on(() => this.widget.hide())\n    );\n\n    disposables.add(\n      pageRoot.slots.viewportUpdated.on(() => {\n        this.widget.hide();\n        if (this.widget.dropIndicator) {\n          this.widget.dropIndicator.rect = null;\n        }\n      })\n    );\n\n    disposables.addFromEvent(\n      scrollContainer,\n      'scrollend',\n      this.widget.updateDropIndicatorOnScroll\n    );\n  }\n}\n"]}