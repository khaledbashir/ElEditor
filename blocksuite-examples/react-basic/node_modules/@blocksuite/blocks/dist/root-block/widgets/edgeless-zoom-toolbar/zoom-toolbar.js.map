{"version":3,"file":"zoom-toolbar.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/edgeless-zoom-toolbar/zoom-toolbar.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  MinusIcon,\n  PlusIcon,\n  ViewBarIcon,\n} from '@blocksuite/affine-components/icons';\nimport { stopPropagation } from '@blocksuite/affine-shared/utils';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { effect } from '@preact/signals-core';\nimport { baseTheme } from '@toeverything/theme';\nimport { css, html, LitElement, nothing, unsafeCSS } from 'lit';\nimport { property } from 'lit/decorators.js';\n\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nimport { ZOOM_STEP } from '../../edgeless/utils/zoom.js';\n\nexport class EdgelessZoomToolbar extends WithDisposable(LitElement) {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n\n    .edgeless-zoom-toolbar-container {\n      display: flex;\n      align-items: center;\n      background: transparent;\n      border-radius: 8px;\n      fill: currentcolor;\n      padding: 4px;\n    }\n\n    .edgeless-zoom-toolbar-container.horizantal {\n      flex-direction: row;\n    }\n\n    .edgeless-zoom-toolbar-container.vertical {\n      flex-direction: column;\n      width: 40px;\n      background-color: var(--affine-background-overlay-panel-color);\n      box-shadow: var(--affine-shadow-2);\n      border: 1px solid var(--affine-border-color);\n      border-radius: 8px;\n    }\n\n    .edgeless-zoom-toolbar-container[level='second'] {\n      position: absolute;\n      bottom: 8px;\n      transform: translateY(-100%);\n    }\n\n    .edgeless-zoom-toolbar-container[hidden] {\n      display: none;\n    }\n\n    .zoom-percent {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 40px;\n      height: 32px;\n      border: none;\n      box-sizing: border-box;\n      padding: 4px;\n      color: var(--affine-icon-color);\n      background-color: transparent;\n      border-radius: 4px;\n      cursor: pointer;\n      white-space: nowrap;\n      font-size: 12px;\n      font-weight: 500;\n      text-align: center;\n      font-family: ${unsafeCSS(baseTheme.fontSansFamily)};\n    }\n\n    .zoom-percent:hover {\n      color: var(--affine-primary-color);\n      background-color: var(--affine-hover-color);\n    }\n\n    .zoom-percent[disabled] {\n      pointer-events: none;\n      cursor: not-allowed;\n      color: var(--affine-text-disable-color);\n    }\n  `;\n\n  get edgelessService() {\n    return this.edgeless.service;\n  }\n\n  get edgelessTool() {\n    return this.edgeless.gfx.tool.currentToolOption$.peek();\n  }\n\n  get locked() {\n    return this.edgelessService.locked;\n  }\n\n  get viewport() {\n    return this.edgelessService.viewport;\n  }\n\n  get zoom() {\n    if (!this.viewport) {\n      console.error('Something went wrong, viewport is not available');\n      return 1;\n    }\n    return this.viewport.zoom;\n  }\n\n  constructor(edgeless: EdgelessRootBlockComponent) {\n    super();\n    this.edgeless = edgeless;\n  }\n\n  private _isVerticalBar() {\n    return this.layout === 'vertical';\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this.disposables.add(\n      effect(() => {\n        this.edgeless.gfx.tool.currentToolName$.value;\n        this.requestUpdate();\n      })\n    );\n  }\n\n  override firstUpdated() {\n    const { disposables } = this;\n    disposables.add(\n      this.edgeless.service.viewport.viewportUpdated.on(() =>\n        this.requestUpdate()\n      )\n    );\n    disposables.add(\n      this.edgeless.slots.readonlyUpdated.on(() => {\n        this.requestUpdate();\n      })\n    );\n  }\n\n  override render() {\n    if (this.edgeless.doc.readonly) {\n      return nothing;\n    }\n\n    const formattedZoom = `${Math.round(this.zoom * 100)}%`;\n    const classes = `edgeless-zoom-toolbar-container ${this.layout}`;\n    const locked = this.locked;\n\n    return html`\n      <div\n        class=${classes}\n        @dblclick=${stopPropagation}\n        @mousedown=${stopPropagation}\n        @mouseup=${stopPropagation}\n        @pointerdown=${stopPropagation}\n      >\n        <edgeless-tool-icon-button\n          .tooltip=${'Fit to screen'}\n          .tipPosition=${this._isVerticalBar() ? 'right' : 'top-end'}\n          .arrow=${!this._isVerticalBar()}\n          @click=${() => this.edgelessService.zoomToFit()}\n          .iconContainerPadding=${4}\n          .disabled=${locked}\n        >\n          ${ViewBarIcon}\n        </edgeless-tool-icon-button>\n        <edgeless-tool-icon-button\n          .tooltip=${'Zoom out'}\n          .tipPosition=${this._isVerticalBar() ? 'right' : 'top'}\n          .arrow=${!this._isVerticalBar()}\n          @click=${() => this.edgelessService.setZoomByStep(-ZOOM_STEP)}\n          .iconContainerPadding=${4}\n          .disabled=${locked}\n        >\n          ${MinusIcon}\n        </edgeless-tool-icon-button>\n        <button\n          class=\"zoom-percent\"\n          @click=${() => this.viewport.smoothZoom(1)}\n          .disabled=${locked}\n        >\n          ${formattedZoom}\n        </button>\n        <edgeless-tool-icon-button\n          .tooltip=${'Zoom in'}\n          .tipPosition=${this._isVerticalBar() ? 'right' : 'top'}\n          .arrow=${!this._isVerticalBar()}\n          @click=${() => this.edgelessService.setZoomByStep(ZOOM_STEP)}\n          .iconContainerPadding=${4}\n          .disabled=${locked}\n        >\n          ${PlusIcon}\n        </edgeless-tool-icon-button>\n      </div>\n    `;\n  }\n\n  @property({ attribute: false })\n  accessor edgeless: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor layout: 'horizontal' | 'vertical' = 'horizontal';\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-zoom-toolbar': EdgelessZoomToolbar;\n  }\n}\n"]}