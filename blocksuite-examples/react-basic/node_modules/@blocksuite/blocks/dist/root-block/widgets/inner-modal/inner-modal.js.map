{"version":3,"file":"inner-modal.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/inner-modal/inner-modal.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,uBAAuB,CAAC;AACxD,OAAO,EACL,UAAU,EACV,eAAe,EAGf,IAAI,GACL,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AAE9B,MAAM,CAAC,MAAM,yBAAyB,GAAG,2BAA2B,CAAC;AAErE,MAAM,OAAO,sBAAuB,SAAQ,eAAe;IAGzD,IAAI,MAAM;QACR,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,OAAO,IAAI,CAAC,UAAU,EAAE,CAAC;QAC3B,CAAC;QACD,OAAO,QAAQ,CAAC,IAAI,CAAC;IACvB,CAAC;IAED,IAAI,CACF,KAAsB,EACtB,GAA6B;QAE7B,MAAM,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE;YACjD,eAAe,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE;gBAClC,UAAU,EAAE;oBACV,IAAI,CAAC;wBACH,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE;4BACnB,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE;gCACzB,IAAI,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI;gCAC9B,GAAG,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI;gCAC7B,KAAK,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI;gCACnC,MAAM,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,MAAM,IAAI;6BACtC,CAAC,CAAC;wBACL,CAAC;qBACF,CAAC;iBACH;aACF,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC1B,CAAC,CAAC,CAAC;QACH,MAAM,KAAK,GAAG,GAAG,EAAE;YACjB,KAAK,CAAC,MAAM,EAAE,CAAC;YACf,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC;YAChB,MAAM,EAAE,CAAC;QACX,CAAC,CAAC;QACF,OAAO,EAAE,KAAK,EAAE,CAAC;IACnB,CAAC;IAEQ,MAAM;QACb,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,SAAS,CAAC,EAA0B;QAClC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;IACvB,CAAC;CACF","sourcesContent":["import { WidgetComponent } from '@blocksuite/block-std';\nimport {\n  autoUpdate,\n  computePosition,\n  type FloatingElement,\n  type ReferenceElement,\n  size,\n} from '@floating-ui/dom';\nimport { nothing } from 'lit';\n\nexport const AFFINE_INNER_MODAL_WIDGET = 'affine-inner-modal-widget';\n\nexport class AffineInnerModalWidget extends WidgetComponent {\n  private _getTarget?: () => ReferenceElement;\n\n  get target(): ReferenceElement {\n    if (this._getTarget) {\n      return this._getTarget();\n    }\n    return document.body;\n  }\n\n  open(\n    modal: FloatingElement,\n    ops: { onClose?: () => void }\n  ): { close(): void } {\n    const cancel = autoUpdate(this.target, modal, () => {\n      computePosition(this.target, modal, {\n        middleware: [\n          size({\n            apply: ({ rects }) => {\n              Object.assign(modal.style, {\n                left: `${rects.reference.x}px`,\n                top: `${rects.reference.y}px`,\n                width: `${rects.reference.width}px`,\n                height: `${rects.reference.height}px`,\n              });\n            },\n          }),\n        ],\n      }).catch(console.error);\n    });\n    const close = () => {\n      modal.remove();\n      ops.onClose?.();\n      cancel();\n    };\n    return { close };\n  }\n\n  override render() {\n    return nothing;\n  }\n\n  setTarget(fn: () => ReferenceElement) {\n    this._getTarget = fn;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_INNER_MODAL_WIDGET]: AffineInnerModalWidget;\n  }\n}\n"]}