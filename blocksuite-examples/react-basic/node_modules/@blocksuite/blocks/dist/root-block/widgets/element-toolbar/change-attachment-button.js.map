{"version":3,"file":"change-attachment-button.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/element-toolbar/change-attachment-button.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AttachmentBlockModel } from '@blocksuite/affine-model';\nimport type { TemplateResult } from 'lit';\n\nimport {\n  CaptionIcon,\n  DownloadIcon,\n  PaletteIcon,\n} from '@blocksuite/affine-components/icons';\nimport { renderToolbarSeparator } from '@blocksuite/affine-components/toolbar';\nimport { ThemeProvider } from '@blocksuite/affine-shared/services';\nimport { Bound, WithDisposable } from '@blocksuite/global/utils';\nimport { html, LitElement, nothing } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { join } from 'lit/directives/join.js';\n\nimport type { EmbedCardStyle } from '../../../_common/types.js';\nimport type { AttachmentBlockComponent } from '../../../attachment-block/index.js';\nimport type { EdgelessRootBlockComponent } from '../../edgeless/edgeless-root-block.js';\n\nimport {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '../../../_common/consts.js';\nimport { getEmbedCardIcons } from '../../../_common/utils/url.js';\nimport { attachmentViewToggleMenu } from '../../../attachment-block/index.js';\n\nexport class EdgelessChangeAttachmentButton extends WithDisposable(LitElement) {\n  private _download = () => {\n    this._block?.download();\n  };\n\n  private _setCardStyle = (style: EmbedCardStyle) => {\n    const bounds = Bound.deserialize(this.model.xywh);\n    bounds.w = EMBED_CARD_WIDTH[style];\n    bounds.h = EMBED_CARD_HEIGHT[style];\n    const xywh = bounds.serialize();\n    this.model.doc.updateBlock(this.model, { style, xywh });\n  };\n\n  private _showCaption = () => {\n    this._block?.captionEditor?.show();\n  };\n\n  private get _block() {\n    const block = this.std.view.getBlock(this.model.id);\n    if (!block) return null;\n    return block as AttachmentBlockComponent;\n  }\n\n  private get _doc() {\n    return this.model.doc;\n  }\n\n  private get _getCardStyleOptions(): {\n    style: EmbedCardStyle;\n    Icon: TemplateResult<1>;\n    tooltip: string;\n  }[] {\n    const theme = this.std.get(ThemeProvider).theme;\n    const { EmbedCardListIcon, EmbedCardCubeIcon } = getEmbedCardIcons(theme);\n    return [\n      {\n        style: 'horizontalThin',\n        Icon: EmbedCardListIcon,\n        tooltip: 'Horizontal style',\n      },\n      {\n        style: 'cubeThick',\n        Icon: EmbedCardCubeIcon,\n        tooltip: 'Vertical style',\n      },\n    ];\n  }\n\n  get std() {\n    return this.edgeless.std;\n  }\n\n  get viewToggleMenu() {\n    const block = this._block;\n    const model = this.model;\n    if (!block || !model) return nothing;\n\n    return attachmentViewToggleMenu({\n      block,\n      callback: () => this.requestUpdate(),\n    });\n  }\n\n  override render() {\n    return join(\n      [\n        this.model.style === 'pdf'\n          ? null\n          : html`\n              <editor-menu-button\n                .contentPadding=${'8px'}\n                .button=${html`\n                  <editor-icon-button\n                    aria-label=\"Card style\"\n                    .tooltip=${'Card style'}\n                  >\n                    ${PaletteIcon}\n                  </editor-icon-button>\n                `}\n              >\n                <card-style-panel\n                  .value=${this.model.style}\n                  .options=${this._getCardStyleOptions}\n                  .onSelect=${this._setCardStyle}\n                >\n                </card-style-panel>\n              </editor-menu-button>\n            `,\n        this.viewToggleMenu,\n        html`\n          <editor-icon-button\n            aria-label=\"Download\"\n            .tooltip=${'Download'}\n            ?disabled=${this._doc.readonly}\n            @click=${this._download}\n          >\n            ${DownloadIcon}\n          </editor-icon-button>\n        `,\n        html`\n          <editor-icon-button\n            aria-label=\"Add caption\"\n            .tooltip=${'Add caption'}\n            class=\"change-attachment-button caption\"\n            ?disabled=${this._doc.readonly}\n            @click=${this._showCaption}\n          >\n            ${CaptionIcon}\n          </editor-icon-button>\n        `,\n      ].filter(button => button !== nothing && button),\n      renderToolbarSeparator\n    );\n  }\n\n  @property({ attribute: false })\n  accessor edgeless!: EdgelessRootBlockComponent;\n\n  @property({ attribute: false })\n  accessor model!: AttachmentBlockModel;\n}\n\nexport function renderAttachmentButton(\n  edgeless: EdgelessRootBlockComponent,\n  attachments?: AttachmentBlockModel[]\n) {\n  if (attachments?.length !== 1) return nothing;\n\n  return html`\n    <edgeless-change-attachment-button\n      .model=${attachments[0]}\n      .edgeless=${edgeless}\n    ></edgeless-change-attachment-button>\n  `;\n}\n"]}