{"version":3,"file":"drag-handle.js","sourceRoot":"","sources":["../../../../src/root-block/widgets/drag-handle/drag-handle.ts"],"names":[],"mappings":"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","sourcesContent":["import type { RootBlockModel } from '@blocksuite/affine-model';\nimport type { GfxBlockElementModel } from '@blocksuite/block-std/gfx';\nimport type { IVec } from '@blocksuite/global/utils';\n\nimport {\n  DocModeProvider,\n  DragHandleConfigIdentifier,\n  type DropType,\n} from '@blocksuite/affine-shared/services';\nimport {\n  getScrollContainer,\n  isInsideEdgelessEditor,\n  isInsidePageEditor,\n  matchFlavours,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  type BlockComponent,\n  type DndEventState,\n  WidgetComponent,\n} from '@blocksuite/block-std';\nimport { DisposableGroup, Point, Rect } from '@blocksuite/global/utils';\nimport { computed, type ReadonlySignal, signal } from '@preact/signals-core';\nimport { html } from 'lit';\nimport { query, state } from 'lit/decorators.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { EdgelessRootService } from '../../edgeless/index.js';\nimport type { DragPreview } from './components/drag-preview.js';\nimport type { DropIndicator } from './components/drop-indicator.js';\nimport type { DropResult } from './config.js';\nimport type { AFFINE_DRAG_HANDLE_WIDGET } from './consts.js';\n\nimport { isTopLevelBlock } from '../../../root-block/edgeless/utils/query.js';\nimport { autoScroll } from '../../../root-block/text-selection/utils.js';\nimport { DragHandleOptionsRunner } from './config.js';\nimport { PreviewHelper } from './helpers/preview-helper.js';\nimport { RectHelper } from './helpers/rect-helper.js';\nimport { SelectionHelper } from './helpers/selection-helper.js';\nimport { styles } from './styles.js';\nimport {\n  calcDropTarget,\n  containBlock,\n  containChildBlock,\n  getClosestBlockByPoint,\n  getClosestNoteBlock,\n  isOutOfNoteBlock,\n  updateDragHandleClassName,\n} from './utils.js';\nimport { DragEventWatcher } from './watchers/drag-event-watcher.js';\nimport { EdgelessWatcher } from './watchers/edgeless-watcher.js';\nimport { HandleEventWatcher } from './watchers/handle-event-watcher.js';\nimport { KeyboardEventWatcher } from './watchers/keyboard-event-watcher.js';\nimport { LegacyDragEventWatcher } from './watchers/legacy-drag-event-watcher.js';\nimport { PageWatcher } from './watchers/page-watcher.js';\nimport { PointerEventWatcher } from './watchers/pointer-event-watcher.js';\n\nexport class AffineDragHandleWidget extends WidgetComponent<RootBlockModel> {\n  static override styles = styles;\n\n  private _anchorModelDisposables: DisposableGroup | null = null;\n\n  private _dragEventWatcher = new DragEventWatcher(this);\n\n  private _getBlockView = (blockId: string) => {\n    return this.host.view.getBlock(blockId);\n  };\n\n  /**\n   * When dragging, should update indicator position and target drop block id\n   */\n  private _getDropResult = (state: DndEventState): DropResult | null => {\n    const point = new Point(state.raw.x, state.raw.y);\n    const closestBlock = getClosestBlockByPoint(\n      this.host,\n      this.rootComponent,\n      point\n    );\n    if (!closestBlock) return null;\n\n    const blockId = closestBlock.model.id;\n    const model = closestBlock.model;\n\n    const isDatabase = matchFlavours(model, ['affine:database']);\n    if (isDatabase) return null;\n\n    // note block can only be dropped into another note block\n    // prevent note block from being dropped into other blocks\n    const isDraggedElementNote =\n      this.draggingElements.length === 1 &&\n      matchFlavours(this.draggingElements[0].model, ['affine:note']);\n\n    if (isDraggedElementNote) {\n      const parent = this.std.doc.getParent(closestBlock.model);\n      if (!parent) return null;\n      const parentElement = this._getBlockView(parent.id);\n      if (!parentElement) return null;\n      if (!matchFlavours(parentElement.model, ['affine:note'])) return null;\n    }\n\n    // Should make sure that target drop block is\n    // neither within the dragging elements\n    // nor a child-block of any dragging elements\n    if (\n      containBlock(\n        this.draggingElements.map(block => block.model.id),\n        blockId\n      ) ||\n      containChildBlock(this.draggingElements, model)\n    ) {\n      return null;\n    }\n\n    let rect = null;\n    let dropType: DropType = 'before';\n\n    const result = calcDropTarget(\n      point,\n      model,\n      closestBlock,\n      this.draggingElements,\n      this.scale.peek(),\n      isDraggedElementNote === false\n    );\n\n    if (result) {\n      rect = result.rect;\n      dropType = result.dropType;\n    }\n\n    if (isDraggedElementNote && dropType === 'in') return null;\n\n    const dropIndicator = {\n      rect,\n      dropBlockId: blockId,\n      dropType,\n    };\n\n    return dropIndicator;\n  };\n\n  private _handleEventWatcher = new HandleEventWatcher(this);\n\n  private _keyboardEventWatcher = new KeyboardEventWatcher(this);\n\n  private _legacyDragEventWatcher = new LegacyDragEventWatcher(this);\n\n  private _pageWatcher = new PageWatcher(this);\n\n  private _removeDropIndicator = () => {\n    if (this.dropIndicator) {\n      this.dropIndicator.remove();\n      this.dropIndicator = null;\n    }\n  };\n\n  private _reset = () => {\n    this.draggingElements = [];\n    this.dropBlockId = '';\n    this.dropType = null;\n    this.lastDragPointerState = null;\n    this.rafID = 0;\n    this.dragging = false;\n\n    this.dragHoverRect = null;\n    this.anchorBlockId.value = null;\n    this.isDragHandleHovered = false;\n    this.isHoverDragHandleVisible = false;\n    this.isTopLevelDragHandleVisible = false;\n\n    this.pointerEventWatcher.reset();\n\n    this.previewHelper.removeDragPreview();\n    this._removeDropIndicator();\n    this._resetCursor();\n  };\n\n  private _resetCursor = () => {\n    document.documentElement.classList.remove('affine-drag-preview-grabbing');\n  };\n\n  private _resetDropResult = () => {\n    this.dropBlockId = '';\n    this.dropType = null;\n    if (this.dropIndicator) this.dropIndicator.rect = null;\n  };\n\n  private _updateDropResult = (dropResult: DropResult | null) => {\n    if (!this.dropIndicator) return;\n    this.dropBlockId = dropResult?.dropBlockId ?? '';\n    this.dropType = dropResult?.dropType ?? null;\n    if (dropResult?.rect) {\n      const offsetParentRect =\n        this.dragHandleContainerOffsetParent.getBoundingClientRect();\n      let { left, top } = dropResult.rect;\n      left -= offsetParentRect.left;\n      top -= offsetParentRect.top;\n\n      const { width, height } = dropResult.rect;\n\n      const rect = Rect.fromLWTH(left, width, top, height);\n      this.dropIndicator.rect = rect;\n    } else {\n      this.dropIndicator.rect = dropResult?.rect ?? null;\n    }\n  };\n\n  anchorBlockId = signal<string | null>(null);\n\n  anchorBlockComponent = computed<BlockComponent | null>(() => {\n    if (!this.anchorBlockId.value) return null;\n\n    return this.std.view.getBlock(this.anchorBlockId.value);\n  });\n\n  anchorEdgelessElement: ReadonlySignal<GfxBlockElementModel | null> = computed(\n    () => {\n      if (!this.anchorBlockId.value) return null;\n      if (this.mode === 'page') return null;\n\n      const service = this.std.getService('affine:page') as EdgelessRootService;\n      const edgelessElement = service.getElementById(this.anchorBlockId.value);\n      return isTopLevelBlock(edgelessElement) ? edgelessElement : null;\n    }\n  );\n\n  // Single block: drag handle should show on the vertical middle of the first line of element\n  center: IVec = [0, 0];\n\n  dragging = false;\n\n  rectHelper = new RectHelper(this);\n\n  draggingAreaRect: ReadonlySignal<Rect | null> = computed(\n    this.rectHelper.getDraggingAreaRect\n  );\n\n  draggingElements: BlockComponent[] = [];\n\n  dragPreview: DragPreview | null = null;\n\n  dropBlockId = '';\n\n  dropIndicator: DropIndicator | null = null;\n\n  dropType: DropType | null = null;\n\n  edgelessWatcher = new EdgelessWatcher(this);\n\n  handleAnchorModelDisposables = () => {\n    const block = this.anchorBlockComponent.peek();\n    if (!block) return;\n    const blockModel = block.model;\n\n    if (this._anchorModelDisposables) {\n      this._anchorModelDisposables.dispose();\n      this._anchorModelDisposables = null;\n    }\n\n    this._anchorModelDisposables = new DisposableGroup();\n    this._anchorModelDisposables.add(\n      blockModel.propsUpdated.on(() => this.hide())\n    );\n\n    this._anchorModelDisposables.add(blockModel.deleted.on(() => this.hide()));\n  };\n\n  hide = (force = false) => {\n    if (this.dragging && !force) return;\n    updateDragHandleClassName();\n\n    this.isHoverDragHandleVisible = false;\n    this.isTopLevelDragHandleVisible = false;\n    this.isDragHandleHovered = false;\n\n    this.anchorBlockId.value = null;\n\n    if (this.dragHandleContainer) {\n      this.dragHandleContainer.style.display = 'none';\n    }\n\n    if (force) {\n      this._reset();\n    }\n  };\n\n  isDragHandleHovered = false;\n\n  isHoverDragHandleVisible = false;\n\n  isTopLevelDragHandleVisible = false;\n\n  lastDragPointerState: DndEventState | null = null;\n\n  noteScale = signal(1);\n\n  readonly optionRunner = new DragHandleOptionsRunner();\n\n  pointerEventWatcher = new PointerEventWatcher(this);\n\n  previewHelper = new PreviewHelper(this);\n\n  rafID = 0;\n\n  scale = signal(1);\n\n  scaleInNote = computed(() => this.scale.value * this.noteScale.value);\n\n  selectionHelper = new SelectionHelper(this);\n\n  updateDropIndicator = (\n    state: DndEventState,\n    shouldAutoScroll: boolean = false\n  ) => {\n    const point = new Point(state.raw.x, state.raw.y);\n    const closestNoteBlock = getClosestNoteBlock(\n      this.host,\n      this.rootComponent,\n      point\n    );\n    if (\n      !closestNoteBlock ||\n      isOutOfNoteBlock(this.host, closestNoteBlock, point, this.scale.peek())\n    ) {\n      this._resetDropResult();\n    } else {\n      const dropResult = this._getDropResult(state);\n      this._updateDropResult(dropResult);\n    }\n\n    this.lastDragPointerState = state;\n    if (this.mode === 'page') {\n      if (!shouldAutoScroll) return;\n\n      const scrollContainer = getScrollContainer(this.rootComponent);\n      const result = autoScroll(scrollContainer, state.raw.y);\n      if (!result) {\n        this.clearRaf();\n        return;\n      }\n      this.rafID = requestAnimationFrame(() =>\n        this.updateDropIndicator(state, true)\n      );\n    } else {\n      this.clearRaf();\n    }\n  };\n\n  updateDropIndicatorOnScroll = () => {\n    if (\n      !this.dragging ||\n      this.draggingElements.length === 0 ||\n      !this.lastDragPointerState\n    )\n      return;\n\n    const state = this.lastDragPointerState;\n    this.rafID = requestAnimationFrame(() =>\n      this.updateDropIndicator(state, false)\n    );\n  };\n\n  private get _enableNewDnd() {\n    return this.std.doc.awarenessStore.getFlag('enable_new_dnd') ?? true;\n  }\n\n  get dragHandleContainerOffsetParent() {\n    return this.dragHandleContainer.parentElement!;\n  }\n\n  get mode() {\n    return this.std.get(DocModeProvider).getEditorMode();\n  }\n\n  get rootComponent() {\n    return this.block;\n  }\n\n  clearRaf() {\n    if (this.rafID) {\n      cancelAnimationFrame(this.rafID);\n      this.rafID = 0;\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.std.provider.getAll(DragHandleConfigIdentifier).forEach(config => {\n      this.optionRunner.register(config);\n    });\n\n    this.pointerEventWatcher.watch();\n    this._keyboardEventWatcher.watch();\n    if (this._enableNewDnd) {\n      this._dragEventWatcher.watch();\n    } else {\n      this._legacyDragEventWatcher.watch();\n    }\n  }\n\n  override disconnectedCallback() {\n    this.hide(true);\n    this._disposables.dispose();\n    this._anchorModelDisposables?.dispose();\n    super.disconnectedCallback();\n  }\n\n  override firstUpdated() {\n    this.hide(true);\n    this._disposables.addFromEvent(this.host, 'pointerleave', () => {\n      this.hide();\n    });\n\n    this._handleEventWatcher.watch();\n\n    if (isInsidePageEditor(this.host)) {\n      this._pageWatcher.watch();\n    } else if (isInsideEdgelessEditor(this.host)) {\n      this.edgelessWatcher.watch();\n    }\n  }\n\n  override render() {\n    const hoverRectStyle = styleMap(\n      this.dragHoverRect\n        ? {\n            width: `${this.dragHoverRect.width}px`,\n            height: `${this.dragHoverRect.height}px`,\n            top: `${this.dragHoverRect.top}px`,\n            left: `${this.dragHoverRect.left}px`,\n          }\n        : {\n            display: 'none',\n          }\n    );\n\n    return html`\n      <div class=\"affine-drag-handle-widget\">\n        <div class=\"affine-drag-handle-container\" draggable=\"true\">\n          <div class=\"affine-drag-handle-grabber\"></div>\n        </div>\n        <div class=\"affine-drag-hover-rect\" style=${hoverRectStyle}></div>\n      </div>\n    `;\n  }\n\n  @query('.affine-drag-handle-container')\n  accessor dragHandleContainer!: HTMLDivElement;\n\n  @query('.affine-drag-handle-grabber')\n  accessor dragHandleGrabber!: HTMLDivElement;\n\n  @state()\n  accessor dragHoverRect: {\n    width: number;\n    height: number;\n    left: number;\n    top: number;\n  } | null = null;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [AFFINE_DRAG_HANDLE_WIDGET]: AffineDragHandleWidget;\n  }\n}\n"]}