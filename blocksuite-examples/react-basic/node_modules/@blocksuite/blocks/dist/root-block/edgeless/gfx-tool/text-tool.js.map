{"version":3,"file":"text-tool.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/gfx-tool/text-tool.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AACvE,OAAO,EAAE,QAAQ,EAAsB,MAAM,2BAA2B,CAAC;AACzE,OAAO,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AACjD,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAIlD,OAAO,EAAE,sBAAsB,EAAE,MAAM,kBAAkB,CAAC;AAE1D,MAAM,UAAU,OAAO,CAAC,GAAkB,EAAE,KAAwB;IAClE,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAC3D,MAAM,QAAQ,GAAG,GAAG,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAE7C,IAAI,CAAC,QAAQ,EAAE,CAAC;QACd,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;QAErE,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;YACjB,OAAO;QACT,CAAC;QAED,MAAM,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC;YAChC,IAAI,EAAE,MAAM;YACZ,IAAI,EAAE,IAAI,KAAK,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,SAAS,EAAE;YACnD,IAAI,EAAE,IAAI,aAAa,CAAC,CAAC,CAAC,IAAI,EAAE;SACjC,CAAC,CAAC;QACH,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;QACtB,MAAM,WAAW,GAAG,GAAG,CAAC,cAAc,CAAC,EAAE,CAAqB,CAAC;QAC/D,MAAM,YAAY,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,IAAK,CAAC,EAAE,CAAC,CAAC;QACjE,sBAAsB,CACpB,WAAW,EACX,YAA0C,CAC3C,CAAC;IACJ,CAAC;AACH,CAAC;AAED,MAAM,OAAO,QAAS,SAAQ,QAAQ;aACpB,aAAQ,GAAW,MAAM,CAAC;IAEjC,KAAK,CAAC,CAAoB;QACjC,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,OAAO,CAClD,sBAAsB,CACvB,CAAC;QAEF,IAAI,QAAQ,EAAE,CAAC;YACb,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YACxD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YAC1D,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACnC,CAAC;aAAM,CAAC;YACN,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;QACvB,CAAC;QAED,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,iBAAiB,CAAC,EAAE,KAAK,CAAC,oBAAoB,EAAE;YACvE,OAAO,EAAE,aAAa;YACtB,IAAI,EAAE,mBAAmB;YACzB,MAAM,EAAE,SAAS;YACjB,OAAO,EAAE,SAAS;YAClB,IAAI,EAAE,MAAM;SACb,CAAC,CAAC;IACL,CAAC","sourcesContent":["import type { TextElementModel } from '@blocksuite/affine-model';\nimport type { PointerEventState } from '@blocksuite/block-std';\n\nimport { TelemetryProvider } from '@blocksuite/affine-shared/services';\nimport { BaseTool, type GfxController } from '@blocksuite/block-std/gfx';\nimport { Bound } from '@blocksuite/global/utils';\nimport { DocCollection } from '@blocksuite/store';\n\nimport type { EdgelessRootBlockComponent } from '../edgeless-root-block.js';\n\nimport { mountTextElementEditor } from '../utils/text.js';\n\nexport function addText(gfx: GfxController, event: PointerEventState) {\n  const [x, y] = gfx.viewport.toModelCoord(event.x, event.y);\n  const selected = gfx.getElementByPoint(x, y);\n\n  if (!selected) {\n    const [modelX, modelY] = gfx.viewport.toModelCoord(event.x, event.y);\n\n    if (!gfx.surface) {\n      return;\n    }\n\n    const id = gfx.surface.addElement({\n      type: 'text',\n      xywh: new Bound(modelX, modelY, 32, 32).serialize(),\n      text: new DocCollection.Y.Text(),\n    });\n    gfx.doc.captureSync();\n    const textElement = gfx.getElementById(id) as TextElementModel;\n    const edgelessView = gfx.std.view.getBlock(gfx.std.doc.root!.id);\n    mountTextElementEditor(\n      textElement,\n      edgelessView as EdgelessRootBlockComponent\n    );\n  }\n}\n\nexport class TextTool extends BaseTool {\n  static override toolName: string = 'text';\n\n  override click(e: PointerEventState): void {\n    const textFlag = this.gfx.doc.awarenessStore.getFlag(\n      'enable_edgeless_text'\n    );\n\n    if (textFlag) {\n      const [x, y] = this.gfx.viewport.toModelCoord(e.x, e.y);\n      this.gfx.std.command.exec('insertEdgelessText', { x, y });\n      this.gfx.tool.setTool('default');\n    } else {\n      addText(this.gfx, e);\n    }\n\n    this.gfx.std.getOptional(TelemetryProvider)?.track('CanvasElementAdded', {\n      control: 'canvas:draw',\n      page: 'whiteboard editor',\n      module: 'toolbar',\n      segment: 'toolbar',\n      type: 'text',\n    });\n  }\n}\n\ndeclare module '@blocksuite/block-std/gfx' {\n  interface GfxToolsMap {\n    text: TextTool;\n  }\n}\n"]}