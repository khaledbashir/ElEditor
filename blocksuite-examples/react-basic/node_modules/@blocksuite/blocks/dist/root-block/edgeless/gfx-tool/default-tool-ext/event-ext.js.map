{"version":3,"file":"event-ext.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/gfx-tool/default-tool-ext/event-ext.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,0BAA0B,CAAC;AAEvD,OAAO,EAAE,mBAAmB,EAAE,cAAc,EAAE,MAAM,UAAU,CAAC;AAE/D,MAAM,OAAO,qBAAsB,SAAQ,cAAc;IAAzD;;QACU,uBAAkB,GAA0B,EAAE,CAAC;QAE9C,uBAAkB,GAA0B;YACnD,mBAAmB,CAAC,IAAI;SACzB,CAAC;IAoDJ,CAAC;IAlDS,mBAAmB,CACzB,QAA6C,EAC7C,GAAG,GAAG,IAAI,CAAC,kBAAkB;QAE7B,KAAK,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YACzC,MAAM,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;YAEpB,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjB,CAAC;IACH,CAAC;IAEQ,KAAK,CAAC,IAAuB;QACpC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IACzD,CAAC;IAEQ,QAAQ,CAAC,IAAuB;QACvC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;IAC5D,CAAC;IAEQ,WAAW,CAAC,IAAuB;QAC1C,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,QAAQ,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;IAC/D,CAAC;IAEQ,WAAW,CAAC,IAAuB;QAC1C,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QAC9D,MAAM,eAAe,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI;aAClC,MAAM,CAAC,IAAI,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE;YAC7B,MAAM,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC;SAC5B,CAAC;aACD,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAA0B,CAAC;QACnE,MAAM,mBAAmB,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC7D,MAAM,OAAO,GAAG,IAAI,GAAG,EAAuB,CAAC;QAE/C,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE;YAC9B,IAAI,mBAAmB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;gBAClC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAClB,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YACrC,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;YACtC,CAAC;QACH,CAAC,EAAE,eAAe,CAAC,CAAC;QACpB,IAAI,CAAC,mBAAmB,CACtB,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,IAAI,CAAC,CAClE,CAAC;QACF,IAAI,CAAC,kBAAkB,GAAG,eAAe,CAAC;IAC5C,CAAC;IAEQ,SAAS,CAAC,IAAuB;QACxC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,QAAQ,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IAC7D,CAAC;CACF","sourcesContent":["import type { PointerEventState } from '@blocksuite/block-std';\nimport type { GfxElementModelView } from '@blocksuite/block-std/gfx';\n\nimport { Bound, last } from '@blocksuite/global/utils';\n\nimport { DefaultModeDragType, DefaultToolExt } from './ext.js';\n\nexport class CanvasElementEventExt extends DefaultToolExt {\n  private _currentStackedElm: GfxElementModelView[] = [];\n\n  override supportedDragTypes: DefaultModeDragType[] = [\n    DefaultModeDragType.None,\n  ];\n\n  private _callInReverseOrder(\n    callback: (view: GfxElementModelView) => void,\n    arr = this._currentStackedElm\n  ) {\n    for (let i = arr.length - 1; i >= 0; i--) {\n      const view = arr[i];\n\n      callback(view);\n    }\n  }\n\n  override click(_evt: PointerEventState): void {\n    last(this._currentStackedElm)?.dispatch('click', _evt);\n  }\n\n  override dblClick(_evt: PointerEventState): void {\n    last(this._currentStackedElm)?.dispatch('dblclick', _evt);\n  }\n\n  override pointerDown(_evt: PointerEventState): void {\n    last(this._currentStackedElm)?.dispatch('pointerdown', _evt);\n  }\n\n  override pointerMove(_evt: PointerEventState): void {\n    const [x, y] = this.gfx.viewport.toModelCoord(_evt.x, _evt.y);\n    const hoveredElmViews = this.gfx.grid\n      .search(new Bound(x, y, 1, 1), {\n        filter: ['canvas', 'local'],\n      })\n      .map(model => this.gfx.view.get(model)) as GfxElementModelView[];\n    const currentStackedViews = new Set(this._currentStackedElm);\n    const visited = new Set<GfxElementModelView>();\n\n    this._callInReverseOrder(view => {\n      if (currentStackedViews.has(view)) {\n        visited.add(view);\n        view.dispatch('pointermove', _evt);\n      } else {\n        view.dispatch('pointerenter', _evt);\n      }\n    }, hoveredElmViews);\n    this._callInReverseOrder(\n      view => !visited.has(view) && view.dispatch('pointerleave', _evt)\n    );\n    this._currentStackedElm = hoveredElmViews;\n  }\n\n  override pointerUp(_evt: PointerEventState): void {\n    last(this._currentStackedElm)?.dispatch('pointerup', _evt);\n  }\n}\n"]}