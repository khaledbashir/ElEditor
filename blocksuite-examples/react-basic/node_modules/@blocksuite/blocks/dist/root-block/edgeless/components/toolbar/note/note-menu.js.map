{"version":3,"file":"note-menu.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/note/note-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import type { GfxToolsFullOptionValue } from '@blocksuite/block-std/gfx';\n\nimport { AttachmentIcon, LinkIcon } from '@blocksuite/affine-components/icons';\nimport { TelemetryProvider } from '@blocksuite/affine-shared/services';\nimport { effect } from '@preact/signals-core';\nimport { css, html, LitElement } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { NoteToolOption } from '../../../gfx-tool/note-tool.js';\n\nimport {\n  getImageFilesFromLocal,\n  type NoteChildrenFlavour,\n  openFileOrFiles,\n} from '../../../../../_common/utils/index.js';\nimport { ImageIcon } from '../../../../../image-block/styles.js';\nimport { addAttachments, addImages } from '../../../utils/common.js';\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { NOTE_MENU_ITEMS } from './note-menu-config.js';\n\nexport class EdgelessNoteMenu extends EdgelessToolbarToolMixin(LitElement) {\n  static override styles = css`\n    :host {\n      position: absolute;\n      display: flex;\n      z-index: -1;\n    }\n    .menu-content {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .button-group-container {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 14px;\n      fill: var(--affine-icon-color);\n    }\n    .button-group-container svg {\n      width: 20px;\n      height: 20px;\n    }\n    .divider {\n      width: 1px;\n      height: 24px;\n      background: var(--affine-border-color);\n      transform: scaleX(0.5);\n      margin: 0 14px;\n    }\n  `;\n\n  override type: GfxToolsFullOptionValue['type'] = 'affine:note';\n\n  private async _addImages() {\n    this._imageLoading = true;\n    const imageFiles = await getImageFilesFromLocal();\n    const ids = await addImages(this.edgeless.std, imageFiles);\n    this._imageLoading = false;\n    this.edgeless.gfx.tool.setTool('default');\n    this.edgeless.gfx.selection.set({ elements: ids });\n  }\n\n  private _onHandleLinkButtonClick() {\n    const { insertedLinkType } = this.edgeless.service.std.command.exec(\n      'insertLinkByQuickSearch'\n    );\n\n    insertedLinkType\n      ?.then(type => {\n        const flavour = type?.flavour;\n        if (!flavour) return;\n\n        this.edgeless.std\n          .getOptional(TelemetryProvider)\n          ?.track('CanvasElementAdded', {\n            control: 'toolbar:general',\n            page: 'whiteboard editor',\n            module: 'toolbar',\n            type: flavour.split(':')[1],\n          });\n      })\n      .catch(console.error);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n  }\n\n  override firstUpdated() {\n    this.disposables.add(\n      effect(() => {\n        const tool = this.edgeless.gfx.tool.currentToolOption$.value;\n\n        if (tool?.type !== 'affine:note') return;\n        this.childFlavour = tool.childFlavour;\n        this.childType = tool.childType;\n        this.tip = tool.tip;\n      })\n    );\n  }\n\n  override render() {\n    const { childType } = this;\n\n    return html`\n      <edgeless-slide-menu>\n        <div class=\"menu-content\">\n          <!-- add to edgeless -->\n          <div class=\"button-group-container\">\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${'Image'}\n              @click=${this._addImages}\n              .disabled=${this._imageLoading}\n            >\n              ${ImageIcon}\n            </edgeless-tool-icon-button>\n\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${getTooltipWithShortcut('Link', '@')}\n              @click=${() => {\n                this._onHandleLinkButtonClick();\n              }}\n            >\n              ${LinkIcon}\n            </edgeless-tool-icon-button>\n\n            <edgeless-tool-icon-button\n              .activeMode=${'background'}\n              .tooltip=${'File'}\n              @click=${async () => {\n                const file = await openFileOrFiles();\n                if (!file) return;\n                await addAttachments(this.edgeless.std, [file]);\n                this.edgeless.gfx.tool.setTool('default');\n                this.edgeless.std\n                  .getOptional(TelemetryProvider)\n                  ?.track('CanvasElementAdded', {\n                    control: 'toolbar:general',\n                    page: 'whiteboard editor',\n                    module: 'toolbar',\n                    segment: 'toolbar',\n                    type: 'attachment',\n                  });\n              }}\n            >\n              ${AttachmentIcon}\n            </edgeless-tool-icon-button>\n          </div>\n\n          <div class=\"divider\"></div>\n\n          <!-- add to note -->\n          <div class=\"button-group-container\">\n            ${repeat(\n              NOTE_MENU_ITEMS,\n              item => item.childFlavour,\n              item => html`\n                <edgeless-tool-icon-button\n                  .active=${childType === item.childType}\n                  .activeMode=${'background'}\n                  .tooltip=${item.tooltip}\n                  @click=${() =>\n                    this.onChange({\n                      childFlavour: item.childFlavour,\n                      childType: item.childType,\n                      tip: item.tooltip,\n                    })}\n                >\n                  ${item.icon}\n                </edgeless-tool-icon-button>\n              `\n            )}\n          </div>\n        </div>\n      </edgeless-slide-menu>\n    `;\n  }\n\n  @state()\n  private accessor _imageLoading = false;\n\n  @property({ attribute: false })\n  accessor childFlavour!: NoteChildrenFlavour;\n\n  @property({ attribute: false })\n  accessor childType!: string | null;\n\n  @property({ attribute: false })\n  accessor onChange!: (\n    props: Partial<{\n      childFlavour: NoteToolOption['childFlavour'];\n      childType: string | null;\n      tip: string;\n    }>\n  ) => void;\n\n  @property({ attribute: false })\n  accessor tip!: string;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-note-menu': EdgelessNoteMenu;\n  }\n}\n"]}