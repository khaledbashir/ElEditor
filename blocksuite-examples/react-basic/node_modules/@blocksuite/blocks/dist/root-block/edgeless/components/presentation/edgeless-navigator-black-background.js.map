{"version":3,"file":"edgeless-navigator-black-background.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/presentation/edgeless-navigator-black-background.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,OAAO,EAAE,cAAc,EAAE,MAAM,oCAAoC,CAAC;AACpE,OAAO,EAAE,eAAe,EAAE,MAAM,uBAAuB,CAAC;AACxD,OAAO,EAAE,uBAAuB,EAAE,MAAM,2BAA2B,CAAC;AACpE,OAAO,EAAE,KAAK,EAAE,MAAM,0BAA0B,CAAC;AACjD,OAAO,EAAE,MAAM,EAAE,MAAM,sBAAsB,CAAC;AAC9C,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAI1C,MAAM,CAAC,MAAM,0CAA0C,GACrD,qCAAqC,CAAC;IAC3B,sCAAsC;sBAAS,eAAe;;;;;;;iBAA9D,sCAAuC,SAAQ,WAG3D;;;iCA8FE,KAAK,EAAE;gCAGP,KAAK,EAAE;YAFR,oKAAiB,KAAK,6BAAL,KAAK,qFAA0C;YAGhE,iKAAiB,IAAI,6BAAJ,IAAI,mFAAS;;;iBAjGd,WAAM,GAAG,GAAG,CAAA;;;;;;;;GAQ3B,AARqB,CAQpB;QAIF,IAAI,GAAG;YACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QAC/C,CAAC;QAEO,uBAAuB;YAC7B,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG;iBACnB,GAAG,CAAC,cAAc,CAAC;iBACnB,UAAU,CAAC,wBAAwB,CAAC,CAAC;YACxC,IAAI,CAAC,gBAAgB,GAAG,KAAK,IAAI,IAAI,CAAC;QACxC,CAAC;QAEQ,YAAY;YACnB,MAAM,EAAE,YAAY,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;YAC1C,YAAY,CAAC,GAAG,CACd,KAAK,CAAC,KAAK,CAAC,qBAAqB,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE;gBAC3C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACrB,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CACd,KAAK,CAAC,KAAK,CAAC,uBAAuB,CAAC,EAAE,CAAC,CAAC,EAAE,eAAe,EAAE,EAAE,EAAE;gBAC7D,IAAI,eAAe,KAAK,SAAS,EAAE,CAAC;oBAClC,IAAI,CAAC,GAAG;yBACL,GAAG,CAAC,cAAc,CAAC;yBACnB,UAAU,CAAC,wBAAwB,EAAE,eAAe,CAAC,CAAC;oBAEzD,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;oBAExC,IAAI,CAAC,IAAI;wBACP,eAAe;4BACf,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,gBAAgB,CAAC;gBACvE,CAAC;YACH,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CACd,MAAM,CAAC,GAAG,EAAE;gBACV,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC;gBAE7C,IAAI,IAAI,KAAK,gBAAgB,EAAE,CAAC;oBAC9B,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;gBACpB,CAAC;qBAAM,CAAC;oBACN,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC;gBACpC,CAAC;YACH,CAAC,CAAC,CACH,CAAC;YAEF,YAAY,CAAC,GAAG,CACd,KAAK,CAAC,KAAK,CAAC,iBAAiB,CAAC,EAAE,CAC9B,GAAG,EAAE,CACH,UAAU,CAAC,GAAG,EAAE;gBACd,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,CAAC,EAAE,GAAG,CAAC,CAAC,iCAAiC;aAC5C,CACF,CAAC;YAEF,IAAI,CAAC,uBAAuB,EAAE,CAAC;QACjC,CAAC;QAEQ,MAAM;YACb,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;YAElC,IAAI,CAAC,IAAI,IAAI,CAAC,KAAK;gBAAE,OAAO,OAAO,CAAC;YAEpC,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC5C,MAAM,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC;YAC/B,MAAM,KAAK,GAAG,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC;YAC7B,MAAM,MAAM,GAAG,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC;YAC9B,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;YAE1D,OAAO,IAAI,CAAA;;mBAEI,KAAK;oBACJ,MAAM;iBACT,CAAC;kBACA,CAAC;;;8DAG2C,CAAC;QAC7D,CAAC;QAGD,wBAAgE;QAAhE,IAAiB,KAAK,2CAA0C;QAAhE,IAAiB,KAAK,iDAA0C;QAGhE,uBAA8B;QAA9B,IAAiB,IAAI,0CAAS;QAA9B,IAAiB,IAAI,gDAAS;;;YAvFtB,qBAAgB,GAAG,KAAK,CAAC;YAoFhB,4EAAqC,SAAS,EAAC;YAG/C,8HAAO,KAAK,GAAC;;;;;SArGnB,sCAAsC","sourcesContent":["import type { FrameBlockModel, RootBlockModel } from '@blocksuite/affine-model';\n\nimport { EditPropsStore } from '@blocksuite/affine-shared/services';\nimport { WidgetComponent } from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport { Bound } from '@blocksuite/global/utils';\nimport { effect } from '@preact/signals-core';\nimport { css, html, nothing } from 'lit';\nimport { state } from 'lit/decorators.js';\n\nimport type { EdgelessRootBlockComponent } from '../../edgeless-root-block.js';\n\nexport const EDGELESS_NAVIGATOR_BLACK_BACKGROUND_WIDGET =\n  'edgeless-navigator-black-background';\nexport class EdgelessNavigatorBlackBackgroundWidget extends WidgetComponent<\n  RootBlockModel,\n  EdgelessRootBlockComponent\n> {\n  static override styles = css`\n    .edgeless-navigator-black-background {\n      background-color: black;\n      position: absolute;\n      z-index: 1;\n      background-color: transparent;\n      box-shadow: 0 0 0 5000px black;\n    }\n  `;\n\n  private _blackBackground = false;\n\n  get gfx() {\n    return this.std.get(GfxControllerIdentifier);\n  }\n\n  private _tryLoadBlackBackground() {\n    const value = this.std\n      .get(EditPropsStore)\n      .getStorage('presentBlackBackground');\n    this._blackBackground = value ?? true;\n  }\n\n  override firstUpdated() {\n    const { _disposables, gfx, block } = this;\n    _disposables.add(\n      block.slots.navigatorFrameChanged.on(frame => {\n        this.frame = frame;\n      })\n    );\n\n    _disposables.add(\n      block.slots.navigatorSettingUpdated.on(({ blackBackground }) => {\n        if (blackBackground !== undefined) {\n          this.std\n            .get(EditPropsStore)\n            .setStorage('presentBlackBackground', blackBackground);\n\n          this._blackBackground = blackBackground;\n\n          this.show =\n            blackBackground &&\n            block.gfx.tool.currentToolOption$.peek().type === 'frameNavigator';\n        }\n      })\n    );\n\n    _disposables.add(\n      effect(() => {\n        const tool = gfx.tool.currentToolName$.value;\n\n        if (tool !== 'frameNavigator') {\n          this.show = false;\n        } else {\n          this.show = this._blackBackground;\n        }\n      })\n    );\n\n    _disposables.add(\n      block.slots.fullScreenToggled.on(\n        () =>\n          setTimeout(() => {\n            this.requestUpdate();\n          }, 500) // wait for full screen animation\n      )\n    );\n\n    this._tryLoadBlackBackground();\n  }\n\n  override render() {\n    const { frame, show, gfx } = this;\n\n    if (!show || !frame) return nothing;\n\n    const bound = Bound.deserialize(frame.xywh);\n    const zoom = gfx.viewport.zoom;\n    const width = bound.w * zoom;\n    const height = bound.h * zoom;\n    const [x, y] = gfx.viewport.toViewCoord(bound.x, bound.y);\n\n    return html` <style>\n        .edgeless-navigator-black-background {\n          width: ${width}px;\n          height: ${height}px;\n          top: ${y}px;\n          left: ${x}px;\n        }\n      </style>\n      <div class=\"edgeless-navigator-black-background\"></div>`;\n  }\n\n  @state()\n  private accessor frame: FrameBlockModel | undefined = undefined;\n\n  @state()\n  private accessor show = false;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-navigator-black-background': EdgelessNavigatorBlackBackgroundWidget;\n  }\n}\n"]}