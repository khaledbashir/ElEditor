{"version":3,"file":"connector-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/connector/connector-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  ArrowUpIcon,\n  ConnectorCWithArrowIcon,\n  ConnectorLWithArrowIcon,\n  ConnectorXWithArrowIcon,\n} from '@blocksuite/affine-components/icons';\nimport { ConnectorMode, getConnectorModeName } from '@blocksuite/affine-model';\nimport { EditPropsStore } from '@blocksuite/affine-shared/services';\nimport { SignalWatcher } from '@blocksuite/global/utils';\nimport { computed } from '@preact/signals-core';\nimport { css, html, LitElement } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport { QuickToolMixin } from '../mixins/quick-tool.mixin.js';\n\nconst IcomMap = {\n  [ConnectorMode.Straight]: ConnectorLWithArrowIcon,\n  [ConnectorMode.Orthogonal]: ConnectorXWithArrowIcon,\n  [ConnectorMode.Curve]: ConnectorCWithArrowIcon,\n};\n\nexport class EdgelessConnectorToolButton extends QuickToolMixin(\n  SignalWatcher(LitElement)\n) {\n  static override styles = css`\n    :host {\n      display: flex;\n    }\n    .edgeless-connector-button {\n      display: flex;\n      position: relative;\n    }\n    .arrow-up-icon {\n      position: absolute;\n      top: 4px;\n      right: 2px;\n      font-size: 0;\n    }\n  `;\n\n  private _mode$ = computed(() => {\n    return this.edgeless.std.get(EditPropsStore).lastProps$.value.connector\n      .mode;\n  });\n\n  override type = 'connector' as const;\n\n  private _toggleMenu() {\n    if (this.tryDisposePopper()) return;\n\n    const menu = this.createPopper('edgeless-connector-menu', this);\n    menu.element.edgeless = this.edgeless;\n    menu.element.onChange = (props: Record<string, unknown>) => {\n      this.edgeless.std.get(EditPropsStore).recordLastProps('connector', props);\n      this.setEdgelessTool(this.type, {\n        mode: this._mode$.value,\n      });\n    };\n  }\n\n  override render() {\n    const { active } = this;\n    const mode = this._mode$.value;\n    const arrowColor = active ? 'currentColor' : 'var(--affine-icon-secondary)';\n    return html`\n      <edgeless-tool-icon-button\n        .tooltip=${this.popper\n          ? ''\n          : getTooltipWithShortcut(getConnectorModeName(mode), 'C')}\n        .tooltipOffset=${17}\n        .active=${active}\n        .iconContainerPadding=${6}\n        class=\"edgeless-connector-button\"\n        @click=${() => {\n          // don't update tool before toggling menu\n          this._toggleMenu();\n          this.edgeless.gfx.tool.setTool('connector', {\n            mode,\n          });\n        }}\n      >\n        ${IcomMap[mode]}\n        <span class=\"arrow-up-icon\" style=${styleMap({ color: arrowColor })}>\n          ${ArrowUpIcon}\n        </span>\n      </edgeless-tool-icon-button>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-connector-tool-button': EdgelessConnectorToolButton;\n  }\n}\n"]}