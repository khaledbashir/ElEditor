{"version":3,"file":"default-tool-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/default/default-tool-button.ts"],"names":[],"mappings":"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","sourcesContent":["import type { GfxToolsFullOptionValue } from '@blocksuite/block-std/gfx';\n\nimport {\n  ArrowUpIcon,\n  HandIcon,\n  SelectIcon,\n} from '@blocksuite/affine-components/icons';\nimport { effect } from '@preact/signals-core';\nimport { css, html, LitElement } from 'lit';\nimport { query } from 'lit/decorators.js';\n\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport { QuickToolMixin } from '../mixins/quick-tool.mixin.js';\n\nexport class EdgelessDefaultToolButton extends QuickToolMixin(LitElement) {\n  static override styles = css`\n    .current-icon {\n      transition: 100ms;\n      width: 24px;\n      height: 24px;\n    }\n    .current-icon > svg {\n      display: block;\n    }\n    .arrow-up-icon {\n      position: absolute;\n      top: 4px;\n      right: 2px;\n      font-size: 0;\n      color: var(--affine-icon-secondary);\n    }\n    .active .arrow-up-icon {\n      color: inherit;\n    }\n  `;\n\n  override type: GfxToolsFullOptionValue['type'][] = ['default', 'pan'];\n\n  private _changeTool() {\n    if (this.toolbar.activePopper) {\n      // click manually always closes the popper\n      this.toolbar.activePopper.dispose();\n    }\n    const type = this.edgelessTool?.type;\n    if (type !== 'default' && type !== 'pan') {\n      if (localStorage.defaultTool === 'default') {\n        this.setEdgelessTool('default');\n      } else if (localStorage.defaultTool === 'pan') {\n        this.setEdgelessTool('pan', { panning: false });\n      }\n      return;\n    }\n    this._fadeOut();\n    // wait for animation to finish\n    setTimeout(() => {\n      if (type === 'default') {\n        this.setEdgelessTool('pan', { panning: false });\n      } else if (type === 'pan') {\n        this.setEdgelessTool('default');\n      }\n      this._fadeIn();\n    }, 100);\n  }\n\n  private _fadeIn() {\n    this.currentIcon.style.opacity = '1';\n    this.currentIcon.style.transform = `translateY(0px)`;\n  }\n\n  private _fadeOut() {\n    this.currentIcon.style.opacity = '0';\n    this.currentIcon.style.transform = `translateY(-5px)`;\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    if (!localStorage.defaultTool) {\n      localStorage.defaultTool = 'default';\n    }\n    this.disposables.add(\n      effect(() => {\n        const tool = this.edgeless.gfx.tool.currentToolName$.value;\n        if (tool === 'default' || tool === 'pan') {\n          localStorage.defaultTool = tool;\n        }\n      })\n    );\n  }\n\n  override render() {\n    const type = this.edgelessTool?.type;\n    const { active } = this;\n    return html`\n      <edgeless-tool-icon-button\n        class=\"edgeless-default-button ${type} ${active ? 'active' : ''}\"\n        .tooltip=${type === 'pan'\n          ? getTooltipWithShortcut('Hand', 'H')\n          : getTooltipWithShortcut('Select', 'V')}\n        .tooltipOffset=${17}\n        .active=${active}\n        .iconContainerPadding=${6}\n        @click=${this._changeTool}\n      >\n        <span class=\"current-icon\">\n          ${localStorage.defaultTool === 'default' ? SelectIcon : HandIcon}\n        </span>\n        <span class=\"arrow-up-icon\">${ArrowUpIcon}</span>\n      </edgeless-tool-icon-button>\n    `;\n  }\n\n  @query('.current-icon')\n  accessor currentIcon!: HTMLInputElement;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'edgeless-default-tool-button': EdgelessDefaultToolButton;\n  }\n}\n"]}