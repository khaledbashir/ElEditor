{"version":3,"file":"edgeless-root-block.js","sourceRoot":"","sources":["../../../src/root-block/edgeless/edgeless-root-block.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  SurfaceBlockComponent,\n  SurfaceBlockModel,\n} from '@blocksuite/affine-block-surface';\nimport type {\n  RootBlockModel,\n  ShapeElementModel,\n} from '@blocksuite/affine-model';\nimport type {\n  GfxBlockComponent,\n  SurfaceSelection,\n  UIEventHandler,\n} from '@blocksuite/block-std';\n\nimport { CommonUtils } from '@blocksuite/affine-block-surface';\nimport { toast } from '@blocksuite/affine-components/toast';\nimport {\n  EditPropsStore,\n  FontLoaderService,\n  ThemeProvider,\n} from '@blocksuite/affine-shared/services';\nimport {\n  isTouchPadPinchEvent,\n  requestConnectedFrame,\n  requestThrottledConnectedFrame,\n} from '@blocksuite/affine-shared/utils';\nimport { BlockComponent } from '@blocksuite/block-std';\nimport {\n  GfxControllerIdentifier,\n  type GfxViewportElement,\n} from '@blocksuite/block-std/gfx';\nimport { IS_WINDOWS } from '@blocksuite/global/env';\nimport { assertExists, Bound, Point, Vec } from '@blocksuite/global/utils';\nimport { effect } from '@preact/signals-core';\nimport { css, html } from 'lit';\nimport { query } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { Viewport } from '../../_common/utils/index.js';\nimport type { EdgelessRootBlockWidgetName } from '../types.js';\nimport type { EdgelessSelectedRectWidget } from './components/rects/edgeless-selected-rect.js';\nimport type { EdgelessRootService } from './edgeless-root-service.js';\n\nimport { isSingleMindMapNode } from '../../_common/edgeless/mindmap/index.js';\nimport { EdgelessClipboardController } from './clipboard/clipboard.js';\nimport { EdgelessPageKeyboardManager } from './edgeless-keyboard.js';\nimport { getBackgroundGrid, isCanvasElement } from './utils/query.js';\nimport { mountShapeTextEditor } from './utils/text.js';\nimport { fitToScreen } from './utils/viewport.js';\n\nconst { normalizeWheelDeltaY } = CommonUtils;\n\nexport class EdgelessRootBlockComponent extends BlockComponent<\n  RootBlockModel,\n  EdgelessRootService,\n  EdgelessRootBlockWidgetName\n> {\n  static override styles = css`\n    affine-edgeless-root {\n      -webkit-user-select: none;\n      user-select: none;\n      display: block;\n      height: 100%;\n      touch-action: none;\n    }\n\n    .widgets-container {\n      position: absolute;\n      left: 0;\n      top: 0;\n      pointer-events: none;\n      contain: size layout;\n      height: 100%;\n      width: 100%;\n    }\n\n    .widgets-container > * {\n      pointer-events: auto;\n    }\n\n    .edgeless-background {\n      height: 100%;\n      background-color: var(--affine-background-primary-color);\n      background-image: radial-gradient(\n        var(--affine-edgeless-grid-color) 1px,\n        var(--affine-background-primary-color) 1px\n      );\n    }\n\n    .edgeless-container {\n      color: var(--affine-text-primary-color);\n      position: relative;\n    }\n\n    @media print {\n      .selected {\n        background-color: transparent !important;\n      }\n    }\n  `;\n\n  private _refreshLayerViewport = requestThrottledConnectedFrame(() => {\n    const { zoom, translateX, translateY } = this.gfx.viewport;\n    const { gap } = getBackgroundGrid(zoom, true);\n\n    if (this.backgroundElm) {\n      this.backgroundElm.style.setProperty(\n        'background-position',\n        `${translateX}px ${translateY}px`\n      );\n      this.backgroundElm.style.setProperty(\n        'background-size',\n        `${gap}px ${gap}px`\n      );\n    }\n  }, this);\n\n  private _resizeObserver: ResizeObserver | null = null;\n\n  private _viewportElement: HTMLElement | null = null;\n\n  clipboardController = new EdgelessClipboardController(this);\n\n  keyboardManager: EdgelessPageKeyboardManager | null = null;\n\n  get dispatcher() {\n    return this.std.event;\n  }\n\n  get gfx() {\n    return this.std.get(GfxControllerIdentifier);\n  }\n\n  get selectedRectWidget() {\n    return this.host.view.getWidget(\n      'edgeless-selected-rect',\n      this.host.id\n    ) as EdgelessSelectedRectWidget;\n  }\n\n  get slots() {\n    return this.service.slots;\n  }\n\n  get surfaceBlockModel() {\n    return this.model.children.find(\n      child => child.flavour === 'affine:surface'\n    ) as SurfaceBlockModel;\n  }\n\n  /**\n   * Don't confuse with `gfx.viewport` which is edgeless-only concept.\n   * This refers to the wrapper element of the EditorHost.\n   */\n  get viewport(): Viewport {\n    const {\n      scrollLeft,\n      scrollTop,\n      scrollWidth,\n      scrollHeight,\n      clientWidth,\n      clientHeight,\n    } = this.viewportElement;\n    const { top, left } = this.viewportElement.getBoundingClientRect();\n    return {\n      top,\n      left,\n      scrollLeft,\n      scrollTop,\n      scrollWidth,\n      scrollHeight,\n      clientWidth,\n      clientHeight,\n    };\n  }\n\n  get viewportElement(): HTMLElement {\n    if (this._viewportElement) return this._viewportElement;\n    this._viewportElement = this.host.closest(\n      '.affine-edgeless-viewport'\n    ) as HTMLElement | null;\n    assertExists(this._viewportElement);\n    return this._viewportElement;\n  }\n\n  private _initFontLoader() {\n    this.std\n      .get(FontLoaderService)\n      .ready.then(() => {\n        this.surface.refresh();\n      })\n      .catch(console.error);\n  }\n\n  private _initLayerUpdateEffect() {\n    const updateLayers = requestThrottledConnectedFrame(() => {\n      const blocks = Array.from(\n        this.gfxViewportElm.children as HTMLCollectionOf<GfxBlockComponent>\n      );\n\n      blocks.forEach((block: GfxBlockComponent) => {\n        block.updateZIndex?.();\n      });\n    });\n\n    this._disposables.add(\n      this.gfx.layer.slots.layerUpdated.on(() => updateLayers())\n    );\n  }\n\n  private _initPanEvent() {\n    this.disposables.add(\n      this.dispatcher.add('pan', ctx => {\n        const { viewport } = this.gfx;\n        if (viewport.locked) return;\n\n        const multiPointersState = ctx.get('multiPointerState');\n        const [p1, p2] = multiPointersState.pointers;\n\n        const dx =\n          (0.25 * (p1.delta.x + p2.delta.x)) / viewport.zoom / viewport.scale;\n        const dy =\n          (0.25 * (p1.delta.y + p2.delta.y)) / viewport.zoom / viewport.scale;\n\n        // direction is opposite\n        viewport.applyDeltaCenter(-dx, -dy);\n      })\n    );\n  }\n\n  private _initPinchEvent() {\n    this.disposables.add(\n      this.dispatcher.add('pinch', ctx => {\n        const { viewport } = this.gfx;\n        if (viewport.locked) return;\n\n        const multiPointersState = ctx.get('multiPointerState');\n        const [p1, p2] = multiPointersState.pointers;\n\n        const currentCenter = new Point(\n          0.5 * (p1.x + p2.x),\n          0.5 * (p1.y + p2.y)\n        );\n\n        const lastDistance = Vec.dist(\n          [p1.x - p1.delta.x, p1.y - p1.delta.y],\n          [p2.x - p2.delta.x, p2.y - p2.delta.y]\n        );\n        const currentDistance = Vec.dist([p1.x, p1.y], [p2.x, p2.y]);\n\n        const zoom = (currentDistance / lastDistance) * viewport.zoom;\n\n        const [baseX, baseY] = viewport.toModelCoord(\n          currentCenter.x,\n          currentCenter.y\n        );\n\n        viewport.setZoom(zoom, new Point(baseX, baseY));\n\n        return false;\n      })\n    );\n  }\n\n  private _initPixelRatioChangeEffect() {\n    let media: MediaQueryList;\n\n    const onPixelRatioChange = () => {\n      if (media) {\n        this.gfx.viewport.onResize();\n        media.removeEventListener('change', onPixelRatioChange);\n      }\n\n      media = matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n      media.addEventListener('change', onPixelRatioChange);\n    };\n\n    onPixelRatioChange();\n\n    this._disposables.add(() => {\n      media?.removeEventListener('change', onPixelRatioChange);\n    });\n  }\n\n  private _initRemoteCursor() {\n    let rafId: number | null = null;\n\n    const setRemoteCursor = (pos: { x: number; y: number }) => {\n      if (rafId) cancelAnimationFrame(rafId);\n      rafId = requestConnectedFrame(() => {\n        if (!this.gfx.viewport) return;\n        const cursorPosition = this.gfx.viewport.toModelCoord(pos.x, pos.y);\n        this.gfx.selection.setCursor({\n          x: cursorPosition[0],\n          y: cursorPosition[1],\n        });\n        rafId = null;\n      }, this);\n    };\n\n    this.handleEvent('pointerMove', e => {\n      const pointerEvent = e.get('pointerState');\n      setRemoteCursor(pointerEvent);\n    });\n  }\n\n  private _initResizeEffect() {\n    const resizeObserver = new ResizeObserver((_: ResizeObserverEntry[]) => {\n      this.gfx.selection.set(this.gfx.selection.surfaceSelections);\n      this.gfx.viewport.onResize();\n    });\n\n    resizeObserver.observe(this.viewportElement);\n    this._resizeObserver = resizeObserver;\n  }\n\n  private _initSlotEffects() {\n    const { disposables, slots } = this;\n\n    this.disposables.add(\n      this.std.get(ThemeProvider).theme$.subscribe(() => this.surface.refresh())\n    );\n\n    disposables.add(\n      effect(() => {\n        this.style.cursor = this.gfx.cursor$.value;\n      })\n    );\n\n    let canCopyAsPng = true;\n    disposables.add(\n      slots.copyAsPng.on(({ blocks, shapes }) => {\n        if (!canCopyAsPng) return;\n        canCopyAsPng = false;\n\n        this.clipboardController\n          .copyAsPng(blocks, shapes)\n          .then(() => toast(this.host, 'Copied to clipboard'))\n          .catch(() => toast(this.host, 'Failed to copy as PNG'))\n          .finally(() => {\n            canCopyAsPng = true;\n          });\n      })\n    );\n  }\n\n  private _initViewport() {\n    const { std, gfx } = this;\n\n    const run = () => {\n      const storedViewport = std.get(EditPropsStore).getStorage('viewport');\n\n      if (!storedViewport) {\n        fitToScreen(this.gfx.gfxElements, gfx.viewport, {\n          smooth: false,\n        });\n        return;\n      }\n\n      if ('xywh' in storedViewport) {\n        const bound = Bound.deserialize(storedViewport.xywh);\n        gfx.viewport.setViewportByBound(bound, storedViewport.padding);\n      } else {\n        const { zoom, centerX, centerY } = storedViewport;\n        gfx.viewport.setViewport(zoom, [centerX, centerY]);\n      }\n    };\n\n    run();\n\n    this._disposables.add(() => {\n      std.get(EditPropsStore).setStorage('viewport', {\n        centerX: gfx.viewport.centerX,\n        centerY: gfx.viewport.centerY,\n        zoom: gfx.viewport.zoom,\n      });\n    });\n  }\n\n  private _initWheelEvent() {\n    this._disposables.add(\n      this.dispatcher.add('wheel', ctx => {\n        const state = ctx.get('defaultState');\n        const e = state.event as WheelEvent;\n\n        e.preventDefault();\n\n        const { viewport } = this.gfx;\n        if (viewport.locked) return;\n\n        // zoom\n        if (isTouchPadPinchEvent(e)) {\n          const rect = this.getBoundingClientRect();\n          // Perform zooming relative to the mouse position\n          const [baseX, baseY] = this.gfx.viewport.toModelCoord(\n            e.clientX - rect.x,\n            e.clientY - rect.y\n          );\n\n          const zoom = normalizeWheelDeltaY(e.deltaY, viewport.zoom);\n          viewport.setZoom(zoom, new Point(baseX, baseY));\n          e.stopPropagation();\n        }\n        // pan\n        else {\n          const simulateHorizontalScroll = IS_WINDOWS && e.shiftKey;\n          const dx = simulateHorizontalScroll\n            ? e.deltaY / viewport.zoom\n            : e.deltaX / viewport.zoom;\n          const dy = simulateHorizontalScroll ? 0 : e.deltaY / viewport.zoom;\n\n          viewport.applyDeltaCenter(dx, dy);\n          viewport.viewportMoved.emit([dx, dy]);\n          e.stopPropagation();\n        }\n      })\n    );\n  }\n\n  override bindHotKey(\n    keymap: Record<string, UIEventHandler>,\n    options?: { global?: boolean; flavour?: boolean }\n  ): () => void {\n    const { gfx } = this;\n    const selection = gfx.selection;\n\n    Object.keys(keymap).forEach(key => {\n      if (key.length === 1 && key >= 'A' && key <= 'z') {\n        const handler = keymap[key];\n\n        keymap[key] = ctx => {\n          const elements = selection.selectedElements;\n\n          if (isSingleMindMapNode(elements) && !selection.editing) {\n            const target = gfx.getElementById(\n              elements[0].id\n            ) as ShapeElementModel;\n            if (target.text) {\n              this.doc.transact(() => {\n                target.text!.delete(0, target.text!.length);\n                target.text!.insert(0, key);\n              });\n            }\n            mountShapeTextEditor(target, this);\n          } else {\n            handler(ctx);\n          }\n        };\n      }\n    });\n\n    return super.bindHotKey(keymap, options);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    this._initViewport();\n\n    this.clipboardController.hostConnected();\n    this.keyboardManager = new EdgelessPageKeyboardManager(this);\n\n    this.handleEvent('selectionChange', () => {\n      const surface = this.host.selection.value.find(\n        (sel): sel is SurfaceSelection => sel.is('surface')\n      );\n      if (!surface) return;\n\n      const el = this.gfx.getElementById(surface.elements[0]);\n      if (isCanvasElement(el)) {\n        return true;\n      }\n\n      return;\n    });\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.clipboardController.hostDisconnected();\n    if (this._resizeObserver) {\n      this._resizeObserver.disconnect();\n      this._resizeObserver = null;\n    }\n\n    this.keyboardManager = null;\n  }\n\n  override firstUpdated() {\n    this._initSlotEffects();\n    this._initResizeEffect();\n    this._initPixelRatioChangeEffect();\n    this._initFontLoader();\n    this._initRemoteCursor();\n    this._initLayerUpdateEffect();\n\n    this._initWheelEvent();\n    this._initPanEvent();\n    this._initPinchEvent();\n\n    if (this.doc.readonly) {\n      this.gfx.tool.setTool('pan', { panning: true });\n    } else {\n      this.gfx.tool.setTool('default');\n    }\n\n    requestConnectedFrame(() => {\n      this.requestUpdate();\n    }, this);\n\n    this._disposables.add(\n      this.gfx.viewport.viewportUpdated.on(() => {\n        this._refreshLayerViewport();\n      })\n    );\n\n    this._refreshLayerViewport();\n  }\n\n  override renderBlock() {\n    const widgets = repeat(\n      Object.entries(this.widgets),\n      ([id]) => id,\n      ([_, widget]) => widget\n    );\n\n    return html`\n      <div class=\"edgeless-background edgeless-container\">\n        <gfx-viewport\n          .maxConcurrentRenders=${6}\n          .viewport=${this.gfx.viewport}\n          .getModelsInViewport=${() => {\n            const blocks = this.gfx.grid.search(\n              this.gfx.viewport.viewportBounds,\n              {\n                useSet: true,\n                filter: ['block'],\n              }\n            );\n\n            return blocks;\n          }}\n          .host=${this.host}\n        >\n          ${this.renderChildren(this.model)}\n          ${this.renderChildren(this.surfaceBlockModel)}\n        </gfx-viewport>\n      </div>\n\n      <!--\n        Used to mount component before widgets\n        Eg., canvas text editor\n      -->\n      <div class=\"edgeless-mount-point\"></div>\n\n      <div class=\"widgets-container\">${widgets}</div>\n    `;\n  }\n\n  @query('.edgeless-background')\n  accessor backgroundElm: HTMLDivElement | null = null;\n\n  @query('gfx-viewport')\n  accessor gfxViewportElm!: GfxViewportElement;\n\n  @query('.edgeless-mount-point')\n  accessor mountElm: HTMLDivElement | null = null;\n\n  @query('affine-surface')\n  accessor surface!: SurfaceBlockComponent;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'affine-edgeless-root': EdgelessRootBlockComponent;\n  }\n}\n"]}