{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/root-block/edgeless/components/note-slicer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { SmallScissorsIcon } from '@blocksuite/affine-components/icons';\nimport { DEFAULT_NOTE_HEIGHT } from '@blocksuite/affine-model';\nimport { EDGELESS_BLOCK_CHILD_PADDING } from '@blocksuite/affine-shared/consts';\nimport { TelemetryProvider } from '@blocksuite/affine-shared/services';\nimport { getRectByBlockComponent } from '@blocksuite/affine-shared/utils';\nimport { WidgetComponent } from '@blocksuite/block-std';\nimport { GfxControllerIdentifier } from '@blocksuite/block-std/gfx';\nimport {\n  deserializeXYWH,\n  DisposableGroup,\n  Point,\n  serializeXYWH,\n} from '@blocksuite/global/utils';\nimport { css, html, nothing, type PropertyValues } from 'lit';\nimport { state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type {\n  EdgelessRootBlockComponent,\n  NoteBlockComponent,\n  NoteBlockModel,\n  RootBlockModel,\n} from '../../../../index.js';\n\nimport { isNoteBlock } from '../../utils/query.js';\n\nconst DIVIDING_LINE_OFFSET = 4;\nconst NEW_NOTE_GAP = 40;\n\nconst styles = css`\n  :host {\n    display: flex;\n  }\n\n  .note-slicer-container {\n    display: flex;\n  }\n\n  .note-slicer-button {\n    position: absolute;\n    top: 0;\n    right: 0;\n    display: flex;\n    box-sizing: border-box;\n    border-radius: 4px;\n    justify-content: center;\n    align-items: center;\n    color: var(--affine-icon-color);\n    border: 1px solid var(--affine-border-color);\n    background-color: var(--affine-background-overlay-panel-color);\n    box-shadow: var(--affine-menu-shadow);\n    cursor: pointer;\n    width: 24px;\n    height: 24px;\n    transform-origin: left top;\n    z-index: var(--affine-z-index-popover);\n    opacity: 0;\n    transition: opacity 150ms cubic-bezier(0.25, 0.1, 0.25, 1);\n  }\n\n  .note-slicer-dividing-line-container {\n    display: flex;\n    align-items: center;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 4px;\n    cursor: pointer;\n  }\n\n  .note-slicer-dividing-line {\n    display: block;\n    height: 1px;\n    width: 100%;\n    z-index: var(--affine-z-index-popover);\n    background-image: linear-gradient(\n      to right,\n      var(--affine-black-10) 50%,\n      transparent 50%\n    );\n    background-size: 4px 100%;\n  }\n  .note-slicer-dividing-line-container.active .note-slicer-dividing-line {\n    background-image: linear-gradient(\n      to right,\n      var(--affine-black-60) 50%,\n      transparent 50%\n    );\n    animation: slide 0.3s linear infinite;\n  }\n  @keyframes slide {\n    0% {\n      background-position: 0 0;\n    }\n    100% {\n      background-position: -4px 0;\n    }\n  }\n`;\n\nexport const NOTE_SLICER_WIDGET = 'note-slicer';\n\nexport class NoteSlicer extends WidgetComponent<\n  RootBlockModel,\n  EdgelessRootBlockComponent\n> {\n  static override styles = styles;\n\n  private _divingLinePositions: Point[] = [];\n\n  private _hidden = false;\n\n  private _noteBlockIds: string[] = [];\n\n  private _noteDisposables: DisposableGroup | null = null;\n\n  get _editorHost() {\n    return this.std.host;\n  }\n\n  get _noteBlock() {\n    if (!this._editorHost) return null;\n    const noteBlock = this._editorHost.view.getBlock(\n      this._anchorNote?.id ?? ''\n    );\n    return noteBlock ? (noteBlock as NoteBlockComponent) : null;\n  }\n\n  get _selection() {\n    return this.gfx.selection;\n  }\n\n  get _viewportOffset() {\n    const { viewport } = this.gfx;\n    return {\n      left: viewport.left ?? 0,\n      top: viewport.top ?? 0,\n    };\n  }\n\n  get _zoom() {\n    return this.gfx.viewport.zoom;\n  }\n\n  get gfx() {\n    return this.std.get(GfxControllerIdentifier);\n  }\n\n  get selectedRectEle() {\n    return this.block.selectedRectWidget;\n  }\n\n  private _sliceNote() {\n    if (!this._anchorNote || !this._noteBlockIds.length) return;\n    const doc = this.doc;\n\n    const {\n      index: originIndex,\n      xywh,\n      background,\n      children,\n      displayMode,\n    } = this._anchorNote;\n    const {\n      collapse: _,\n      collapsedHeight: __,\n      ...restOfEdgeless\n    } = this._anchorNote.edgeless;\n    const anchorBlockId = this._noteBlockIds[this._activeSlicerIndex];\n    if (!anchorBlockId) return;\n    const sliceIndex = children.findIndex(block => block.id === anchorBlockId);\n    const resetBlocks = children.slice(sliceIndex + 1);\n    const [x, , width] = deserializeXYWH(xywh);\n    const sliceVerticalPos =\n      this._divingLinePositions[this._activeSlicerIndex].y;\n    const newY = this.gfx.viewport.toModelCoord(x, sliceVerticalPos)[1];\n    const newNoteId = this.doc.addBlock(\n      'affine:note',\n      {\n        background,\n        displayMode,\n        xywh: serializeXYWH(x, newY + NEW_NOTE_GAP, width, DEFAULT_NOTE_HEIGHT),\n        index: originIndex + 1,\n        edgeless: restOfEdgeless,\n      },\n      doc.root?.id\n    );\n\n    doc.moveBlocks(resetBlocks, doc.getBlockById(newNoteId) as NoteBlockModel);\n\n    this._activeSlicerIndex = 0;\n    this._selection.set({\n      elements: [newNoteId],\n      editing: false,\n    });\n\n    this.std.getOptional(TelemetryProvider)?.track('SplitNote', {\n      control: 'NoteSlicer',\n    });\n  }\n\n  private _updateActiveSlicerIndex(pos: Point) {\n    const { _divingLinePositions } = this;\n    const curY = pos.y + DIVIDING_LINE_OFFSET * this._zoom;\n    let index = -1;\n    for (let i = 0; i < _divingLinePositions.length; i++) {\n      const currentY = _divingLinePositions[i].y;\n      const previousY = i > 0 ? _divingLinePositions[i - 1].y : 0;\n      const midY = (currentY + previousY) / 2;\n      if (curY < midY) {\n        break;\n      }\n      index++;\n    }\n\n    if (index < 0) index = 0;\n    this._activeSlicerIndex = index;\n  }\n\n  private _updateDivingLineAndBlockIds() {\n    if (!this._anchorNote || !this._noteBlock) {\n      this._divingLinePositions = [];\n      this._noteBlockIds = [];\n      return;\n    }\n\n    const divingLinePositions: Point[] = [];\n    const noteBlockIds: string[] = [];\n    const noteRect = this._noteBlock.getBoundingClientRect();\n    const noteTop = noteRect.top;\n    const noteBottom = noteRect.bottom;\n\n    for (let i = 0; i < this._anchorNote.children.length - 1; i++) {\n      const child = this._anchorNote.children[i];\n      const rect = this.host.view.getBlock(child.id)?.getBoundingClientRect();\n\n      if (rect && rect.bottom > noteTop && rect.bottom < noteBottom) {\n        const x = rect.x - this._viewportOffset.left;\n        const y =\n          rect.bottom +\n          DIVIDING_LINE_OFFSET * this._zoom -\n          this._viewportOffset.top;\n        divingLinePositions.push(new Point(x, y));\n        noteBlockIds.push(child.id);\n      }\n    }\n\n    this._divingLinePositions = divingLinePositions;\n    this._noteBlockIds = noteBlockIds;\n  }\n\n  private _updateSlicedNote() {\n    const { selectedElements } = this.gfx.selection;\n\n    if (\n      !this.gfx.selection.editing &&\n      selectedElements.length === 1 &&\n      isNoteBlock(selectedElements[0])\n    ) {\n      this._anchorNote = selectedElements[0];\n    } else {\n      this._anchorNote = null;\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n\n    const { disposables, std, block, gfx } = this;\n\n    this._updateDivingLineAndBlockIds();\n\n    disposables.add(\n      block.slots.elementResizeStart.on(() => {\n        this._isResizing = true;\n      })\n    );\n\n    disposables.add(\n      block.slots.elementResizeEnd.on(() => {\n        this._isResizing = false;\n      })\n    );\n\n    disposables.add(\n      std.event.add('pointerMove', ctx => {\n        if (this._hidden) this._hidden = false;\n\n        const state = ctx.get('pointerState');\n        const pos = new Point(state.x, state.y);\n        this._updateActiveSlicerIndex(pos);\n      })\n    );\n\n    disposables.add(\n      gfx.viewport.viewportUpdated.on(() => {\n        this._hidden = true;\n        this.requestUpdate();\n      })\n    );\n\n    disposables.add(\n      gfx.selection.slots.updated.on(() => {\n        this._enableNoteSlicer = false;\n        this._updateSlicedNote();\n\n        if (this.selectedRectEle) {\n          this.selectedRectEle.autoCompleteOff = false;\n        }\n      })\n    );\n\n    disposables.add(\n      block.slots.toggleNoteSlicer.on(() => {\n        this._enableNoteSlicer = !this._enableNoteSlicer;\n\n        if (this.selectedRectEle && this._enableNoteSlicer) {\n          this.selectedRectEle.autoCompleteOff = true;\n        }\n      })\n    );\n\n    const { surface } = block;\n    requestAnimationFrame(() => {\n      if (surface.isConnected && std.event) {\n        disposables.add(\n          std.event.add('click', ctx => {\n            const event = ctx.get('pointerState');\n            const { raw } = event;\n            const target = raw.target as HTMLElement;\n            if (!target) return;\n\n            if (target.closest('note-slicer')) {\n              this._sliceNote();\n            }\n          })\n        );\n      }\n    });\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.disposables.dispose();\n    this._noteDisposables?.dispose();\n    this._noteDisposables = null;\n  }\n\n  override firstUpdated() {\n    if (!this.block.service) return;\n    this.disposables.add(\n      this.block.service.uiEventDispatcher.add('wheel', () => {\n        this._hidden = true;\n        this.requestUpdate();\n      })\n    );\n  }\n\n  override render() {\n    if (\n      this.doc.readonly ||\n      this._hidden ||\n      this._isResizing ||\n      !this._anchorNote ||\n      !this._enableNoteSlicer\n    ) {\n      return nothing;\n    }\n\n    this._updateDivingLineAndBlockIds();\n\n    const noteBlock = this._noteBlock;\n    if (!noteBlock || !this._divingLinePositions.length) return nothing;\n\n    const rect = getRectByBlockComponent(noteBlock);\n    const width = rect.width - 2 * EDGELESS_BLOCK_CHILD_PADDING;\n    const buttonPosition = this._divingLinePositions[this._activeSlicerIndex];\n\n    return html`<div class=\"note-slicer-container\">\n      <div\n        class=\"note-slicer-button\"\n        style=${styleMap({\n          left: `${buttonPosition.x - 66 * this._zoom}px`,\n          top: `${buttonPosition.y}px`,\n          opacity: 1,\n          scale: `${this._zoom}`,\n          transform: 'translateY(-50%)',\n        })}\n      >\n        ${SmallScissorsIcon}\n      </div>\n      ${this._divingLinePositions.map((pos, idx) => {\n        const dividingLineClasses = classMap({\n          'note-slicer-dividing-line-container': true,\n          active: idx === this._activeSlicerIndex,\n        });\n        return html`<div\n          class=${dividingLineClasses}\n          style=${styleMap({\n            left: `${pos.x}px`,\n            top: `${pos.y}px`,\n            width: `${width}px`,\n          })}\n        >\n          <span class=\"note-slicer-dividing-line\"></span>\n        </div>`;\n      })}\n    </div> `;\n  }\n\n  protected override updated(_changedProperties: PropertyValues) {\n    super.updated(_changedProperties);\n    if (_changedProperties.has('anchorNote')) {\n      this._noteDisposables?.dispose();\n      this._noteDisposables = null;\n      if (this._anchorNote) {\n        this._noteDisposables = new DisposableGroup();\n        this._noteDisposables.add(\n          this._anchorNote.propsUpdated.on(({ key }) => {\n            if (key === 'children' || key === 'xywh') {\n              this.requestUpdate();\n            }\n          })\n        );\n      }\n    }\n  }\n\n  @state()\n  private accessor _activeSlicerIndex = 0;\n\n  @state()\n  private accessor _anchorNote: NoteBlockModel | null = null;\n\n  @state()\n  private accessor _enableNoteSlicer = false;\n\n  @state()\n  private accessor _isResizing = false;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'note-slicer': NoteSlicer;\n  }\n}\n"]}