{"version":3,"file":"indicator-overlay.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/gfx-tool/default-tool-ext/mind-map-ext/indicator-overlay.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  NODE_HORIZONTAL_SPACING,\n  NODE_VERTICAL_SPACING,\n  Overlay,\n  PathGenerator,\n} from '@blocksuite/affine-block-surface';\nimport {\n  ConnectorMode,\n  LayoutType,\n  type MindmapElementModel,\n  type MindmapNode,\n} from '@blocksuite/affine-model';\nimport { ThemeProvider } from '@blocksuite/affine-shared/services';\nimport {\n  type Bound,\n  isVecZero,\n  type IVec,\n  last,\n  PointLocation,\n  toRadian,\n  Vec,\n} from '@blocksuite/global/utils';\n\nexport class MindMapIndicatorOverlay extends Overlay {\n  static INDICATOR_SIZE = [48, 22];\n\n  static override overlayName: string = 'mindmap-indicator';\n\n  currentDragPos: IVec | null = null;\n\n  direction: LayoutType.LEFT | LayoutType.RIGHT = LayoutType.RIGHT;\n\n  dragNodeImage: HTMLCanvasElement | null = null;\n\n  dragNodePos: IVec = [0, 0];\n\n  mode: ConnectorMode = ConnectorMode.Straight;\n\n  parentBound: Bound | null = null;\n\n  pathGen = new PathGenerator();\n\n  targetBound: Bound | null = null;\n\n  get themeService() {\n    return this.gfx.std.get(ThemeProvider);\n  }\n\n  private _generatePath() {\n    const startRelativePos =\n      this.direction === LayoutType.RIGHT\n        ? PointLocation.fromVec([1, 0.5])\n        : PointLocation.fromVec([0, 0.5]);\n    const endRelativePos =\n      this.direction === LayoutType.RIGHT\n        ? PointLocation.fromVec([0, 0.5])\n        : PointLocation.fromVec([1, 0.5]);\n    const { parentBound, targetBound: newPosBound } = this;\n\n    if (this.mode === ConnectorMode.Orthogonal) {\n      return this.pathGen\n        .generateOrthogonalConnectorPath({\n          startPoint: this._getRelativePoint(parentBound!, startRelativePos),\n          endPoint: this._getRelativePoint(newPosBound!, endRelativePos),\n          startBound: parentBound,\n          endBound: newPosBound,\n        })\n        .map(p => new PointLocation(p));\n    } else if (this.mode === ConnectorMode.Curve) {\n      const startPoint = this._getRelativePoint(\n        this.parentBound!,\n        startRelativePos\n      );\n      const endPoint = this._getRelativePoint(\n        this.targetBound!,\n        endRelativePos\n      );\n\n      const startTangentVertical = Vec.rot(startPoint.tangent, -Math.PI / 2);\n      startPoint.out = Vec.mul(\n        startTangentVertical,\n        Math.max(\n          100,\n          Math.abs(\n            Vec.pry(Vec.sub(endPoint, startPoint), startTangentVertical)\n          ) / 3\n        )\n      );\n\n      const endTangentVertical = Vec.rot(endPoint.tangent, -Math.PI / 2);\n      endPoint.in = Vec.mul(\n        endTangentVertical,\n        Math.max(\n          100,\n          Math.abs(Vec.pry(Vec.sub(startPoint, endPoint), endTangentVertical)) /\n            3\n        )\n      );\n\n      return [startPoint, endPoint];\n    } else {\n      const startPoint = new PointLocation(\n        this.parentBound!.getRelativePoint(startRelativePos)\n      );\n      const endPoint = new PointLocation(\n        this.targetBound!.getRelativePoint(endRelativePos)\n      );\n\n      return [startPoint, endPoint];\n    }\n  }\n\n  private _getRelativePoint(bound: Bound, position: IVec) {\n    const location = new PointLocation(\n      bound.getRelativePoint(position as IVec)\n    );\n\n    if (isVecZero(Vec.sub(position, [0, 0.5])))\n      location.tangent = Vec.rot([0, -1], toRadian(0));\n    else if (isVecZero(Vec.sub(position, [1, 0.5])))\n      location.tangent = Vec.rot([0, 1], toRadian(0));\n    else if (isVecZero(Vec.sub(position, [0.5, 0])))\n      location.tangent = Vec.rot([1, 0], toRadian(0));\n    else if (isVecZero(Vec.sub(position, [0.5, 1])))\n      location.tangent = Vec.rot([-1, 0], toRadian(0));\n\n    return location;\n  }\n\n  /**\n   * Use to calculate the position of the indicator given its sibling's bound\n   * @param siblingBound\n   * @param direction\n   */\n  private _moveRelativeToBound(\n    siblingBound: Bound,\n    direction: 'up' | 'down',\n    layoutDir: Exclude<LayoutType, LayoutType.BALANCE>\n  ) {\n    const isLeftLayout = layoutDir === LayoutType.LEFT;\n    const isUpDirection = direction === 'up';\n\n    return siblingBound.moveDelta(\n      isLeftLayout\n        ? siblingBound.w - MindMapIndicatorOverlay.INDICATOR_SIZE[0]\n        : 0,\n      isUpDirection\n        ? -(\n            NODE_VERTICAL_SPACING / 2 +\n            MindMapIndicatorOverlay.INDICATOR_SIZE[1] / 2\n          )\n        : siblingBound.h +\n            NODE_VERTICAL_SPACING / 2 -\n            MindMapIndicatorOverlay.INDICATOR_SIZE[1] / 2\n    );\n  }\n\n  override clear() {\n    this.targetBound = null;\n    this.parentBound = null;\n  }\n\n  override render(ctx: CanvasRenderingContext2D): void {\n    if (this.currentDragPos && this.dragNodeImage) {\n      ctx.save();\n      ctx.globalAlpha = 0.3;\n      ctx.drawImage(\n        this.dragNodeImage,\n        this.currentDragPos[0] + this.dragNodePos[0],\n        this.currentDragPos[1] + this.dragNodePos[1],\n        this.dragNodeImage.width / 2,\n        this.dragNodeImage.height / 2\n      );\n      ctx.restore();\n    }\n\n    if (!this.parentBound || !this.targetBound) {\n      return;\n    }\n\n    const targetPos = this.targetBound;\n    const points = this._generatePath();\n    const color = this.themeService.getColorValue(\n      '--affine-primary-color',\n      '#1E96EB',\n      true\n    );\n\n    ctx.strokeStyle = color;\n    ctx.fillStyle = color;\n    ctx.lineWidth = 3;\n\n    ctx.roundRect(targetPos.x, targetPos.y, targetPos.w, targetPos.h, 4);\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(points[0][0], points[0][1]);\n\n    if (this.mode === ConnectorMode.Curve) {\n      points.forEach((point, idx) => {\n        if (idx === 0) return;\n        const last = points[idx - 1];\n        ctx.bezierCurveTo(\n          last.absOut[0],\n          last.absOut[1],\n          point.absIn[0],\n          point.absIn[1],\n          point[0],\n          point[1]\n        );\n      });\n    } else {\n      points.forEach((point, idx) => {\n        if (idx === 0) return;\n        ctx.lineTo(point[0], point[1]);\n      });\n    }\n\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  setIndicatorInfo(options: {\n    targetMindMap: MindmapElementModel;\n    target: MindmapNode;\n    parent: MindmapNode;\n    parentChildren: MindmapNode[];\n    insertPosition:\n      | {\n          type: 'sibling';\n          layoutDir: Exclude<LayoutType, LayoutType.BALANCE>;\n          position: 'prev' | 'next';\n        }\n      | { type: 'child'; layoutDir: Exclude<LayoutType, LayoutType.BALANCE> };\n    path: number[];\n  }) {\n    const {\n      insertPosition,\n      parent,\n      parentChildren,\n      targetMindMap,\n      target,\n      path,\n    } = options;\n\n    const parentBound = parent.element.elementBound;\n    const isBalancedMindMap = targetMindMap.layoutType === LayoutType.BALANCE;\n    const isLeftLayout = insertPosition.layoutDir === LayoutType.LEFT;\n    const isFirstLevel = path.length === 2;\n\n    this.direction = insertPosition.layoutDir;\n    this.parentBound = parentBound;\n\n    if (insertPosition.type === 'sibling') {\n      const targetBound = target.element.elementBound;\n\n      this.targetBound =\n        isBalancedMindMap && isFirstLevel && isLeftLayout\n          ? this._moveRelativeToBound(\n              targetBound,\n              insertPosition.position === 'next' ? 'up' : 'down',\n              insertPosition.layoutDir\n            )\n          : this._moveRelativeToBound(\n              targetBound,\n              insertPosition.position === 'next' ? 'down' : 'up',\n              insertPosition.layoutDir\n            );\n    } else {\n      if (parentChildren.length === 0 || parent.detail.collapsed) {\n        this.targetBound = parentBound.moveDelta(\n          (isLeftLayout ? -1 : 1) *\n            (NODE_HORIZONTAL_SPACING / 2 + parentBound.w),\n          parentBound.h / 2 - MindMapIndicatorOverlay.INDICATOR_SIZE[1] / 2\n        );\n      } else {\n        const lastChildBound = last(parentChildren)!.element.elementBound;\n\n        this.targetBound =\n          isBalancedMindMap && isFirstLevel && isLeftLayout\n            ? this._moveRelativeToBound(\n                lastChildBound,\n                'up',\n                insertPosition.layoutDir\n              )\n            : this._moveRelativeToBound(\n                lastChildBound,\n                'down',\n                insertPosition.layoutDir\n              );\n      }\n    }\n\n    this.targetBound.w = MindMapIndicatorOverlay.INDICATOR_SIZE[0];\n    this.targetBound.h = MindMapIndicatorOverlay.INDICATOR_SIZE[1];\n\n    this.mode = targetMindMap.styleGetter.getNodeStyle(\n      target,\n      options.path\n    ).connector.mode;\n  }\n}\n"]}