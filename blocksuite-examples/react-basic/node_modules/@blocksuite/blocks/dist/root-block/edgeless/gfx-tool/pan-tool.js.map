{"version":3,"file":"pan-tool.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/gfx-tool/pan-tool.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,EAAE,EAAE,MAAM,iCAAiC,CAAC;AACrD,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AAClE,OAAO,EAAE,MAAM,EAAE,MAAM,sBAAsB,CAAC;AAM9C,MAAM,OAAO,OAAQ,SAAQ,QAAuB;IAApD;;QAGU,eAAU,GAA4B,IAAI,CAAC;QAE1C,aAAQ,GAAG,IAAI,MAAM,CAAU,KAAK,CAAC,CAAC;IA4DjD,CAAC;aAhEiB,aAAQ,GAAG,KAAK,AAAR,CAAS;IAMjC,IAAa,wBAAwB;QACnC,OAAO,IAAI,CAAC;IACd,CAAC;IAEQ,OAAO,CAAC,CAAoB;QACnC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;IAC9B,CAAC;IAEQ,QAAQ,CAAC,CAAoB;QACpC,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO;QAE7B,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC;QAC9B,MAAM,EAAE,IAAI,EAAE,GAAG,QAAQ,CAAC;QAE1B,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;QACvC,MAAM,MAAM,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;QAC3B,MAAM,MAAM,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;QAE3B,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAE7B,QAAQ,CAAC,gBAAgB,CAAC,MAAM,GAAG,IAAI,EAAE,MAAM,GAAG,IAAI,CAAC,CAAC;IAC1D,CAAC;IAEQ,SAAS,CAAC,CAAoB;QACrC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7B,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAI,CAAC;IAC7B,CAAC;IAEQ,OAAO;QACd,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,EAAE;YAChC,MAAM,mBAAmB,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM,CAAC;YAElE,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACzB,OAAO;YACT,CAAC;YAED,GAAG,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC;YAEzB,MAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;YAC9D,MAAM,iBAAiB,GAAG,GAAG,EAAE;gBAC7B,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YACvC,CAAC,CAAC;YAEF,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,EAAE;gBAC7B,OAAO,EAAE,IAAI;aACd,CAAC,CAAC;YAEH,MAAM,OAAO,GAAG,EAAE,CAAC,QAAQ,EAAE,WAAW,EAAE,GAAG,CAAC,EAAE;gBAC9C,IAAI,GAAG,CAAC,MAAM,KAAK,WAAW,CAAC,MAAM,EAAE,CAAC;oBACtC,iBAAiB,EAAE,CAAC;oBACpB,OAAO,EAAE,CAAC;gBACZ,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,OAAO,KAAK,CAAC;QACf,CAAC,CAAC,CAAC;IACL,CAAC","sourcesContent":["import type { PointerEventState } from '@blocksuite/block-std';\n\nimport { on } from '@blocksuite/affine-shared/utils';\nimport { BaseTool, MouseButton } from '@blocksuite/block-std/gfx';\nimport { Signal } from '@preact/signals-core';\n\nexport type PanToolOption = {\n  panning: boolean;\n};\n\nexport class PanTool extends BaseTool<PanToolOption> {\n  static override toolName = 'pan';\n\n  private _lastPoint: [number, number] | null = null;\n\n  readonly panning$ = new Signal<boolean>(false);\n\n  override get allowDragWithRightButton(): boolean {\n    return true;\n  }\n\n  override dragEnd(_: PointerEventState): void {\n    this._lastPoint = null;\n    this.panning$.value = false;\n  }\n\n  override dragMove(e: PointerEventState): void {\n    if (!this._lastPoint) return;\n\n    const { viewport } = this.gfx;\n    const { zoom } = viewport;\n\n    const [lastX, lastY] = this._lastPoint;\n    const deltaX = lastX - e.x;\n    const deltaY = lastY - e.y;\n\n    this._lastPoint = [e.x, e.y];\n\n    viewport.applyDeltaCenter(deltaX / zoom, deltaY / zoom);\n  }\n\n  override dragStart(e: PointerEventState): void {\n    this._lastPoint = [e.x, e.y];\n    this.panning$.value = true;\n  }\n\n  override mounted(): void {\n    this.addHook('pointerDown', evt => {\n      const shouldPanWithMiddle = evt.raw.button === MouseButton.MIDDLE;\n\n      if (!shouldPanWithMiddle) {\n        return;\n      }\n\n      evt.raw.preventDefault();\n\n      const currentTool = this.controller.currentToolOption$.peek();\n      const restoreToPrevious = () => {\n        this.controller.setTool(currentTool);\n      };\n\n      this.controller.setTool('pan', {\n        panning: true,\n      });\n\n      const dispose = on(document, 'pointerup', evt => {\n        if (evt.button === MouseButton.MIDDLE) {\n          restoreToPrevious();\n          dispose();\n        }\n      });\n\n      return false;\n    });\n  }\n}\n\ndeclare module '@blocksuite/block-std/gfx' {\n  interface GfxToolsMap {\n    pan: PanTool;\n  }\n\n  interface GfxToolsOption {\n    pan: PanToolOption;\n  }\n}\n"]}