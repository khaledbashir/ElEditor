{"version":3,"file":"note-senior-button.js","sourceRoot":"","sources":["../../../../../../src/root-block/edgeless/components/toolbar/note/note-senior-button.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Heading1Icon,\n  LinkIcon,\n  TextIcon,\n} from '@blocksuite/affine-components/icons';\nimport {\n  EditPropsStore,\n  ThemeProvider,\n} from '@blocksuite/affine-shared/services';\nimport { SignalWatcher } from '@blocksuite/global/utils';\nimport { computed } from '@preact/signals-core';\nimport { css, html, LitElement } from 'lit';\nimport { state } from 'lit/decorators.js';\n\nimport type { NoteToolOption } from '../../../gfx-tool/note-tool.js';\n\nimport { getTooltipWithShortcut } from '../../utils.js';\nimport { EdgelessToolbarToolMixin } from '../mixins/tool.mixin.js';\nimport { toShapeNotToAdapt } from './icon.js';\n\nexport class EdgelessNoteSeniorButton extends EdgelessToolbarToolMixin(\n  SignalWatcher(LitElement)\n) {\n  static override styles = css`\n    :host,\n    .edgeless-note-button {\n      display: block;\n      width: 100%;\n      height: 100%;\n    }\n    :host * {\n      box-sizing: border-box;\n    }\n\n    .note-root[data-app-theme='light'] {\n      --paper-border-color: var(--affine-pure-white);\n      --paper-foriegn-color: rgba(0, 0, 0, 0.1);\n      --paper-shadow: 0px 2px 4px rgba(0, 0, 0, 0.25);\n      --icon-card-bg: #fff;\n      --icon-card-shadow: 0px 2px 4px rgba(0, 0, 0, 0.22),\n        inset 0px -2px 1px rgba(0, 0, 0, 0.14);\n    }\n    .note-root[data-app-theme='dark'] {\n      --paper-border-color: var(--affine-divider-color);\n      --paper-foriegn-color: rgba(255, 255, 255, 0.12);\n      --paper-shadow: 0px 2px 6px rgba(0, 0, 0, 0.8);\n      --icon-card-bg: #343434;\n      --icon-card-shadow: 0px 2px 4px rgba(0, 0, 0, 0.6),\n        inset 0px -2px 1px rgba(255, 255, 255, 0.06);\n    }\n\n    .note-root {\n      width: 100%;\n      height: 64px;\n      background: transparent;\n      position: relative;\n      overflow: hidden;\n      cursor: pointer;\n      display: flex;\n      align-items: flex-end;\n      justify-content: center;\n    }\n    .paper {\n      --y: 20px;\n      --r: 4.42deg;\n      width: 60px;\n      height: 72px;\n      background: var(--paper-bg);\n      border: 1px solid var(--paper-border-color);\n      position: absolute;\n      transform: translateY(var(--y)) rotate(var(--r));\n      color: var(--paper-foriegn-color);\n      box-shadow: var(--paper-shadow);\n      padding-top: 32px;\n      padding-left: 3px;\n      transition: transform 0.4s ease;\n    }\n    .edgeless-toolbar-note-icon {\n      position: absolute;\n      width: 26px;\n      height: 26px;\n      border-radius: 2px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--affine-icon-secondary);\n      background: var(--icon-card-bg);\n      box-shadow: var(--icon-card-shadow);\n      bottom: 12px;\n      transition: transform 0.4s ease;\n      transform: translateX(var(--x)) translateY(var(--y)) rotate(var(--r));\n    }\n    .edgeless-toolbar-note-icon.link {\n      --x: -22px;\n      --y: -5px;\n      --r: -6deg;\n      transform-origin: 0% 100%;\n    }\n    .edgeless-toolbar-note-icon.text {\n      --r: 4deg;\n      --x: 0px;\n      --y: 0px;\n    }\n    .edgeless-toolbar-note-icon.heading {\n      --x: 21px;\n      --y: -7px;\n      --r: 8deg;\n      transform-origin: 0% 100%;\n    }\n\n    .note-root:hover .paper {\n      --y: 15px;\n    }\n    .note-root:hover .link {\n      --x: -25px;\n      --y: -5px;\n      --r: -9.5deg;\n    }\n    .note-root:hover .text {\n      --y: -10px;\n    }\n    .note-root:hover .heading {\n      --x: 23px;\n      --y: -8px;\n      --r: 15deg;\n    }\n  `;\n\n  private _noteBg$ = computed(() => {\n    return this.edgeless.std\n      .get(ThemeProvider)\n      .generateColorProperty(\n        this.edgeless.std.get(EditPropsStore).lastProps$.value['affine:note']\n          .background\n      );\n  });\n\n  private _states = ['childFlavour', 'childType', 'tip'] as const;\n\n  override enableActiveBackground = true;\n\n  override type = 'affine:note' as const;\n\n  private _toggleNoteMenu() {\n    if (this.tryDisposePopper()) return;\n\n    const { edgeless, childFlavour, childType, tip } = this;\n\n    this.setEdgelessTool({\n      type: 'affine:note',\n      childFlavour,\n      childType,\n      tip,\n    });\n    const menu = this.createPopper('edgeless-note-menu', this);\n\n    Object.assign(menu.element, {\n      edgeless,\n      childFlavour,\n      childType,\n      tip,\n      onChange: (\n        props: Partial<{\n          childFlavour: NoteToolOption['childFlavour'];\n          childType: string | null;\n          tip: string;\n        }>\n      ) => {\n        this._states.forEach(key => {\n          if (props[key] != undefined) {\n            Object.assign(this, { [key]: props[key] });\n          }\n        });\n        this.setEdgelessTool({\n          type: 'affine:note',\n          childFlavour: this.childFlavour,\n          childType: this.childType,\n          tip: this.tip,\n        });\n      },\n    });\n  }\n\n  override render() {\n    const appTheme = this.edgeless.std.get(ThemeProvider).app$.value;\n\n    return html`<edgeless-toolbar-button\n      class=\"edgeless-note-button\"\n      .tooltip=${this.popper ? '' : getTooltipWithShortcut('Note', 'N')}\n      .tooltipOffset=${5}\n    >\n      <div\n        class=\"note-root\"\n        data-app-theme=${appTheme}\n        @click=${this._toggleNoteMenu}\n        style=\"--paper-bg: ${this._noteBg$.value}\"\n      >\n        <div class=\"paper\">${toShapeNotToAdapt}</div>\n        <div class=\"edgeless-toolbar-note-icon link\">${LinkIcon}</div>\n        <div class=\"edgeless-toolbar-note-icon heading\">${Heading1Icon}</div>\n        <div class=\"edgeless-toolbar-note-icon text\">${TextIcon}</div>\n      </div>\n    </edgeless-toolbar-button>`;\n  }\n\n  // TODO: better to extract these states outside of component?\n  @state()\n  accessor childFlavour: NoteToolOption['childFlavour'] = 'affine:paragraph';\n\n  @state()\n  accessor childType = 'text';\n\n  @state()\n  accessor tip = 'Note';\n}\n"]}