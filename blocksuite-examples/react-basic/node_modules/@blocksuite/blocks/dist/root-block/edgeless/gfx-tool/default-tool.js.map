{"version":3,"file":"default-tool.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/gfx-tool/default-tool.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n  EdgelessTextBlockModel,\n  FrameBlockModel,\n  NoteBlockModel,\n} from '@blocksuite/affine-model';\nimport type { PointerEventState } from '@blocksuite/block-std';\nimport type { IVec } from '@blocksuite/global/utils';\n\nimport {\n  ConnectorUtils,\n  OverlayIdentifier,\n} from '@blocksuite/affine-block-surface';\nimport { focusTextModel } from '@blocksuite/affine-components/rich-text';\nimport {\n  ConnectorElementModel,\n  GroupElementModel,\n  MindmapElementModel,\n  ShapeElementModel,\n  TextElementModel,\n} from '@blocksuite/affine-model';\nimport { TelemetryProvider } from '@blocksuite/affine-shared/services';\nimport {\n  clamp,\n  handleNativeRangeAtPoint,\n  resetNativeSelection,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  BaseTool,\n  getTopElements,\n  GfxExtensionIdentifier,\n  type GfxModel,\n  type GfxPrimitiveElementModel,\n  isGfxGroupCompatibleModel,\n  type PointTestOptions,\n} from '@blocksuite/block-std/gfx';\nimport {\n  Bound,\n  DisposableGroup,\n  getCommonBoundWithRotation,\n  last,\n  noop,\n  Vec,\n} from '@blocksuite/global/utils';\nimport { effect } from '@preact/signals-core';\n\nimport type { GfxBlockModel } from '../block-model.js';\nimport type { EdgelessRootBlockComponent } from '../edgeless-root-block.js';\nimport type { EdgelessFrameManager, FrameOverlay } from '../frame-manager.js';\nimport type { EdgelessSnapManager } from '../utils/snap-manager.js';\nimport type { DefaultToolExt } from './default-tool-ext/ext.js';\n\nimport { isSingleMindMapNode } from '../../../_common/edgeless/mindmap/index.js';\nimport { prepareCloneData } from '../utils/clone-utils.js';\nimport { calPanDelta } from '../utils/panning-utils.js';\nimport {\n  isCanvasElement,\n  isEdgelessTextBlock,\n  isFrameBlock,\n  isNoteBlock,\n} from '../utils/query.js';\nimport {\n  addText,\n  mountConnectorLabelEditor,\n  mountFrameTitleEditor,\n  mountGroupTitleEditor,\n  mountShapeTextEditor,\n  mountTextElementEditor,\n} from '../utils/text.js';\nimport { fitToScreen } from '../utils/viewport.js';\nimport { CanvasElementEventExt } from './default-tool-ext/event-ext.js';\nimport { DefaultModeDragType } from './default-tool-ext/ext.js';\nimport { MindMapExt } from './default-tool-ext/mind-map-ext/mind-map-ext.js';\n\nexport class DefaultTool extends BaseTool {\n  static override toolName: string = 'default';\n\n  private _accumulateDelta: IVec = [0, 0];\n\n  private _alignBound = new Bound();\n\n  private _autoPanTimer: number | null = null;\n\n  private _clearDisposable = () => {\n    if (this._disposables) {\n      this._disposables.dispose();\n      this._disposables = null;\n    }\n  };\n\n  private _clearSelectingState = () => {\n    this._stopAutoPanning();\n    this._clearDisposable();\n\n    this._wheeling = false;\n  };\n\n  private _disposables: DisposableGroup | null = null;\n\n  private _extHandlers: {\n    dragStart?: (evt: PointerEventState) => void;\n    dragMove?: (evt: PointerEventState) => void;\n    dragEnd?: (evt: PointerEventState) => void;\n  }[] = [];\n\n  private _exts: DefaultToolExt[] = [];\n\n  private _hoveredFrame: FrameBlockModel | null = null;\n\n  // Do not select the text, when click again after activating the note.\n  private _isDoubleClickedOnMask = false;\n\n  private _lock = false;\n\n  private _panViewport = (delta: IVec) => {\n    this._accumulateDelta[0] += delta[0];\n    this._accumulateDelta[1] += delta[1];\n    this.gfx.viewport.applyDeltaCenter(delta[0], delta[1]);\n  };\n\n  private _pendingUpdates = new Map<\n    GfxBlockModel | GfxPrimitiveElementModel,\n    Partial<GfxBlockModel>\n  >();\n\n  private _rafId: number | null = null;\n\n  private _selectedBounds: Bound[] = [];\n\n  // For moving the connector label\n  private _selectedConnector: ConnectorElementModel | null = null;\n\n  private _selectedConnectorLabelBounds: Bound | null = null;\n\n  private _selectionRectTransition: null | {\n    w: number;\n    h: number;\n    startX: number;\n    startY: number;\n    endX: number;\n    endY: number;\n  } = null;\n\n  private _startAutoPanning = (delta: IVec) => {\n    this._panViewport(delta);\n    this._updateSelectingState(delta);\n    this._stopAutoPanning();\n\n    this._autoPanTimer = window.setInterval(() => {\n      this._panViewport(delta);\n      this._updateSelectingState(delta);\n    }, 30);\n  };\n\n  private _stopAutoPanning = () => {\n    if (this._autoPanTimer) {\n      clearTimeout(this._autoPanTimer);\n      this._autoPanTimer = null;\n    }\n  };\n\n  private _toBeMoved: GfxModel[] = [];\n\n  private _updateSelectingState = (delta: IVec = [0, 0]) => {\n    const { gfx } = this;\n\n    if (gfx.keyboard.spaceKey$.peek() && this._selectionRectTransition) {\n      /* Move the selection if space is pressed */\n      const curDraggingViewArea = this.controller.draggingViewArea$.peek();\n      const { w, h, startX, startY, endX, endY } =\n        this._selectionRectTransition;\n      const { endX: lastX, endY: lastY } = curDraggingViewArea;\n\n      const dx = lastX + delta[0] - endX + this._accumulateDelta[0];\n      const dy = lastY + delta[1] - endY + this._accumulateDelta[1];\n\n      this.controller.draggingViewArea$.value = {\n        ...curDraggingViewArea,\n        x: Math.min(startX + dx, lastX),\n        y: Math.min(startY + dy, lastY),\n        w,\n        h,\n        startX: startX + dx,\n        startY: startY + dy,\n      };\n    } else {\n      const curDraggingArea = this.controller.draggingViewArea$.peek();\n      const newStartX = curDraggingArea.startX - delta[0];\n      const newStartY = curDraggingArea.startY - delta[1];\n\n      this.controller.draggingViewArea$.value = {\n        ...curDraggingArea,\n        startX: newStartX,\n        startY: newStartY,\n        x: Math.min(newStartX, curDraggingArea.endX),\n        y: Math.min(newStartY, curDraggingArea.endY),\n        w: Math.abs(curDraggingArea.endX - newStartX),\n        h: Math.abs(curDraggingArea.endY - newStartY),\n      };\n    }\n\n    const { x, y, w, h } = this.controller.draggingArea$.peek();\n    const bound = new Bound(x, y, w, h);\n\n    let elements = gfx.getElementsByBound(bound).filter(el => {\n      if (isFrameBlock(el)) {\n        return el.childElements.length === 0 || bound.contains(el.elementBound);\n      }\n      if (el instanceof MindmapElementModel) {\n        return bound.contains(el.elementBound);\n      }\n      return true;\n    });\n\n    elements = getTopElements(elements).filter(el => !el.isLocked());\n\n    const set = new Set(\n      gfx.keyboard.shiftKey$.peek()\n        ? [...elements, ...gfx.selection.selectedElements]\n        : elements\n    );\n\n    this.edgelessSelectionManager.set({\n      elements: Array.from(set).map(element => element.id),\n      editing: false,\n    });\n  };\n\n  private _wheeling = false;\n\n  dragType = DefaultModeDragType.None;\n\n  enableHover = true;\n\n  private get _edgeless(): EdgelessRootBlockComponent | null {\n    const block = this.std.view.getBlock(this.doc.root!.id);\n\n    return (block as EdgelessRootBlockComponent) ?? null;\n  }\n\n  private get _frameMgr() {\n    return this.std.get(\n      GfxExtensionIdentifier('frame-manager')\n    ) as EdgelessFrameManager;\n  }\n\n  private get _supportedExts() {\n    return this._exts.filter(ext =>\n      ext.supportedDragTypes.includes(this.dragType)\n    );\n  }\n\n  /**\n   * Get the end position of the dragging area in the model coordinate\n   */\n  get dragLastPos() {\n    const { endX, endY } = this.controller.draggingArea$.peek();\n\n    return [endX, endY] as IVec;\n  }\n\n  /**\n   * Get the start position of the dragging area in the model coordinate\n   */\n  get dragStartPos() {\n    const { startX, startY } = this.controller.draggingArea$.peek();\n\n    return [startX, startY] as IVec;\n  }\n\n  get edgelessSelectionManager() {\n    return this.gfx.selection;\n  }\n\n  private get frameOverlay() {\n    return this.std.get(OverlayIdentifier('frame')) as FrameOverlay;\n  }\n\n  get snapOverlay() {\n    return this.std.get(\n      OverlayIdentifier('snap-manager')\n    ) as EdgelessSnapManager;\n  }\n\n  private _addEmptyParagraphBlock(\n    block: NoteBlockModel | EdgelessTextBlockModel\n  ) {\n    const blockId = this.doc.addBlock(\n      'affine:paragraph',\n      { type: 'text' },\n      block.id\n    );\n    if (blockId) {\n      focusTextModel(this.std, blockId);\n    }\n  }\n\n  private async _cloneContent() {\n    this._lock = true;\n\n    if (!this._edgeless) return;\n\n    const clipboardController = this._edgeless?.clipboardController;\n    const snapshot = prepareCloneData(this._toBeMoved, this.std);\n\n    const bound = getCommonBoundWithRotation(this._toBeMoved);\n    const { canvasElements, blockModels } =\n      await clipboardController.createElementsFromClipboardData(\n        snapshot,\n        bound.center\n      );\n\n    this._toBeMoved = [...canvasElements, ...blockModels];\n    this.edgelessSelectionManager.set({\n      elements: this._toBeMoved.map(e => e.id),\n      editing: false,\n    });\n  }\n\n  private _determineDragType(e: PointerEventState): DefaultModeDragType {\n    const { x, y } = e;\n    // Is dragging started from current selected rect\n    if (this.edgelessSelectionManager.isInSelectedRect(x, y)) {\n      if (this.edgelessSelectionManager.selectedElements.length === 1) {\n        let selected = this.edgelessSelectionManager.selectedElements[0];\n        // double check\n        const currentSelected = this._pick(x, y);\n        if (\n          !isFrameBlock(selected) &&\n          !(selected instanceof GroupElementModel) &&\n          currentSelected &&\n          currentSelected !== selected\n        ) {\n          selected = currentSelected;\n          this.edgelessSelectionManager.set({\n            elements: [selected.id],\n            editing: false,\n          });\n        }\n\n        if (\n          isCanvasElement(selected) &&\n          ConnectorUtils.isConnectorWithLabel(selected) &&\n          (selected as ConnectorElementModel).labelIncludesPoint(\n            this.gfx.viewport.toModelCoord(x, y)\n          )\n        ) {\n          this._selectedConnector = selected as ConnectorElementModel;\n          this._selectedConnectorLabelBounds = Bound.fromXYWH(\n            this._selectedConnector.labelXYWH!\n          );\n          return DefaultModeDragType.ConnectorLabelMoving;\n        }\n      }\n\n      return this.edgelessSelectionManager.editing\n        ? DefaultModeDragType.NativeEditing\n        : DefaultModeDragType.ContentMoving;\n    } else {\n      const selected = this._pick(x, y);\n      if (selected) {\n        this.edgelessSelectionManager.set({\n          elements: [selected.id],\n          editing: false,\n        });\n\n        if (\n          isCanvasElement(selected) &&\n          ConnectorUtils.isConnectorWithLabel(selected) &&\n          (selected as ConnectorElementModel).labelIncludesPoint(\n            this.gfx.viewport.toModelCoord(x, y)\n          )\n        ) {\n          this._selectedConnector = selected as ConnectorElementModel;\n          this._selectedConnectorLabelBounds = Bound.fromXYWH(\n            this._selectedConnector.labelXYWH!\n          );\n          return DefaultModeDragType.ConnectorLabelMoving;\n        }\n\n        return DefaultModeDragType.ContentMoving;\n      } else {\n        return DefaultModeDragType.Selecting;\n      }\n    }\n  }\n\n  private _filterConnectedConnector() {\n    this._toBeMoved = this._toBeMoved.filter(ele => {\n      if (\n        ele instanceof ConnectorElementModel &&\n        ele.source?.id &&\n        ele.target?.id\n      ) {\n        if (\n          this._toBeMoved.some(e => e.id === ele.source.id) &&\n          this._toBeMoved.some(e => e.id === ele.target.id)\n        ) {\n          return false;\n        }\n      }\n      return true;\n    });\n  }\n\n  private _isDraggable(element: GfxModel) {\n    return !(\n      element instanceof ConnectorElementModel &&\n      !ConnectorUtils.isConnectorAndBindingsAllSelected(\n        element,\n        this._toBeMoved\n      )\n    );\n  }\n\n  private _moveContent(\n    [dx, dy]: IVec,\n    alignBound: Bound,\n    shifted?: boolean,\n    shouldClone?: boolean\n  ) {\n    alignBound.x += dx;\n    alignBound.y += dy;\n\n    const alignRst = this.snapOverlay.align(alignBound);\n    const delta = [dx + alignRst.dx, dy + alignRst.dy];\n\n    if (shifted) {\n      const angle = Math.abs(Math.atan2(delta[1], delta[0]));\n      const direction =\n        angle < Math.PI / 4 || angle > 3 * (Math.PI / 4) ? 'x' : 'y';\n      delta[direction === 'x' ? 1 : 0] = 0;\n    }\n\n    this._toBeMoved.forEach((element, index) => {\n      const isGraphicElement = isCanvasElement(element);\n\n      if (isGraphicElement && !this._isDraggable(element)) return;\n\n      let bound = this._selectedBounds[index];\n      if (shouldClone) bound = bound.clone();\n\n      bound.x += delta[0];\n      bound.y += delta[1];\n\n      if (isGraphicElement) {\n        if (!this._lock) {\n          this._lock = true;\n          this.doc.captureSync();\n        }\n\n        if (element instanceof ConnectorElementModel) {\n          element.moveTo(bound);\n        }\n      }\n\n      this._scheduleUpdate(element, {\n        xywh: bound.serialize(),\n      });\n    });\n\n    this._hoveredFrame = this._frameMgr.getFrameFromPoint(\n      this.dragLastPos,\n      this._toBeMoved.filter(ele => isFrameBlock(ele))\n    );\n\n    this._hoveredFrame && !this._hoveredFrame.isLocked()\n      ? this.frameOverlay.highlight(this._hoveredFrame)\n      : this.frameOverlay.clear();\n  }\n\n  private _moveLabel(delta: IVec) {\n    const connector = this._selectedConnector;\n    let bounds = this._selectedConnectorLabelBounds;\n    if (!connector || !bounds) return;\n    bounds = bounds.clone();\n    const center = connector.getNearestPoint(\n      Vec.add(bounds.center, delta) as IVec\n    );\n    const distance = connector.getOffsetDistanceByPoint(center as IVec);\n    bounds.center = center;\n    this.gfx.updateElement(connector, {\n      labelXYWH: bounds.toXYWH(),\n      labelOffset: {\n        distance,\n      },\n    });\n  }\n\n  private _pick(x: number, y: number, options?: PointTestOptions) {\n    const modelPos = this.gfx.viewport.toModelCoord(x, y);\n\n    const tryGetLockedAncestor = (e: GfxModel | null) => {\n      if (e?.isLockedByAncestor()) {\n        return e.groups.findLast(group => group.isLocked());\n      }\n      return e;\n    };\n\n    const frameByPickingTitle = last(\n      this.gfx\n        .getElementByPoint(modelPos[0], modelPos[1], {\n          ...options,\n          all: true,\n        })\n        .filter(\n          el => isFrameBlock(el) && el.externalBound?.isPointInBound(modelPos)\n        )\n    );\n\n    if (frameByPickingTitle) return tryGetLockedAncestor(frameByPickingTitle);\n\n    const result = this.gfx.getElementInGroup(\n      modelPos[0],\n      modelPos[1],\n      options\n    );\n\n    if (result instanceof MindmapElementModel) {\n      const picked = this.gfx.getElementByPoint(modelPos[0], modelPos[1], {\n        ...((options ?? {}) as PointTestOptions),\n        all: true,\n      });\n\n      let pickedIdx = picked.length - 1;\n\n      while (pickedIdx >= 0) {\n        const element = picked[pickedIdx];\n        if (element === result) {\n          pickedIdx -= 1;\n          continue;\n        }\n\n        break;\n      }\n\n      return tryGetLockedAncestor(picked[pickedIdx]) ?? null;\n    }\n\n    // if the frame has title, it only can be picked by clicking the title\n    if (isFrameBlock(result) && result.externalXYWH) {\n      return null;\n    }\n\n    return tryGetLockedAncestor(result);\n  }\n\n  private _scheduleUpdate(\n    element: GfxBlockModel | GfxPrimitiveElementModel,\n    updates: Partial<GfxBlockModel>\n  ) {\n    this._pendingUpdates.set(element, updates);\n\n    if (this._rafId !== null) return;\n\n    this._rafId = requestAnimationFrame(() => {\n      this._pendingUpdates.forEach((updates, element) => {\n        this.gfx.updateElement(element, updates);\n      });\n      this._pendingUpdates.clear();\n      this._rafId = null;\n    });\n  }\n\n  private initializeDragState(\n    dragType: DefaultModeDragType,\n    event: PointerEventState\n  ) {\n    this.dragType = dragType;\n\n    if (\n      (this._toBeMoved.length &&\n        this._toBeMoved.every(\n          ele => !(ele.group instanceof MindmapElementModel)\n        )) ||\n      (isSingleMindMapNode(this._toBeMoved) &&\n        this._toBeMoved[0].id ===\n          (this._toBeMoved[0].group as MindmapElementModel).tree.id)\n    ) {\n      const mindmap = this._toBeMoved[0].group as MindmapElementModel;\n\n      this._alignBound = this.snapOverlay.setupAlignables(this._toBeMoved, [\n        mindmap,\n        ...(mindmap?.childElements || []),\n      ]);\n    }\n\n    this._clearDisposable();\n    this._disposables = new DisposableGroup();\n\n    const ctx = {\n      movedElements: this._toBeMoved,\n      dragType,\n      event,\n    };\n\n    this._extHandlers = this._supportedExts.map(ext => ext.initDrag(ctx));\n    this._selectedBounds = this._toBeMoved.map(element =>\n      Bound.deserialize(element.xywh)\n    );\n\n    // If the drag type is selecting, set up the dragging area disposable group\n    // If the viewport updates when dragging, should update the dragging area and selection\n    if (this.dragType === DefaultModeDragType.Selecting) {\n      this._disposables.add(\n        this.gfx.viewport.viewportUpdated.on(() => {\n          if (\n            this.dragType === DefaultModeDragType.Selecting &&\n            this.controller.dragging$.peek() &&\n            !this._autoPanTimer\n          ) {\n            this._updateSelectingState();\n          }\n        })\n      );\n      return;\n    }\n\n    if (this.dragType === DefaultModeDragType.ContentMoving) {\n      this._disposables.add(\n        this.gfx.viewport.viewportMoved.on(delta => {\n          if (\n            this.dragType === DefaultModeDragType.ContentMoving &&\n            this.controller.dragging$.peek() &&\n            !this._autoPanTimer\n          ) {\n            if (\n              this._toBeMoved.every(ele => {\n                return !this._isDraggable(ele);\n              })\n            ) {\n              return;\n            }\n\n            if (!this._wheeling) {\n              this._wheeling = true;\n              this._selectedBounds = this._toBeMoved.map(element =>\n                Bound.deserialize(element.xywh)\n              );\n            }\n\n            this._alignBound = this.snapOverlay.setupAlignables(\n              this._toBeMoved\n            );\n\n            this._moveContent(delta, this._alignBound);\n          }\n        })\n      );\n      return;\n    }\n  }\n\n  override activate(_: Record<string, unknown>): void {\n    if (this.gfx.selection.lastSurfaceSelections.length) {\n      this.gfx.selection.set(this.gfx.selection.lastSurfaceSelections);\n    }\n  }\n\n  override click(e: PointerEventState) {\n    if (this.doc.readonly) return;\n\n    const selected = this._pick(e.x, e.y, {\n      ignoreTransparent: true,\n    });\n\n    if (selected) {\n      const { selectedIds, surfaceSelections } = this.edgelessSelectionManager;\n      const editing = surfaceSelections[0]?.editing ?? false;\n\n      // click active canvas text, edgeless text block and note block\n      if (\n        selectedIds.length === 1 &&\n        selectedIds[0] === selected.id &&\n        editing\n      ) {\n        // edgeless text block and note block\n        if (\n          (isNoteBlock(selected) || isEdgelessTextBlock(selected)) &&\n          selected.children.length === 0\n        ) {\n          this._addEmptyParagraphBlock(selected);\n        }\n        // canvas text\n        return;\n      }\n\n      // click non-active edgeless text block and note block, and then enter editing\n      if (\n        !selected.isLocked() &&\n        !e.keys.shift &&\n        selectedIds.length === 1 &&\n        (isNoteBlock(selected) || isEdgelessTextBlock(selected)) &&\n        ((selectedIds[0] === selected.id && !editing) ||\n          (editing && selectedIds[0] !== selected.id))\n      ) {\n        // issue #1809\n        // If the previously selected element is a noteBlock and is in an active state,\n        // then the currently clicked noteBlock should also be in an active state when selected.\n        this.edgelessSelectionManager.set({\n          elements: [selected.id],\n          editing: true,\n        });\n        this._edgeless?.updateComplete\n          .then(() => {\n            // check if block has children blocks, if not, add a paragraph block and focus on it\n            if (selected.children.length === 0) {\n              this._addEmptyParagraphBlock(selected);\n            } else {\n              const block = this.std.host.view.getBlock(selected.id);\n              if (block) {\n                const rect = block\n                  .querySelector('.affine-block-children-container')!\n                  .getBoundingClientRect();\n\n                const offsetY = 8 * this.gfx.viewport.zoom;\n                const offsetX = 2 * this.gfx.viewport.zoom;\n                const x = clamp(\n                  e.raw.clientX,\n                  rect.left + offsetX,\n                  rect.right - offsetX\n                );\n                const y = clamp(\n                  e.raw.clientY,\n                  rect.top + offsetY,\n                  rect.bottom - offsetY\n                );\n                handleNativeRangeAtPoint(x, y);\n              } else {\n                handleNativeRangeAtPoint(e.raw.clientX, e.raw.clientY);\n              }\n            }\n          })\n          .catch(console.error);\n        return;\n      }\n\n      this.edgelessSelectionManager.set({\n        // hold shift key to multi select or de-select element\n        elements: e.keys.shift\n          ? this.edgelessSelectionManager.has(selected.id)\n            ? selectedIds.filter(id => id !== selected.id)\n            : [...selectedIds, selected.id]\n          : [selected.id],\n        editing: false,\n      });\n    } else if (!e.keys.shift) {\n      this.edgelessSelectionManager.clear();\n      resetNativeSelection(null);\n    }\n\n    this._isDoubleClickedOnMask = false;\n    this._supportedExts.forEach(ext => ext.click?.(e));\n  }\n\n  override deactivate() {\n    this._stopAutoPanning();\n    this._clearDisposable();\n    this._accumulateDelta = [0, 0];\n    noop();\n  }\n\n  override doubleClick(e: PointerEventState) {\n    if (this.doc.readonly) {\n      const viewport = this.gfx.viewport;\n      if (viewport.zoom === 1) {\n        // Fit to Screen\n        fitToScreen(\n          [...this.gfx.layer.blocks, ...this.gfx.layer.canvasElements],\n          this.gfx.viewport\n        );\n      } else {\n        // Zoom to 100% and Center\n        const [x, y] = viewport.toModelCoord(e.x, e.y);\n        viewport.setViewport(1, [x, y], true);\n      }\n      return;\n    }\n\n    const selected = this._pick(e.x, e.y, {\n      hitThreshold: 10,\n    });\n    if (!this._edgeless) {\n      return;\n    }\n\n    if (!selected) {\n      const textFlag = this.doc.awarenessStore.getFlag('enable_edgeless_text');\n\n      if (textFlag) {\n        const [x, y] = this.gfx.viewport.toModelCoord(e.x, e.y);\n        this.std.command.exec('insertEdgelessText', { x, y });\n      } else {\n        addText(this._edgeless, e);\n      }\n      this.std.getOptional(TelemetryProvider)?.track('CanvasElementAdded', {\n        control: 'canvas:dbclick',\n        page: 'whiteboard editor',\n        module: 'toolbar',\n        segment: 'toolbar',\n        type: 'text',\n      });\n      return;\n    } else {\n      if (selected.isLocked()) return;\n      const [x, y] = this.gfx.viewport.toModelCoord(e.x, e.y);\n      if (selected instanceof TextElementModel) {\n        mountTextElementEditor(selected, this._edgeless, {\n          x,\n          y,\n        });\n        return;\n      }\n      if (selected instanceof ShapeElementModel) {\n        mountShapeTextEditor(selected, this._edgeless);\n        return;\n      }\n      if (selected instanceof ConnectorElementModel) {\n        mountConnectorLabelEditor(selected, this._edgeless, [x, y]);\n        return;\n      }\n      if (isFrameBlock(selected)) {\n        mountFrameTitleEditor(selected, this._edgeless);\n        return;\n      }\n      if (selected instanceof GroupElementModel) {\n        mountGroupTitleEditor(selected, this._edgeless);\n        return;\n      }\n    }\n\n    this._supportedExts.forEach(ext => ext.click?.(e));\n\n    if (\n      e.raw.target &&\n      e.raw.target instanceof HTMLElement &&\n      e.raw.target.classList.contains('affine-note-mask')\n    ) {\n      this.click(e);\n      this._isDoubleClickedOnMask = true;\n      return;\n    }\n  }\n\n  override dragEnd(e: PointerEventState) {\n    this._extHandlers.forEach(handler => handler.dragEnd?.(e));\n\n    this._toBeMoved.forEach(el => {\n      this.doc.transact(() => {\n        el.pop('xywh');\n      });\n\n      if (el instanceof ConnectorElementModel) {\n        el.pop('labelXYWH');\n      }\n    });\n\n    {\n      const frameManager = this._frameMgr;\n      const toBeMovedTopElements = getTopElements(\n        this._toBeMoved.map(el =>\n          el.group instanceof MindmapElementModel ? el.group : el\n        )\n      );\n      if (this._hoveredFrame) {\n        frameManager.addElementsToFrame(\n          this._hoveredFrame,\n          toBeMovedTopElements\n        );\n      } else {\n        // only apply to root nodes of trees\n        toBeMovedTopElements.map(element =>\n          frameManager.removeFromParentFrame(element)\n        );\n      }\n    }\n\n    if (this._lock) {\n      this.doc.captureSync();\n      this._lock = false;\n    }\n\n    if (this.edgelessSelectionManager.editing) return;\n\n    this._selectedBounds = [];\n    this.snapOverlay.cleanupAlignables();\n    this.frameOverlay.clear();\n    this._toBeMoved = [];\n    this._selectedConnector = null;\n    this._selectedConnectorLabelBounds = null;\n    this._clearSelectingState();\n    this.dragType = DefaultModeDragType.None;\n  }\n\n  override dragMove(e: PointerEventState) {\n    const { viewport } = this.gfx;\n    switch (this.dragType) {\n      case DefaultModeDragType.Selecting: {\n        // Record the last drag pointer position for auto panning and view port updating\n\n        this._updateSelectingState();\n        const moveDelta = calPanDelta(viewport, e);\n        if (moveDelta) {\n          this._startAutoPanning(moveDelta);\n        } else {\n          this._stopAutoPanning();\n        }\n        break;\n      }\n      case DefaultModeDragType.AltCloning:\n      case DefaultModeDragType.ContentMoving: {\n        if (\n          this._toBeMoved.length &&\n          this._toBeMoved.every(ele => {\n            return !this._isDraggable(ele);\n          })\n        ) {\n          return;\n        }\n\n        if (this._wheeling) {\n          this._wheeling = false;\n        }\n\n        const dx = this.dragLastPos[0] - this.dragStartPos[0];\n        const dy = this.dragLastPos[1] - this.dragStartPos[1];\n        const alignBound = this._alignBound.clone();\n        const shifted = e.keys.shift || this.gfx.keyboard.shiftKey$.peek();\n\n        this._moveContent([dx, dy], alignBound, shifted, true);\n        this._extHandlers.forEach(handler => handler.dragMove?.(e));\n        break;\n      }\n      case DefaultModeDragType.ConnectorLabelMoving: {\n        const dx = this.dragLastPos[0] - this.dragStartPos[0];\n        const dy = this.dragLastPos[1] - this.dragStartPos[1];\n        this._moveLabel([dx, dy]);\n        break;\n      }\n      case DefaultModeDragType.NativeEditing: {\n        // TODO reset if drag out of note\n        break;\n      }\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  override async dragStart(e: PointerEventState) {\n    if (this.edgelessSelectionManager.editing) return;\n    // Determine the drag type based on the current state and event\n    let dragType = this._determineDragType(e);\n\n    const elements = this.edgelessSelectionManager.selectedElements;\n    if (elements.some(e => e.isLocked())) return;\n\n    const toBeMoved = new Set(elements);\n\n    elements.forEach(element => {\n      if (isGfxGroupCompatibleModel(element)) {\n        element.descendantElements.forEach(ele => {\n          toBeMoved.add(ele);\n        });\n      }\n    });\n\n    this._toBeMoved = Array.from(toBeMoved);\n\n    // If alt key is pressed and content is moving, clone the content\n    if (e.keys.alt && dragType === DefaultModeDragType.ContentMoving) {\n      dragType = DefaultModeDragType.AltCloning;\n      await this._cloneContent();\n    }\n    this._filterConnectedConnector();\n\n    // Connector needs to be updated first\n    this._toBeMoved.sort((a, _) =>\n      a instanceof ConnectorElementModel ? -1 : 1\n    );\n\n    // Set up drag state\n    this.initializeDragState(dragType, e);\n\n    // stash the state\n    this._toBeMoved.forEach(ele => {\n      ele.stash('xywh');\n\n      if (ele instanceof ConnectorElementModel) {\n        ele.stash('labelXYWH');\n      }\n    });\n\n    this._extHandlers.forEach(handler => handler.dragStart?.(e));\n  }\n\n  override mounted() {\n    this.disposable.add(\n      effect(() => {\n        const pressed = this.gfx.keyboard.spaceKey$.value;\n\n        if (pressed) {\n          const currentDraggingArea = this.controller.draggingViewArea$.peek();\n\n          this._selectionRectTransition = {\n            w: currentDraggingArea.w,\n            h: currentDraggingArea.h,\n            startX: currentDraggingArea.startX,\n            startY: currentDraggingArea.startY,\n            endX: currentDraggingArea.endX,\n            endY: currentDraggingArea.endY,\n          };\n        } else {\n          this._selectionRectTransition = null;\n        }\n      })\n    );\n\n    this._exts = [MindMapExt, CanvasElementEventExt].map(\n      constructor => new constructor(this)\n    );\n    this._exts.forEach(ext => ext.mounted());\n  }\n\n  override pointerDown(e: PointerEventState): void {\n    this._supportedExts.forEach(ext => ext.pointerDown(e));\n  }\n\n  override pointerMove(e: PointerEventState) {\n    const hovered = this._pick(e.x, e.y, {\n      hitThreshold: 10,\n    });\n\n    if (\n      isFrameBlock(hovered) &&\n      hovered.externalBound?.isPointInBound(\n        this.gfx.viewport.toModelCoord(e.x, e.y)\n      )\n    ) {\n      this.frameOverlay.highlight(hovered);\n    } else {\n      this.frameOverlay.clear();\n    }\n\n    this._supportedExts.forEach(ext => ext.pointerMove(e));\n  }\n\n  override pointerUp(e: PointerEventState) {\n    this._supportedExts.forEach(ext => ext.pointerUp(e));\n  }\n\n  override tripleClick() {\n    if (this._isDoubleClickedOnMask) return;\n  }\n\n  override unmounted(): void {\n    this._exts.forEach(ext => ext.unmounted());\n  }\n}\n\ndeclare module '@blocksuite/block-std/gfx' {\n  interface GfxToolsMap {\n    default: DefaultTool;\n  }\n}\n"]}