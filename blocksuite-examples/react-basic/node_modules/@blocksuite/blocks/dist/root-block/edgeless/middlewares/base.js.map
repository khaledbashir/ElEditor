{"version":3,"file":"base.js","sourceRoot":"","sources":["../../../../src/root-block/edgeless/middlewares/base.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAE,MAAM,oCAAoC,CAAC;AACpE,OAAO,EAEL,wBAAwB,GACzB,MAAM,2BAA2B,CAAC;AAEnC,OAAO,EAAE,eAAe,EAAE,MAAM,gCAAgC,CAAC;AAEjE,MAAM,OAAO,0BAA2B,SAAQ,wBAAwB;IAAxE;;QAGE,eAAU,GAAsB,GAAG,CAAC,EAAE;YACpC,IAAI,GAAG,CAAC,IAAI,KAAK,WAAW,EAAE,CAAC;gBAC7B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC,OAAO,CAAC;gBACpC,MAAM,GAAG,GAAG,eAAe,CAAC,IAAoC,EAAE,KAAK,CAAC,CAAC;gBACzE,MAAM,MAAM,GAAG,GAAG;oBAChB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC;oBACrE,CAAC,CAAC,IAAI,CAAC;gBAET,GAAG,CAAC,OAAO,CAAC,KAAK,GAAG;oBAClB,GAAG,CAAC,MAAM,IAAI,KAAK,CAAC;oBACpB,KAAK,EAAE,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,aAAa,EAAE;iBACrD,CAAC;YACJ,CAAC;QACH,CAAC,CAAC;IACJ,CAAC;aAhBiB,QAAG,GAAG,WAAW,AAAd,CAAe","sourcesContent":["import { EditPropsStore } from '@blocksuite/affine-shared/services';\nimport {\n  type SurfaceMiddleware,\n  SurfaceMiddlewareBuilder,\n} from '@blocksuite/block-std/gfx';\n\nimport { getLastPropsKey } from '../utils/get-last-props-key.js';\n\nexport class EditPropsMiddlewareBuilder extends SurfaceMiddlewareBuilder {\n  static override key = 'editProps';\n\n  middleware: SurfaceMiddleware = ctx => {\n    if (ctx.type === 'beforeAdd') {\n      const { type, props } = ctx.payload;\n      const key = getLastPropsKey(type as BlockSuite.EdgelessModelKeys, props);\n      const nProps = key\n        ? this.std.get(EditPropsStore).applyLastProps(key, ctx.payload.props)\n        : null;\n\n      ctx.payload.props = {\n        ...(nProps ?? props),\n        index: props.index ?? this.gfx.layer.generateIndex(),\n      };\n    }\n  };\n}\n"]}