{"version":3,"file":"options.js","sourceRoot":"","sources":["../../../src/attachment-block/components/options.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  CaptionIcon,\n  DownloadIcon,\n  EditIcon,\n  MoreVerticalIcon,\n  SmallArrowDownIcon,\n} from '@blocksuite/affine-components/icons';\nimport { createLitPortal } from '@blocksuite/affine-components/portal';\nimport {\n  cloneGroups,\n  renderGroups,\n  renderToolbarSeparator,\n} from '@blocksuite/affine-components/toolbar';\nimport {\n  type AttachmentBlockModel,\n  defaultAttachmentProps,\n} from '@blocksuite/affine-model';\nimport {\n  EMBED_CARD_HEIGHT,\n  EMBED_CARD_WIDTH,\n} from '@blocksuite/affine-shared/consts';\nimport { Bound } from '@blocksuite/global/utils';\nimport { flip, offset } from '@floating-ui/dom';\nimport { html, nothing } from 'lit';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AttachmentBlockComponent } from '../attachment-block.js';\n\nimport { getMoreMenuConfig } from '../../root-block/configs/toolbar.js';\nimport { BUILT_IN_GROUPS } from './config.js';\nimport { AttachmentToolbarMoreMenuContext } from './context.js';\nimport { RenameModal } from './rename-model.js';\nimport { styles } from './styles.js';\n\nexport function attachmentViewToggleMenu({\n  block,\n  callback,\n}: {\n  block: AttachmentBlockComponent;\n  callback?: () => void;\n}) {\n  const model = block.model;\n  const readonly = model.doc.readonly;\n  const embedded = model.embed;\n  const viewType = embedded ? 'embed' : 'card';\n  const viewActions = [\n    {\n      type: 'card',\n      label: 'Card view',\n      disabled: readonly || !embedded,\n      action: () => {\n        const style = defaultAttachmentProps.style!;\n        const width = EMBED_CARD_WIDTH[style];\n        const height = EMBED_CARD_HEIGHT[style];\n        const bound = Bound.deserialize(model.xywh);\n        bound.w = width;\n        bound.h = height;\n        model.doc.updateBlock(model, {\n          style,\n          embed: false,\n          xywh: bound.serialize(),\n        });\n        callback?.();\n      },\n    },\n    {\n      type: 'embed',\n      label: 'Embed view',\n      disabled: readonly || embedded || !block.embedded(),\n      action: () => {\n        block.convertTo();\n        callback?.();\n      },\n    },\n  ];\n\n  return html`\n    <editor-menu-button\n      .contentPadding=${'8px'}\n      .button=${html`\n        <editor-icon-button\n          aria-label=\"Switch view\"\n          .justify=${'space-between'}\n          .labelHeight=${'20px'}\n          .iconContainerWidth=${'110px'}\n        >\n          <div class=\"label\">\n            <span style=\"text-transform: capitalize\">${viewType}</span>\n            view\n          </div>\n          ${SmallArrowDownIcon}\n        </editor-icon-button>\n      `}\n    >\n      <div data-size=\"small\" data-orientation=\"vertical\">\n        ${repeat(\n          viewActions,\n          button => button.type,\n          ({ type, label, action, disabled }) => html`\n            <editor-menu-action\n              data-testid=${`link-to-${type}`}\n              ?data-selected=${type === viewType}\n              ?disabled=${disabled}\n              @click=${action}\n            >\n              ${label}\n            </editor-menu-action>\n          `\n        )}\n      </div>\n    </editor-menu-button>\n  `;\n}\n\nexport function AttachmentOptionsTemplate({\n  block,\n  model,\n  abortController,\n}: {\n  block: AttachmentBlockComponent;\n  model: AttachmentBlockModel;\n  abortController: AbortController;\n}) {\n  const std = block.std;\n  const editorHost = block.host;\n  const readonly = model.doc.readonly;\n  const context = new AttachmentToolbarMoreMenuContext(block, abortController);\n  const groups = getMoreMenuConfig(std).configure(cloneGroups(BUILT_IN_GROUPS));\n  const moreMenuActions = renderGroups(groups, context);\n\n  const buttons = [\n    // preview\n    // html`\n    //   <editor-icon-button aria-label=\"Preview\" .tooltip=${'Preview'}>\n    //     ${ViewIcon}\n    //   </editor-icon-button>\n    // `,\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Rename\"\n            .tooltip=${'Rename'}\n            @click=${() => {\n              abortController.abort();\n              const renameAbortController = new AbortController();\n              createLitPortal({\n                template: RenameModal({\n                  model,\n                  editorHost,\n                  abortController: renameAbortController,\n                }),\n                computePosition: {\n                  referenceElement: block,\n                  placement: 'top-start',\n                  middleware: [flip(), offset(4)],\n                  // It has a overlay mask, so we don't need to update the position.\n                  // autoUpdate: true,\n                },\n                abortController: renameAbortController,\n              });\n            }}\n          >\n            ${EditIcon}\n          </editor-icon-button>\n        `,\n\n    attachmentViewToggleMenu({\n      block,\n      callback: () => abortController.abort(),\n    }),\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Download\"\n            .tooltip=${'Download'}\n            @click=${() => block.download()}\n          >\n            ${DownloadIcon}\n          </editor-icon-button>\n        `,\n\n    readonly\n      ? nothing\n      : html`\n          <editor-icon-button\n            aria-label=\"Caption\"\n            .tooltip=${'Caption'}\n            @click=${() => block.captionEditor?.show()}\n          >\n            ${CaptionIcon}\n          </editor-icon-button>\n        `,\n\n    html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n            ${MoreVerticalIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"large\" data-orientation=\"vertical\">\n          ${moreMenuActions}\n        </div>\n      </editor-menu-button>\n    `,\n  ];\n\n  return html`\n    <style>\n      ${styles}\n    </style>\n    <editor-toolbar class=\"affine-attachment-toolbar\">\n      ${join(\n        buttons.filter(button => button !== nothing),\n        renderToolbarSeparator\n      )}\n    </editor-toolbar>\n  `;\n}\n"]}