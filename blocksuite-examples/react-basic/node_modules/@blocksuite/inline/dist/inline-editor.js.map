{"version":3,"file":"inline-editor.js","sourceRoot":"","sources":["../src/inline-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { signal, type Signal } from '@preact/signals-core';\n/* eslint-disable @stylistic/ts/lines-between-class-members */\n/* eslint-disable perfectionist/sort-classes */\nimport type * as Y from 'yjs';\n\nimport { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport { assertExists, DisposableGroup, Slot } from '@blocksuite/global/utils';\nimport { nothing, render, type TemplateResult } from 'lit';\n\nimport type { VLine } from './components/v-line.js';\nimport type { DeltaInsert, InlineRange } from './types.js';\n\nimport { INLINE_ROOT_ATTR } from './consts.js';\nimport { InlineHookService } from './services/hook.js';\nimport {\n  AttributeService,\n  DeltaService,\n  EventService,\n  RangeService,\n} from './services/index.js';\nimport { RenderService } from './services/render.js';\nimport { InlineTextService } from './services/text.js';\nimport {\n  type BaseTextAttributes,\n  nativePointToTextPoint,\n  textPointToDomPoint,\n} from './utils/index.js';\nimport { getTextNodesFromElement } from './utils/text.js';\n\nexport type InlineRootElement<\n  T extends BaseTextAttributes = BaseTextAttributes,\n> = HTMLElement & {\n  inlineEditor: InlineEditor<T>;\n};\n\nexport interface InlineRangeProvider {\n  inlineRange$: Signal<InlineRange | null>;\n  setInlineRange(inlineRange: InlineRange | null): void;\n}\n\nexport class InlineEditor<\n  TextAttributes extends BaseTextAttributes = BaseTextAttributes,\n> {\n  static getTextNodesFromElement = getTextNodesFromElement;\n\n  static nativePointToTextPoint = nativePointToTextPoint;\n\n  static textPointToDomPoint = textPointToDomPoint;\n\n  readonly disposables = new DisposableGroup();\n\n  readonly attributeService: AttributeService<TextAttributes> =\n    new AttributeService<TextAttributes>(this);\n  getFormat = this.attributeService.getFormat;\n  normalizeAttributes = this.attributeService.normalizeAttributes;\n  resetMarks = this.attributeService.resetMarks;\n  setAttributeRenderer = this.attributeService.setAttributeRenderer;\n  setAttributeSchema = this.attributeService.setAttributeSchema;\n  setMarks = this.attributeService.setMarks;\n  get marks() {\n    return this.attributeService.marks;\n  }\n\n  readonly textService: InlineTextService<TextAttributes> =\n    new InlineTextService<TextAttributes>(this);\n  deleteText = this.textService.deleteText;\n  formatText = this.textService.formatText;\n  insertLineBreak = this.textService.insertLineBreak;\n  insertText = this.textService.insertText;\n  resetText = this.textService.resetText;\n  setText = this.textService.setText;\n\n  readonly deltaService: DeltaService<TextAttributes> =\n    new DeltaService<TextAttributes>(this);\n  getDeltaByRangeIndex = this.deltaService.getDeltaByRangeIndex;\n  getDeltasByInlineRange = this.deltaService.getDeltasByInlineRange;\n  mapDeltasInInlineRange = this.deltaService.mapDeltasInInlineRange;\n  get embedDeltas() {\n    return this.deltaService.embedDeltas;\n  }\n\n  readonly rangeService: RangeService<TextAttributes> =\n    new RangeService<TextAttributes>(this);\n  focusEnd = this.rangeService.focusEnd;\n  focusIndex = this.rangeService.focusIndex;\n  focusStart = this.rangeService.focusStart;\n  getInlineRangeFromElement = this.rangeService.getInlineRangeFromElement;\n  isFirstLine = this.rangeService.isFirstLine;\n  isLastLine = this.rangeService.isLastLine;\n  isValidInlineRange = this.rangeService.isValidInlineRange;\n  selectAll = this.rangeService.selectAll;\n  syncInlineRange = this.rangeService.syncInlineRange;\n  toDomRange = this.rangeService.toDomRange;\n  toInlineRange = this.rangeService.toInlineRange;\n  getLine = this.rangeService.getLine;\n  getNativeRange = this.rangeService.getNativeRange;\n  getNativeSelection = this.rangeService.getNativeSelection;\n  getTextPoint = this.rangeService.getTextPoint;\n  get lastStartRelativePosition() {\n    return this.rangeService.lastStartRelativePosition;\n  }\n  get lastEndRelativePosition() {\n    return this.rangeService.lastEndRelativePosition;\n  }\n\n  readonly eventService: EventService<TextAttributes> =\n    new EventService<TextAttributes>(this);\n  get isComposing() {\n    return this.eventService.isComposing;\n  }\n\n  readonly renderService: RenderService<TextAttributes> =\n    new RenderService<TextAttributes>(this);\n  waitForUpdate = this.renderService.waitForUpdate;\n  rerenderWholeEditor = this.renderService.rerenderWholeEditor;\n  render = this.renderService.render;\n  get rendering() {\n    return this.renderService.rendering;\n  }\n\n  readonly hooksService: InlineHookService<TextAttributes>;\n  get hooks() {\n    return this.hooksService.hooks;\n  }\n\n  private _eventSource: HTMLElement | null = null;\n  get eventSource() {\n    return this._eventSource;\n  }\n\n  private _isReadonly = false;\n  get isReadonly() {\n    return this._isReadonly;\n  }\n\n  private _mounted = false;\n  get mounted() {\n    return this._mounted;\n  }\n\n  private _rootElement: InlineRootElement<TextAttributes> | null = null;\n  get rootElement() {\n    assertExists(this._rootElement);\n    return this._rootElement;\n  }\n\n  private _inlineRangeProviderOverride = false;\n  get inlineRangeProviderOverride() {\n    return this._inlineRangeProviderOverride;\n  }\n  readonly inlineRangeProvider: InlineRangeProvider = {\n    inlineRange$: signal(null),\n    setInlineRange: inlineRange => {\n      this.inlineRange$.value = inlineRange;\n    },\n  };\n  get inlineRange$() {\n    return this.inlineRangeProvider.inlineRange$;\n  }\n  setInlineRange = (inlineRange: InlineRange | null) => {\n    this.inlineRangeProvider.setInlineRange(inlineRange);\n  };\n  getInlineRange = () => {\n    return this.inlineRange$.peek();\n  };\n\n  readonly slots = {\n    mounted: new Slot(),\n    unmounted: new Slot(),\n    renderComplete: new Slot(),\n    textChange: new Slot(),\n    inlineRangeSync: new Slot<Range | null>(),\n    /**\n     * Corresponding to the `compositionUpdate` and `beforeInput` events, and triggered only when the `inlineRange` is not null.\n     */\n    inputting: new Slot(),\n    /**\n     * Triggered only when the `inlineRange` is not null.\n     */\n    keydown: new Slot<KeyboardEvent>(),\n  };\n\n  readonly vLineRenderer: ((vLine: VLine) => TemplateResult) | null;\n\n  readonly yText: Y.Text;\n  get yTextDeltas() {\n    return this.yText.toDelta();\n  }\n  get yTextLength() {\n    return this.yText.length;\n  }\n  get yTextString() {\n    return this.yText.toString();\n  }\n\n  readonly isEmbed: (delta: DeltaInsert<TextAttributes>) => boolean;\n\n  constructor(\n    yText: InlineEditor['yText'],\n    ops: {\n      isEmbed?: (delta: DeltaInsert<TextAttributes>) => boolean;\n      hooks?: InlineHookService<TextAttributes>['hooks'];\n      inlineRangeProvider?: InlineRangeProvider;\n      vLineRenderer?: (vLine: VLine) => TemplateResult;\n    } = {}\n  ) {\n    if (!yText.doc) {\n      throw new BlockSuiteError(\n        ErrorCode.InlineEditorError,\n        'yText must be attached to a Y.Doc'\n      );\n    }\n\n    if (yText.toString().includes('\\r')) {\n      throw new BlockSuiteError(\n        ErrorCode.InlineEditorError,\n        'yText must not contain \"\\\\r\" because it will break the range synchronization'\n      );\n    }\n\n    const {\n      isEmbed = () => false,\n      hooks = {},\n      inlineRangeProvider,\n      vLineRenderer = null,\n    } = ops;\n    this.yText = yText;\n    this.isEmbed = isEmbed;\n    this.vLineRenderer = vLineRenderer;\n    this.hooksService = new InlineHookService(this, hooks);\n    if (inlineRangeProvider) {\n      this.inlineRangeProvider = inlineRangeProvider;\n      this._inlineRangeProviderOverride = true;\n    }\n  }\n\n  mount(\n    rootElement: HTMLElement,\n    eventSource: HTMLElement = rootElement,\n    isReadonly = false\n  ) {\n    const inlineRoot = rootElement as InlineRootElement<TextAttributes>;\n    inlineRoot.inlineEditor = this;\n    this._rootElement = inlineRoot;\n    this._eventSource = eventSource;\n    this._eventSource.style.outline = 'none';\n    this._rootElement.dataset.vRoot = 'true';\n    this.setReadonly(isReadonly);\n\n    this.rootElement.replaceChildren();\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    delete (this.rootElement as any)['_$litPart$'];\n\n    this.eventService.mount();\n    this.rangeService.mount();\n    this.renderService.mount();\n\n    this._mounted = true;\n    this.slots.mounted.emit();\n\n    this.render();\n  }\n\n  unmount() {\n    if (this.rootElement.isConnected) {\n      render(nothing, this.rootElement);\n    }\n    this.rootElement.removeAttribute(INLINE_ROOT_ATTR);\n    this._rootElement = null;\n    this._mounted = false;\n    this.disposables.dispose();\n    this.slots.unmounted.emit();\n  }\n\n  setReadonly(isReadonly: boolean): void {\n    const value = isReadonly ? 'false' : 'true';\n\n    if (this.rootElement.contentEditable !== value) {\n      this.rootElement.contentEditable = value;\n    }\n\n    if (this.eventSource && this.eventSource.contentEditable !== value) {\n      this.eventSource.contentEditable = value;\n    }\n\n    this._isReadonly = isReadonly;\n  }\n\n  transact(fn: () => void): void {\n    const doc = this.yText.doc;\n    if (!doc) {\n      throw new BlockSuiteError(\n        ErrorCode.InlineEditorError,\n        'yText is not attached to a doc'\n      );\n    }\n\n    doc.transact(fn, doc.clientID);\n  }\n}\n"]}